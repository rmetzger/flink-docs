<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Apache Flink 1.1-SNAPSHOT Documentation: Storm Compatibility</title>
    <link rel="shortcut icon" href="/page/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/page/favicon.ico" type="image/x-icon">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="/page/css/flink.css">
    <link rel="stylesheet" href="/page/css/syntax.css">
    <link rel="stylesheet" href="/page/css/codetabs.css">
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    
    





    <!-- Top navbar. -->
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <!-- The logo. -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <div class="navbar-logo">
            <a href="http://flink.apache.org"><img alt="Apache Flink" src="/page/img/navbar-brand-logo.jpg"></a>
          </div>
        </div><!-- /.navbar-header -->

        <!-- The navigation links. -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav">
            <li class="hidden-sm "><a href="/">Docs v1.1</a></li>

            <li class=""><a href="/concepts/concepts.html">Concepts</a></li>

            <!-- Setup -->
            <li class="dropdown">
              <a href="/setup" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Setup <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                
                
                <li class=""><a href="/setup/building.html">Build Flink from Source</a></li>
                
                <li class=""><a href="/setup/config.html">Configuration</a></li>
                

                <li class="divider"></li>
                <li role="presentation" class="dropdown-header"><strong>Quickstart</strong></li>

                <!-- Quickstart -->
                
                
                <li class=""><a href="/quickstart/setup_quickstart.html">Setup & Run Example</a></li>
                
                <li class=""><a href="/quickstart/java_api_quickstart.html">Java API</a></li>
                
                <li class=""><a href="/quickstart/scala_api_quickstart.html">Scala API</a></li>
                

                <li class="divider"></li>
                <li role="presentation" class="dropdown-header"><strong>Deployment</strong></li>
                
                
                <li class=""><a href="/setup/local_setup.html">Local</a></li>
                
                <li class=""><a href="/setup/cluster_setup.html">Cluster (Standalone)</a></li>
                
                <li class=""><a href="/setup/yarn_setup.html">YARN</a></li>
                
                <li class=""><a href="/setup/gce_setup.html">Google Compute Engine</a></li>
                
                <li class=""><a href="/setup/aws.html">AWS</a></li>
                
                <li class=""><a href="/setup/jobmanager_high_availability.html">High Availability</a></li>
                
              </ul>
            </li>

            <!-- Programming Guides -->
            <li class="dropdown active">
              <a href="/apis" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Programming Guides <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                
                
                <li class=""><a href="/apis/common/index.html"><strong>Basic API Concepts</strong></a></li>
                
                <li class=""><a href="/apis/streaming/index.html"><strong>Streaming Guide</strong> (DataStream API)</a></li>
                
                <li class=""><a href="/apis/batch/index.html"><strong>Batch Guide</strong> (DataSet API)</a></li>
                
                <li class=""><a href="/apis/best_practices.html">Best Practices</a></li>
                
                <li class=""><a href="/apis/table.html">Table API and SQL</a></li>
                
                <li class=""><a href="/apis/cli.html">Command-Line Interface</a></li>
                
                <li class=""><a href="/apis/local_execution.html">Local Execution</a></li>
                
                <li class=""><a href="/apis/cluster_execution.html">Cluster Execution</a></li>
                
                <li class=""><a href="/apis/scala_shell.html">Scala Shell</a></li>
                
                <li class=""><a href="/apis/scala_api_extensions.html">Scala API Extensions</a></li>
                
                <li class=""><a href="/apis/java8.html">Java 8</a></li>
                
              </ul>
            </li>

            <!-- Libraries -->
            <li class="dropdown">
              <a href="/libs" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Libraries <span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                  
                  
                  <li class=""><a href="/apis/batch/libs/gelly.html">Graphs: Gelly</a></li>
                  
                  <li class=""><a href="/apis/streaming/libs/cep.html">CEP</a></li>
                  
                  <li class=""><a href="/apis/batch/libs/ml/index.html">Machine Learning</a></li>
                  
              </ul>
            </li>

            <!-- Internals -->
            <li class="dropdown">
              <a href="/internals" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Internals <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                <li role="presentation" class="dropdown-header"><strong>Contribute</strong></li>
                <li><a href="http://flink.apache.org/how-to-contribute.html"><small><span class="glyphicon glyphicon-new-window"></span></small> How to Contribute</a></li>
                <li><a href="http://flink.apache.org/contribute-code.html#coding-guidelines"><small><span class="glyphicon glyphicon-new-window"></span></small> Coding Guidelines</a></li>
                
                
                <li class=""><a href="/internals/ide_setup.html">IDE Setup</a></li>
                
                <li class=""><a href="/internals/logging.html">Logging</a></li>
                
                <li class=""><a href="/internals/general_arch.html">Architecture and Process Model</a></li>
                
                <li class=""><a href="/internals/stream_checkpointing.html">Fault Tolerance for Data Streaming</a></li>
                
                <li class=""><a href="/internals/types_serialization.html">Type Extraction and Serialization</a></li>
                
                <li class=""><a href="/internals/monitoring_rest_api.html">Monitoring REST API</a></li>
                
                <li class=""><a href="/internals/job_scheduling.html">Jobs and Scheduling</a></li>
                
                <li class=""><a href="/internals/add_operator.html">How-To: Add an Operator</a></li>
                
                <li class=""><a href="/internals/back_pressure_monitoring.html">Back Pressure Monitoring</a></li>
                
              </ul>
            </li>
          </ul>
          <form class="navbar-form navbar-right hidden-sm hidden-md" role="search" action="/search-results.html">
            <div class="form-group">
              <input type="text" class="form-control" size="16px" name="q" placeholder="Search all pages">
            </div>
            <button type="submit" class="btn btn-default">Search</button>
          </form>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container -->
    </nav>


    

    <!-- Main content. -->
    <div class="container">
      
      
<div class="row">


  <!-- Sub Navigation -->
  <div class="col-sm-3">
    <ul id="sub-nav">
      
      
      
        
        
        
        <li><a href="/apis/streaming/index.html" class="">DataStream API</a>
          
        </li>
      
        
        
        
        <li><a href="/quickstart/run_example_quickstart.html" class="">Example: Wikipedia Edits</a>
          
        </li>
      
        
        
        
        <li><a href="/apis/streaming/event_time.html" class="">Event Time</a>
          
          <ul>
            
              <li><a href="/apis/streaming/event_timestamp_extractors.html" class="">Pre-defined Timestamp Extractors / Watermark Emitters</a></li>
            
              <li><a href="/apis/streaming/event_timestamps_watermarks.html" class="">Generating Timestamps / Watermarks</a></li>
            
          </ul>
          
        </li>
      
        
        
        
        <li><a href="/apis/streaming/windows.html" class="">Windows</a>
          
        </li>
      
        
        
        
        <li><a href="/apis/streaming/fault_tolerance.html" class="">Fault Tolerance</a>
          
          <ul>
            
              <li><a href="/apis/streaming/state.html" class="">Working with State</a></li>
            
              <li><a href="/apis/streaming/state_backends.html" class="">State Backends</a></li>
            
          </ul>
          
        </li>
      
        
        
        
        <li><a href="/apis/streaming/connectors/index.html" class="">Connectors</a>
          
          <ul>
            
              <li><a href="/apis/streaming/connectors/kafka.html" class="">Kafka</a></li>
            
              <li><a href="/apis/streaming/connectors/elasticsearch.html" class="">Elasticsearch</a></li>
            
              <li><a href="/apis/streaming/connectors/elasticsearch2.html" class="">Elasticsearch 2.x</a></li>
            
              <li><a href="/apis/streaming/connectors/filesystem_sink.html" class="">Filesystem Sink</a></li>
            
              <li><a href="/apis/streaming/connectors/rabbitmq.html" class="">RabbitMQ</a></li>
            
              <li><a href="/apis/streaming/connectors/kinesis.html" class="">Amazon Kinesis Streams</a></li>
            
              <li><a href="/apis/streaming/connectors/twitter.html" class="">Twitter</a></li>
            
          </ul>
          
        </li>
      
        
        
        
        <li><a href="/apis/streaming/savepoints.html" class="">Savepoints</a>
          
        </li>
      
        
        
        
        <li><a href="/apis/streaming/libs/index.html" class="">Libraries</a>
          
          <ul>
            
              <li><a href="/apis/streaming/libs/cep.html" class="">Event Processing (CEP)</a></li>
            
          </ul>
          
        </li>
      
        
        
        
        <li><a href="/apis/streaming/storm_compatibility.html" class="active">Storm Compatibility</a>
          
        </li>
      
    </ul>
  </div>
  <!-- Main -->
  <div class="col-sm-9">
    <!-- Top anchor -->
    <a href="#top"></a>

    <!-- Artifact name change warning. Remove for the 1.0 release. -->
    <div class="panel panel-default">
      <div class="panel-body"><strong>Important</strong>: Maven artifacts which depend on Scala are now suffixed with the Scala major version, e.g. "2.10" or "2.11". Please consult the <a href="https://cwiki.apache.org/confluence/display/FLINK/Maven+artifact+names+suffixed+with+Scala+version">migration guide on the project Wiki</a>.</div>
    </div>

    <!-- Breadcrumbs above the main heading -->
    <ol class="breadcrumb">
      
      
      <li><a href="/apis/streaming/index.html">Streaming Guide</a></li>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      

      
      <li class="active">Storm Compatibility</li>
    </ol>

    <div class="text">
      <!-- Main heading -->
      <h1>Storm Compatibility <span class="beta">(Beta)</span></h1>

      <!-- Content -->
      

<p><a href="index.html">Flink streaming</a> is compatible with Apache Storm interfaces and therefore allows
reusing code that was implemented for Storm.</p>

<p>You can:</p>

<ul>
  <li>execute a whole Storm <code>Topology</code> in Flink.</li>
  <li>use Storm <code>Spout</code>/<code>Bolt</code> as source/operator in Flink streaming programs.</li>
</ul>

<p>This document shows how to use existing Storm code with Flink.</p>

<ul id="markdown-toc">
  <li><a href="#project-configuration" id="markdown-toc-project-configuration">Project Configuration</a></li>
  <li><a href="#execute-storm-topologies" id="markdown-toc-execute-storm-topologies">Execute Storm Topologies</a></li>
  <li><a href="#embed-storm-operators-in-flink-streaming-programs" id="markdown-toc-embed-storm-operators-in-flink-streaming-programs">Embed Storm Operators in Flink Streaming Programs</a>    <ul>
      <li><a href="#embed-spouts" id="markdown-toc-embed-spouts">Embed Spouts</a></li>
      <li><a href="#embed-bolts" id="markdown-toc-embed-bolts">Embed Bolts</a>        <ul>
          <li><a href="#named-attribute-access-for-embedded-bolts" id="markdown-toc-named-attribute-access-for-embedded-bolts">Named Attribute Access for Embedded Bolts</a></li>
        </ul>
      </li>
      <li><a href="#configuring-spouts-and-bolts" id="markdown-toc-configuring-spouts-and-bolts">Configuring Spouts and Bolts</a></li>
      <li><a href="#multiple-output-streams" id="markdown-toc-multiple-output-streams">Multiple Output Streams</a></li>
    </ul>
  </li>
  <li><a href="#flink-extensions" id="markdown-toc-flink-extensions">Flink Extensions</a>    <ul>
      <li><a href="#finite-spouts" id="markdown-toc-finite-spouts">Finite Spouts</a></li>
    </ul>
  </li>
  <li><a href="#storm-compatibility-examples" id="markdown-toc-storm-compatibility-examples">Storm Compatibility Examples</a></li>
</ul>

<h1 id="project-configuration">Project Configuration</h1>

<p>Support for Storm is contained in the <code>flink-storm</code> Maven module.
The code resides in the <code>org.apache.flink.storm</code> package.</p>

<p>Add the following dependency to your <code>pom.xml</code> if you want to execute Storm code in Flink.</p>

<div class="highlight"><pre><code class="language-xml"><span class="nt">&lt;dependency&gt;</span>
	<span class="nt">&lt;groupId&gt;</span>org.apache.flink<span class="nt">&lt;/groupId&gt;</span>
	<span class="nt">&lt;artifactId&gt;</span>flink-storm_2.10<span class="nt">&lt;/artifactId&gt;</span>
	<span class="nt">&lt;version&gt;</span>1.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></div>

<p><strong>Please note</strong>: Do not add <code>storm-core</code> as a dependency. It is already included via <code>flink-storm</code>.</p>

<p><strong>Please note</strong>: <code>flink-storm</code> is not part of the provided binary Flink distribution.
Thus, you need to include <code>flink-storm</code> classes (and their dependencies) in your program jar (also called ueber-jar or fat-jar) that is submitted to Flink’s JobManager.
See <em>WordCount Storm</em> within <code>flink-storm-examples/pom.xml</code> for an example how to package a jar correctly.</p>

<p>If you want to avoid large ueber-jars, you can manually copy <code>storm-core-0.9.4.jar</code>, <code>json-simple-1.1.jar</code> and <code>flink-storm-1.1-SNAPSHOT.jar</code> into Flink’s <code>lib/</code> folder of each cluster node (<em>before</em> the cluster is started).
For this case, it is sufficient to include only your own Spout and Bolt classes (and their internal dependencies) into the program jar.</p>

<h1 id="execute-storm-topologies">Execute Storm Topologies</h1>

<p>Flink provides a Storm compatible API (<code>org.apache.flink.storm.api</code>) that offers replacements for the following classes:</p>

<ul>
  <li><code>StormSubmitter</code> replaced by <code>FlinkSubmitter</code></li>
  <li><code>NimbusClient</code> and <code>Client</code> replaced by <code>FlinkClient</code></li>
  <li><code>LocalCluster</code> replaced by <code>FlinkLocalCluster</code></li>
</ul>

<p>In order to submit a Storm topology to Flink, it is sufficient to replace the used Storm classes with their Flink replacements in the Storm <em>client code that assembles</em> the topology.
The actual runtime code, ie, Spouts and Bolts, can be used <em>unmodified</em>.
If a topology is executed in a remote cluster, parameters <code>nimbus.host</code> and <code>nimbus.thrift.port</code> are used as <code>jobmanger.rpc.address</code> and <code>jobmanger.rpc.port</code>, respectively.  If a parameter is not specified, the value is taken from <code>flink-conf.yaml</code>.</p>

<div class="codetabs">
  <div data-lang="java">
    <div class="highlight"><pre><code class="language-java"><span class="n">TopologyBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">TopologyBuilder</span><span class="o">();</span> <span class="c1">// the Storm topology builder</span>

<span class="c1">// actual topology assembling code and used Spouts/Bolts can be used as-is</span>
<span class="n">builder</span><span class="o">.</span><span class="na">setSpout</span><span class="o">(</span><span class="s">&quot;source&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="nf">FileSpout</span><span class="o">(</span><span class="n">inputFilePath</span><span class="o">));</span>
<span class="n">builder</span><span class="o">.</span><span class="na">setBolt</span><span class="o">(</span><span class="s">&quot;tokenizer&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="nf">BoltTokenizer</span><span class="o">()).</span><span class="na">shuffleGrouping</span><span class="o">(</span><span class="s">&quot;source&quot;</span><span class="o">);</span>
<span class="n">builder</span><span class="o">.</span><span class="na">setBolt</span><span class="o">(</span><span class="s">&quot;counter&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="nf">BoltCounter</span><span class="o">()).</span><span class="na">fieldsGrouping</span><span class="o">(</span><span class="s">&quot;tokenizer&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="nf">Fields</span><span class="o">(</span><span class="s">&quot;word&quot;</span><span class="o">));</span>
<span class="n">builder</span><span class="o">.</span><span class="na">setBolt</span><span class="o">(</span><span class="s">&quot;sink&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="nf">BoltFileSink</span><span class="o">(</span><span class="n">outputFilePath</span><span class="o">)).</span><span class="na">shuffleGrouping</span><span class="o">(</span><span class="s">&quot;counter&quot;</span><span class="o">);</span>

<span class="n">Config</span> <span class="n">conf</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Config</span><span class="o">();</span>
<span class="k">if</span><span class="o">(</span><span class="n">runLocal</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// submit to test cluster</span>
	<span class="c1">// replaces: LocalCluster cluster = new LocalCluster();</span>
	<span class="n">FlinkLocalCluster</span> <span class="n">cluster</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">FlinkLocalCluster</span><span class="o">();</span>
	<span class="n">cluster</span><span class="o">.</span><span class="na">submitTopology</span><span class="o">(</span><span class="s">&quot;WordCount&quot;</span><span class="o">,</span> <span class="n">conf</span><span class="o">,</span> <span class="n">FlinkTopology</span><span class="o">.</span><span class="na">createTopology</span><span class="o">(</span><span class="n">builder</span><span class="o">));</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span> <span class="c1">// submit to remote cluster</span>
	<span class="c1">// optional</span>
	<span class="c1">// conf.put(Config.NIMBUS_HOST, &quot;remoteHost&quot;);</span>
	<span class="c1">// conf.put(Config.NIMBUS_THRIFT_PORT, 6123);</span>
	<span class="c1">// replaces: StormSubmitter.submitTopology(topologyId, conf, builder.createTopology());</span>
	<span class="n">FlinkSubmitter</span><span class="o">.</span><span class="na">submitTopology</span><span class="o">(</span><span class="s">&quot;WordCount&quot;</span><span class="o">,</span> <span class="n">conf</span><span class="o">,</span> <span class="n">FlinkTopology</span><span class="o">.</span><span class="na">createTopology</span><span class="o">(</span><span class="n">builder</span><span class="o">));</span>
<span class="o">}</span></code></pre></div>
  </div>
</div>

<h1 id="embed-storm-operators-in-flink-streaming-programs">Embed Storm Operators in Flink Streaming Programs</h1>

<p>As an alternative, Spouts and Bolts can be embedded into regular streaming programs.
The Storm compatibility layer offers a wrapper classes for each, namely <code>SpoutWrapper</code> and <code>BoltWrapper</code> (<code>org.apache.flink.storm.wrappers</code>).</p>

<p>Per default, both wrappers convert Storm output tuples to Flink’s <a href="/apis/batch/index.html#tuples-and-case-classes">Tuple</a> types (ie, <code>Tuple0</code> to <code>Tuple25</code> according to the number of fields of the Storm tuples).
For single field output tuples a conversion to the field’s data type is also possible (eg, <code>String</code> instead of <code>Tuple1&lt;String&gt;</code>).</p>

<p>Because Flink cannot infer the output field types of Storm operators, it is required to specify the output type manually.
In order to get the correct <code>TypeInformation</code> object, Flink’s <code>TypeExtractor</code> can be used.</p>

<h2 id="embed-spouts">Embed Spouts</h2>

<p>In order to use a Spout as Flink source, use <code>StreamExecutionEnvironment.addSource(SourceFunction, TypeInformation)</code>.
The Spout object is handed to the constructor of <code>SpoutWrapper&lt;OUT&gt;</code> that serves as first argument to <code>addSource(...)</code>.
The generic type declaration <code>OUT</code> specifies the type of the source output stream.</p>

<div class="codetabs">
  <div data-lang="java">
    <div class="highlight"><pre><code class="language-java"><span class="n">StreamExecutionEnvironment</span> <span class="n">env</span> <span class="o">=</span> <span class="n">StreamExecutionEnvironment</span><span class="o">.</span><span class="na">getExecutionEnvironment</span><span class="o">();</span>

<span class="c1">// stream has `raw` type (single field output streams only)</span>
<span class="n">DataStream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">rawInput</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="na">addSource</span><span class="o">(</span>
	<span class="k">new</span> <span class="n">SpoutWrapper</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(</span><span class="k">new</span> <span class="nf">FileSpout</span><span class="o">(</span><span class="n">localFilePath</span><span class="o">),</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]</span> <span class="o">{</span> <span class="n">Utils</span><span class="o">.</span><span class="na">DEFAULT_STREAM_ID</span> <span class="o">}),</span> <span class="c1">// emit default output stream as raw type</span>
	<span class="n">TypeExtractor</span><span class="o">.</span><span class="na">getForClass</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">));</span> <span class="c1">// output type</span>

<span class="c1">// process data stream</span>
<span class="o">[...]</span></code></pre></div>
  </div>
</div>

<p>If a Spout emits a finite number of tuples, <code>SpoutWrapper</code> can be configures to terminate automatically by setting <code>numberOfInvocations</code> parameter in its constructor.
This allows the Flink program to shut down automatically after all data is processed.
Per default the program will run until it is <a href="/apis/cli.html">canceled</a> manually.</p>

<h2 id="embed-bolts">Embed Bolts</h2>

<p>In order to use a Bolt as Flink operator, use <code>DataStream.transform(String, TypeInformation, OneInputStreamOperator)</code>.
The Bolt object is handed to the constructor of <code>BoltWrapper&lt;IN,OUT&gt;</code> that serves as last argument to <code>transform(...)</code>.
The generic type declarations <code>IN</code> and <code>OUT</code> specify the type of the operator’s input and output stream, respectively.</p>

<div class="codetabs">
  <div data-lang="java">
    <div class="highlight"><pre><code class="language-java"><span class="n">StreamExecutionEnvironment</span> <span class="n">env</span> <span class="o">=</span> <span class="n">StreamExecutionEnvironment</span><span class="o">.</span><span class="na">getExecutionEnvironment</span><span class="o">();</span>
<span class="n">DataStream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">text</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="na">readTextFile</span><span class="o">(</span><span class="n">localFilePath</span><span class="o">);</span>

<span class="n">DataStream</span><span class="o">&lt;</span><span class="n">Tuple2</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span>
	<span class="s">&quot;tokenizer&quot;</span><span class="o">,</span> <span class="c1">// operator name</span>
	<span class="n">TypeExtractor</span><span class="o">.</span><span class="na">getForObject</span><span class="o">(</span><span class="k">new</span> <span class="n">Tuple2</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;(</span><span class="s">&quot;&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">)),</span> <span class="c1">// output type</span>
	<span class="k">new</span> <span class="n">BoltWrapper</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Tuple2</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;&gt;(</span><span class="k">new</span> <span class="nf">BoltTokenizer</span><span class="o">()));</span> <span class="c1">// Bolt operator</span>

<span class="c1">// do further processing</span>
<span class="o">[...]</span></code></pre></div>
  </div>
</div>

<h3 id="named-attribute-access-for-embedded-bolts">Named Attribute Access for Embedded Bolts</h3>

<p>Bolts can accesses input tuple fields via name (additionally to access via index).
To use this feature with embedded Bolts, you need to have either a</p>

<ol>
  <li><a href="/apis/batch/index.html#pojos">POJO</a> type input stream or</li>
  <li><a href="/apis/batch/index.html#tuples-and-case-classes">Tuple</a> type input stream and specify the input schema (i.e. name-to-index-mapping)</li>
</ol>

<p>For POJO input types, Flink accesses the fields via reflection.
For this case, Flink expects either a corresponding public member variable or public getter method.
For example, if a Bolt accesses a field via name <code>sentence</code> (eg, <code>String s = input.getStringByField("sentence");</code>), the input POJO class must have a member variable <code>public String sentence;</code> or method <code>public String getSentence() { ... };</code> (pay attention to camel-case naming).</p>

<p>For <code>Tuple</code> input types, it is required to specify the input schema using Storm’s <code>Fields</code> class.
For this case, the constructor of <code>BoltWrapper</code> takes an additional argument: <code>new BoltWrapper&lt;Tuple1&lt;String&gt;, ...&gt;(..., new Fields("sentence"))</code>.
The input type is <code>Tuple1&lt;String&gt;</code> and <code>Fields("sentence")</code> specify that <code>input.getStringByField("sentence")</code> is equivalent to <code>input.getString(0)</code>.</p>

<p>See <a href="https://github.com/apache/flink/tree/master/flink-contrib/flink-storm-examples/src/main/java/org/apache/flink/storm/wordcount/BoltTokenizerWordCountPojo.java">BoltTokenizerWordCountPojo</a> and <a href="https://github.com/apache/flink/tree/master/flink-contrib/flink-storm-examples/src/main/java/org/apache/flink/storm/wordcount/BoltTokenizerWordCountWithNames.java">BoltTokenizerWordCountWithNames</a> for examples.</p>

<h2 id="configuring-spouts-and-bolts">Configuring Spouts and Bolts</h2>

<p>In Storm, Spouts and Bolts can be configured with a globally distributed <code>Map</code> object that is given to <code>submitTopology(...)</code> method of <code>LocalCluster</code> or <code>StormSubmitter</code>.
This <code>Map</code> is provided by the user next to the topology and gets forwarded as a parameter to the calls <code>Spout.open(...)</code> and <code>Bolt.prepare(...)</code>.
If a whole topology is executed in Flink using <code>FlinkTopologyBuilder</code> etc., there is no special attention required – it works as in regular Storm.</p>

<p>For embedded usage, Flink’s configuration mechanism must be used.
A global configuration can be set in a <code>StreamExecutionEnvironment</code> via <code>.getConfig().setGlobalJobParameters(...)</code>.
Flink’s regular <code>Configuration</code> class can be used to configure Spouts and Bolts.
However, <code>Configuration</code> does not support arbitrary key data types as Storm does (only <code>String</code> keys are allowed).
Thus, Flink additionally provides <code>StormConfig</code> class that can be used like a raw <code>Map</code> to provide full compatibility to Storm.</p>

<div class="codetabs">
  <div data-lang="java">
    <div class="highlight"><pre><code class="language-java"><span class="n">StreamExecutionEnvironment</span> <span class="n">env</span> <span class="o">=</span> <span class="n">StreamExecutionEnvironment</span><span class="o">.</span><span class="na">getExecutionEnvironment</span><span class="o">();</span>

<span class="n">StormConfig</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">StormConfig</span><span class="o">();</span>
<span class="c1">// set config values</span>
<span class="o">[...]</span>

<span class="c1">// set global Storm configuration</span>
<span class="n">env</span><span class="o">.</span><span class="na">getConfig</span><span class="o">().</span><span class="na">setGlobalJobParameters</span><span class="o">(</span><span class="n">config</span><span class="o">);</span>

<span class="c1">// assemble program with embedded Spouts and/or Bolts</span>
<span class="o">[...]</span></code></pre></div>
  </div>
</div>

<h2 id="multiple-output-streams">Multiple Output Streams</h2>

<p>Flink can also handle the declaration of multiple output streams for Spouts and Bolts.
If a whole topology is executed in Flink using <code>FlinkTopologyBuilder</code> etc., there is no special attention required – it works as in regular Storm.</p>

<p>For embedded usage, the output stream will be of data type <code>SplitStreamType&lt;T&gt;</code> and must be split by using <code>DataStream.split(...)</code> and <code>SplitStream.select(...)</code>.
Flink provides the predefined output selector <code>StormStreamSelector&lt;T&gt;</code> for <code>.split(...)</code> already.
Furthermore, the wrapper type <code>SplitStreamTuple&lt;T&gt;</code> can be removed using <code>SplitStreamMapper&lt;T&gt;</code>.</p>

<div class="codetabs">
  <div data-lang="java">
    <div class="highlight"><pre><code class="language-java"><span class="o">[...]</span>

<span class="c1">// get DataStream from Spout or Bolt which declares two output streams s1 and s2 with output type SomeType</span>
<span class="n">DataStream</span><span class="o">&lt;</span><span class="n">SplitStreamType</span><span class="o">&lt;</span><span class="n">SomeType</span><span class="o">&gt;&gt;</span> <span class="n">multiStream</span> <span class="o">=</span> <span class="o">...</span>

<span class="n">SplitStream</span><span class="o">&lt;</span><span class="n">SplitStreamType</span><span class="o">&lt;</span><span class="n">SomeType</span><span class="o">&gt;&gt;</span> <span class="n">splitStream</span> <span class="o">=</span> <span class="n">multiStream</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="k">new</span> <span class="n">StormStreamSelector</span><span class="o">&lt;</span><span class="n">SomeType</span><span class="o">&gt;());</span>

<span class="c1">// remove SplitStreamType using SplitStreamMapper to get data stream of type SomeType</span>
<span class="n">DataStream</span><span class="o">&lt;</span><span class="n">SomeType</span><span class="o">&gt;</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">splitStream</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">&quot;s1&quot;</span><span class="o">).</span><span class="na">map</span><span class="o">(</span><span class="k">new</span> <span class="n">SplitStreamMapper</span><span class="o">&lt;</span><span class="n">SomeType</span><span class="o">&gt;()).</span><span class="na">returns</span><span class="o">(</span><span class="n">SomeType</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="n">DataStream</span><span class="o">&lt;</span><span class="n">SomeType</span><span class="o">&gt;</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">splitStream</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">&quot;s2&quot;</span><span class="o">).</span><span class="na">map</span><span class="o">(</span><span class="k">new</span> <span class="n">SplitStreamMapper</span><span class="o">&lt;</span><span class="n">SomeType</span><span class="o">&gt;()).</span><span class="na">returns</span><span class="o">(</span><span class="n">SomeType</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

<span class="c1">// do further processing on s1 and s2</span>
<span class="o">[...]</span></code></pre></div>
  </div>
</div>

<p>See <a href="https://github.com/apache/flink/tree/master/flink-contrib/flink-storm-examples/src/main/java/org/apache/flink/storm/split/SpoutSplitExample.java">SpoutSplitExample.java</a> for a full example.</p>

<h1 id="flink-extensions">Flink Extensions</h1>

<h2 id="finite-spouts">Finite Spouts</h2>

<p>In Flink, streaming sources can be finite, ie, emit a finite number of records and stop after emitting the last record. However, Spouts usually emit infinite streams.
The bridge between the two approaches is the <code>FiniteSpout</code> interface which, in addition to <code>IRichSpout</code>, contains a <code>reachedEnd()</code> method, where the user can specify a stopping-condition.
The user can create a finite Spout by implementing this interface instead of (or additionally to) <code>IRichSpout</code>, and implementing the <code>reachedEnd()</code> method in addition.
In contrast to a <code>SpoutWrapper</code> that is configured to emit a finite number of tuples, <code>FiniteSpout</code> interface allows to implement more complex termination criteria.</p>

<p>Although finite Spouts are not necessary to embed Spouts into a Flink streaming program or to submit a whole Storm topology to Flink, there are cases where they may come in handy:</p>

<ul>
  <li>to achieve that a native Spout behaves the same way as a finite Flink source with minimal modifications</li>
  <li>the user wants to process a stream only for some time; after that, the Spout can stop automatically</li>
  <li>reading a file into a stream</li>
  <li>for testing purposes</li>
</ul>

<p>An example of a finite Spout that emits records for 10 seconds only:</p>

<div class="codetabs">
  <div data-lang="java">
    <div class="highlight"><pre><code class="language-java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TimedFiniteSpout</span> <span class="kd">extends</span> <span class="n">BaseRichSpout</span> <span class="kd">implements</span> <span class="n">FiniteSpout</span> <span class="o">{</span>
	<span class="o">[...]</span> <span class="c1">// implement open(), nextTuple(), ...</span>

	<span class="kd">private</span> <span class="kt">long</span> <span class="n">starttime</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>

	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">reachedEnd</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">starttime</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="n">l</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></div>
  </div>
</div>

<h1 id="storm-compatibility-examples">Storm Compatibility Examples</h1>

<p>You can find more examples in Maven module <code>flink-storm-examples</code>.
For the different versions of WordCount, see <a href="https://github.com/apache/flink/tree/master/flink-contrib/flink-storm-examples/README.md">README.md</a>.
To run the examples, you need to assemble a correct jar file.
<code>flink-storm-examples-1.1-SNAPSHOT.jar</code> is <strong>no</strong> valid jar file for job execution (it is only a standard maven artifact).</p>

<p>There are example jars for embedded Spout and Bolt, namely <code>WordCount-SpoutSource.jar</code> and <code>WordCount-BoltTokenizer.jar</code>, respectively.
Compare <code>pom.xml</code> to see how both jars are built.
Furthermore, there is one example for whole Storm topologies (<code>WordCount-StormTopology.jar</code>).</p>

<p>You can run each of those examples via <code>bin/flink run &lt;jarname&gt;.jar</code>. The correct entry point class is contained in each jar’s manifest file.</p>

    </div>
  </div>

  
</div>

    </div><!-- /.container -->

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.1.0/anchor.min.js"></script>
    <script src="/page/js/flink.js"></script>

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-52545728-1', 'auto');
      ga('send', 'pageview');
    </script>

    <!-- Disqus -->
    
  </body>
</html>
