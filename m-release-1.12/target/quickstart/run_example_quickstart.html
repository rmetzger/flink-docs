<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Apache Flink 1.1-SNAPSHOT Documentation: Monitoring the Wikipedia Edit Stream</title>
    <link rel="shortcut icon" href="/page/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/page/favicon.ico" type="image/x-icon">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="/page/css/flink.css">
    <link rel="stylesheet" href="/page/css/syntax.css">
    <link rel="stylesheet" href="/page/css/codetabs.css">
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    
    





    <!-- Top navbar. -->
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <!-- The logo. -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <div class="navbar-logo">
            <a href="http://flink.apache.org"><img alt="Apache Flink" src="/page/img/navbar-brand-logo.jpg"></a>
          </div>
        </div><!-- /.navbar-header -->

        <!-- The navigation links. -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav">
            <li class="hidden-sm "><a href="/">Docs v1.1</a></li>

            <li class=""><a href="/concepts/concepts.html">Concepts</a></li>

            <!-- Setup -->
            <li class="dropdown">
              <a href="/setup" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Setup <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                
                
                <li class=""><a href="/setup/building.html">Build Flink from Source</a></li>
                
                <li class=""><a href="/setup/config.html">Configuration</a></li>
                

                <li class="divider"></li>
                <li role="presentation" class="dropdown-header"><strong>Quickstart</strong></li>

                <!-- Quickstart -->
                
                
                <li class=""><a href="/quickstart/setup_quickstart.html">Setup & Run Example</a></li>
                
                <li class=""><a href="/quickstart/java_api_quickstart.html">Java API</a></li>
                
                <li class=""><a href="/quickstart/scala_api_quickstart.html">Scala API</a></li>
                

                <li class="divider"></li>
                <li role="presentation" class="dropdown-header"><strong>Deployment</strong></li>
                
                
                <li class=""><a href="/setup/local_setup.html">Local</a></li>
                
                <li class=""><a href="/setup/cluster_setup.html">Cluster (Standalone)</a></li>
                
                <li class=""><a href="/setup/yarn_setup.html">YARN</a></li>
                
                <li class=""><a href="/setup/gce_setup.html">Google Compute Engine</a></li>
                
                <li class=""><a href="/setup/aws.html">AWS</a></li>
                
                <li class=""><a href="/setup/jobmanager_high_availability.html">High Availability</a></li>
                
              </ul>
            </li>

            <!-- Programming Guides -->
            <li class="dropdown">
              <a href="/apis" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Programming Guides <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                
                
                <li class=""><a href="/apis/common/index.html"><strong>Basic API Concepts</strong></a></li>
                
                <li class=""><a href="/apis/streaming/index.html"><strong>Streaming Guide</strong> (DataStream API)</a></li>
                
                <li class=""><a href="/apis/batch/index.html"><strong>Batch Guide</strong> (DataSet API)</a></li>
                
                <li class=""><a href="/apis/best_practices.html">Best Practices</a></li>
                
                <li class=""><a href="/apis/table.html">Table API and SQL</a></li>
                
                <li class=""><a href="/apis/cli.html">Command-Line Interface</a></li>
                
                <li class=""><a href="/apis/local_execution.html">Local Execution</a></li>
                
                <li class=""><a href="/apis/cluster_execution.html">Cluster Execution</a></li>
                
                <li class=""><a href="/apis/scala_shell.html">Scala Shell</a></li>
                
                <li class=""><a href="/apis/scala_api_extensions.html">Scala API Extensions</a></li>
                
                <li class=""><a href="/apis/java8.html">Java 8</a></li>
                
              </ul>
            </li>

            <!-- Libraries -->
            <li class="dropdown">
              <a href="/libs" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Libraries <span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                  
                  
                  <li class=""><a href="/apis/batch/libs/gelly.html">Graphs: Gelly</a></li>
                  
                  <li class=""><a href="/apis/streaming/libs/cep.html">CEP</a></li>
                  
                  <li class=""><a href="/apis/batch/libs/ml/index.html">Machine Learning</a></li>
                  
              </ul>
            </li>

            <!-- Internals -->
            <li class="dropdown">
              <a href="/internals" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Internals <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                <li role="presentation" class="dropdown-header"><strong>Contribute</strong></li>
                <li><a href="http://flink.apache.org/how-to-contribute.html"><small><span class="glyphicon glyphicon-new-window"></span></small> How to Contribute</a></li>
                <li><a href="http://flink.apache.org/contribute-code.html#coding-guidelines"><small><span class="glyphicon glyphicon-new-window"></span></small> Coding Guidelines</a></li>
                
                
                <li class=""><a href="/internals/ide_setup.html">IDE Setup</a></li>
                
                <li class=""><a href="/internals/logging.html">Logging</a></li>
                
                <li class=""><a href="/internals/general_arch.html">Architecture and Process Model</a></li>
                
                <li class=""><a href="/internals/stream_checkpointing.html">Fault Tolerance for Data Streaming</a></li>
                
                <li class=""><a href="/internals/types_serialization.html">Type Extraction and Serialization</a></li>
                
                <li class=""><a href="/internals/monitoring_rest_api.html">Monitoring REST API</a></li>
                
                <li class=""><a href="/internals/job_scheduling.html">Jobs and Scheduling</a></li>
                
                <li class=""><a href="/internals/add_operator.html">How-To: Add an Operator</a></li>
                
                <li class=""><a href="/internals/back_pressure_monitoring.html">Back Pressure Monitoring</a></li>
                
              </ul>
            </li>
          </ul>
          <form class="navbar-form navbar-right hidden-sm hidden-md" role="search" action="/search-results.html">
            <div class="form-group">
              <input type="text" class="form-control" size="16px" name="q" placeholder="Search all pages">
            </div>
            <button type="submit" class="btn btn-default">Search</button>
          </form>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container -->
    </nav>


    

    <!-- Main content. -->
    <div class="container">
      
      
<div class="row">


  <!-- Sub Navigation -->
  <div class="col-sm-3">
    <ul id="sub-nav">
      
      
      
        
        
        
        <li><a href="/apis/streaming/index.html" class="">DataStream API</a>
          
        </li>
      
        
        
        
        <li><a href="/quickstart/run_example_quickstart.html" class="active">Example: Wikipedia Edits</a>
          
        </li>
      
        
        
        
        <li><a href="/apis/streaming/event_time.html" class="">Event Time</a>
          
          <ul>
            
              <li><a href="/apis/streaming/event_timestamp_extractors.html" class="">Pre-defined Timestamp Extractors / Watermark Emitters</a></li>
            
              <li><a href="/apis/streaming/event_timestamps_watermarks.html" class="">Generating Timestamps / Watermarks</a></li>
            
          </ul>
          
        </li>
      
        
        
        
        <li><a href="/apis/streaming/windows.html" class="">Windows</a>
          
        </li>
      
        
        
        
        <li><a href="/apis/streaming/fault_tolerance.html" class="">Fault Tolerance</a>
          
          <ul>
            
              <li><a href="/apis/streaming/state.html" class="">Working with State</a></li>
            
              <li><a href="/apis/streaming/state_backends.html" class="">State Backends</a></li>
            
          </ul>
          
        </li>
      
        
        
        
        <li><a href="/apis/streaming/connectors/index.html" class="">Connectors</a>
          
          <ul>
            
              <li><a href="/apis/streaming/connectors/kafka.html" class="">Kafka</a></li>
            
              <li><a href="/apis/streaming/connectors/elasticsearch.html" class="">Elasticsearch</a></li>
            
              <li><a href="/apis/streaming/connectors/elasticsearch2.html" class="">Elasticsearch 2.x</a></li>
            
              <li><a href="/apis/streaming/connectors/filesystem_sink.html" class="">Filesystem Sink</a></li>
            
              <li><a href="/apis/streaming/connectors/rabbitmq.html" class="">RabbitMQ</a></li>
            
              <li><a href="/apis/streaming/connectors/kinesis.html" class="">Amazon Kinesis Streams</a></li>
            
              <li><a href="/apis/streaming/connectors/twitter.html" class="">Twitter</a></li>
            
          </ul>
          
        </li>
      
        
        
        
        <li><a href="/apis/streaming/savepoints.html" class="">Savepoints</a>
          
        </li>
      
        
        
        
        <li><a href="/apis/streaming/libs/index.html" class="">Libraries</a>
          
          <ul>
            
              <li><a href="/apis/streaming/libs/cep.html" class="">Event Processing (CEP)</a></li>
            
          </ul>
          
        </li>
      
        
        
        
        <li><a href="/apis/streaming/storm_compatibility.html" class="">Storm Compatibility</a>
          
        </li>
      
    </ul>
  </div>
  <!-- Main -->
  <div class="col-sm-9">
    <!-- Top anchor -->
    <a href="#top"></a>

    <!-- Artifact name change warning. Remove for the 1.0 release. -->
    <div class="panel panel-default">
      <div class="panel-body"><strong>Important</strong>: Maven artifacts which depend on Scala are now suffixed with the Scala major version, e.g. "2.10" or "2.11". Please consult the <a href="https://cwiki.apache.org/confluence/display/FLINK/Maven+artifact+names+suffixed+with+Scala+version">migration guide on the project Wiki</a>.</div>
    </div>

    <!-- Breadcrumbs above the main heading -->
    <ol class="breadcrumb">
      
      
      <li><a href="/apis/streaming/index.html">Streaming Guide</a></li>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      

      
      <li class="active">Example: Wikipedia Edits</li>
    </ol>

    <div class="text">
      <!-- Main heading -->
      <h1>Monitoring the Wikipedia Edit Stream</h1>

      <!-- Content -->
      

<ul id="markdown-toc">
  <li><a href="#setting-up-a-maven-project" id="markdown-toc-setting-up-a-maven-project">Setting up a Maven Project</a></li>
  <li><a href="#writing-a-flink-program" id="markdown-toc-writing-a-flink-program">Writing a Flink Program</a></li>
  <li><a href="#bonus-exercise-running-on-a-cluster-and-writing-to-kafka" id="markdown-toc-bonus-exercise-running-on-a-cluster-and-writing-to-kafka">Bonus Exercise: Running on a Cluster and Writing to Kafka</a></li>
</ul>

<p>In this guide we will start from scratch and go from setting up a Flink project and running
a streaming analysis program on a Flink cluster.</p>

<p>Wikipedia provides an IRC channel where all edits to the wiki are logged. We are going to
read this channel in Flink and count the number of bytes that each user edits within
a given window of time. This is easy enough to implement in a few minutes using Flink but it will
give you a good foundation from which to start building more complex analysis programs on your own.</p>

<h2 id="setting-up-a-maven-project">Setting up a Maven Project</h2>

<p>We are going to use a Flink Maven Archetype for creating our project stucture. Please
see <a href="/quickstart/java_api_quickstart.html">Java API Quickstart</a> for more details
about this. For our purposes, the command to run is this:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>mvn archetype:generate<span class="se">\</span>
    -DarchetypeGroupId<span class="o">=</span>org.apache.flink<span class="se">\</span>
    -DarchetypeArtifactId<span class="o">=</span>flink-quickstart-java<span class="se">\</span>
    -DarchetypeVersion<span class="o">=</span>1.0.0<span class="se">\</span>
    -DgroupId<span class="o">=</span>wiki-edits<span class="se">\</span>
    -DartifactId<span class="o">=</span>wiki-edits<span class="se">\</span>
    -Dversion<span class="o">=</span>0.1<span class="se">\</span>
    -Dpackage<span class="o">=</span>wikiedits<span class="se">\</span>
    -DinteractiveMode<span class="o">=</span><span class="nb">false</span><span class="se">\</span></code></pre></div>

<p>You can edit the <code>groupId</code>, <code>artifactId</code> and <code>package</code> if you like. With the above parameters,
Maven will create a project structure that looks like this:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>tree wiki-edits
wiki-edits/
├── pom.xml
└── src
    └── main
        ├── java
        │   └── wikiedits
        │       ├── Job.java
        │       ├── SocketTextStreamWordCount.java
        │       └── WordCount.java
        └── resources
            └── log4j.properties</code></pre></div>

<p>There is our <code>pom.xml</code> file that already has the Flink dependencies added in the root directory and
several example Flink programs in <code>src/main/java</code>. We can delete the example programs, since
we are going to start from scratch:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rm wiki-edits/src/main/java/wikiedits/*.java</code></pre></div>

<p>As a last step we need to add the Flink Wikipedia connector as a dependency so that we can
use it in our program. Edit the <code>dependencies</code> section so that it looks like this:</p>

<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.apache.flink<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>flink-java<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>${flink.version}<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.apache.flink<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>flink-streaming-java_2.10<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>${flink.version}<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.apache.flink<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>flink-clients_2.10<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>${flink.version}<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.apache.flink<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>flink-connector-wikiedits_2.10<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>${flink.version}<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span></code></pre></div>

<p>Notice the <code>flink-connector-wikiedits_2.10</code> dependency that was added. (This example and
the Wikipedia connector were inspired by the <em>Hello Samza</em> example of Apache Samza.)</p>

<h2 id="writing-a-flink-program">Writing a Flink Program</h2>

<p>It’s coding time. Fire up your favorite IDE and import the Maven project or open a text editor and
create the file <code>src/main/java/wikiedits/WikipediaAnalysis.java</code>:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">wikiedits</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WikipediaAnalysis</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

    <span class="o">}</span>
<span class="o">}</span></code></pre></div>

<p>I admit it’s very bare bones now but we will fill it as we go. Note, that I’ll not give
import statements here since IDEs can add them automatically. At the end of this section I’ll show
the complete code with import statements if you simply want to skip ahead and enter that in your
editor.</p>

<p>The first step in a Flink program is to create a <code>StreamExecutionEnvironment</code>
(or <code>ExecutionEnvironment</code> if you are writing a batch job). This can be used to set execution
parameters and create sources for reading from external systems. So let’s go ahead, add
this to the main method:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">StreamExecutionEnvironment</span> <span class="n">see</span> <span class="o">=</span> <span class="n">StreamExecutionEnvironment</span><span class="o">.</span><span class="na">getExecutionEnvironment</span><span class="o">();</span></code></pre></div>

<p>Next, we will create a source that reads from the Wikipedia IRC log:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">DataStream</span><span class="o">&lt;</span><span class="n">WikipediaEditEvent</span><span class="o">&gt;</span> <span class="n">edits</span> <span class="o">=</span> <span class="n">see</span><span class="o">.</span><span class="na">addSource</span><span class="o">(</span><span class="k">new</span> <span class="nf">WikipediaEditsSource</span><span class="o">());</span></code></pre></div>

<p>This creates a <code>DataStream</code> of <code>WikipediaEditEvent</code> elements that we can further process. For
the purposes of this example we are interested in determining the number of added or removed
bytes that each user causes in a certain time window, let’s say five seconds. For this we first
have to specify that we want to key the stream on the user name, that is to say that operations
on this should take the key into account. In our case the summation of edited bytes in the windows
should be per unique user. For keying a Stream we have to provide a <code>KeySelector</code>, like this:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">KeyedStream</span><span class="o">&lt;</span><span class="n">WikipediaEditEvent</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">keyedEdits</span> <span class="o">=</span> <span class="n">edits</span>
    <span class="o">.</span><span class="na">keyBy</span><span class="o">(</span><span class="k">new</span> <span class="n">KeySelector</span><span class="o">&lt;</span><span class="n">WikipediaEditEvent</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">getKey</span><span class="o">(</span><span class="n">WikipediaEditEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">event</span><span class="o">.</span><span class="na">getUser</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">});</span></code></pre></div>

<p>This gives us a Stream of <code>WikipediaEditEvent</code> that has a <code>String</code> key, the user name.
We can now specify that we want to have windows imposed on this stream and compute a
result based on elements in these windows. A window specifies a slice of a Stream
on which to perform a computation. They are required when performing an aggregation
computation on an infinite stream of elements. In our example we will say
that we want to aggregate the sum of edited bytes for every five seconds:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">DataStream</span><span class="o">&lt;</span><span class="n">Tuple2</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Long</span><span class="o">&gt;&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">keyedEdits</span>
    <span class="o">.</span><span class="na">timeWindow</span><span class="o">(</span><span class="n">Time</span><span class="o">.</span><span class="na">seconds</span><span class="o">(</span><span class="mi">5</span><span class="o">))</span>
    <span class="o">.</span><span class="na">fold</span><span class="o">(</span><span class="k">new</span> <span class="n">Tuple2</span><span class="o">&lt;&gt;(</span><span class="s">&quot;&quot;</span><span class="o">,</span> <span class="mi">0L</span><span class="o">),</span> <span class="k">new</span> <span class="n">FoldFunction</span><span class="o">&lt;</span><span class="n">WikipediaEditEvent</span><span class="o">,</span> <span class="n">Tuple2</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Long</span><span class="o">&gt;&gt;()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">Tuple2</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="nf">fold</span><span class="o">(</span><span class="n">Tuple2</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="n">acc</span><span class="o">,</span> <span class="n">WikipediaEditEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">acc</span><span class="o">.</span><span class="na">f0</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">getUser</span><span class="o">();</span>
            <span class="n">acc</span><span class="o">.</span><span class="na">f1</span> <span class="o">+=</span> <span class="n">event</span><span class="o">.</span><span class="na">getByteDiff</span><span class="o">();</span>
            <span class="k">return</span> <span class="n">acc</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">});</span></code></pre></div>

<p>The first call, <code>.timeWindow()</code>, specifies that we want to have tumbling (non-overlapping) windows
of five seconds. The second call specifies a <em>Fold transformation</em> on each window slice for
each unique key. In our case we start from an initial value of <code>("", 0L)</code> and add to it the byte
difference of every edit in that time window for a user. The resulting Stream now contains
a <code>Tuple2&lt;String, Long&gt;</code> for every user which gets emitted every five seconds.</p>

<p>The only thing left to do is print the stream to the console and start execution:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">result</span><span class="o">.</span><span class="na">print</span><span class="o">();</span>

<span class="n">see</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span></code></pre></div>

<p>That last call is necessary to start the actual Flink job. All operations, such as creating
sources, transformations and sinks only build up a graph of internal operations. Only when
<code>execute()</code> is called is this graph of operations thrown on a cluster or executed on your local
machine.</p>

<p>The complete code so far is this:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">wikiedits</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.flink.api.common.functions.FoldFunction</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.api.java.functions.KeySelector</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.api.java.tuple.Tuple2</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.streaming.api.datastream.DataStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.streaming.api.datastream.KeyedStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.streaming.api.environment.StreamExecutionEnvironment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.streaming.api.windowing.time.Time</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.streaming.connectors.wikiedits.WikipediaEditEvent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.streaming.connectors.wikiedits.WikipediaEditsSource</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WikipediaAnalysis</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

    <span class="n">StreamExecutionEnvironment</span> <span class="n">see</span> <span class="o">=</span> <span class="n">StreamExecutionEnvironment</span><span class="o">.</span><span class="na">getExecutionEnvironment</span><span class="o">();</span>

    <span class="n">DataStream</span><span class="o">&lt;</span><span class="n">WikipediaEditEvent</span><span class="o">&gt;</span> <span class="n">edits</span> <span class="o">=</span> <span class="n">see</span><span class="o">.</span><span class="na">addSource</span><span class="o">(</span><span class="k">new</span> <span class="nf">WikipediaEditsSource</span><span class="o">());</span>

    <span class="n">KeyedStream</span><span class="o">&lt;</span><span class="n">WikipediaEditEvent</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">keyedEdits</span> <span class="o">=</span> <span class="n">edits</span>
      <span class="o">.</span><span class="na">keyBy</span><span class="o">(</span><span class="k">new</span> <span class="n">KeySelector</span><span class="o">&lt;</span><span class="n">WikipediaEditEvent</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">getKey</span><span class="o">(</span><span class="n">WikipediaEditEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">return</span> <span class="n">event</span><span class="o">.</span><span class="na">getUser</span><span class="o">();</span>
        <span class="o">}</span>
      <span class="o">});</span>

    <span class="n">DataStream</span><span class="o">&lt;</span><span class="n">Tuple2</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Long</span><span class="o">&gt;&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">keyedEdits</span>
      <span class="o">.</span><span class="na">timeWindow</span><span class="o">(</span><span class="n">Time</span><span class="o">.</span><span class="na">seconds</span><span class="o">(</span><span class="mi">5</span><span class="o">))</span>
      <span class="o">.</span><span class="na">fold</span><span class="o">(</span><span class="k">new</span> <span class="n">Tuple2</span><span class="o">&lt;&gt;(</span><span class="s">&quot;&quot;</span><span class="o">,</span> <span class="mi">0L</span><span class="o">),</span> <span class="k">new</span> <span class="n">FoldFunction</span><span class="o">&lt;</span><span class="n">WikipediaEditEvent</span><span class="o">,</span> <span class="n">Tuple2</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Long</span><span class="o">&gt;&gt;()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">Tuple2</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="nf">fold</span><span class="o">(</span><span class="n">Tuple2</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="n">acc</span><span class="o">,</span> <span class="n">WikipediaEditEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">acc</span><span class="o">.</span><span class="na">f0</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">getUser</span><span class="o">();</span>
          <span class="n">acc</span><span class="o">.</span><span class="na">f1</span> <span class="o">+=</span> <span class="n">event</span><span class="o">.</span><span class="na">getByteDiff</span><span class="o">();</span>
          <span class="k">return</span> <span class="n">acc</span><span class="o">;</span>
        <span class="o">}</span>
      <span class="o">});</span>

    <span class="n">result</span><span class="o">.</span><span class="na">print</span><span class="o">();</span>

    <span class="n">see</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></div>

<p>You can run this example in your IDE or on the command line, using Maven:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>mvn clean package
<span class="nv">$ </span>mvn <span class="nb">exec</span>:java -Dexec.mainClass<span class="o">=</span>wikiedits.WikipediaAnalysis</code></pre></div>

<p>The first command builds our project and the second executes our main class. The output should be
similar to this:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">1&gt; <span class="o">(</span>Fenix down,114<span class="o">)</span>
6&gt; <span class="o">(</span>AnomieBOT,155<span class="o">)</span>
8&gt; <span class="o">(</span>BD2412bot,-3690<span class="o">)</span>
7&gt; <span class="o">(</span>IgnorantArmies,49<span class="o">)</span>
3&gt; <span class="o">(</span>Ckh3111,69<span class="o">)</span>
5&gt; <span class="o">(</span>Slade360,0<span class="o">)</span>
7&gt; <span class="o">(</span>Narutolovehinata5,2195<span class="o">)</span>
6&gt; <span class="o">(</span>Vuyisa2001,79<span class="o">)</span>
4&gt; <span class="o">(</span>Ms Sarah Welch,269<span class="o">)</span>
4&gt; <span class="o">(</span>KasparBot,-245<span class="o">)</span></code></pre></div>

<p>The number in front of each line tells you on which parallel instance of the print sink the output
was produced.</p>

<p>This should get you started with writing your own Flink programs. You can check out our guides
about [basic concepts]/apis/common/index.html} and the
[DataStream API]/apis/streaming/index.html} if you want to learn more. Stick
around for the bonus exercise if you want to learn about setting up a Flink cluster on
your own machine and writing results to <a href="http://kafka.apache.org">Kafka</a>.</p>

<h2 id="bonus-exercise-running-on-a-cluster-and-writing-to-kafka">Bonus Exercise: Running on a Cluster and Writing to Kafka</h2>

<p>Please follow our <a href="setup_quickstart.html">setup quickstart</a> for setting up a Flink distribution
on your machine and refer to the <a href="https://kafka.apache.org/documentation.html#quickstart">Kafka quickstart</a>
for setting up a Kafka installation before we proceed.</p>

<p>As a first step, we have to add the Flink Kafka connector as a dependency so that we can
use the Kafka sink. Add this to the <code>pom.xml</code> file in the dependencies section:</p>

<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.apache.flink<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>flink-connector-kafka-0.8_2.10<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>${flink.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></div>

<p>Next, we need to modify our program. We’ll remove the <code>print()</code> sink and instead use a
Kafka sink. The new code looks like this:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">result</span>
    <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="k">new</span> <span class="n">MapFunction</span><span class="o">&lt;</span><span class="n">Tuple2</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Long</span><span class="o">&gt;,</span> <span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">map</span><span class="o">(</span><span class="n">Tuple2</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="n">tuple</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">tuple</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">})</span>
    <span class="o">.</span><span class="na">addSink</span><span class="o">(</span><span class="k">new</span> <span class="n">FlinkKafkaProducer08</span><span class="o">&lt;&gt;(</span><span class="s">&quot;localhost:9092&quot;</span><span class="o">,</span> <span class="s">&quot;wiki-result&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="nf">SimpleStringSchema</span><span class="o">()));</span></code></pre></div>

<p>Note how we first transform the Stream of <code>Tuple2&lt;String, Long&gt;</code> to a Stream of <code>String</code> using
a MapFunction. We are doing this because it is easier to write plain strings to Kafka. Then,
we create a Kafka sink. You might have to adapt the hostname and port to your setup. <code>"wiki-result"</code>
is the name of the Kafka stream that we are going to create next, before running our program.
Build the project using Maven because we need the jar file for running on the cluster:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>mvn clean package</code></pre></div>

<p>The resulting jar file will be in the <code>target</code> subfolder: <code>target/wiki-edits-0.1.jar</code>. We’ll use
this later.</p>

<p>Now we are ready to launch a Flink cluster and run the program that writes to Kafka on it. Go
to the location where you installed Flink and start a local cluster:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cd </span>my/flink/directory
<span class="nv">$ </span>bin/start-local.sh</code></pre></div>

<p>We also have to create the Kafka Topic, so that our program can write to it:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cd </span>my/kafka/directory
<span class="nv">$ </span>bin/kafka-topics.sh --create --zookeeper localhost:2181 --topic wiki-results</code></pre></div>

<p>Now we are ready to run our jar file on the local Flink cluster:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cd </span>my/flink/directory
<span class="nv">$ </span>bin/flink run -c wikiedits.WikipediaAnalysis path/to/wikiedits-0.1.jar</code></pre></div>

<p>The output of that command should look similar to this, if everything went according to plan:</p>

<div class="highlight"><pre><code>03/08/2016 15:09:27 Job execution switched to status RUNNING.
03/08/2016 15:09:27 Source: Custom Source(1/1) switched to SCHEDULED
03/08/2016 15:09:27 Source: Custom Source(1/1) switched to DEPLOYING
03/08/2016 15:09:27 TriggerWindow(TumblingProcessingTimeWindows(5000), FoldingStateDescriptor{name=window-contents, defaultValue=(,0), serializer=null}, ProcessingTimeTrigger(), WindowedStream.fold(WindowedStream.java:207)) -&gt; Map -&gt; Sink: Unnamed(1/1) switched to SCHEDULED
03/08/2016 15:09:27 TriggerWindow(TumblingProcessingTimeWindows(5000), FoldingStateDescriptor{name=window-contents, defaultValue=(,0), serializer=null}, ProcessingTimeTrigger(), WindowedStream.fold(WindowedStream.java:207)) -&gt; Map -&gt; Sink: Unnamed(1/1) switched to DEPLOYING
03/08/2016 15:09:27 TriggerWindow(TumblingProcessingTimeWindows(5000), FoldingStateDescriptor{name=window-contents, defaultValue=(,0), serializer=null}, ProcessingTimeTrigger(), WindowedStream.fold(WindowedStream.java:207)) -&gt; Map -&gt; Sink: Unnamed(1/1) switched to RUNNING
03/08/2016 15:09:27 Source: Custom Source(1/1) switched to RUNNING
</code></pre></div>

<p>You can see how the individual operators start running. There are only two, because
the operations after the window get folded into one operation for performance reasons. In Flink
we call this <em>chaining</em>.</p>

<p>You can observe the output of the program by inspecting the Kafka topic using the Kafka
console consumer:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">bin/kafka-console-consumer.sh  --zookeeper localhost:2181 --topic wiki-result</code></pre></div>

<p>You can also check out the Flink dashboard which should be running at <a href="http://localhost:8081">http://localhost:8081</a>.
You get an overview of your cluster resources and running jobs:</p>

<p><a href="/page/img/quickstart-example/jobmanager-overview.png"><img class="img-responsive" src="/page/img/quickstart-example/jobmanager-overview.png" alt="JobManager Overview" /></a></p>

<p>If you click on your running job you will get a view where you can inspect individual operations
and, for example, see the number of processed elements:</p>

<p><a href="/page/img/quickstart-example/jobmanager-job.png"><img class="img-responsive" src="/page/img/quickstart-example/jobmanager-job.png" alt="Example Job View" /></a></p>

<p>This concludes our little tour of Flink. If you have any questions, please don’t hesitate to ask on our <a href="http://flink.apache.org/community.html#mailing-lists">Mailing Lists</a>.</p>

    </div>
  </div>

  
</div>

    </div><!-- /.container -->

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.1.0/anchor.min.js"></script>
    <script src="/page/js/flink.js"></script>

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-52545728-1', 'auto');
      ga('send', 'pageview');
    </script>

    <!-- Disqus -->
    
  </body>
</html>
