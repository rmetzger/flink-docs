<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Apache Flink 1.12 Documentation: User-defined Sources & Sinks</title>
    <link rel="shortcut icon" href="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/favicon.ico" type="image/x-icon">
    <link rel="icon" href="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/favicon.ico" type="image/x-icon">
    <link rel="canonical" href="//ci.apache.org/projects/flink/flink-docs-stable/zh/dev/table/sourceSinks.html">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/css/flink.css">
    <link rel="stylesheet" href="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/css/syntax.css">
    <link rel="stylesheet" href="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/css/codetabs.css">
    <link rel="stylesheet" href="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/font-awesome/css/font-awesome.min.css">
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    

    <!-- Main content. -->
    <div class="container">
      
      <div class="row">
        <div class="col-lg-3" id="sidenavcol">
          <div class="sidenav-logo">
  <p><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/"><img class="bottom" alt="Apache Flink" src="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/img/navbar-brand-logo.jpg"></a> v1.12</p>
</div>
<ul id="sidenav">
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/"><i class="fa fa-home title" aria-hidden="true"></i> Home</a></li><hr class="section-break"></hr>
<li><a href="#collapse-2" data-toggle="collapse"><i class="fa fa-rocket title appetizer" aria-hidden="true"></i> Try Flink<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-2"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/try-flink/local_installation.html">本地模式安装</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/try-flink/datastream_api.html">基于 DataStream API 实现欺诈检测</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/try-flink/table_api.html">基于 Table API 实现实时报表</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/try-flink/flink-operations-playground.html">Flink 操作场景</a></li>
</ul></div></li>
<li><a href="#collapse-8" data-toggle="collapse"><i class="fa fa-hand-paper-o title appetizer" aria-hidden="true"></i> 实践练习<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-8"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/learn-flink/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/learn-flink/datastream_api.html">DataStream API 简介</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/learn-flink/etl.html">数据管道 & ETL</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/learn-flink/streaming_analytics.html">流式分析</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/learn-flink/event_driven.html">事件驱动应用</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/learn-flink/fault_tolerance.html">容错处理</a></li>
</ul></div></li>
<li><a href="#collapse-15" data-toggle="collapse"><i class="fa fa-map-o title appetizer" aria-hidden="true"></i> 概念透析<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-15"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/concepts/index.html">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/concepts/stateful-stream-processing.html">有状态流处理</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/concepts/timely-stream-processing.html">及时流处理</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/concepts/flink-architecture.html">Flink 架构</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/concepts/glossary.html">词汇表</a></li>
</ul></div></li><hr class="section-break"></hr>
<li><a href="#collapse-21" data-toggle="collapse"class="active"><i class="fa fa-code title maindish" aria-hidden="true"></i> 应用开发</a><div class="collapse in" id="collapse-21"><ul>
<li><a href="#collapse-22" data-toggle="collapse">DataStream API<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-22"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/datastream_api.html">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/datastream_execution_mode.html">Execution Mode (Batch/Streaming)</a></li>
<li><a href="#collapse-24" data-toggle="collapse">事件时间<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-24"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/event_time.html">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/event_timestamps_watermarks.html">生成 Watermark</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/event_timestamp_extractors.html">内置 Watermark 生成器</a></li>
</ul></div></li>
<li><a href="#collapse-28" data-toggle="collapse">状态与容错<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-28"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/state.html">Working with State</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/broadcast_state.html">Broadcast State 模式</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/checkpointing.html">Checkpointing</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/queryable_state.html">Queryable State</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/state_backends.html">State Backends</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/schema_evolution.html">状态数据结构升级</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/custom_serialization.html">自定义状态序列化</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/user_defined_functions.html">用户自定义 Functions</a></li>
<li><a href="#collapse-38" data-toggle="collapse">算子<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-38"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/operators/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/operators/windows.html">窗口</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/operators/joining.html">Joining</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/operators/process_function.html">Process Function</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/operators/asyncio.html">异步 I/O</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/sources.html">Data Sources</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/side_output.html">旁路输出</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/application_parameters.html">Handling Application Parameters</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/testing.html">测试</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/experimental.html">实验功能</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/scala_api_extensions.html">Scala API Extensions</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/java_lambdas.html">Java Lambda 表达式</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/project-configuration.html">Project Configuration</a></li>
</ul></div></li>
<li><a href="#collapse-53" data-toggle="collapse">DataSet API<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-53"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/dataset_transformations.html">Transformations</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/iterations.html">迭代</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/zip_elements_guide.html">Zipping Elements</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/hadoop_compatibility.html">Hadoop 兼容</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/local_execution.html">本地执行</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/cluster_execution.html">集群执行</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/examples.html">Batch 示例</a></li>
</ul></div></li>
<li><a href="#collapse-62" data-toggle="collapse"class="active">Table API & SQL</a><div class="collapse in" id="collapse-62"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/common.html">概念与通用 API</a></li>
<li><a href="#collapse-64" data-toggle="collapse">流式概念<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-64"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/streaming/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/streaming/dynamic_tables.html">动态表 (Dynamic Table)</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/streaming/time_attributes.html">时间属性</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/streaming/joins.html">流上的 Join</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/streaming/temporal_tables.html">时态表（Temporal Tables）</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/streaming/match_recognize.html">模式检测</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/streaming/query_configuration.html">Query Configuration</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/types.html">数据类型</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/tableApi.html">Table API</a></li>
<li><a href="#collapse-74" data-toggle="collapse">SQL<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-74"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/queries.html">查询语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/create.html">CREATE 语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/drop.html">DROP 语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/alter.html">ALTER 语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/insert.html">INSERT 语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/hints.html">SQL Hints</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/describe.html">DESCRIBE 语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/explain.html">EXPLAIN 语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/use.html">USE 语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/show.html">SHOW 语句</a></li>
</ul></div></li>
<li><a href="#collapse-86" data-toggle="collapse">函数<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-86"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/functions/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/functions/systemFunctions.html">系统（内置）函数</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/functions/udfs.html">自定义函数</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/modules.html">模块</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/catalogs.html">Catalogs</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sqlClient.html">SQL 客户端</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/config.html">配置</a></li>
<li><a href="#collapse-94" data-toggle="collapse">Performance Tuning<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-94"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/tuning/streaming_aggregation_optimization.html">流式聚合</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sourceSinks.html" class="active">User-defined Sources & Sinks</a></li>
</ul></div></li>
<li><a href="#collapse-99" data-toggle="collapse">Python API<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-99"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/installation.html">环境安装</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table_api_tutorial.html">Table API 教程</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/datastream_tutorial.html">DataStream API 教程</a></li>
<li><a href="#collapse-103" data-toggle="collapse">Table API用户指南<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-103"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/intro_to_table_api.html">Python Table API 简介</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/table_environment.html">TableEnvironment</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/operations.html">Operations</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/python_types.html">数据类型</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/built_in_functions.html">系统（内置）函数</a></li>
<li><a href="#collapse-109" data-toggle="collapse">自定义函数<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-109"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/udfs/python_udfs.html">普通自定义函数（UDF）</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/udfs/vectorized_python_udfs.html">向量化自定义函数</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/conversion_of_pandas.html">PyFlink Table 和 Pandas DataFrame 互转</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/dependency_management.html">依赖管理</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/sql.html">SQL</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/catalogs.html">Catalogs</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/metrics.html">指标</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/python_table_api_connectors.html">连接器</a></li>
</ul></div></li>
<li><a href="#collapse-120" data-toggle="collapse">DataStream API用户指南<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-120"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/datastream-api-users-guide/data_types.html">数据类型</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/datastream-api-users-guide/operators.html">算子</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/datastream-api-users-guide/dependency_management.html">依赖管理</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/python_config.html">配置</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/environment_variables.html">环境变量</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/faq.html">常见问题</a></li>
</ul></div></li>
<li><a href="#collapse-129" data-toggle="collapse">数据类型以及序列化<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-129"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/types_serialization.html">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/custom_serializers.html">自定义序列化器</a></li>
</ul></div></li>
<li><a href="#collapse-132" data-toggle="collapse">管理执行<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-132"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/execution_configuration.html">执行配置</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/packaging.html">程序打包</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/parallel.html">并行执行</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/execution_plans.html">执行计划</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/task_failure_recovery.html">Task 故障恢复</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/migration.html">API 迁移指南</a></li>
</ul></div></li>
<li><a href="#collapse-141" data-toggle="collapse"><i class="fa fa-book title maindish" aria-hidden="true"></i> Libraries<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-141"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/cep.html">事件处理 (CEP)</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/state_processor_api.html">State Processor API</a></li>
<li><a href="#collapse-144" data-toggle="collapse">图计算: Gelly<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-144"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/graph_api.html">Graph API</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/iterative_graph_processing.html">Iterative Graph Processing</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/library_methods.html">Library Methods</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/graph_algorithms.html">Graph Algorithms</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/graph_generators.html">Graph Generators</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/bipartite_graph.html">Bipartite Graph</a></li>
</ul></div></li>
</ul></div></li>
<li><a href="#collapse-153" data-toggle="collapse"><i class="fa fa-random title maindish" aria-hidden="true"></i> Connectors<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-153"><ul>
<li><a href="#collapse-154" data-toggle="collapse">DataStream Connectors<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-154"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/guarantees.html">容错保证</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/kafka.html">Kafka</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/cassandra.html">Cassandra</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/kinesis.html">Kinesis</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/elasticsearch.html">Elasticsearch</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/file_sink.html">File Sink</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/streamfile_sink.html">Streaming File Sink</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/rabbitmq.html">RabbitMQ</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/nifi.html">NiFi</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/pubsub.html">Google Cloud PubSub</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/twitter.html">Twitter</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/jdbc.html">JDBC</a></li>
</ul></div></li>
<li><a href="#collapse-168" data-toggle="collapse">Table & SQL Connectors<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-168"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/">概览</a></li>
<li><a href="#collapse-169" data-toggle="collapse">Formats<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-169"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/csv.html">CSV</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/json.html">JSON</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/avro-confluent.html">Confluent Avro</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/avro.html">Avro</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/debezium.html">Debezium</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/canal.html">Canal</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/maxwell.html">Maxwell</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/parquet.html">Parquet</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/orc.html">Orc</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/raw.html">Raw</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/kafka.html">Kafka</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/upsert-kafka.html">Upsert Kafka</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/kinesis.html">Kinesis</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/jdbc.html">JDBC</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/elasticsearch.html">Elasticsearch</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/filesystem.html">FileSystem</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/hbase.html">HBase</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/datagen.html">DataGen</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/print.html">Print</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/blackhole.html">BlackHole</a></li>
<li><a href="#collapse-191" data-toggle="collapse">Hive<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-191"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/hive/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/hive/hive_catalog.html">Hive Catalog</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/hive/hive_dialect.html">Hive 方言</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/hive/hive_read_write.html">Hive Read & Write</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/hive/hive_functions.html">Hive 函数</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/downloads.html">下载</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/connectors.html">DataSet Connectors</a></li>
</ul></div></li>
<li><a href="#collapse-201" data-toggle="collapse"><i class="fa fa-sliders title maindish" aria-hidden="true"></i> Deployment<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-201"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/">概览</a></li>
<li><a href="#collapse-202" data-toggle="collapse">Resource Providers<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-202"><ul>
<li><a href="#collapse-203" data-toggle="collapse">Standalone<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-203"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/resource-providers/standalone/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/resource-providers/standalone/local.html">本地集群</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/resource-providers/standalone/docker.html">Docker</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/resource-providers/standalone/kubernetes.html">Kubernetes</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/resource-providers/native_kubernetes.html">Native Kubernetes</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/resource-providers/yarn.html">YARN</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/resource-providers/mesos.html">Mesos</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/config.html">配置参数</a></li>
<li><a href="#collapse-213" data-toggle="collapse">内存配置<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-213"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_setup.html">配置 Flink 进程的内存</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_setup_tm.html">配置 TaskManager 内存</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_setup_jobmanager.html">配置 JobManager 内存</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_tuning.html">调优指南</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_trouble.html">常见问题</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_migration.html">升级指南</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/cli.html">Command-Line Interface</a></li>
<li><a href="#collapse-222" data-toggle="collapse">文件系统<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-222"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/filesystems/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/filesystems/common.html">通用配置</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/filesystems/s3.html">Amazon S3</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/filesystems/oss.html">阿里云 OSS</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/filesystems/azure.html">Azure Blob 存储</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/filesystems/plugins.html">Plugins</a></li>
</ul></div></li>
<li><a href="#collapse-229" data-toggle="collapse">High Availability (HA)<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-229"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/ha/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/ha/zookeeper_ha.html">ZooKeeper HA Services</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/ha/kubernetes_ha.html">Kubernetes HA Services</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/metric_reporters.html">Metric Reporters</a></li>
<li><a href="#collapse-234" data-toggle="collapse">Security<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-234"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/security/security-ssl.html">SSL 设置</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/security/security-kerberos.html">Kerberos</a></li>
</ul></div></li>
<li><a href="#collapse-238" data-toggle="collapse">REPLs<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-238"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/repls/python_shell.html">Python REPL</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/repls/scala_shell.html">Scala REPL</a></li>
</ul></div></li>
<li><a href="#collapse-242" data-toggle="collapse">Advanced<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-242"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/advanced/external_resources.html">扩展资源</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/advanced/historyserver.html">History Server</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/advanced/logging.html">日志</a></li>
</ul></div></li>
</ul></div></li>
<li><a href="#collapse-248" data-toggle="collapse"><i class="fa fa-cogs title maindish" aria-hidden="true"></i> Operations<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-248"><ul>
<li><a href="#collapse-249" data-toggle="collapse">状态与容错<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-249"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/state/checkpoints.html">Checkpoints</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/state/savepoints.html">Savepoints</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/state/state_backends.html">State Backends</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/state/large_state_tuning.html">大状态与 Checkpoint 调优</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/metrics.html">指标</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/rest_api.html">REST API</a></li>
<li><a href="#collapse-257" data-toggle="collapse">Debugging<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-257"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/debugging/debugging_event_time.html">调试窗口与事件时间</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/debugging/debugging_classloading.html">调试类加载</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/debugging/application_profiling.html">应用程序分析</a></li>
</ul></div></li>
<li><a href="#collapse-262" data-toggle="collapse">Monitoring<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-262"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/monitoring/checkpoint_monitoring.html">监控 Checkpoint</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/monitoring/back_pressure.html">监控反压</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/upgrading.html">升级应用程序和 Flink 版本</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/production_ready.html">生产就绪情况核对清单</a></li>
</ul></div></li><hr class="section-break"></hr>
<li><a href="#collapse-269" data-toggle="collapse"><i class="fa fa-cogs title dessert" aria-hidden="true"></i> Flink 开发<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-269"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/flinkDev/ide_setup.html">导入 Flink 到 IDE 中</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/flinkDev/building.html">从源码构建 Flink</a></li>
</ul></div></li>
<li><a href="#collapse-273" data-toggle="collapse"><i class="fa fa-book title dessert" aria-hidden="true"></i> 内幕<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-273"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/internals/job_scheduling.html">作业调度</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/internals/task_lifecycle.html">Task 生命周期</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/internals/filesystems.html">文件系统</a></li>
</ul></div></li>
  <li class="divider"></li>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/api/java"><i class="fa fa-external-link title" aria-hidden="true"></i> Javadocs</a></li>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/api/scala/index.html#org.apache.flink.api.scala.package"><i class="fa fa-external-link title" aria-hidden="true"></i> Scaladocs</a></li>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/api/python"><i class="fa fa-external-link title" aria-hidden="true"></i> Pythondocs</a></li>
  <li><a href="http://flink.apache.org"><i class="fa fa-external-link title" aria-hidden="true"></i> Project Page</a></li>
</ul>

<div class="sidenav-search-box">
  <form class="navbar-form" role="search" action="//ci.apache.org/projects/flink/flink-docs-release-1.12/search-results.html">
    <div class="form-group">
      <input type="text" class="form-control" size="16px" name="q" placeholder="Search">
    </div>
    <button type="submit" class="btn btn-default">Go</button>
  </form>
</div>

<div class="sidenav-versions">
  <div class="dropdown">
    <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">选择文档版本<span class="caret"></span></button>
    <ul class="dropdown-menu">
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.11">v1.11</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.10">v1.10</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.9">v1.9</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.8">v1.8</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.7">v1.7</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.6">v1.6</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.5">v1.5</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.4">v1.4</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.3">v1.3</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.2">v1.2</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.1">v1.1</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.0">v1.0</a></li>
    </ul>
  </div>
</div>

<div class="sidenav-languages"><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/dev/table/sourceSinks.html">
      <button type="submit" class="btn btn-default">English</button>
    </a>
</div>

        </div>
        <div class="col-lg-9 content" id="contentcol">

          

<ol class="breadcrumb">
  
    <li><i class="fa fa-code title maindish" aria-hidden="true"></i> 应用开发</li>
  
    <li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/">Table API & SQL</a></li>
  
    <li class="active">User-defined Sources & Sinks</li>
</ol>

<h1>User-defined Sources & Sinks</h1>




<p><em>Dynamic tables</em> are the core concept of Flink’s Table &amp; SQL API for processing both bounded and unbounded
data in a unified fashion.</p>

<p>Because dynamic tables are only a logical concept, Flink does not own the data itself. Instead, the content
of a dynamic table is stored in external systems (such as databases, key-value stores, message queues) or files.</p>

<p><em>Dynamic sources</em> and <em>dynamic sinks</em> can be used to read and write data from and to an external system. In
the documentation, sources and sinks are often summarized under the term <em>connector</em>.</p>

<p>Flink provides pre-defined connectors for Kafka, Hive, and different file systems. See the <a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/">connector section</a>
for more information about built-in table sources and sinks.</p>

<p>This page focuses on how to develop a custom, user-defined connector.</p>

<p><span class="label label-danger">Attention</span> New table source and table sink interfaces have been
introduced in Flink 1.11 as part of <a href="https://cwiki.apache.org/confluence/display/FLINK/FLIP-95%3A+New+TableSource+and+TableSink+interfaces">FLIP-95</a>.
Also the factory interfaces have been reworked. If necessary, take a look at the <a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/legacySourceSinks.html">old table sources and sinks page</a>.
Those interfaces are still supported for backwards compatibility.</p>

<ul id="markdown-toc">
  <li><a href="#overview" id="markdown-toc-overview">Overview</a>    <ul>
      <li><a href="#metadata" id="markdown-toc-metadata">Metadata</a></li>
      <li><a href="#planning" id="markdown-toc-planning">Planning</a></li>
      <li><a href="#runtime" id="markdown-toc-runtime">Runtime</a></li>
    </ul>
  </li>
  <li><a href="#extension-points" id="markdown-toc-extension-points">Extension Points</a>    <ul>
      <li><a href="#dynamic-table-factories" id="markdown-toc-dynamic-table-factories">Dynamic Table Factories</a></li>
      <li><a href="#dynamic-table-source" id="markdown-toc-dynamic-table-source">Dynamic Table Source</a></li>
      <li><a href="#dynamic-table-sink" id="markdown-toc-dynamic-table-sink">Dynamic Table Sink</a></li>
      <li><a href="#encoding--decoding-formats" id="markdown-toc-encoding--decoding-formats">Encoding / Decoding Formats</a></li>
    </ul>
  </li>
  <li><a href="#full-stack-example" id="markdown-toc-full-stack-example">Full Stack Example</a>    <ul>
      <li><a href="#factories" id="markdown-toc-factories">Factories</a></li>
      <li><a href="#table-source-and-decoding-format" id="markdown-toc-table-source-and-decoding-format">Table Source and Decoding Format</a></li>
      <li><a href="#runtime-1" id="markdown-toc-runtime-1">Runtime</a></li>
    </ul>
  </li>
</ul>

<h2 id="overview">Overview</h2>

<p>In many cases, implementers don’t need to create a new connector from scratch but would like to slightly
modify existing connectors or hook into the existing stack. In other cases, implementers would like to
create specialized connectors.</p>

<p>This section helps for both kinds of use cases. It explains the general architecture of table connectors
from pure declaration in the API to runtime code that will be executed on the cluster.</p>

<p>The filled arrows show how objects are transformed to other objects from one stage to the next stage during
the translation process.</p>

<div style="text-align: center">
  <img width="90%" src="//ci.apache.org/projects/flink/flink-docs-release-1.12/fig/table_connectors.svg" alt="Translation of table connectors" />
</div>

<h3 id="metadata">Metadata</h3>

<p>Both Table API and SQL are declarative APIs. This includes the declaration of tables. Thus, executing
a <code class="highlighter-rouge">CREATE TABLE</code> statement results in updated metadata in the target catalog.</p>

<p>For most catalog implementations, physical data in the external system is not modified for such an
operation. Connector-specific dependencies don’t have to be present in the classpath yet. The options declared
in the <code class="highlighter-rouge">WITH</code> clause are neither validated nor otherwise interpreted.</p>

<p>The metadata for dynamic tables (created via DDL or provided by the catalog) is represented as instances
of <code class="highlighter-rouge">CatalogTable</code>. A table name will be resolved into a <code class="highlighter-rouge">CatalogTable</code> internally when necessary.</p>

<h3 id="planning">Planning</h3>

<p>When it comes to planning and optimization of the table program, a <code class="highlighter-rouge">CatalogTable</code> needs to be resolved
into a <code class="highlighter-rouge">DynamicTableSource</code> (for reading in a <code class="highlighter-rouge">SELECT</code> query) and <code class="highlighter-rouge">DynamicTableSink</code> (for writing in
an <code class="highlighter-rouge">INSERT INTO</code> statement).</p>

<p><code class="highlighter-rouge">DynamicTableSourceFactory</code> and <code class="highlighter-rouge">DynamicTableSinkFactory</code> provide connector-specific logic for translating
the metadata of a <code class="highlighter-rouge">CatalogTable</code> into instances of <code class="highlighter-rouge">DynamicTableSource</code> and <code class="highlighter-rouge">DynamicTableSink</code>. In most
of the cases, a factory’s purpose is to validate options (such as <code class="highlighter-rouge">'port' = '5022'</code> in the example),
configure encoding/decoding formats (if required), and create a parameterized instance of the table
connector.</p>

<p>By default, instances of <code class="highlighter-rouge">DynamicTableSourceFactory</code> and <code class="highlighter-rouge">DynamicTableSinkFactory</code> are discovered using
Java’s <a href="https://docs.oracle.com/javase/tutorial/sound/SPI-intro.html">Service Provider Interfaces (SPI)</a>. The
<code class="highlighter-rouge">connector</code> option (such as <code class="highlighter-rouge">'connector' = 'custom'</code> in the example) must correspond to a valid factory
identifier.</p>

<p>Although it might not be apparent in the class naming, <code class="highlighter-rouge">DynamicTableSource</code> and <code class="highlighter-rouge">DynamicTableSink</code>
can also be seen as stateful factories that eventually produce concrete runtime implementation for reading/writing
the actual data.</p>

<p>The planner uses the source and sink instances to perform connector-specific bidirectional communication
until an optimal logical plan could be found. Depending on the optionally declared ability interfaces (e.g.
<code class="highlighter-rouge">SupportsProjectionPushDown</code> or <code class="highlighter-rouge">SupportsOverwrite</code>), the planner might apply changes to an instance and
thus mutate the produced runtime implementation.</p>

<h3 id="runtime">Runtime</h3>

<p>Once the logical planning is complete, the planner will obtain the <em>runtime implementation</em> from the table
connector. Runtime logic is implemented in Flink’s core connector interfaces such as <code class="highlighter-rouge">InputFormat</code> or <code class="highlighter-rouge">SourceFunction</code>.</p>

<p>Those interfaces are grouped by another level of abstraction as subclasses of <code class="highlighter-rouge">ScanRuntimeProvider</code>,
<code class="highlighter-rouge">LookupRuntimeProvider</code>, and <code class="highlighter-rouge">SinkRuntimeProvider</code>.</p>

<p>For example, both <code class="highlighter-rouge">OutputFormatProvider</code> (providing <code class="highlighter-rouge">org.apache.flink.api.common.io.OutputFormat</code>) and <code class="highlighter-rouge">SinkFunctionProvider</code> (providing <code class="highlighter-rouge">org.apache.flink.streaming.api.functions.sink.SinkFunction</code>) are concrete instances of <code class="highlighter-rouge">SinkRuntimeProvider</code>
that the planner can handle.</p>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<h2 id="extension-points">Extension Points</h2>

<p>This section explains the available interfaces for extending Flink’s table connectors.</p>

<h3 id="dynamic-table-factories">Dynamic Table Factories</h3>

<p>Dynamic table factories are used to configure a dynamic table connector for an external storage system from catalog
and session information.</p>

<p><code class="highlighter-rouge">org.apache.flink.table.factories.DynamicTableSourceFactory</code> can be implemented to construct a <code class="highlighter-rouge">DynamicTableSource</code>.</p>

<p><code class="highlighter-rouge">org.apache.flink.table.factories.DynamicTableSinkFactory</code> can be implemented to construct a <code class="highlighter-rouge">DynamicTableSink</code>.</p>

<p>By default, the factory is discovered using the value of the <code class="highlighter-rouge">connector</code> option as the factory identifier
and Java’s Service Provider Interface.</p>

<p>In JAR files, references to new implementations can be added to the service file:</p>

<p><code class="highlighter-rouge">META-INF/services/org.apache.flink.table.factories.Factory</code></p>

<p>The framework will check for a single matching factory that is uniquely identified by factory identifier
and requested base class (e.g. <code class="highlighter-rouge">DynamicTableSourceFactory</code>).</p>

<p>The factory discovery process can be bypassed by the catalog implementation if necessary. For this, a
catalog needs to return an instance that implements the requested base class in <code class="highlighter-rouge">org.apache.flink.table.catalog.Catalog#getFactory</code>.</p>

<h3 id="dynamic-table-source">Dynamic Table Source</h3>

<p>By definition, a dynamic table can change over time.</p>

<p>When reading a dynamic table, the content can either be considered as:</p>
<ul>
  <li>A changelog (finite or infinite) for which all changes are consumed continuously until the changelog
is exhausted. This is represented by the <code class="highlighter-rouge">ScanTableSource</code> interface.</li>
  <li>A continuously changing or very large external table whose content is usually never read entirely
but queried for individual values when necessary. This is represented by the <code class="highlighter-rouge">LookupTableSource</code>
interface.</li>
</ul>

<p>A class can implement both of these interfaces at the same time. The planner decides about their usage depending
on the specified query.</p>

<h4 id="scan-table-source">Scan Table Source</h4>

<p>A <code class="highlighter-rouge">ScanTableSource</code> scans all rows from an external storage system during runtime.</p>

<p>The scanned rows don’t have to contain only insertions but can also contain updates and deletions. Thus,
the table source can be used to read a (finite or infinite) changelog. The returned <em>changelog mode</em> indicates
the set of changes that the planner can expect during runtime.</p>

<p>For regular batch scenarios, the source can emit a bounded stream of insert-only rows.</p>

<p>For regular streaming scenarios, the source can emit an unbounded stream of insert-only rows.</p>

<p>For change data capture (CDC) scenarios, the source can emit bounded or unbounded streams with insert,
update, and delete rows.</p>

<p>A table source can implement further ability interfaces such as <code class="highlighter-rouge">SupportsProjectionPushDown</code> that might
mutate an instance during planning. All abilities can be found in the <code class="highlighter-rouge">org.apache.flink.table.connector.source.abilities</code>
package and are listed in the <a href="#source-abilities">source abilities table</a>.</p>

<p>The runtime implementation of a <code class="highlighter-rouge">ScanTableSource</code> must produce internal data structures. Thus, records
must be emitted as <code class="highlighter-rouge">org.apache.flink.table.data.RowData</code>. The framework provides runtime converters such
that a source can still work on common data structures and perform a conversion at the end.</p>

<h4 id="lookup-table-source">Lookup Table Source</h4>

<p>A <code class="highlighter-rouge">LookupTableSource</code> looks up rows of an external storage system by one or more keys during runtime.</p>

<p>Compared to <code class="highlighter-rouge">ScanTableSource</code>, the source does not have to read the entire table and can lazily fetch individual
values from a (possibly continuously changing) external table when necessary.</p>

<p>Compared to <code class="highlighter-rouge">ScanTableSource</code>, a <code class="highlighter-rouge">LookupTableSource</code> does only support emitting insert-only changes currently.</p>

<p>Further abilities are not supported. See the documentation of <code class="highlighter-rouge">org.apache.flink.table.connector.source.LookupTableSource</code>
for more information.</p>

<p>The runtime implementation of a <code class="highlighter-rouge">LookupTableSource</code> is a <code class="highlighter-rouge">TableFunction</code> or <code class="highlighter-rouge">AsyncTableFunction</code>. The function
will be called with values for the given lookup keys during runtime.</p>

<h4 id="source-abilities">Source Abilities</h4>

<table class="table table-bordered">
    <thead>
        <tr>
        <th class="text-left" style="width: 25%">Interface</th>
        <th class="text-center" style="width: 75%">Description</th>
        </tr>
    </thead>
    <tbody>
    <tr>
        <td><a href="https://github.com/apache/flink/blob/master/flink-table/flink-table-common/src/main/java/org/apache/flink/table/connector/source/abilities/SupportsFilterPushDown.java">SupportsFilterPushDown</a></td>
        <td>Enables to push down the filter into the <code>DynamicTableSource</code>. For efficiency, a source can
        push filters further down in order to be close to the actual data generation.</td>
    </tr>
    <tr>
        <td><a href="https://github.com/apache/flink/blob/master/flink-table/flink-table-common/src/main/java/org/apache/flink/table/connector/source/abilities/SupportsLimitPushDown.java">SupportsLimitPushDown</a></td>
        <td>Enables to push down a limit (the expected maximum number of produced records) into a <code>DynamicTableSource</code>.</td>
    </tr>
    <tr>
        <td><a href="https://github.com/apache/flink/blob/master/flink-table/flink-table-common/src/main/java/org/apache/flink/table/connector/source/abilities/SupportsPartitionPushDown.java">SupportsPartitionPushDown</a></td>
        <td>Enables to pass available partitions to the planner and push down partitions into a <code>DynamicTableSource</code>.
        During the runtime, the source will only read data from the passed partition list for efficiency.</td>
    </tr>
    <tr>
        <td><a href="https://github.com/apache/flink/blob/master/flink-table/flink-table-common/src/main/java/org/apache/flink/table/connector/source/abilities/SupportsProjectionPushDown.java">SupportsProjectionPushDown</a> </td>
        <td>Enables to push down a (possibly nested) projection into a <code>DynamicTableSource</code>. For efficiency,
        a source can push a projection further down in order to be close to the actual data generation. If the source
        also implements <code>SupportsReadingMetadata</code>, the source will also read the required metadata only.
        </td>
    </tr>
    <tr>
        <td><a href="https://github.com/apache/flink/blob/master/flink-table/flink-table-common/src/main/java/org/apache/flink/table/connector/source/abilities/SupportsReadingMetadata.java">SupportsReadingMetadata</a></td>
        <td>Enables to read metadata columns from a <code>DynamicTableSource</code>. The source
        is responsible to add the required metadata at the end of the produced rows. This includes
        potentially forwarding metadata column from contained formats.</td>
    </tr>
    <tr>
        <td><a href="https://github.com/apache/flink/blob/master/flink-table/flink-table-common/src/main/java/org/apache/flink/table/connector/source/abilities/SupportsWatermarkPushDown.java">SupportsWatermarkPushDown</a></td>
        <td>Enables to push down a watermark strategy into a <code>DynamicTableSource</code>. The watermark
        strategy is a builder/factory for timestamp extraction and watermark generation. During the runtime, the
        watermark generator is located inside the source and is able to generate per-partition watermarks.</td>
    </tr>
    </tbody>
</table>

<p><span class="label label-danger">Attention</span> The interfaces above are currently only available for
<code class="highlighter-rouge">ScanTableSource</code>, not for <code class="highlighter-rouge">LookupTableSource</code>.</p>

<h3 id="dynamic-table-sink">Dynamic Table Sink</h3>

<p>By definition, a dynamic table can change over time.</p>

<p>When writing a dynamic table, the content can always be considered as a changelog (finite or infinite)
for which all changes are written out continuously until the changelog is exhausted. The returned <em>changelog mode</em>
indicates the set of changes that the sink accepts during runtime.</p>

<p>For regular batch scenarios, the sink can solely accept insert-only rows and write out bounded streams.</p>

<p>For regular streaming scenarios, the sink can solely accept insert-only rows and can write out unbounded streams.</p>

<p>For change data capture (CDC) scenarios, the sink can write out bounded or unbounded streams with insert,
update, and delete rows.</p>

<p>A table sink can implement further ability interfaces such as <code class="highlighter-rouge">SupportsOverwrite</code> that might mutate an
instance during planning. All abilities can be found in the <code class="highlighter-rouge">org.apache.flink.table.connector.sink.abilities</code>
package and are listed in the <a href="#sink-abilities">sink abilities table</a>.</p>

<p>The runtime implementation of a <code class="highlighter-rouge">DynamicTableSink</code> must consume internal data structures. Thus, records
must be accepted as <code class="highlighter-rouge">org.apache.flink.table.data.RowData</code>. The framework provides runtime converters such
that a sink can still work on common data structures and perform a conversion at the beginning.</p>

<h4 id="sink-abilities">Sink Abilities</h4>

<table class="table table-bordered">
    <thead>
        <tr>
        <th class="text-left" style="width: 25%">Interface</th>
        <th class="text-center" style="width: 75%">Description</th>
        </tr>
    </thead>
    <tbody>
    <tr>
        <td><a href="https://github.com/apache/flink/blob/master/flink-table/flink-table-common/src/main/java/org/apache/flink/table/connector/sink/abilities/SupportsOverwrite.java">SupportsOverwrite</a></td>
        <td>Enables to overwrite existing data in a <code>DynamicTableSink</code>. By default, if
        this interface is not implemented, existing tables or partitions cannot be overwritten using
        e.g. the SQL <code>INSERT OVERWRITE</code> clause.</td>
    </tr>
    <tr>
        <td><a href="https://github.com/apache/flink/blob/master/flink-table/flink-table-common/src/main/java/org/apache/flink/table/connector/sink/abilities/SupportsPartitioning.java">SupportsPartitioning</a></td>
        <td>Enables to write partitioned data in a <code>DynamicTableSink</code>.</td>
    </tr>
    <tr>
        <td><a href="https://github.com/apache/flink/blob/master/flink-table/flink-table-common/src/main/java/org/apache/flink/table/connector/sink/abilities/SupportsWritingMetadata.java">SupportsWritingMetadata</a></td>
        <td>Enables to write metadata columns into a <code>DynamicTableSource</code>. A table sink is
        responsible for accepting requested metadata columns at the end of consumed rows and persist
        them. This includes potentially forwarding metadata columns to contained formats.</td>
    </tr>
    </tbody>
</table>

<h3 id="encoding--decoding-formats">Encoding / Decoding Formats</h3>

<p>Some table connectors accept different formats that encode and decode keys and/or values.</p>

<p>Formats work similar to the pattern <code class="highlighter-rouge">DynamicTableSourceFactory -&gt; DynamicTableSource -&gt; ScanRuntimeProvider</code>,
where the factory is responsible for translating options and the source is responsible for creating runtime logic.</p>

<p>Because formats might be located in different modules, they are discovered using Java’s Service Provider
Interface similar to <a href="#dynamic-table-factories">table factories</a>. In order to discover a format factory,
the dynamic table factory searches for a factory that corresponds to a factory identifier and connector-specific
base class.</p>

<p>For example, the Kafka table source requires a <code class="highlighter-rouge">DeserializationSchema</code> as runtime interface for a decoding
format. Therefore, the Kafka table source factory uses the value of the <code class="highlighter-rouge">value.format</code> option to discover
a <code class="highlighter-rouge">DeserializationFormatFactory</code>.</p>

<p>The following format factories are currently supported:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>org.apache.flink.table.factories.DeserializationFormatFactory
org.apache.flink.table.factories.SerializationFormatFactory
</code></pre></div></div>

<p>The format factory translates the options into an <code class="highlighter-rouge">EncodingFormat</code> or a <code class="highlighter-rouge">DecodingFormat</code>. Those interfaces are
another kind of factory that produce specialized format runtime logic for the given data type.</p>

<p>For example, for a Kafka table source factory, the <code class="highlighter-rouge">DeserializationFormatFactory</code> would return an <code class="highlighter-rouge">EncodingFormat&lt;DeserializationSchema&gt;</code>
that can be passed into the Kafka table source.</p>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<h2 id="full-stack-example">Full Stack Example</h2>

<p>This section sketches how to implement a scan table source with a decoding format that supports changelog
semantics. The example illustrates how all of the mentioned components play together. It can serve as
a reference implementation.</p>

<p>In particular, it shows how to</p>
<ul>
  <li>create factories that parse and validate options,</li>
  <li>implement table connectors,</li>
  <li>implement and discover custom formats,</li>
  <li>and use provided utilities such as data structure converters and the <code class="highlighter-rouge">FactoryUtil</code>.</li>
</ul>

<p>The table source uses a simple single-threaded <code class="highlighter-rouge">SourceFunction</code> to open a socket that listens for incoming
bytes. The raw bytes are decoded into rows by a pluggable format. The format expects a changelog flag
as the first column.</p>

<p>We will use most of the interfaces mentioned above to enable the following DDL:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">UserScores</span> <span class="p">(</span><span class="n">name</span> <span class="n">STRING</span><span class="p">,</span> <span class="n">score</span> <span class="nb">INT</span><span class="p">)</span>
<span class="k">WITH</span> <span class="p">(</span>
  <span class="s1">'connector'</span> <span class="o">=</span> <span class="s1">'socket'</span><span class="p">,</span>
  <span class="s1">'hostname'</span> <span class="o">=</span> <span class="s1">'localhost'</span><span class="p">,</span>
  <span class="s1">'port'</span> <span class="o">=</span> <span class="s1">'9999'</span><span class="p">,</span>
  <span class="s1">'byte-delimiter'</span> <span class="o">=</span> <span class="s1">'10'</span><span class="p">,</span>
  <span class="s1">'format'</span> <span class="o">=</span> <span class="s1">'changelog-csv'</span><span class="p">,</span>
  <span class="s1">'changelog-csv.column-delimiter'</span> <span class="o">=</span> <span class="s1">'|'</span>
<span class="p">);</span></code></pre></figure>

<p>Because the format supports changelog semantics, we are able to ingest updates during runtime and create
an updating view that can continuously evaluate changing data:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">name</span><span class="p">,</span> <span class="k">SUM</span><span class="p">(</span><span class="n">score</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">UserScores</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">name</span><span class="p">;</span></code></pre></figure>

<p>Use the following command to ingest data in a terminal:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">&gt; nc -lk 9999
INSERT|Alice|12
INSERT|Bob|5
DELETE|Alice|12
INSERT|Alice|18</code></pre></figure>

<h3 id="factories">Factories</h3>

<p>This section illustrates how to translate metadata coming from the catalog to concrete connector instances.</p>

<p>Both factories have been added to the <code class="highlighter-rouge">META-INF/services</code> directory.</p>

<p><strong><code class="highlighter-rouge">SocketDynamicTableFactory</code></strong></p>

<p>The <code class="highlighter-rouge">SocketDynamicTableFactory</code> translates the catalog table to a table source. Because the table source
requires a decoding format, we are discovering the format using the provided <code class="highlighter-rouge">FactoryUtil</code> for convenience.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">org.apache.flink.api.common.serialization.DeserializationSchema</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.configuration.ConfigOption</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.configuration.ConfigOptions</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.configuration.ReadableConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.connector.format.DecodingFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.connector.source.DynamicTableSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.data.RowData</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.factories.DeserializationFormatFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.factories.DynamicTableSourceFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.factories.FactoryUtil</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.types.DataType</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SocketDynamicTableFactory</span> <span class="kd">implements</span> <span class="nc">DynamicTableSourceFactory</span> <span class="o">{</span>

  <span class="c1">// define all options statically</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">ConfigOption</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="no">HOSTNAME</span> <span class="o">=</span> <span class="nc">ConfigOptions</span><span class="o">.</span><span class="na">key</span><span class="o">(</span><span class="s">"hostname"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">stringType</span><span class="o">()</span>
    <span class="o">.</span><span class="na">noDefaultValue</span><span class="o">();</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">ConfigOption</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="no">PORT</span> <span class="o">=</span> <span class="nc">ConfigOptions</span><span class="o">.</span><span class="na">key</span><span class="o">(</span><span class="s">"port"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">intType</span><span class="o">()</span>
    <span class="o">.</span><span class="na">noDefaultValue</span><span class="o">();</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">ConfigOption</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="no">BYTE_DELIMITER</span> <span class="o">=</span> <span class="nc">ConfigOptions</span><span class="o">.</span><span class="na">key</span><span class="o">(</span><span class="s">"byte-delimiter"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">intType</span><span class="o">()</span>
    <span class="o">.</span><span class="na">defaultValue</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span> <span class="c1">// corresponds to '\n'</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">factoryIdentifier</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">"socket"</span><span class="o">;</span> <span class="c1">// used for matching to `connector = '...'`</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">ConfigOption</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">requiredOptions</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">ConfigOption</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">options</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;&gt;();</span>
    <span class="n">options</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="no">HOSTNAME</span><span class="o">);</span>
    <span class="n">options</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="no">PORT</span><span class="o">);</span>
    <span class="n">options</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">FactoryUtil</span><span class="o">.</span><span class="na">FORMAT</span><span class="o">);</span> <span class="c1">// use pre-defined option for format</span>
    <span class="k">return</span> <span class="n">options</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">ConfigOption</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">optionalOptions</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">ConfigOption</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">options</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;&gt;();</span>
    <span class="n">options</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="no">BYTE_DELIMITER</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">options</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">DynamicTableSource</span> <span class="nf">createDynamicTableSource</span><span class="o">(</span><span class="nc">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// either implement your custom validation logic here ...</span>
    <span class="c1">// or use the provided helper utility</span>
    <span class="kd">final</span> <span class="nc">FactoryUtil</span><span class="o">.</span><span class="na">TableFactoryHelper</span> <span class="n">helper</span> <span class="o">=</span> <span class="nc">FactoryUtil</span><span class="o">.</span><span class="na">createTableFactoryHelper</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">context</span><span class="o">);</span>

    <span class="c1">// discover a suitable decoding format</span>
    <span class="kd">final</span> <span class="nc">DecodingFormat</span><span class="o">&lt;</span><span class="nc">DeserializationSchema</span><span class="o">&lt;</span><span class="nc">RowData</span><span class="o">&gt;&gt;</span> <span class="n">decodingFormat</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="na">discoverDecodingFormat</span><span class="o">(</span>
      <span class="nc">DeserializationFormatFactory</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
      <span class="nc">FactoryUtil</span><span class="o">.</span><span class="na">FORMAT</span><span class="o">);</span>

    <span class="c1">// validate all options</span>
    <span class="n">helper</span><span class="o">.</span><span class="na">validate</span><span class="o">();</span>

    <span class="c1">// get the validated options</span>
    <span class="kd">final</span> <span class="nc">ReadableConfig</span> <span class="n">options</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="na">getOptions</span><span class="o">();</span>
    <span class="kd">final</span> <span class="nc">String</span> <span class="n">hostname</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="no">HOSTNAME</span><span class="o">);</span>
    <span class="kd">final</span> <span class="kt">int</span> <span class="n">port</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="no">PORT</span><span class="o">);</span>
    <span class="kd">final</span> <span class="kt">byte</span> <span class="n">byteDelimiter</span> <span class="o">=</span> <span class="o">(</span><span class="kt">byte</span><span class="o">)</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">options</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="no">BYTE_DELIMITER</span><span class="o">);</span>

    <span class="c1">// derive the produced data type (excluding computed columns) from the catalog table</span>
    <span class="kd">final</span> <span class="nc">DataType</span> <span class="n">producedDataType</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getCatalogTable</span><span class="o">().</span><span class="na">getSchema</span><span class="o">().</span><span class="na">toPhysicalRowDataType</span><span class="o">();</span>

    <span class="c1">// create and return dynamic table source</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">SocketDynamicTableSource</span><span class="o">(</span><span class="n">hostname</span><span class="o">,</span> <span class="n">port</span><span class="o">,</span> <span class="n">byteDelimiter</span><span class="o">,</span> <span class="n">decodingFormat</span><span class="o">,</span> <span class="n">producedDataType</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p><strong><code class="highlighter-rouge">ChangelogCsvFormatFactory</code></strong></p>

<p>The <code class="highlighter-rouge">ChangelogCsvFormatFactory</code> translates format-specific options to a format. The <code class="highlighter-rouge">FactoryUtil</code> in <code class="highlighter-rouge">SocketDynamicTableFactory</code>
takes care of adapting the option keys accordingly and handles the prefixing like <code class="highlighter-rouge">changelog-csv.column-delimiter</code>.</p>

<p>Because this factory implements <code class="highlighter-rouge">DeserializationFormatFactory</code>, it could also be used for other connectors
that support deserialization formats such as the Kafka connector.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">org.apache.flink.api.common.serialization.DeserializationSchema</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.configuration.ConfigOption</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.configuration.ConfigOptions</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.configuration.ReadableConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.connector.format.DecodingFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.data.RowData</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.factories.FactoryUtil</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.factories.DeserializationFormatFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.factories.DynamicTableFactory</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ChangelogCsvFormatFactory</span> <span class="kd">implements</span> <span class="nc">DeserializationFormatFactory</span> <span class="o">{</span>

  <span class="c1">// define all options statically</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">ConfigOption</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="no">COLUMN_DELIMITER</span> <span class="o">=</span> <span class="nc">ConfigOptions</span><span class="o">.</span><span class="na">key</span><span class="o">(</span><span class="s">"column-delimiter"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">stringType</span><span class="o">()</span>
    <span class="o">.</span><span class="na">defaultValue</span><span class="o">(</span><span class="s">"|"</span><span class="o">);</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">factoryIdentifier</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">"changelog-csv"</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">ConfigOption</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">requiredOptions</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nc">Collections</span><span class="o">.</span><span class="na">emptySet</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">ConfigOption</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">optionalOptions</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">ConfigOption</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">options</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;&gt;();</span>
    <span class="n">options</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="no">COLUMN_DELIMITER</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">options</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">DecodingFormat</span><span class="o">&lt;</span><span class="nc">DeserializationSchema</span><span class="o">&lt;</span><span class="nc">RowData</span><span class="o">&gt;&gt;</span> <span class="nf">createDecodingFormat</span><span class="o">(</span>
      <span class="nc">DynamicTableFactory</span><span class="o">.</span><span class="na">Context</span> <span class="n">context</span><span class="o">,</span>
      <span class="nc">ReadableConfig</span> <span class="n">formatOptions</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// either implement your custom validation logic here ...</span>
    <span class="c1">// or use the provided helper method</span>
    <span class="nc">FactoryUtil</span><span class="o">.</span><span class="na">validateFactoryOptions</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">formatOptions</span><span class="o">);</span>

    <span class="c1">// get the validated options</span>
    <span class="kd">final</span> <span class="nc">String</span> <span class="n">columnDelimiter</span> <span class="o">=</span> <span class="n">formatOptions</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="no">COLUMN_DELIMITER</span><span class="o">);</span>

    <span class="c1">// create and return the format</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">ChangelogCsvFormat</span><span class="o">(</span><span class="n">columnDelimiter</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<h3 id="table-source-and-decoding-format">Table Source and Decoding Format</h3>

<p>This section illustrates how to translate from instances of the planning layer to runtime instances that
are shipped to the cluster.</p>

<p><strong><code class="highlighter-rouge">SocketDynamicTableSource</code></strong></p>

<p>The <code class="highlighter-rouge">SocketDynamicTableSource</code> is used during planning. In our example, we don’t implement any of the
available ability interfaces. Therefore, the main logic can be found in <code class="highlighter-rouge">getScanRuntimeProvider(...)</code>
where we instantiate the required <code class="highlighter-rouge">SourceFunction</code> and its <code class="highlighter-rouge">DeserializationSchema</code> for runtime. Both
instances are parameterized to return internal data structures (i.e. <code class="highlighter-rouge">RowData</code>).</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">org.apache.flink.api.common.serialization.DeserializationSchema</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.streaming.api.functions.source.SourceFunction</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.connector.ChangelogMode</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.connector.format.DecodingFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.connector.source.DynamicTableSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.connector.source.ScanTableSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.connector.source.SourceFunctionProvider</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.data.RowData</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.types.DataType</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SocketDynamicTableSource</span> <span class="kd">implements</span> <span class="nc">ScanTableSource</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">hostname</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">port</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">byte</span> <span class="n">byteDelimiter</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">DecodingFormat</span><span class="o">&lt;</span><span class="nc">DeserializationSchema</span><span class="o">&lt;</span><span class="nc">RowData</span><span class="o">&gt;&gt;</span> <span class="n">decodingFormat</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">DataType</span> <span class="n">producedDataType</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">SocketDynamicTableSource</span><span class="o">(</span>
      <span class="nc">String</span> <span class="n">hostname</span><span class="o">,</span>
      <span class="kt">int</span> <span class="n">port</span><span class="o">,</span>
      <span class="kt">byte</span> <span class="n">byteDelimiter</span><span class="o">,</span>
      <span class="nc">DecodingFormat</span><span class="o">&lt;</span><span class="nc">DeserializationSchema</span><span class="o">&lt;</span><span class="nc">RowData</span><span class="o">&gt;&gt;</span> <span class="n">decodingFormat</span><span class="o">,</span>
      <span class="nc">DataType</span> <span class="n">producedDataType</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">hostname</span> <span class="o">=</span> <span class="n">hostname</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">port</span> <span class="o">=</span> <span class="n">port</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">byteDelimiter</span> <span class="o">=</span> <span class="n">byteDelimiter</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">decodingFormat</span> <span class="o">=</span> <span class="n">decodingFormat</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">producedDataType</span> <span class="o">=</span> <span class="n">producedDataType</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">ChangelogMode</span> <span class="nf">getChangelogMode</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// in our example the format decides about the changelog mode</span>
    <span class="c1">// but it could also be the source itself</span>
    <span class="k">return</span> <span class="n">decodingFormat</span><span class="o">.</span><span class="na">getChangelogMode</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">ScanRuntimeProvider</span> <span class="nf">getScanRuntimeProvider</span><span class="o">(</span><span class="nc">ScanContext</span> <span class="n">runtimeProviderContext</span><span class="o">)</span> <span class="o">{</span>

    <span class="c1">// create runtime classes that are shipped to the cluster</span>

    <span class="kd">final</span> <span class="nc">DeserializationSchema</span><span class="o">&lt;</span><span class="nc">RowData</span><span class="o">&gt;</span> <span class="n">deserializer</span> <span class="o">=</span> <span class="n">decodingFormat</span><span class="o">.</span><span class="na">createRuntimeDecoder</span><span class="o">(</span>
      <span class="n">runtimeProviderContext</span><span class="o">,</span>
      <span class="n">producedDataType</span><span class="o">);</span>

    <span class="kd">final</span> <span class="nc">SourceFunction</span><span class="o">&lt;</span><span class="nc">RowData</span><span class="o">&gt;</span> <span class="n">sourceFunction</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SocketSourceFunction</span><span class="o">(</span>
      <span class="n">hostname</span><span class="o">,</span>
      <span class="n">port</span><span class="o">,</span>
      <span class="n">byteDelimiter</span><span class="o">,</span>
      <span class="n">deserializer</span><span class="o">);</span>

    <span class="k">return</span> <span class="nc">SourceFunctionProvider</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">sourceFunction</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">DynamicTableSource</span> <span class="nf">copy</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">SocketDynamicTableSource</span><span class="o">(</span><span class="n">hostname</span><span class="o">,</span> <span class="n">port</span><span class="o">,</span> <span class="n">byteDelimiter</span><span class="o">,</span> <span class="n">decodingFormat</span><span class="o">,</span> <span class="n">producedDataType</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">asSummaryString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">"Socket Table Source"</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p><strong><code class="highlighter-rouge">ChangelogCsvFormat</code></strong></p>

<p>The <code class="highlighter-rouge">ChangelogCsvFormat</code> is a decoding format that uses a <code class="highlighter-rouge">DeserializationSchema</code> during runtime. It
supports emitting <code class="highlighter-rouge">INSERT</code> and <code class="highlighter-rouge">DELETE</code> changes.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">org.apache.flink.api.common.serialization.DeserializationSchema</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.api.common.typeinfo.TypeInformation</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.connector.ChangelogMode</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.connector.format.DecodingFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.connector.source.DynamicTableSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.connector.source.DynamicTableSource.DataStructureConverter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.data.RowData</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.types.DataType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.types.logical.LogicalType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.types.RowKind</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ChangelogCsvFormat</span> <span class="kd">implements</span> <span class="nc">DecodingFormat</span><span class="o">&lt;</span><span class="nc">DeserializationSchema</span><span class="o">&lt;</span><span class="nc">RowData</span><span class="o">&gt;&gt;</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">columnDelimiter</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">ChangelogCsvFormat</span><span class="o">(</span><span class="nc">String</span> <span class="n">columnDelimiter</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">columnDelimiter</span> <span class="o">=</span> <span class="n">columnDelimiter</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="nc">DeserializationSchema</span><span class="o">&lt;</span><span class="nc">RowData</span><span class="o">&gt;</span> <span class="nf">createRuntimeDecoder</span><span class="o">(</span>
      <span class="nc">DynamicTableSource</span><span class="o">.</span><span class="na">Context</span> <span class="n">context</span><span class="o">,</span>
      <span class="nc">DataType</span> <span class="n">producedDataType</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// create type information for the DeserializationSchema</span>
    <span class="kd">final</span> <span class="nc">TypeInformation</span><span class="o">&lt;</span><span class="nc">RowData</span><span class="o">&gt;</span> <span class="n">producedTypeInfo</span> <span class="o">=</span> <span class="o">(</span><span class="nc">TypeInformation</span><span class="o">&lt;</span><span class="nc">RowData</span><span class="o">&gt;)</span> <span class="n">context</span><span class="o">.</span><span class="na">createTypeInformation</span><span class="o">(</span>
      <span class="n">producedDataType</span><span class="o">);</span>

    <span class="c1">// most of the code in DeserializationSchema will not work on internal data structures</span>
    <span class="c1">// create a converter for conversion at the end</span>
    <span class="kd">final</span> <span class="nc">DataStructureConverter</span> <span class="n">converter</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">createDataStructureConverter</span><span class="o">(</span><span class="n">producedDataType</span><span class="o">);</span>

    <span class="c1">// use logical types during runtime for parsing</span>
    <span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">LogicalType</span><span class="o">&gt;</span> <span class="n">parsingTypes</span> <span class="o">=</span> <span class="n">producedDataType</span><span class="o">.</span><span class="na">getLogicalType</span><span class="o">().</span><span class="na">getChildren</span><span class="o">();</span>

    <span class="c1">// create runtime class</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">ChangelogCsvDeserializer</span><span class="o">(</span><span class="n">parsingTypes</span><span class="o">,</span> <span class="n">converter</span><span class="o">,</span> <span class="n">producedTypeInfo</span><span class="o">,</span> <span class="n">columnDelimiter</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">ChangelogMode</span> <span class="nf">getChangelogMode</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// define that this format can produce INSERT and DELETE rows</span>
    <span class="k">return</span> <span class="nc">ChangelogMode</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">()</span>
      <span class="o">.</span><span class="na">addContainedKind</span><span class="o">(</span><span class="nc">RowKind</span><span class="o">.</span><span class="na">INSERT</span><span class="o">)</span>
      <span class="o">.</span><span class="na">addContainedKind</span><span class="o">(</span><span class="nc">RowKind</span><span class="o">.</span><span class="na">DELETE</span><span class="o">)</span>
      <span class="o">.</span><span class="na">build</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<h3 id="runtime-1">Runtime</h3>

<p>For completeness, this section illustrates the runtime logic for both <code class="highlighter-rouge">SourceFunction</code> and <code class="highlighter-rouge">DeserializationSchema</code>.</p>

<p><strong>ChangelogCsvDeserializer</strong></p>

<p>The <code class="highlighter-rouge">ChangelogCsvDeserializer</code> contains a simple parsing logic for converting bytes into <code class="highlighter-rouge">Row</code> of <code class="highlighter-rouge">Integer</code>
and <code class="highlighter-rouge">String</code> with a row kind. The final conversion step converts those into internal data structures.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">org.apache.flink.api.common.serialization.DeserializationSchema</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.api.common.typeinfo.TypeInformation</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.connector.RuntimeConverter.Context</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.connector.source.DynamicTableSource.DataStructureConverter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.data.RowData</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.types.logical.LogicalType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.types.logical.LogicalTypeRoot</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.types.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.types.RowKind</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ChangelogCsvDeserializer</span> <span class="kd">implements</span> <span class="nc">DeserializationSchema</span><span class="o">&lt;</span><span class="nc">RowData</span><span class="o">&gt;</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">LogicalType</span><span class="o">&gt;</span> <span class="n">parsingTypes</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">DataStructureConverter</span> <span class="n">converter</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">TypeInformation</span><span class="o">&lt;</span><span class="nc">RowData</span><span class="o">&gt;</span> <span class="n">producedTypeInfo</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">columnDelimiter</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">ChangelogCsvDeserializer</span><span class="o">(</span>
      <span class="nc">List</span><span class="o">&lt;</span><span class="nc">LogicalType</span><span class="o">&gt;</span> <span class="n">parsingTypes</span><span class="o">,</span>
      <span class="nc">DataStructureConverter</span> <span class="n">converter</span><span class="o">,</span>
      <span class="nc">TypeInformation</span><span class="o">&lt;</span><span class="nc">RowData</span><span class="o">&gt;</span> <span class="n">producedTypeInfo</span><span class="o">,</span>
      <span class="nc">String</span> <span class="n">columnDelimiter</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">parsingTypes</span> <span class="o">=</span> <span class="n">parsingTypes</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">converter</span> <span class="o">=</span> <span class="n">converter</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">producedTypeInfo</span> <span class="o">=</span> <span class="n">producedTypeInfo</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">columnDelimiter</span> <span class="o">=</span> <span class="n">columnDelimiter</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">TypeInformation</span><span class="o">&lt;</span><span class="nc">RowData</span><span class="o">&gt;</span> <span class="nf">getProducedType</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// return the type information required by Flink's core interfaces</span>
    <span class="k">return</span> <span class="n">producedTypeInfo</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">open</span><span class="o">(</span><span class="nc">InitializationContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// converters must be open</span>
    <span class="n">converter</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="nc">Context</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">ChangelogCsvDeserializer</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getClassLoader</span><span class="o">()));</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">RowData</span> <span class="nf">deserialize</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// parse the columns including a changelog flag</span>
    <span class="kd">final</span> <span class="nc">String</span><span class="o">[]</span> <span class="n">columns</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="n">message</span><span class="o">).</span><span class="na">split</span><span class="o">(</span><span class="nc">Pattern</span><span class="o">.</span><span class="na">quote</span><span class="o">(</span><span class="n">columnDelimiter</span><span class="o">));</span>
    <span class="kd">final</span> <span class="nc">RowKind</span> <span class="n">kind</span> <span class="o">=</span> <span class="nc">RowKind</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">columns</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
    <span class="kd">final</span> <span class="nc">Row</span> <span class="n">row</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Row</span><span class="o">(</span><span class="n">kind</span><span class="o">,</span> <span class="n">parsingTypes</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">parsingTypes</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
      <span class="n">row</span><span class="o">.</span><span class="na">setField</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">parse</span><span class="o">(</span><span class="n">parsingTypes</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">getTypeRoot</span><span class="o">(),</span> <span class="n">columns</span><span class="o">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">]));</span>
    <span class="o">}</span>
    <span class="c1">// convert to internal data structure</span>
    <span class="k">return</span> <span class="o">(</span><span class="nc">RowData</span><span class="o">)</span> <span class="n">converter</span><span class="o">.</span><span class="na">toInternal</span><span class="o">(</span><span class="n">row</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="kd">static</span> <span class="nc">Object</span> <span class="nf">parse</span><span class="o">(</span><span class="nc">LogicalTypeRoot</span> <span class="n">root</span><span class="o">,</span> <span class="nc">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">switch</span> <span class="o">(</span><span class="n">root</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nl">INTEGER:</span>
        <span class="k">return</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
      <span class="k">case</span> <span class="nl">VARCHAR:</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">;</span>
      <span class="k">default</span><span class="o">:</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isEndOfStream</span><span class="o">(</span><span class="nc">RowData</span> <span class="n">nextElement</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p><strong>SocketSourceFunction</strong></p>

<p>The <code class="highlighter-rouge">SocketSourceFunction</code> opens a socket and consumes bytes. It splits records by the given byte
delimiter (<code class="highlighter-rouge">\n</code> by default) and delegates the decoding to a pluggable <code class="highlighter-rouge">DeserializationSchema</code>. The
source function can only work with a parallelism of 1.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">org.apache.flink.api.common.serialization.DeserializationSchema</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.api.common.typeinfo.TypeInformation</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.api.java.typeutils.ResultTypeQueryable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.configuration.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.streaming.api.functions.source.RichSourceFunction</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.data.RowData</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SocketSourceFunction</span> <span class="kd">extends</span> <span class="nc">RichSourceFunction</span><span class="o">&lt;</span><span class="nc">RowData</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="nc">ResultTypeQueryable</span><span class="o">&lt;</span><span class="nc">RowData</span><span class="o">&gt;</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">hostname</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">port</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">byte</span> <span class="n">byteDelimiter</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">DeserializationSchema</span><span class="o">&lt;</span><span class="nc">RowData</span><span class="o">&gt;</span> <span class="n">deserializer</span><span class="o">;</span>

  <span class="kd">private</span> <span class="kd">volatile</span> <span class="kt">boolean</span> <span class="n">isRunning</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
  <span class="kd">private</span> <span class="nc">Socket</span> <span class="n">currentSocket</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">SocketSourceFunction</span><span class="o">(</span><span class="nc">String</span> <span class="n">hostname</span><span class="o">,</span> <span class="kt">int</span> <span class="n">port</span><span class="o">,</span> <span class="kt">byte</span> <span class="n">byteDelimiter</span><span class="o">,</span> <span class="nc">DeserializationSchema</span><span class="o">&lt;</span><span class="nc">RowData</span><span class="o">&gt;</span> <span class="n">deserializer</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">hostname</span> <span class="o">=</span> <span class="n">hostname</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">port</span> <span class="o">=</span> <span class="n">port</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">byteDelimiter</span> <span class="o">=</span> <span class="n">byteDelimiter</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">deserializer</span> <span class="o">=</span> <span class="n">deserializer</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">TypeInformation</span><span class="o">&lt;</span><span class="nc">RowData</span><span class="o">&gt;</span> <span class="nf">getProducedType</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">deserializer</span><span class="o">.</span><span class="na">getProducedType</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">open</span><span class="o">(</span><span class="nc">Configuration</span> <span class="n">parameters</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="n">deserializer</span><span class="o">.</span><span class="na">open</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">getRuntimeContext</span><span class="o">().</span><span class="na">getMetricGroup</span><span class="o">());</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="nc">SourceContext</span><span class="o">&lt;</span><span class="nc">RowData</span><span class="o">&gt;</span> <span class="n">ctx</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="k">while</span> <span class="o">(</span><span class="n">isRunning</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// open and consume from socket</span>
      <span class="k">try</span> <span class="o">(</span><span class="kd">final</span> <span class="nc">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Socket</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">currentSocket</span> <span class="o">=</span> <span class="n">socket</span><span class="o">;</span>
        <span class="n">socket</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="k">new</span> <span class="nc">InetSocketAddress</span><span class="o">(</span><span class="n">hostname</span><span class="o">,</span> <span class="n">port</span><span class="o">),</span> <span class="mi">0</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">(</span><span class="nc">InputStream</span> <span class="n">stream</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">())</span> <span class="o">{</span>
          <span class="nc">ByteArrayOutputStream</span> <span class="n">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ByteArrayOutputStream</span><span class="o">();</span>
          <span class="kt">int</span> <span class="n">b</span><span class="o">;</span>
          <span class="k">while</span> <span class="o">((</span><span class="n">b</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="na">read</span><span class="o">())</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// buffer until delimiter</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">b</span> <span class="o">!=</span> <span class="n">byteDelimiter</span><span class="o">)</span> <span class="o">{</span>
              <span class="n">buffer</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">b</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="c1">// decode and emit record</span>
            <span class="k">else</span> <span class="o">{</span>
              <span class="n">ctx</span><span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">deserializer</span><span class="o">.</span><span class="na">deserialize</span><span class="o">(</span><span class="n">buffer</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">()));</span>
              <span class="n">buffer</span><span class="o">.</span><span class="na">reset</span><span class="o">();</span>
            <span class="o">}</span>
          <span class="o">}</span>
        <span class="o">}</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Throwable</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">t</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span> <span class="c1">// print and continue</span>
      <span class="o">}</span>
      <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1000</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">cancel</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">isRunning</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">currentSocket</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Throwable</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// ignore</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>



<div class="footer">
  <a href="https://cwiki.apache.org/confluence/display/FLINK/Flink+Translation+Specifications" target="_blank">
    
      想参与贡献翻译？
    
  </a>
</div>


        </div>
      </div>
    </div><!-- /.container -->

    <!-- default code tab -->
    <script>var defaultCodeTab = "";</script>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/js/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.1.0/anchor.min.js"></script>
    <script src="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/js/flink.js"></script>

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-52545728-1', 'auto');
      ga('send', 'pageview');
    </script>

    <!-- Disqus -->
    
  </body>
</html>
