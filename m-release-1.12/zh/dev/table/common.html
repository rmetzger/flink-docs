<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Apache Flink 1.12 Documentation: 概念与通用 API</title>
    <link rel="shortcut icon" href="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/favicon.ico" type="image/x-icon">
    <link rel="icon" href="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/favicon.ico" type="image/x-icon">
    <link rel="canonical" href="//ci.apache.org/projects/flink/flink-docs-stable/zh/dev/table/common.html">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/css/flink.css">
    <link rel="stylesheet" href="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/css/syntax.css">
    <link rel="stylesheet" href="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/css/codetabs.css">
    <link rel="stylesheet" href="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/font-awesome/css/font-awesome.min.css">
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    

    <!-- Main content. -->
    <div class="container">
      
      <div class="row">
        <div class="col-lg-3" id="sidenavcol">
          <div class="sidenav-logo">
  <p><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/"><img class="bottom" alt="Apache Flink" src="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/img/navbar-brand-logo.jpg"></a> v1.12</p>
</div>
<ul id="sidenav">
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/"><i class="fa fa-home title" aria-hidden="true"></i> Home</a></li><hr class="section-break"></hr>
<li><a href="#collapse-2" data-toggle="collapse"><i class="fa fa-rocket title appetizer" aria-hidden="true"></i> Try Flink<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-2"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/try-flink/local_installation.html">本地模式安装</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/try-flink/datastream_api.html">基于 DataStream API 实现欺诈检测</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/try-flink/table_api.html">基于 Table API 实现实时报表</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/try-flink/flink-operations-playground.html">Flink 操作场景</a></li>
</ul></div></li>
<li><a href="#collapse-8" data-toggle="collapse"><i class="fa fa-hand-paper-o title appetizer" aria-hidden="true"></i> 实践练习<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-8"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/learn-flink/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/learn-flink/datastream_api.html">DataStream API 简介</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/learn-flink/etl.html">数据管道 & ETL</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/learn-flink/streaming_analytics.html">流式分析</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/learn-flink/event_driven.html">事件驱动应用</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/learn-flink/fault_tolerance.html">容错处理</a></li>
</ul></div></li>
<li><a href="#collapse-15" data-toggle="collapse"><i class="fa fa-map-o title appetizer" aria-hidden="true"></i> 概念透析<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-15"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/concepts/index.html">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/concepts/stateful-stream-processing.html">有状态流处理</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/concepts/timely-stream-processing.html">及时流处理</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/concepts/flink-architecture.html">Flink 架构</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/concepts/glossary.html">词汇表</a></li>
</ul></div></li><hr class="section-break"></hr>
<li><a href="#collapse-21" data-toggle="collapse"class="active"><i class="fa fa-code title maindish" aria-hidden="true"></i> 应用开发</a><div class="collapse in" id="collapse-21"><ul>
<li><a href="#collapse-22" data-toggle="collapse">DataStream API<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-22"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/datastream_api.html">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/datastream_execution_mode.html">Execution Mode (Batch/Streaming)</a></li>
<li><a href="#collapse-24" data-toggle="collapse">事件时间<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-24"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/event_time.html">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/event_timestamps_watermarks.html">生成 Watermark</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/event_timestamp_extractors.html">内置 Watermark 生成器</a></li>
</ul></div></li>
<li><a href="#collapse-28" data-toggle="collapse">状态与容错<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-28"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/state.html">Working with State</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/broadcast_state.html">Broadcast State 模式</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/checkpointing.html">Checkpointing</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/queryable_state.html">Queryable State</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/state_backends.html">State Backends</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/schema_evolution.html">状态数据结构升级</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/custom_serialization.html">自定义状态序列化</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/user_defined_functions.html">用户自定义 Functions</a></li>
<li><a href="#collapse-38" data-toggle="collapse">算子<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-38"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/operators/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/operators/windows.html">窗口</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/operators/joining.html">Joining</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/operators/process_function.html">Process Function</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/operators/asyncio.html">异步 I/O</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/sources.html">Data Sources</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/side_output.html">旁路输出</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/application_parameters.html">Handling Application Parameters</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/testing.html">测试</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/experimental.html">实验功能</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/scala_api_extensions.html">Scala API Extensions</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/java_lambdas.html">Java Lambda 表达式</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/project-configuration.html">Project Configuration</a></li>
</ul></div></li>
<li><a href="#collapse-53" data-toggle="collapse">DataSet API<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-53"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/dataset_transformations.html">Transformations</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/iterations.html">迭代</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/zip_elements_guide.html">Zipping Elements</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/hadoop_compatibility.html">Hadoop 兼容</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/local_execution.html">本地执行</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/cluster_execution.html">集群执行</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/examples.html">Batch 示例</a></li>
</ul></div></li>
<li><a href="#collapse-62" data-toggle="collapse"class="active">Table API & SQL</a><div class="collapse in" id="collapse-62"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/common.html" class="active">概念与通用 API</a></li>
<li><a href="#collapse-64" data-toggle="collapse">流式概念<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-64"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/streaming/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/streaming/dynamic_tables.html">动态表 (Dynamic Table)</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/streaming/time_attributes.html">时间属性</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/streaming/joins.html">流上的 Join</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/streaming/temporal_tables.html">时态表（Temporal Tables）</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/streaming/match_recognize.html">模式检测</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/streaming/query_configuration.html">Query Configuration</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/types.html">数据类型</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/tableApi.html">Table API</a></li>
<li><a href="#collapse-74" data-toggle="collapse">SQL<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-74"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/queries.html">查询语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/create.html">CREATE 语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/drop.html">DROP 语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/alter.html">ALTER 语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/insert.html">INSERT 语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/hints.html">SQL Hints</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/describe.html">DESCRIBE 语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/explain.html">EXPLAIN 语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/use.html">USE 语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/show.html">SHOW 语句</a></li>
</ul></div></li>
<li><a href="#collapse-86" data-toggle="collapse">函数<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-86"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/functions/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/functions/systemFunctions.html">系统（内置）函数</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/functions/udfs.html">自定义函数</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/modules.html">模块</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/catalogs.html">Catalogs</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sqlClient.html">SQL 客户端</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/config.html">配置</a></li>
<li><a href="#collapse-94" data-toggle="collapse">Performance Tuning<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-94"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/tuning/streaming_aggregation_optimization.html">流式聚合</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sourceSinks.html">User-defined Sources & Sinks</a></li>
</ul></div></li>
<li><a href="#collapse-99" data-toggle="collapse">Python API<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-99"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/installation.html">环境安装</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table_api_tutorial.html">Table API 教程</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/datastream_tutorial.html">DataStream API 教程</a></li>
<li><a href="#collapse-103" data-toggle="collapse">Table API用户指南<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-103"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/intro_to_table_api.html">Python Table API 简介</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/table_environment.html">TableEnvironment</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/operations.html">Operations</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/python_types.html">数据类型</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/built_in_functions.html">系统（内置）函数</a></li>
<li><a href="#collapse-109" data-toggle="collapse">自定义函数<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-109"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/udfs/python_udfs.html">普通自定义函数（UDF）</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/udfs/vectorized_python_udfs.html">向量化自定义函数</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/conversion_of_pandas.html">PyFlink Table 和 Pandas DataFrame 互转</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/dependency_management.html">依赖管理</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/sql.html">SQL</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/catalogs.html">Catalogs</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/metrics.html">指标</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/python_table_api_connectors.html">连接器</a></li>
</ul></div></li>
<li><a href="#collapse-120" data-toggle="collapse">DataStream API用户指南<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-120"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/datastream-api-users-guide/data_types.html">数据类型</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/datastream-api-users-guide/operators.html">算子</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/datastream-api-users-guide/dependency_management.html">依赖管理</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/python_config.html">配置</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/environment_variables.html">环境变量</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/faq.html">常见问题</a></li>
</ul></div></li>
<li><a href="#collapse-129" data-toggle="collapse">数据类型以及序列化<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-129"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/types_serialization.html">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/custom_serializers.html">自定义序列化器</a></li>
</ul></div></li>
<li><a href="#collapse-132" data-toggle="collapse">管理执行<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-132"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/execution_configuration.html">执行配置</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/packaging.html">程序打包</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/parallel.html">并行执行</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/execution_plans.html">执行计划</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/task_failure_recovery.html">Task 故障恢复</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/migration.html">API 迁移指南</a></li>
</ul></div></li>
<li><a href="#collapse-141" data-toggle="collapse"><i class="fa fa-book title maindish" aria-hidden="true"></i> Libraries<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-141"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/cep.html">事件处理 (CEP)</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/state_processor_api.html">State Processor API</a></li>
<li><a href="#collapse-144" data-toggle="collapse">图计算: Gelly<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-144"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/graph_api.html">Graph API</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/iterative_graph_processing.html">Iterative Graph Processing</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/library_methods.html">Library Methods</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/graph_algorithms.html">Graph Algorithms</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/graph_generators.html">Graph Generators</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/bipartite_graph.html">Bipartite Graph</a></li>
</ul></div></li>
</ul></div></li>
<li><a href="#collapse-153" data-toggle="collapse"><i class="fa fa-random title maindish" aria-hidden="true"></i> Connectors<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-153"><ul>
<li><a href="#collapse-154" data-toggle="collapse">DataStream Connectors<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-154"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/guarantees.html">容错保证</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/kafka.html">Kafka</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/cassandra.html">Cassandra</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/kinesis.html">Kinesis</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/elasticsearch.html">Elasticsearch</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/file_sink.html">File Sink</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/streamfile_sink.html">Streaming File Sink</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/rabbitmq.html">RabbitMQ</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/nifi.html">NiFi</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/pubsub.html">Google Cloud PubSub</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/twitter.html">Twitter</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/jdbc.html">JDBC</a></li>
</ul></div></li>
<li><a href="#collapse-168" data-toggle="collapse">Table & SQL Connectors<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-168"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/">概览</a></li>
<li><a href="#collapse-169" data-toggle="collapse">Formats<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-169"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/csv.html">CSV</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/json.html">JSON</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/avro-confluent.html">Confluent Avro</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/avro.html">Avro</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/debezium.html">Debezium</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/canal.html">Canal</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/maxwell.html">Maxwell</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/parquet.html">Parquet</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/orc.html">Orc</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/raw.html">Raw</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/kafka.html">Kafka</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/upsert-kafka.html">Upsert Kafka</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/kinesis.html">Kinesis</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/jdbc.html">JDBC</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/elasticsearch.html">Elasticsearch</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/filesystem.html">FileSystem</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/hbase.html">HBase</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/datagen.html">DataGen</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/print.html">Print</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/blackhole.html">BlackHole</a></li>
<li><a href="#collapse-191" data-toggle="collapse">Hive<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-191"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/hive/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/hive/hive_catalog.html">Hive Catalog</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/hive/hive_dialect.html">Hive 方言</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/hive/hive_read_write.html">Hive Read & Write</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/hive/hive_functions.html">Hive 函数</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/downloads.html">下载</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/connectors.html">DataSet Connectors</a></li>
</ul></div></li>
<li><a href="#collapse-201" data-toggle="collapse"><i class="fa fa-sliders title maindish" aria-hidden="true"></i> Deployment<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-201"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/">概览</a></li>
<li><a href="#collapse-202" data-toggle="collapse">Resource Providers<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-202"><ul>
<li><a href="#collapse-203" data-toggle="collapse">Standalone<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-203"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/resource-providers/standalone/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/resource-providers/standalone/local.html">本地集群</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/resource-providers/standalone/docker.html">Docker</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/resource-providers/standalone/kubernetes.html">Kubernetes</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/resource-providers/native_kubernetes.html">Native Kubernetes</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/resource-providers/yarn.html">YARN</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/resource-providers/mesos.html">Mesos</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/config.html">配置参数</a></li>
<li><a href="#collapse-213" data-toggle="collapse">内存配置<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-213"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_setup.html">配置 Flink 进程的内存</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_setup_tm.html">配置 TaskManager 内存</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_setup_jobmanager.html">配置 JobManager 内存</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_tuning.html">调优指南</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_trouble.html">常见问题</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_migration.html">升级指南</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/cli.html">Command-Line Interface</a></li>
<li><a href="#collapse-222" data-toggle="collapse">文件系统<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-222"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/filesystems/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/filesystems/common.html">通用配置</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/filesystems/s3.html">Amazon S3</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/filesystems/oss.html">阿里云 OSS</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/filesystems/azure.html">Azure Blob 存储</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/filesystems/plugins.html">Plugins</a></li>
</ul></div></li>
<li><a href="#collapse-229" data-toggle="collapse">High Availability (HA)<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-229"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/ha/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/ha/zookeeper_ha.html">ZooKeeper HA Services</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/ha/kubernetes_ha.html">Kubernetes HA Services</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/metric_reporters.html">Metric Reporters</a></li>
<li><a href="#collapse-234" data-toggle="collapse">Security<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-234"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/security/security-ssl.html">SSL 设置</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/security/security-kerberos.html">Kerberos</a></li>
</ul></div></li>
<li><a href="#collapse-238" data-toggle="collapse">REPLs<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-238"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/repls/python_shell.html">Python REPL</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/repls/scala_shell.html">Scala REPL</a></li>
</ul></div></li>
<li><a href="#collapse-242" data-toggle="collapse">Advanced<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-242"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/advanced/external_resources.html">扩展资源</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/advanced/historyserver.html">History Server</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/advanced/logging.html">日志</a></li>
</ul></div></li>
</ul></div></li>
<li><a href="#collapse-248" data-toggle="collapse"><i class="fa fa-cogs title maindish" aria-hidden="true"></i> Operations<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-248"><ul>
<li><a href="#collapse-249" data-toggle="collapse">状态与容错<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-249"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/state/checkpoints.html">Checkpoints</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/state/savepoints.html">Savepoints</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/state/state_backends.html">State Backends</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/state/large_state_tuning.html">大状态与 Checkpoint 调优</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/metrics.html">指标</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/rest_api.html">REST API</a></li>
<li><a href="#collapse-257" data-toggle="collapse">Debugging<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-257"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/debugging/debugging_event_time.html">调试窗口与事件时间</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/debugging/debugging_classloading.html">调试类加载</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/debugging/application_profiling.html">应用程序分析</a></li>
</ul></div></li>
<li><a href="#collapse-262" data-toggle="collapse">Monitoring<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-262"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/monitoring/checkpoint_monitoring.html">监控 Checkpoint</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/monitoring/back_pressure.html">监控反压</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/upgrading.html">升级应用程序和 Flink 版本</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/production_ready.html">生产就绪情况核对清单</a></li>
</ul></div></li><hr class="section-break"></hr>
<li><a href="#collapse-269" data-toggle="collapse"><i class="fa fa-cogs title dessert" aria-hidden="true"></i> Flink 开发<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-269"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/flinkDev/ide_setup.html">导入 Flink 到 IDE 中</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/flinkDev/building.html">从源码构建 Flink</a></li>
</ul></div></li>
<li><a href="#collapse-273" data-toggle="collapse"><i class="fa fa-book title dessert" aria-hidden="true"></i> 内幕<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-273"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/internals/job_scheduling.html">作业调度</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/internals/task_lifecycle.html">Task 生命周期</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/internals/filesystems.html">文件系统</a></li>
</ul></div></li>
  <li class="divider"></li>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/api/java"><i class="fa fa-external-link title" aria-hidden="true"></i> Javadocs</a></li>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/api/scala/index.html#org.apache.flink.api.scala.package"><i class="fa fa-external-link title" aria-hidden="true"></i> Scaladocs</a></li>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/api/python"><i class="fa fa-external-link title" aria-hidden="true"></i> Pythondocs</a></li>
  <li><a href="http://flink.apache.org"><i class="fa fa-external-link title" aria-hidden="true"></i> Project Page</a></li>
</ul>

<div class="sidenav-search-box">
  <form class="navbar-form" role="search" action="//ci.apache.org/projects/flink/flink-docs-release-1.12/search-results.html">
    <div class="form-group">
      <input type="text" class="form-control" size="16px" name="q" placeholder="Search">
    </div>
    <button type="submit" class="btn btn-default">Go</button>
  </form>
</div>

<div class="sidenav-versions">
  <div class="dropdown">
    <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">选择文档版本<span class="caret"></span></button>
    <ul class="dropdown-menu">
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.11">v1.11</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.10">v1.10</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.9">v1.9</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.8">v1.8</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.7">v1.7</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.6">v1.6</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.5">v1.5</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.4">v1.4</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.3">v1.3</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.2">v1.2</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.1">v1.1</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.0">v1.0</a></li>
    </ul>
  </div>
</div>

<div class="sidenav-languages"><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/dev/table/common.html">
      <button type="submit" class="btn btn-default">English</button>
    </a>
</div>

        </div>
        <div class="col-lg-9 content" id="contentcol">

          

<ol class="breadcrumb">
  
    <li><i class="fa fa-code title maindish" aria-hidden="true"></i> 应用开发</li>
  
    <li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/">Table API & SQL</a></li>
  
    <li class="active">概念与通用 API</li>
</ol>

<h1>概念与通用 API</h1>




<p>Table API 和 SQL 集成在同一套 API 中。这套 API 的核心概念是<code class="highlighter-rouge">Table</code>，用作查询的输入和输出。本文介绍了 Table API 和 SQL 查询程序的通用结构、如何注册 <code class="highlighter-rouge">Table</code> 、如何查询 <code class="highlighter-rouge">Table</code> 以及如何输出 <code class="highlighter-rouge">Table</code> 。</p>

<ul id="markdown-toc">
  <li><a href="#两种计划器planner的主要区别" id="markdown-toc-两种计划器planner的主要区别">两种计划器（Planner）的主要区别</a></li>
  <li><a href="#table-api-和-sql-程序的结构" id="markdown-toc-table-api-和-sql-程序的结构">Table API 和 SQL 程序的结构</a></li>
  <li><a href="#创建-tableenvironment" id="markdown-toc-创建-tableenvironment">创建 TableEnvironment</a></li>
  <li><a href="#在-catalog-中创建表" id="markdown-toc-在-catalog-中创建表">在 Catalog 中创建表</a>    <ul>
      <li><a href="#临时表temporary-table和永久表permanent-table" id="markdown-toc-临时表temporary-table和永久表permanent-table">临时表（Temporary Table）和永久表（Permanent Table）</a></li>
      <li><a href="#创建表" id="markdown-toc-创建表">创建表</a></li>
      <li><a href="#扩展表标识符" id="markdown-toc-扩展表标识符">扩展表标识符</a></li>
    </ul>
  </li>
  <li><a href="#查询表" id="markdown-toc-查询表">查询表</a>    <ul>
      <li><a href="#table-api" id="markdown-toc-table-api">Table API</a></li>
      <li><a href="#sql" id="markdown-toc-sql">SQL</a></li>
      <li><a href="#混用-table-api-和-sql" id="markdown-toc-混用-table-api-和-sql">混用 Table API 和 SQL</a></li>
    </ul>
  </li>
  <li><a href="#输出表" id="markdown-toc-输出表">输出表</a></li>
  <li><a href="#翻译与执行查询" id="markdown-toc-翻译与执行查询">翻译与执行查询</a></li>
  <li><a href="#与-datastream-和-dataset-api-结合" id="markdown-toc-与-datastream-和-dataset-api-结合">与 DataStream 和 DataSet API 结合</a>    <ul>
      <li><a href="#scala-隐式转换" id="markdown-toc-scala-隐式转换">Scala 隐式转换</a></li>
      <li><a href="#通过-dataset-或-datastream-创建视图" id="markdown-toc-通过-dataset-或-datastream-创建视图">通过 DataSet 或 DataStream 创建<code class="highlighter-rouge">视图</code></a></li>
      <li><a href="#将-datastream-或-dataset-转换成表" id="markdown-toc-将-datastream-或-dataset-转换成表">将 DataStream 或 DataSet 转换成表</a></li>
      <li><a href="#将表转换成-datastream-或-dataset" id="markdown-toc-将表转换成-datastream-或-dataset">将表转换成 DataStream 或 DataSet</a></li>
      <li><a href="#数据类型到-table-schema-的映射" id="markdown-toc-数据类型到-table-schema-的映射">数据类型到 Table Schema 的映射</a></li>
    </ul>
  </li>
  <li><a href="#查询优化" id="markdown-toc-查询优化">查询优化</a></li>
  <li><a href="#解释表" id="markdown-toc-解释表">解释表</a></li>
</ul>

<p><a name="main-differences-between-the-two-planners"></a></p>

<h2 id="两种计划器planner的主要区别">两种计划器（Planner）的主要区别</h2>

<ol>
  <li>Blink 将批处理作业视作流处理的一种特例。严格来说，<code class="highlighter-rouge">Table</code> 和 <code class="highlighter-rouge">DataSet</code> 之间不支持相互转换，并且批处理作业也不会转换成 <code class="highlighter-rouge">DataSet</code> 程序而是转换成 <code class="highlighter-rouge">DataStream</code> 程序，流处理作业也一样。</li>
  <li>Blink 计划器不支持  <code class="highlighter-rouge">BatchTableSource</code>，而是使用有界的  <code class="highlighter-rouge">StreamTableSource</code> 来替代。</li>
  <li>旧计划器和 Blink 计划器中 <code class="highlighter-rouge">FilterableTableSource</code> 的实现是不兼容的。旧计划器会将 <code class="highlighter-rouge">PlannerExpression</code> 下推至 <code class="highlighter-rouge">FilterableTableSource</code>，而 Blink 计划器则是将 <code class="highlighter-rouge">Expression</code> 下推。</li>
  <li>基于字符串的键值配置选项仅在 Blink 计划器中使用。（详情参见 <a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/config.html">配置</a> ）</li>
  <li><code class="highlighter-rouge">PlannerConfig</code> 在两种计划器中的实现（<code class="highlighter-rouge">CalciteConfig</code>）是不同的。</li>
  <li>Blink 计划器会将多sink（multiple-sinks）优化成一张有向无环图（DAG），<code class="highlighter-rouge">TableEnvironment</code> 和 <code class="highlighter-rouge">StreamTableEnvironment</code> 都支持该特性。旧计划器总是将每个sink都优化成一个新的有向无环图，且所有图相互独立。</li>
  <li>旧计划器目前不支持 catalog 统计数据，而 Blink 支持。</li>
</ol>

<p><a name="structure-of-table-api-and-sql-programs"></a></p>

<h2 id="table-api-和-sql-程序的结构">Table API 和 SQL 程序的结构</h2>

<p>所有用于批处理和流处理的 Table API 和 SQL 程序都遵循相同的模式。下面的代码示例展示了 Table API 和 SQL 程序的通用结构。</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// create a TableEnvironment for specific planner batch or streaming</span>
<span class="nc">TableEnvironment</span> <span class="n">tableEnv</span> <span class="o">=</span> <span class="o">...;</span> <span class="c1">// see "Create a TableEnvironment" section</span>

<span class="c1">// create a Table</span>
<span class="n">tableEnv</span><span class="o">.</span><span class="na">connect</span><span class="o">(...).</span><span class="na">createTemporaryTable</span><span class="o">(</span><span class="s">"table1"</span><span class="o">);</span>
<span class="c1">// register an output Table</span>
<span class="n">tableEnv</span><span class="o">.</span><span class="na">connect</span><span class="o">(...).</span><span class="na">createTemporaryTable</span><span class="o">(</span><span class="s">"outputTable"</span><span class="o">);</span>

<span class="c1">// create a Table object from a Table API query</span>
<span class="nc">Table</span> <span class="n">tapiResult</span> <span class="o">=</span> <span class="n">tableEnv</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="s">"table1"</span><span class="o">).</span><span class="na">select</span><span class="o">(...);</span>
<span class="c1">// create a Table object from a SQL query</span>
<span class="nc">Table</span> <span class="n">sqlResult</span>  <span class="o">=</span> <span class="n">tableEnv</span><span class="o">.</span><span class="na">sqlQuery</span><span class="o">(</span><span class="s">"SELECT ... FROM table1 ... "</span><span class="o">);</span>

<span class="c1">// emit a Table API result Table to a TableSink, same for SQL result</span>
<span class="nc">TableResult</span> <span class="n">tableResult</span> <span class="o">=</span> <span class="n">tapiResult</span><span class="o">.</span><span class="na">executeInsert</span><span class="o">(</span><span class="s">"outputTable"</span><span class="o">);</span>
<span class="n">tableResult</span><span class="o">...</span>

<span class="c1">// execute</span>
<span class="n">tableEnv</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="s">"java_job"</span><span class="o">);</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// create a TableEnvironment for specific planner batch or streaming</span>
<span class="k">val</span> <span class="nv">tableEnv</span> <span class="k">=</span> <span class="o">...</span> <span class="c1">// see "Create a TableEnvironment" section</span>

<span class="c1">// create a Table</span>
<span class="nv">tableEnv</span><span class="o">.</span><span class="py">connect</span><span class="o">(...).</span><span class="py">createTemporaryTable</span><span class="o">(</span><span class="s">"table1"</span><span class="o">)</span>
<span class="c1">// register an output Table</span>
<span class="nv">tableEnv</span><span class="o">.</span><span class="py">connect</span><span class="o">(...).</span><span class="py">createTemporaryTable</span><span class="o">(</span><span class="s">"outputTable"</span><span class="o">)</span>

<span class="c1">// create a Table from a Table API query</span>
<span class="k">val</span> <span class="nv">tapiResult</span> <span class="k">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">from</span><span class="o">(</span><span class="s">"table1"</span><span class="o">).</span><span class="py">select</span><span class="o">(...)</span>
<span class="c1">// create a Table from a SQL query</span>
<span class="k">val</span> <span class="nv">sqlResult</span>  <span class="k">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">sqlQuery</span><span class="o">(</span><span class="s">"SELECT ... FROM table1 ..."</span><span class="o">)</span>

<span class="c1">// emit a Table API result Table to a TableSink, same for SQL result</span>
<span class="nc">TableResult</span> <span class="n">tableResult</span> <span class="k">=</span> <span class="nv">tapiResult</span><span class="o">.</span><span class="py">executeInsert</span><span class="o">(</span><span class="s">"outputTable"</span><span class="o">);</span>
<span class="n">tableResult</span><span class="o">...</span>

<span class="c1">// execute</span>
<span class="nv">tableEnv</span><span class="o">.</span><span class="py">execute</span><span class="o">(</span><span class="s">"scala_job"</span><span class="o">)</span></code></pre></figure>

  </div>

  <div data-lang="python">

    <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># create a TableEnvironment for specific planner batch or streaming
</span><span class="n">table_env</span> <span class="o">=</span> <span class="p">...</span> <span class="c1"># see "Create a TableEnvironment" section
</span>
<span class="c1"># register a Table
</span><span class="n">table_env</span><span class="p">.</span><span class="n">connect</span><span class="p">(...).</span><span class="n">create_temporary_table</span><span class="p">(</span><span class="s">"table1"</span><span class="p">)</span>

<span class="c1"># register an output Table
</span><span class="n">table_env</span><span class="p">.</span><span class="n">connect</span><span class="p">(...).</span><span class="n">create_temporary_table</span><span class="p">(</span><span class="s">"outputTable"</span><span class="p">)</span>

<span class="c1"># create a Table from a Table API query
</span><span class="n">tapi_result</span> <span class="o">=</span> <span class="n">table_env</span><span class="p">.</span><span class="n">from_path</span><span class="p">(</span><span class="s">"table1"</span><span class="p">).</span><span class="n">select</span><span class="p">(...)</span>
<span class="c1"># create a Table from a SQL query
</span><span class="n">sql_result</span>  <span class="o">=</span> <span class="n">table_env</span><span class="p">.</span><span class="n">sql_query</span><span class="p">(</span><span class="s">"SELECT ... FROM table1 ..."</span><span class="p">)</span>

<span class="c1"># emit a Table API result Table to a TableSink, same for SQL result
</span><span class="n">table_result</span> <span class="o">=</span> <span class="n">tapi_result</span><span class="p">.</span><span class="n">execute_insert</span><span class="p">(</span><span class="s">"outputTable"</span><span class="p">)</span>
<span class="n">table_result</span><span class="p">...</span>

<span class="c1"># execute
</span><span class="n">table_env</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"python_job"</span><span class="p">)</span></code></pre></figure>

  </div>
</div>

<p><strong>注意：</strong> Table API 和 SQL 查询可以很容易地集成并嵌入到 DataStream 或 DataSet 程序中。 请参阅<a href="#integration-with-datastream-and-dataset-api">与 DataStream 和 DataSet API 结合</a> 章节了解如何将 DataSet 和 DataStream 与表之间的相互转化。</p>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<p><a name="create-a-tableenvironment"></a></p>

<h2 id="创建-tableenvironment">创建 TableEnvironment</h2>

<p><code class="highlighter-rouge">TableEnvironment</code> 是 Table API 和 SQL 的核心概念。它负责:</p>

<ul>
  <li>在内部的 catalog 中注册 <code class="highlighter-rouge">Table</code></li>
  <li>注册外部的 catalog</li>
  <li>加载可插拔模块</li>
  <li>执行 SQL 查询</li>
  <li>注册自定义函数 （scalar、table 或 aggregation）</li>
  <li>将 <code class="highlighter-rouge">DataStream</code> 或 <code class="highlighter-rouge">DataSet</code> 转换成 <code class="highlighter-rouge">Table</code></li>
  <li>持有对  <code class="highlighter-rouge">ExecutionEnvironment</code> 或 <code class="highlighter-rouge">StreamExecutionEnvironment</code> 的引用</li>
</ul>

<p><code class="highlighter-rouge">Table</code> 总是与特定的 <code class="highlighter-rouge">TableEnvironment</code> 绑定。不能在同一条查询中使用不同 TableEnvironment 中的表，例如，对它们进行 join 或 union 操作。</p>

<p><code class="highlighter-rouge">TableEnvironment</code> 可以通过静态方法 <code class="highlighter-rouge">BatchTableEnvironment.create()</code> 或者 <code class="highlighter-rouge">StreamTableEnvironment.create()</code> 在 <code class="highlighter-rouge">StreamExecutionEnvironment</code> 或者 <code class="highlighter-rouge">ExecutionEnvironment</code> 中创建，<code class="highlighter-rouge">TableConfig</code> 是可选项。<code class="highlighter-rouge">TableConfig</code>可用于配置<code class="highlighter-rouge">TableEnvironment</code>或定制的查询优化和转换过程(参见 <a href="#query-optimization">查询优化</a>)。</p>

<p>请确保选择与你的编程语言匹配的特定的计划器<code class="highlighter-rouge">BatchTableEnvironment</code>/<code class="highlighter-rouge">StreamTableEnvironment</code>。</p>

<p>如果两种计划器的 jar 包都在 classpath 中（默认行为），你应该明确地设置要在当前程序中使用的计划器。</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// **********************</span>
<span class="c1">// FLINK STREAMING QUERY</span>
<span class="c1">// **********************</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.streaming.api.environment.StreamExecutionEnvironment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.api.EnvironmentSettings</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.api.bridge.java.StreamTableEnvironment</span><span class="o">;</span>

<span class="nc">EnvironmentSettings</span> <span class="n">fsSettings</span> <span class="o">=</span> <span class="nc">EnvironmentSettings</span><span class="o">.</span><span class="na">newInstance</span><span class="o">().</span><span class="na">useOldPlanner</span><span class="o">().</span><span class="na">inStreamingMode</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
<span class="nc">StreamExecutionEnvironment</span> <span class="n">fsEnv</span> <span class="o">=</span> <span class="nc">StreamExecutionEnvironment</span><span class="o">.</span><span class="na">getExecutionEnvironment</span><span class="o">();</span>
<span class="nc">StreamTableEnvironment</span> <span class="n">fsTableEnv</span> <span class="o">=</span> <span class="nc">StreamTableEnvironment</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">fsEnv</span><span class="o">,</span> <span class="n">fsSettings</span><span class="o">);</span>
<span class="c1">// or TableEnvironment fsTableEnv = TableEnvironment.create(fsSettings);</span>

<span class="c1">// ******************</span>
<span class="c1">// FLINK BATCH QUERY</span>
<span class="c1">// ******************</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.api.java.ExecutionEnvironment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.api.bridge.java.BatchTableEnvironment</span><span class="o">;</span>

<span class="nc">ExecutionEnvironment</span> <span class="n">fbEnv</span> <span class="o">=</span> <span class="nc">ExecutionEnvironment</span><span class="o">.</span><span class="na">getExecutionEnvironment</span><span class="o">();</span>
<span class="nc">BatchTableEnvironment</span> <span class="n">fbTableEnv</span> <span class="o">=</span> <span class="nc">BatchTableEnvironment</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">fbEnv</span><span class="o">);</span>

<span class="c1">// **********************</span>
<span class="c1">// BLINK STREAMING QUERY</span>
<span class="c1">// **********************</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.streaming.api.environment.StreamExecutionEnvironment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.api.EnvironmentSettings</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.api.bridge.java.StreamTableEnvironment</span><span class="o">;</span>

<span class="nc">StreamExecutionEnvironment</span> <span class="n">bsEnv</span> <span class="o">=</span> <span class="nc">StreamExecutionEnvironment</span><span class="o">.</span><span class="na">getExecutionEnvironment</span><span class="o">();</span>
<span class="nc">EnvironmentSettings</span> <span class="n">bsSettings</span> <span class="o">=</span> <span class="nc">EnvironmentSettings</span><span class="o">.</span><span class="na">newInstance</span><span class="o">().</span><span class="na">useBlinkPlanner</span><span class="o">().</span><span class="na">inStreamingMode</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
<span class="nc">StreamTableEnvironment</span> <span class="n">bsTableEnv</span> <span class="o">=</span> <span class="nc">StreamTableEnvironment</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">bsEnv</span><span class="o">,</span> <span class="n">bsSettings</span><span class="o">);</span>
<span class="c1">// or TableEnvironment bsTableEnv = TableEnvironment.create(bsSettings);</span>

<span class="c1">// ******************</span>
<span class="c1">// BLINK BATCH QUERY</span>
<span class="c1">// ******************</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.api.EnvironmentSettings</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.api.TableEnvironment</span><span class="o">;</span>

<span class="nc">EnvironmentSettings</span> <span class="n">bbSettings</span> <span class="o">=</span> <span class="nc">EnvironmentSettings</span><span class="o">.</span><span class="na">newInstance</span><span class="o">().</span><span class="na">useBlinkPlanner</span><span class="o">().</span><span class="na">inBatchMode</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
<span class="nc">TableEnvironment</span> <span class="n">bbTableEnv</span> <span class="o">=</span> <span class="nc">TableEnvironment</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">bbSettings</span><span class="o">);</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// **********************</span>
<span class="c1">// FLINK STREAMING QUERY</span>
<span class="c1">// **********************</span>
<span class="k">import</span> <span class="nn">org.apache.flink.streaming.api.scala.StreamExecutionEnvironment</span>
<span class="k">import</span> <span class="nn">org.apache.flink.table.api.EnvironmentSettings</span>
<span class="k">import</span> <span class="nn">org.apache.flink.table.api.bridge.scala.StreamTableEnvironment</span>

<span class="k">val</span> <span class="nv">fsSettings</span> <span class="k">=</span> <span class="nv">EnvironmentSettings</span><span class="o">.</span><span class="py">newInstance</span><span class="o">().</span><span class="py">useOldPlanner</span><span class="o">().</span><span class="py">inStreamingMode</span><span class="o">().</span><span class="py">build</span><span class="o">()</span>
<span class="k">val</span> <span class="nv">fsEnv</span> <span class="k">=</span> <span class="nv">StreamExecutionEnvironment</span><span class="o">.</span><span class="py">getExecutionEnvironment</span>
<span class="k">val</span> <span class="nv">fsTableEnv</span> <span class="k">=</span> <span class="nv">StreamTableEnvironment</span><span class="o">.</span><span class="py">create</span><span class="o">(</span><span class="n">fsEnv</span><span class="o">,</span> <span class="n">fsSettings</span><span class="o">)</span>
<span class="c1">// or val fsTableEnv = TableEnvironment.create(fsSettings)</span>

<span class="c1">// ******************</span>
<span class="c1">// FLINK BATCH QUERY</span>
<span class="c1">// ******************</span>
<span class="k">import</span> <span class="nn">org.apache.flink.api.scala.ExecutionEnvironment</span>
<span class="k">import</span> <span class="nn">org.apache.flink.table.api.bridge.scala.BatchTableEnvironment</span>

<span class="k">val</span> <span class="nv">fbEnv</span> <span class="k">=</span> <span class="nv">ExecutionEnvironment</span><span class="o">.</span><span class="py">getExecutionEnvironment</span>
<span class="k">val</span> <span class="nv">fbTableEnv</span> <span class="k">=</span> <span class="nv">BatchTableEnvironment</span><span class="o">.</span><span class="py">create</span><span class="o">(</span><span class="n">fbEnv</span><span class="o">)</span>

<span class="c1">// **********************</span>
<span class="c1">// BLINK STREAMING QUERY</span>
<span class="c1">// **********************</span>
<span class="k">import</span> <span class="nn">org.apache.flink.streaming.api.scala.StreamExecutionEnvironment</span>
<span class="k">import</span> <span class="nn">org.apache.flink.table.api.EnvironmentSettings</span>
<span class="k">import</span> <span class="nn">org.apache.flink.table.api.bridge.scala.StreamTableEnvironment</span>

<span class="k">val</span> <span class="nv">bsEnv</span> <span class="k">=</span> <span class="nv">StreamExecutionEnvironment</span><span class="o">.</span><span class="py">getExecutionEnvironment</span>
<span class="k">val</span> <span class="nv">bsSettings</span> <span class="k">=</span> <span class="nv">EnvironmentSettings</span><span class="o">.</span><span class="py">newInstance</span><span class="o">().</span><span class="py">useBlinkPlanner</span><span class="o">().</span><span class="py">inStreamingMode</span><span class="o">().</span><span class="py">build</span><span class="o">()</span>
<span class="k">val</span> <span class="nv">bsTableEnv</span> <span class="k">=</span> <span class="nv">StreamTableEnvironment</span><span class="o">.</span><span class="py">create</span><span class="o">(</span><span class="n">bsEnv</span><span class="o">,</span> <span class="n">bsSettings</span><span class="o">)</span>
<span class="c1">// or val bsTableEnv = TableEnvironment.create(bsSettings)</span>

<span class="c1">// ******************</span>
<span class="c1">// BLINK BATCH QUERY</span>
<span class="c1">// ******************</span>
<span class="k">import</span> <span class="nn">org.apache.flink.table.api.</span><span class="o">{</span><span class="nc">EnvironmentSettings</span><span class="o">,</span> <span class="nc">TableEnvironment</span><span class="o">}</span>

<span class="k">val</span> <span class="nv">bbSettings</span> <span class="k">=</span> <span class="nv">EnvironmentSettings</span><span class="o">.</span><span class="py">newInstance</span><span class="o">().</span><span class="py">useBlinkPlanner</span><span class="o">().</span><span class="py">inBatchMode</span><span class="o">().</span><span class="py">build</span><span class="o">()</span>
<span class="k">val</span> <span class="nv">bbTableEnv</span> <span class="k">=</span> <span class="nv">TableEnvironment</span><span class="o">.</span><span class="py">create</span><span class="o">(</span><span class="n">bbSettings</span><span class="o">)</span></code></pre></figure>

  </div>

  <div data-lang="python">

    <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># **********************
# FLINK STREAMING QUERY
# **********************
</span><span class="kn">from</span> <span class="nn">pyflink.datastream</span> <span class="kn">import</span> <span class="n">StreamExecutionEnvironment</span>
<span class="kn">from</span> <span class="nn">pyflink.table</span> <span class="kn">import</span> <span class="n">StreamTableEnvironment</span><span class="p">,</span> <span class="n">EnvironmentSettings</span>

<span class="n">f_s_env</span> <span class="o">=</span> <span class="n">StreamExecutionEnvironment</span><span class="p">.</span><span class="n">get_execution_environment</span><span class="p">()</span>
<span class="n">f_s_settings</span> <span class="o">=</span> <span class="n">EnvironmentSettings</span><span class="p">.</span><span class="n">new_instance</span><span class="p">().</span><span class="n">use_old_planner</span><span class="p">().</span><span class="n">in_streaming_mode</span><span class="p">().</span><span class="n">build</span><span class="p">()</span>
<span class="n">f_s_t_env</span> <span class="o">=</span> <span class="n">StreamTableEnvironment</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">f_s_env</span><span class="p">,</span> <span class="n">environment_settings</span><span class="o">=</span><span class="n">f_s_settings</span><span class="p">)</span>

<span class="c1"># ******************
# FLINK BATCH QUERY
# ******************
</span><span class="kn">from</span> <span class="nn">pyflink.dataset</span> <span class="kn">import</span> <span class="n">ExecutionEnvironment</span>
<span class="kn">from</span> <span class="nn">pyflink.table</span> <span class="kn">import</span> <span class="n">BatchTableEnvironment</span>

<span class="n">f_b_env</span> <span class="o">=</span> <span class="n">ExecutionEnvironment</span><span class="p">.</span><span class="n">get_execution_environment</span><span class="p">()</span>
<span class="n">f_b_t_env</span> <span class="o">=</span> <span class="n">BatchTableEnvironment</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">f_b_env</span><span class="p">,</span> <span class="n">table_config</span><span class="p">)</span>

<span class="c1"># **********************
# BLINK STREAMING QUERY
# **********************
</span><span class="kn">from</span> <span class="nn">pyflink.datastream</span> <span class="kn">import</span> <span class="n">StreamExecutionEnvironment</span>
<span class="kn">from</span> <span class="nn">pyflink.table</span> <span class="kn">import</span> <span class="n">StreamTableEnvironment</span><span class="p">,</span> <span class="n">EnvironmentSettings</span>

<span class="n">b_s_env</span> <span class="o">=</span> <span class="n">StreamExecutionEnvironment</span><span class="p">.</span><span class="n">get_execution_environment</span><span class="p">()</span>
<span class="n">b_s_settings</span> <span class="o">=</span> <span class="n">EnvironmentSettings</span><span class="p">.</span><span class="n">new_instance</span><span class="p">().</span><span class="n">use_blink_planner</span><span class="p">().</span><span class="n">in_streaming_mode</span><span class="p">().</span><span class="n">build</span><span class="p">()</span>
<span class="n">b_s_t_env</span> <span class="o">=</span> <span class="n">StreamTableEnvironment</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">b_s_env</span><span class="p">,</span> <span class="n">environment_settings</span><span class="o">=</span><span class="n">b_s_settings</span><span class="p">)</span>

<span class="c1"># ******************
# BLINK BATCH QUERY
# ******************
</span><span class="kn">from</span> <span class="nn">pyflink.table</span> <span class="kn">import</span> <span class="n">EnvironmentSettings</span><span class="p">,</span> <span class="n">BatchTableEnvironment</span>

<span class="n">b_b_settings</span> <span class="o">=</span> <span class="n">EnvironmentSettings</span><span class="p">.</span><span class="n">new_instance</span><span class="p">().</span><span class="n">use_blink_planner</span><span class="p">().</span><span class="n">in_batch_mode</span><span class="p">().</span><span class="n">build</span><span class="p">()</span>
<span class="n">b_b_t_env</span> <span class="o">=</span> <span class="n">BatchTableEnvironment</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">environment_settings</span><span class="o">=</span><span class="n">b_b_settings</span><span class="p">)</span></code></pre></figure>

  </div>
</div>

<p><strong>注意：</strong> 如果<code class="highlighter-rouge">/lib</code>目录中只有一种计划器的 jar 包，则可以使用<code class="highlighter-rouge">useAnyPlanner</code>（python 使用 <code class="highlighter-rouge">use any_u_planner</code>）创建 <code class="highlighter-rouge">EnvironmentSettings</code>。</p>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<p><a name="create-tables-in-the-catalog"></a></p>

<h2 id="在-catalog-中创建表">在 Catalog 中创建表</h2>

<p><code class="highlighter-rouge">TableEnvironment</code> 维护着一个由标识符（identifier）创建的表 catalog 的映射。标识符由三个部分组成：catalog 名称、数据库名称以及对象名称。如果 catalog 或者数据库没有指明，就会使用当前默认值（参见<a href="#expanding-table-identifiers">表标识符扩展</a>章节中的例子）。</p>

<p><code class="highlighter-rouge">Table</code> 可以是虚拟的（视图 <code class="highlighter-rouge">VIEWS</code>）也可以是常规的（表 <code class="highlighter-rouge">TABLES</code>）。视图 <code class="highlighter-rouge">VIEWS</code>可以从已经存在的<code class="highlighter-rouge">Table</code>中创建，一般是 Table API 或者 SQL 的查询结果。 表<code class="highlighter-rouge">TABLES</code>描述的是外部数据，例如文件、数据库表或者消息队列。</p>

<p><a name="temporary-vs-permanent-tables"></a></p>

<h3 id="临时表temporary-table和永久表permanent-table">临时表（Temporary Table）和永久表（Permanent Table）</h3>

<p>表可以是临时的，并与单个 Flink 会话（session）的生命周期相关，也可以是永久的，并且在多个 Flink 会话和群集（cluster）中可见。</p>

<p>永久表需要 <a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/catalogs.html">catalog</a>（例如 Hive Metastore）以维护表的元数据。一旦永久表被创建，它将对任何连接到 catalog 的 Flink 会话可见且持续存在，直至被明确删除。</p>

<p>另一方面，临时表通常保存于内存中并且仅在创建它们的 Flink 会话持续期间存在。这些表对于其它会话是不可见的。它们不与任何 catalog 或者数据库绑定但可以在一个命名空间（namespace）中创建。即使它们对应的数据库被删除，临时表也不会被删除。</p>

<p><a name="shadowing"></a></p>

<h4 id="屏蔽shadowing">屏蔽（Shadowing）</h4>

<p>可以使用与已存在的永久表相同的标识符去注册临时表。临时表会屏蔽永久表，并且只要临时表存在，永久表就无法访问。所有使用该标识符的查询都将作用于临时表。</p>

<p>这可能对实验（experimentation）有用。它允许先对一个临时表进行完全相同的查询，例如只有一个子集的数据，或者数据是不确定的。一旦验证了查询的正确性，就可以对实际的生产表进行查询。</p>

<p><a name="create-a-table"></a></p>

<h3 id="创建表">创建表</h3>

<p><a name="virtual-tables"></a></p>

<h4 id="虚拟表">虚拟表</h4>

<p>在 SQL 的术语中，Table API 的对象对应于<code class="highlighter-rouge">视图</code>（虚拟表）。它封装了一个逻辑查询计划。它可以通过以下方法在 catalog 中创建：</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// get a TableEnvironment</span>
<span class="nc">TableEnvironment</span> <span class="n">tableEnv</span> <span class="o">=</span> <span class="o">...;</span> <span class="c1">// see "Create a TableEnvironment" section</span>

<span class="c1">// table is the result of a simple projection query </span>
<span class="nc">Table</span> <span class="n">projTable</span> <span class="o">=</span> <span class="n">tableEnv</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="s">"X"</span><span class="o">).</span><span class="na">select</span><span class="o">(...);</span>

<span class="c1">// register the Table projTable as table "projectedTable"</span>
<span class="n">tableEnv</span><span class="o">.</span><span class="na">createTemporaryView</span><span class="o">(</span><span class="s">"projectedTable"</span><span class="o">,</span> <span class="n">projTable</span><span class="o">);</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// get a TableEnvironment</span>
<span class="k">val</span> <span class="nv">tableEnv</span> <span class="k">=</span> <span class="o">...</span> <span class="c1">// see "Create a TableEnvironment" section</span>

<span class="c1">// table is the result of a simple projection query </span>
<span class="k">val</span> <span class="nv">projTable</span><span class="k">:</span> <span class="kt">Table</span> <span class="o">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">from</span><span class="o">(</span><span class="s">"X"</span><span class="o">).</span><span class="py">select</span><span class="o">(...)</span>

<span class="c1">// register the Table projTable as table "projectedTable"</span>
<span class="nv">tableEnv</span><span class="o">.</span><span class="py">createTemporaryView</span><span class="o">(</span><span class="s">"projectedTable"</span><span class="o">,</span> <span class="n">projTable</span><span class="o">)</span></code></pre></figure>

  </div>

  <div data-lang="python">

    <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># get a TableEnvironment
</span><span class="n">table_env</span> <span class="o">=</span> <span class="p">...</span> <span class="c1"># see "Create a TableEnvironment" section
</span>
<span class="c1"># table is the result of a simple projection query 
</span><span class="n">proj_table</span> <span class="o">=</span> <span class="n">table_env</span><span class="p">.</span><span class="n">from_path</span><span class="p">(</span><span class="s">"X"</span><span class="p">).</span><span class="n">select</span><span class="p">(...)</span>

<span class="c1"># register the Table projTable as table "projectedTable"
</span><span class="n">table_env</span><span class="p">.</span><span class="n">register_table</span><span class="p">(</span><span class="s">"projectedTable"</span><span class="p">,</span> <span class="n">proj_table</span><span class="p">)</span></code></pre></figure>

  </div>
</div>

<p><strong>注意：</strong> 从传统数据库系统的角度来看，<code class="highlighter-rouge">Table</code> 对象与 <code class="highlighter-rouge">VIEW</code> 视图非常像。也就是，定义了 <code class="highlighter-rouge">Table</code> 的查询是没有被优化的，
而且会被内嵌到另一个引用了这个注册了的 <code class="highlighter-rouge">Table</code>的查询中。如果多个查询都引用了同一个注册了的<code class="highlighter-rouge">Table</code>，那么它会被内嵌每个查询中并被执行多次，
也就是说注册了的<code class="highlighter-rouge">Table</code>的结果<strong>不会</strong>被共享（注：Blink 计划器的<code class="highlighter-rouge">TableEnvironment</code>会优化成只执行一次）。</p>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<p><a name="connector-tables"></a></p>

<h4 id="connector-tables">Connector Tables</h4>

<p>另外一个方式去创建 <code class="highlighter-rouge">TABLE</code> 是通过 <a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connect.html">connector</a> 声明。Connector 描述了存储表数据的外部系统。存储系统例如 Apache Kafka 或者常规的文件系统都可以通过这种方式来声明。</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">tableEnvironment</span>
  <span class="o">.</span><span class="na">connect</span><span class="o">(...)</span>
  <span class="o">.</span><span class="na">withFormat</span><span class="o">(...)</span>
  <span class="o">.</span><span class="na">withSchema</span><span class="o">(...)</span>
  <span class="o">.</span><span class="na">inAppendMode</span><span class="o">()</span>
  <span class="o">.</span><span class="na">createTemporaryTable</span><span class="o">(</span><span class="s">"MyTable"</span><span class="o">)</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">tableEnvironment</span>
  <span class="o">.</span><span class="py">connect</span><span class="o">(...)</span>
  <span class="o">.</span><span class="py">withFormat</span><span class="o">(...)</span>
  <span class="o">.</span><span class="py">withSchema</span><span class="o">(...)</span>
  <span class="o">.</span><span class="py">inAppendMode</span><span class="o">()</span>
  <span class="o">.</span><span class="py">createTemporaryTable</span><span class="o">(</span><span class="s">"MyTable"</span><span class="o">)</span></code></pre></figure>

  </div>

  <div data-lang="python">

    <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">table_environment</span> \
    <span class="p">.</span><span class="n">connect</span><span class="p">(...)</span> \
    <span class="p">.</span><span class="n">with_format</span><span class="p">(...)</span> \
    <span class="p">.</span><span class="n">with_schema</span><span class="p">(...)</span> \
    <span class="p">.</span><span class="n">in_append_mode</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">create_temporary_table</span><span class="p">(</span><span class="s">"MyTable"</span><span class="p">)</span></code></pre></figure>

  </div>

  <div data-lang="DDL">

    <figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="n">tableEnvironment</span><span class="p">.</span><span class="n">executeSql</span><span class="p">(</span><span class="nv">"CREATE [TEMPORARY] TABLE MyTable (...) WITH (...)"</span><span class="p">)</span></code></pre></figure>

  </div>
</div>

<p><a name="expanding-table-identifiers"></a></p>

<h3 id="扩展表标识符">扩展表标识符</h3>

<p>表总是通过三元标识符注册，包括 catalog 名、数据库名和表名。</p>

<p>用户可以指定一个 catalog 和数据库作为 “当前catalog” 和”当前数据库”。有了这些，那么刚刚提到的三元标识符的前两个部分就可以被省略了。如果前两部分的标识符没有指定，
那么会使用当前的 catalog 和当前数据库。用户也可以通过 Table API 或 SQL 切换当前的 catalog 和当前的数据库。</p>

<p>标识符遵循 SQL 标准，因此使用时需要用反引号（<code class="highlighter-rouge">`</code>）进行转义。</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">TableEnvironment</span> <span class="n">tEnv</span> <span class="o">=</span> <span class="o">...;</span>
<span class="n">tEnv</span><span class="o">.</span><span class="na">useCatalog</span><span class="o">(</span><span class="s">"custom_catalog"</span><span class="o">);</span>
<span class="n">tEnv</span><span class="o">.</span><span class="na">useDatabase</span><span class="o">(</span><span class="s">"custom_database"</span><span class="o">);</span>

<span class="nc">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="o">...;</span>

<span class="c1">// register the view named 'exampleView' in the catalog named 'custom_catalog'</span>
<span class="c1">// in the database named 'custom_database' </span>
<span class="n">tableEnv</span><span class="o">.</span><span class="na">createTemporaryView</span><span class="o">(</span><span class="s">"exampleView"</span><span class="o">,</span> <span class="n">table</span><span class="o">);</span>

<span class="c1">// register the view named 'exampleView' in the catalog named 'custom_catalog'</span>
<span class="c1">// in the database named 'other_database' </span>
<span class="n">tableEnv</span><span class="o">.</span><span class="na">createTemporaryView</span><span class="o">(</span><span class="s">"other_database.exampleView"</span><span class="o">,</span> <span class="n">table</span><span class="o">);</span>

<span class="c1">// register the view named 'example.View' in the catalog named 'custom_catalog'</span>
<span class="c1">// in the database named 'custom_database' </span>
<span class="n">tableEnv</span><span class="o">.</span><span class="na">createTemporaryView</span><span class="o">(</span><span class="s">"`example.View`"</span><span class="o">,</span> <span class="n">table</span><span class="o">);</span>

<span class="c1">// register the view named 'exampleView' in the catalog named 'other_catalog'</span>
<span class="c1">// in the database named 'other_database' </span>
<span class="n">tableEnv</span><span class="o">.</span><span class="na">createTemporaryView</span><span class="o">(</span><span class="s">"other_catalog.other_database.exampleView"</span><span class="o">,</span> <span class="n">table</span><span class="o">);</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// get a TableEnvironment</span>
<span class="k">val</span> <span class="nv">tEnv</span><span class="k">:</span> <span class="kt">TableEnvironment</span> <span class="o">=</span> <span class="o">...;</span>
<span class="nv">tEnv</span><span class="o">.</span><span class="py">useCatalog</span><span class="o">(</span><span class="s">"custom_catalog"</span><span class="o">)</span>
<span class="nv">tEnv</span><span class="o">.</span><span class="py">useDatabase</span><span class="o">(</span><span class="s">"custom_database"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">table</span><span class="k">:</span> <span class="kt">Table</span> <span class="o">=</span> <span class="o">...;</span>

<span class="c1">// register the view named 'exampleView' in the catalog named 'custom_catalog'</span>
<span class="c1">// in the database named 'custom_database' </span>
<span class="nv">tableEnv</span><span class="o">.</span><span class="py">createTemporaryView</span><span class="o">(</span><span class="s">"exampleView"</span><span class="o">,</span> <span class="n">table</span><span class="o">)</span>

<span class="c1">// register the view named 'exampleView' in the catalog named 'custom_catalog'</span>
<span class="c1">// in the database named 'other_database' </span>
<span class="nv">tableEnv</span><span class="o">.</span><span class="py">createTemporaryView</span><span class="o">(</span><span class="s">"other_database.exampleView"</span><span class="o">,</span> <span class="n">table</span><span class="o">)</span>

<span class="c1">// register the view named 'example.View' in the catalog named 'custom_catalog'</span>
<span class="c1">// in the database named 'custom_database' </span>
<span class="nv">tableEnv</span><span class="o">.</span><span class="py">createTemporaryView</span><span class="o">(</span><span class="s">"`example.View`"</span><span class="o">,</span> <span class="n">table</span><span class="o">)</span>

<span class="c1">// register the view named 'exampleView' in the catalog named 'other_catalog'</span>
<span class="c1">// in the database named 'other_database' </span>
<span class="nv">tableEnv</span><span class="o">.</span><span class="py">createTemporaryView</span><span class="o">(</span><span class="s">"other_catalog.other_database.exampleView"</span><span class="o">,</span> <span class="n">table</span><span class="o">)</span></code></pre></figure>

  </div>

</div>

<p><a name="query-a-table"></a></p>

<h2 id="查询表">查询表</h2>

<p><a name="table-api"></a></p>

<h3 id="table-api">Table API</h3>

<p>Table API 是关于 Scala 和 Java 的集成语言式查询 API。与 SQL 相反，Table API 的查询不是由字符串指定，而是在宿主语言中逐步构建。</p>

<p>Table API 是基于 <code class="highlighter-rouge">Table</code> 类的，该类表示一个表（流或批处理），并提供使用关系操作的方法。这些方法返回一个新的 Table 对象，该对象表示对输入 Table 进行关系操作的结果。 一些关系操作由多个方法调用组成，例如 <code class="highlighter-rouge">table.groupBy(...).select()</code>，其中 <code class="highlighter-rouge">groupBy(...)</code> 指定 <code class="highlighter-rouge">table</code> 的分组，而 <code class="highlighter-rouge">select(...)</code> 在  <code class="highlighter-rouge">table</code> 分组上的投影。</p>

<p>文档 <a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/tableApi.html">Table API</a> 说明了所有流处理和批处理表支持的 Table API 算子。</p>

<p>以下示例展示了一个简单的 Table API 聚合查询：</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// get a TableEnvironment</span>
<span class="nc">TableEnvironment</span> <span class="n">tableEnv</span> <span class="o">=</span> <span class="o">...;</span> <span class="c1">// see "Create a TableEnvironment" section</span>

<span class="c1">// register Orders table</span>

<span class="c1">// scan registered Orders table</span>
<span class="nc">Table</span> <span class="n">orders</span> <span class="o">=</span> <span class="n">tableEnv</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="s">"Orders"</span><span class="o">);</span>
<span class="c1">// compute revenue for all customers from France</span>
<span class="nc">Table</span> <span class="n">revenue</span> <span class="o">=</span> <span class="n">orders</span>
  <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="err">$</span><span class="o">(</span><span class="s">"cCountry"</span><span class="o">).</span><span class="na">isEqual</span><span class="o">(</span><span class="s">"FRANCE"</span><span class="o">))</span>
  <span class="o">.</span><span class="na">groupBy</span><span class="o">(</span><span class="err">$</span><span class="o">(</span><span class="s">"cID"</span><span class="o">),</span> <span class="err">$</span><span class="o">(</span><span class="s">"cName"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="err">$</span><span class="o">(</span><span class="s">"cID"</span><span class="o">),</span> <span class="err">$</span><span class="o">(</span><span class="s">"cName"</span><span class="o">),</span> <span class="err">$</span><span class="o">(</span><span class="s">"revenue"</span><span class="o">).</span><span class="na">sum</span><span class="o">().</span><span class="na">as</span><span class="o">(</span><span class="s">"revSum"</span><span class="o">));</span>

<span class="c1">// emit or convert Table</span>
<span class="c1">// execute query</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// get a TableEnvironment</span>
<span class="k">val</span> <span class="nv">tableEnv</span> <span class="k">=</span> <span class="o">...</span> <span class="c1">// see "Create a TableEnvironment" section</span>

<span class="c1">// register Orders table</span>

<span class="c1">// scan registered Orders table</span>
<span class="k">val</span> <span class="nv">orders</span> <span class="k">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">from</span><span class="o">(</span><span class="s">"Orders"</span><span class="o">)</span>
<span class="c1">// compute revenue for all customers from France</span>
<span class="k">val</span> <span class="nv">revenue</span> <span class="k">=</span> <span class="n">orders</span>
  <span class="o">.</span><span class="py">filter</span><span class="o">(</span><span class="n">$</span><span class="s">"cCountry"</span> <span class="o">===</span> <span class="s">"FRANCE"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">groupBy</span><span class="o">(</span><span class="n">$</span><span class="s">"cID"</span><span class="o">,</span> <span class="n">$</span><span class="s">"cName"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="n">$</span><span class="s">"cID"</span><span class="o">,</span> <span class="n">$</span><span class="s">"cName"</span><span class="o">,</span> <span class="n">$</span><span class="s">"revenue"</span><span class="o">.</span><span class="py">sum</span> <span class="nc">AS</span> <span class="s">"revSum"</span><span class="o">)</span>

<span class="c1">// emit or convert Table</span>
<span class="c1">// execute query</span></code></pre></figure>

    <p><strong>Note:</strong> The Scala Table API uses Scala String interpolation that starts with a dollar sign (<code class="highlighter-rouge">$</code>) to reference the attributes of a <code class="highlighter-rouge">Table</code>. The Table API uses Scala implicits. Make sure to import</p>
    <ul>
      <li><code class="highlighter-rouge">org.apache.flink.table.api._</code> - for implicit expression conversions</li>
      <li><code class="highlighter-rouge">org.apache.flink.api.scala._</code> and <code class="highlighter-rouge">org.apache.flink.table.api.bridge.scala._</code> if you want to convert from/to DataStream.</li>
    </ul>
  </div>

  <div data-lang="python">

    <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># get a TableEnvironment
</span><span class="n">table_env</span> <span class="o">=</span> <span class="c1"># see "Create a TableEnvironment" section
</span>
<span class="c1"># register Orders table
</span>
<span class="c1"># scan registered Orders table
</span><span class="n">orders</span> <span class="o">=</span> <span class="n">table_env</span><span class="p">.</span><span class="n">from_path</span><span class="p">(</span><span class="s">"Orders"</span><span class="p">)</span>
<span class="c1"># compute revenue for all customers from France
</span><span class="n">revenue</span> <span class="o">=</span> <span class="n">orders</span> \
    <span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">orders</span><span class="p">.</span><span class="n">cCountry</span> <span class="o">==</span> <span class="s">'FRANCE'</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">orders</span><span class="p">.</span><span class="n">cID</span><span class="p">,</span> <span class="n">orders</span><span class="p">.</span><span class="n">cName</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="n">orders</span><span class="p">.</span><span class="n">cID</span><span class="p">,</span> <span class="n">orders</span><span class="p">.</span><span class="n">cName</span><span class="p">,</span> <span class="n">orders</span><span class="p">.</span><span class="n">revenue</span><span class="p">.</span><span class="nb">sum</span><span class="p">.</span><span class="n">alias</span><span class="p">(</span><span class="s">'revSum'</span><span class="p">))</span>

<span class="c1"># emit or convert Table
# execute query</span></code></pre></figure>

  </div>
</div>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<p><a name="sql"></a></p>

<h3 id="sql">SQL</h3>

<p>Flink SQL 是基于实现了SQL标准的 <a href="https://calcite.apache.org">Apache Calcite</a> 的。SQL 查询由常规字符串指定。</p>

<p>文档 <a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/">SQL</a> 描述了Flink对流处理和批处理表的SQL支持。</p>

<p>下面的示例演示了如何指定查询并将结果作为 <code class="highlighter-rouge">Table</code> 对象返回。</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// get a TableEnvironment</span>
<span class="nc">TableEnvironment</span> <span class="n">tableEnv</span> <span class="o">=</span> <span class="o">...;</span> <span class="c1">// see "Create a TableEnvironment" section</span>

<span class="c1">// register Orders table</span>

<span class="c1">// compute revenue for all customers from France</span>
<span class="nc">Table</span> <span class="n">revenue</span> <span class="o">=</span> <span class="n">tableEnv</span><span class="o">.</span><span class="na">sqlQuery</span><span class="o">(</span>
    <span class="s">"SELECT cID, cName, SUM(revenue) AS revSum "</span> <span class="o">+</span>
    <span class="s">"FROM Orders "</span> <span class="o">+</span>
    <span class="s">"WHERE cCountry = 'FRANCE' "</span> <span class="o">+</span>
    <span class="s">"GROUP BY cID, cName"</span>
  <span class="o">);</span>

<span class="c1">// emit or convert Table</span>
<span class="c1">// execute query</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// get a TableEnvironment</span>
<span class="k">val</span> <span class="nv">tableEnv</span> <span class="k">=</span> <span class="o">...</span> <span class="c1">// see "Create a TableEnvironment" section</span>

<span class="c1">// register Orders table</span>

<span class="c1">// compute revenue for all customers from France</span>
<span class="k">val</span> <span class="nv">revenue</span> <span class="k">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">sqlQuery</span><span class="o">(</span><span class="s">"""
  |SELECT cID, cName, SUM(revenue) AS revSum
  |FROM Orders
  |WHERE cCountry = 'FRANCE'
  |GROUP BY cID, cName
  """</span><span class="o">.</span><span class="py">stripMargin</span><span class="o">)</span>

<span class="c1">// emit or convert Table</span>
<span class="c1">// execute query</span></code></pre></figure>

  </div>

  <div data-lang="python">

    <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># get a TableEnvironment
</span><span class="n">table_env</span> <span class="o">=</span> <span class="p">...</span> <span class="c1"># see "Create a TableEnvironment" section
</span>
<span class="c1"># register Orders table
</span>
<span class="c1"># compute revenue for all customers from France
</span><span class="n">revenue</span> <span class="o">=</span> <span class="n">table_env</span><span class="p">.</span><span class="n">sql_query</span><span class="p">(</span>
    <span class="s">"SELECT cID, cName, SUM(revenue) AS revSum "</span>
    <span class="s">"FROM Orders "</span>
    <span class="s">"WHERE cCountry = 'FRANCE' "</span>
    <span class="s">"GROUP BY cID, cName"</span>
<span class="p">)</span>

<span class="c1"># emit or convert Table
# execute query</span></code></pre></figure>

  </div>
</div>

<p>如下的示例展示了如何指定一个更新查询，将查询的结果插入到已注册的表中。</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// get a TableEnvironment</span>
<span class="nc">TableEnvironment</span> <span class="n">tableEnv</span> <span class="o">=</span> <span class="o">...;</span> <span class="c1">// see "Create a TableEnvironment" section</span>

<span class="c1">// register "Orders" table</span>
<span class="c1">// register "RevenueFrance" output table</span>

<span class="c1">// compute revenue for all customers from France and emit to "RevenueFrance"</span>
<span class="n">tableEnv</span><span class="o">.</span><span class="na">executeSql</span><span class="o">(</span>
    <span class="s">"INSERT INTO RevenueFrance "</span> <span class="o">+</span>
    <span class="s">"SELECT cID, cName, SUM(revenue) AS revSum "</span> <span class="o">+</span>
    <span class="s">"FROM Orders "</span> <span class="o">+</span>
    <span class="s">"WHERE cCountry = 'FRANCE' "</span> <span class="o">+</span>
    <span class="s">"GROUP BY cID, cName"</span>
  <span class="o">);</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// get a TableEnvironment</span>
<span class="k">val</span> <span class="nv">tableEnv</span> <span class="k">=</span> <span class="o">...</span> <span class="c1">// see "Create a TableEnvironment" section</span>

<span class="c1">// register "Orders" table</span>
<span class="c1">// register "RevenueFrance" output table</span>

<span class="c1">// compute revenue for all customers from France and emit to "RevenueFrance"</span>
<span class="nv">tableEnv</span><span class="o">.</span><span class="py">executeSql</span><span class="o">(</span><span class="s">"""
  |INSERT INTO RevenueFrance
  |SELECT cID, cName, SUM(revenue) AS revSum
  |FROM Orders
  |WHERE cCountry = 'FRANCE'
  |GROUP BY cID, cName
  """</span><span class="o">.</span><span class="py">stripMargin</span><span class="o">)</span></code></pre></figure>

  </div>

  <div data-lang="python">

    <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># get a TableEnvironment
</span><span class="n">table_env</span> <span class="o">=</span> <span class="p">...</span> <span class="c1"># see "Create a TableEnvironment" section
</span>
<span class="c1"># register "Orders" table
# register "RevenueFrance" output table
</span>
<span class="c1"># compute revenue for all customers from France and emit to "RevenueFrance"
</span><span class="n">table_env</span><span class="p">.</span><span class="n">execute_sql</span><span class="p">(</span>
    <span class="s">"INSERT INTO RevenueFrance "</span>
    <span class="s">"SELECT cID, cName, SUM(revenue) AS revSum "</span>
    <span class="s">"FROM Orders "</span>
    <span class="s">"WHERE cCountry = 'FRANCE' "</span>
    <span class="s">"GROUP BY cID, cName"</span>
<span class="p">)</span></code></pre></figure>

  </div>
</div>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<p><a name="mixing-table-api-and-sql"></a></p>

<h3 id="混用-table-api-和-sql">混用 Table API 和 SQL</h3>

<p>Table API 和 SQL 查询的混用非常简单因为它们都返回 <code class="highlighter-rouge">Table</code> 对象：</p>

<ul>
  <li>可以在 SQL 查询返回的 <code class="highlighter-rouge">Table</code> 对象上定义 Table API 查询。</li>
  <li>在 <code class="highlighter-rouge">TableEnvironment</code> 中注册的<a href="#register-a-table">结果表</a>可以在 SQL 查询的 <code class="highlighter-rouge">FROM</code> 子句中引用，通过这种方法就可以在 Table API 查询的结果上定义 SQL 查询。</li>
</ul>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<p><a name="emit-a-table"></a></p>

<h2 id="输出表">输出表</h2>

<p><code class="highlighter-rouge">Table</code> 通过写入 <code class="highlighter-rouge">TableSink</code> 输出。<code class="highlighter-rouge">TableSink</code> 是一个通用接口，用于支持多种文件格式（如 CSV、Apache Parquet、Apache Avro）、存储系统（如 JDBC、Apache HBase、Apache Cassandra、Elasticsearch）或消息队列系统（如 Apache Kafka、RabbitMQ）。</p>

<p>批处理 <code class="highlighter-rouge">Table</code> 只能写入 <code class="highlighter-rouge">BatchTableSink</code>，而流处理 <code class="highlighter-rouge">Table</code> 需要指定写入 <code class="highlighter-rouge">AppendStreamTableSink</code>，<code class="highlighter-rouge">RetractStreamTableSink</code> 或者 <code class="highlighter-rouge">UpsertStreamTableSink</code>。</p>

<p>请参考文档 <a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sourceSinks.html">Table Sources &amp; Sinks</a> 以获取更多关于可用 Sink 的信息以及如何自定义 <code class="highlighter-rouge">TableSink</code>。</p>

<p>方法 <code class="highlighter-rouge">Table.executeInsert(String tableName)</code> 将 <code class="highlighter-rouge">Table</code> 发送至已注册的 <code class="highlighter-rouge">TableSink</code>。该方法通过名称在 catalog 中查找 <code class="highlighter-rouge">TableSink</code> 并确认<code class="highlighter-rouge">Table</code> schema 和 <code class="highlighter-rouge">TableSink</code> schema 一致。</p>

<p>下面的示例演示如何输出 <code class="highlighter-rouge">Table</code>：</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// get a TableEnvironment</span>
<span class="nc">TableEnvironment</span> <span class="n">tableEnv</span> <span class="o">=</span> <span class="o">...;</span> <span class="c1">// see "Create a TableEnvironment" section</span>

<span class="c1">// create an output Table</span>
<span class="kd">final</span> <span class="nc">Schema</span> <span class="n">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Schema</span><span class="o">()</span>
    <span class="o">.</span><span class="na">field</span><span class="o">(</span><span class="s">"a"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">INT</span><span class="o">())</span>
    <span class="o">.</span><span class="na">field</span><span class="o">(</span><span class="s">"b"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">STRING</span><span class="o">())</span>
    <span class="o">.</span><span class="na">field</span><span class="o">(</span><span class="s">"c"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">BIGINT</span><span class="o">());</span>

<span class="n">tableEnv</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileSystem</span><span class="o">().</span><span class="na">path</span><span class="o">(</span><span class="s">"/path/to/file"</span><span class="o">))</span>
    <span class="o">.</span><span class="na">withFormat</span><span class="o">(</span><span class="k">new</span> <span class="nc">Csv</span><span class="o">().</span><span class="na">fieldDelimiter</span><span class="o">(</span><span class="sc">'|'</span><span class="o">).</span><span class="na">deriveSchema</span><span class="o">())</span>
    <span class="o">.</span><span class="na">withSchema</span><span class="o">(</span><span class="n">schema</span><span class="o">)</span>
    <span class="o">.</span><span class="na">createTemporaryTable</span><span class="o">(</span><span class="s">"CsvSinkTable"</span><span class="o">);</span>

<span class="c1">// compute a result Table using Table API operators and/or SQL queries</span>
<span class="nc">Table</span> <span class="n">result</span> <span class="o">=</span> <span class="o">...</span>
<span class="c1">// emit the result Table to the registered TableSink</span>
<span class="n">result</span><span class="o">.</span><span class="na">executeInsert</span><span class="o">(</span><span class="s">"CsvSinkTable"</span><span class="o">);</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// get a TableEnvironment</span>
<span class="k">val</span> <span class="nv">tableEnv</span> <span class="k">=</span> <span class="o">...</span> <span class="c1">// see "Create a TableEnvironment" section</span>

<span class="c1">// create an output Table</span>
<span class="k">val</span> <span class="nv">schema</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Schema</span><span class="o">()</span>
    <span class="o">.</span><span class="py">field</span><span class="o">(</span><span class="s">"a"</span><span class="o">,</span> <span class="nv">DataTypes</span><span class="o">.</span><span class="py">INT</span><span class="o">())</span>
    <span class="o">.</span><span class="py">field</span><span class="o">(</span><span class="s">"b"</span><span class="o">,</span> <span class="nv">DataTypes</span><span class="o">.</span><span class="py">STRING</span><span class="o">())</span>
    <span class="o">.</span><span class="py">field</span><span class="o">(</span><span class="s">"c"</span><span class="o">,</span> <span class="nv">DataTypes</span><span class="o">.</span><span class="py">BIGINT</span><span class="o">())</span>

<span class="nv">tableEnv</span><span class="o">.</span><span class="py">connect</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileSystem</span><span class="o">().</span><span class="py">path</span><span class="o">(</span><span class="s">"/path/to/file"</span><span class="o">))</span>
    <span class="o">.</span><span class="py">withFormat</span><span class="o">(</span><span class="k">new</span> <span class="nc">Csv</span><span class="o">().</span><span class="py">fieldDelimiter</span><span class="o">(</span><span class="sc">'|'</span><span class="o">).</span><span class="py">deriveSchema</span><span class="o">())</span>
    <span class="o">.</span><span class="py">withSchema</span><span class="o">(</span><span class="n">schema</span><span class="o">)</span>
    <span class="o">.</span><span class="py">createTemporaryTable</span><span class="o">(</span><span class="s">"CsvSinkTable"</span><span class="o">)</span>

<span class="c1">// compute a result Table using Table API operators and/or SQL queries</span>
<span class="k">val</span> <span class="nv">result</span><span class="k">:</span> <span class="kt">Table</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// emit the result Table to the registered TableSink</span>
<span class="nv">result</span><span class="o">.</span><span class="py">executeInsert</span><span class="o">(</span><span class="s">"CsvSinkTable"</span><span class="o">)</span></code></pre></figure>

  </div>

  <div data-lang="python">

    <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># get a TableEnvironment
</span><span class="n">table_env</span> <span class="o">=</span> <span class="p">...</span> <span class="c1"># see "Create a TableEnvironment" section
</span>
<span class="c1"># create a TableSink
</span><span class="n">table_env</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">FileSystem</span><span class="p">().</span><span class="n">path</span><span class="p">(</span><span class="s">"/path/to/file"</span><span class="p">)))</span>
    <span class="p">.</span><span class="n">with_format</span><span class="p">(</span><span class="n">Csv</span><span class="p">()</span>
                 <span class="p">.</span><span class="n">field_delimiter</span><span class="p">(</span><span class="s">','</span><span class="p">)</span>
                 <span class="p">.</span><span class="n">deriveSchema</span><span class="p">())</span>
    <span class="p">.</span><span class="n">with_schema</span><span class="p">(</span><span class="n">Schema</span><span class="p">()</span>
                 <span class="p">.</span><span class="n">field</span><span class="p">(</span><span class="s">"a"</span><span class="p">,</span> <span class="n">DataTypes</span><span class="p">.</span><span class="n">INT</span><span class="p">())</span>
                 <span class="p">.</span><span class="n">field</span><span class="p">(</span><span class="s">"b"</span><span class="p">,</span> <span class="n">DataTypes</span><span class="p">.</span><span class="n">STRING</span><span class="p">())</span>
                 <span class="p">.</span><span class="n">field</span><span class="p">(</span><span class="s">"c"</span><span class="p">,</span> <span class="n">DataTypes</span><span class="p">.</span><span class="n">BIGINT</span><span class="p">()))</span>
    <span class="p">.</span><span class="n">create_temporary_table</span><span class="p">(</span><span class="s">"CsvSinkTable"</span><span class="p">)</span>

<span class="c1"># compute a result Table using Table API operators and/or SQL queries
</span><span class="n">result</span> <span class="o">=</span> <span class="p">...</span>

<span class="c1"># emit the result Table to the registered TableSink
</span><span class="n">result</span><span class="p">.</span><span class="n">execute_insert</span><span class="p">(</span><span class="s">"CsvSinkTable"</span><span class="p">)</span></code></pre></figure>

  </div>
</div>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<p><a name="translate-and-execute-a-query"></a></p>

<h2 id="翻译与执行查询">翻译与执行查询</h2>

<p>两种计划器翻译和执行查询的方式是不同的。</p>

<div class="codetabs">

  <div data-lang="Blink planner">
    <p>不论输入数据源是流式的还是批式的，Table API 和 SQL 查询都会被转换成 <a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/datastream_api.html">DataStream</a> 程序。查询在内部表示为逻辑查询计划，并被翻译成两个阶段：</p>

    <ol>
      <li>优化逻辑执行计划</li>
      <li>翻译成 DataStream 程序</li>
    </ol>

    <p>Table API 或者 SQL 查询在下列情况下会被翻译：</p>

    <ul>
      <li>当 <code class="highlighter-rouge">TableEnvironment.executeSql()</code> 被调用时。该方法是用来执行一个 SQL 语句，一旦该方法被调用， SQL 语句立即被翻译。</li>
      <li>当 <code class="highlighter-rouge">Table.executeInsert()</code> 被调用时。该方法是用来将一个表的内容插入到目标表中，一旦该方法被调用， TABLE API 程序立即被翻译。</li>
      <li>当 <code class="highlighter-rouge">Table.execute()</code> 被调用时。该方法是用来将一个表的内容收集到本地，一旦该方法被调用， TABLE API 程序立即被翻译。</li>
      <li>当 <code class="highlighter-rouge">StatementSet.execute()</code> 被调用时。<code class="highlighter-rouge">Table</code> （通过 <code class="highlighter-rouge">StatementSet.addInsert()</code> 输出给某个 <code class="highlighter-rouge">Sink</code>）和 INSERT 语句 （通过调用 <code class="highlighter-rouge">StatementSet.addInsertSql()</code>）会先被缓存到 <code class="highlighter-rouge">StatementSet</code> 中，<code class="highlighter-rouge">StatementSet.execute()</code> 方法被调用时，所有的 sink 会被优化成一张有向无环图。</li>
      <li>当 <code class="highlighter-rouge">Table</code> 被转换成 <code class="highlighter-rouge">DataStream</code> 时（参阅<a href="#integration-with-datastream-and-dataset-api">与 DataStream 和 DataSet API 结合</a>）。转换完成后，它就成为一个普通的 DataStream 程序，并会在调用 <code class="highlighter-rouge">StreamExecutionEnvironment.execute()</code> 时被执行。</li>
    </ul>

    <p><span class="label label-danger">注意</span> <strong>从 1.11 版本开始，<code class="highlighter-rouge">sqlUpdate</code> 方法 和 <code class="highlighter-rouge">insertInto</code> 方法被废弃，从这两个方法构建的 Table 程序必须通过 <code class="highlighter-rouge">StreamTableEnvironment.execute()</code> 方法执行，而不能通过 <code class="highlighter-rouge">StreamExecutionEnvironment.execute()</code> 方法来执行。</strong></p>
  </div>

  <div data-lang="Old planner">
    <p>Table API 和 SQL 查询会被翻译成 <a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/datastream_api.html">DataStream</a> 或者 <a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/">DataSet</a> 程序， 这取决于它们的输入数据源是流式的还是批式的。查询在内部表示为逻辑查询计划，并被翻译成两个阶段：</p>

    <ol>
      <li>优化逻辑执行计划</li>
      <li>翻译成 DataStream 或 DataSet 程序</li>
    </ol>

    <p>Table API 或者 SQL 查询在下列情况下会被翻译：</p>

    <ul>
      <li>当 <code class="highlighter-rouge">TableEnvironment.executeSql()</code> 被调用时。该方法是用来执行一个 SQL 语句，一旦该方法被调用， SQL 语句立即被翻译。</li>
      <li>当 <code class="highlighter-rouge">Table.executeInsert()</code> 被调用时。该方法是用来将一个表的内容插入到目标表中，一旦该方法被调用， TABLE API 程序立即被翻译。</li>
      <li>当 <code class="highlighter-rouge">Table.execute()</code> 被调用时。该方法是用来将一个表的内容收集到本地，一旦该方法被调用， TABLE API 程序立即被翻译。</li>
      <li>当 <code class="highlighter-rouge">StatementSet.execute()</code> 被调用时。<code class="highlighter-rouge">Table</code> （通过 <code class="highlighter-rouge">StatementSet.addInsert()</code> 输出给某个 <code class="highlighter-rouge">Sink</code>）和 INSERT 语句 （通过调用 <code class="highlighter-rouge">StatementSet.addInsertSql()</code>）会先被缓存到 <code class="highlighter-rouge">StatementSet</code> 中，<code class="highlighter-rouge">StatementSet.execute()</code> 方法被调用时，所有的 sink 会被优化成一张有向无环图。</li>
      <li>对于 Streaming 而言，当<code class="highlighter-rouge">Table</code> 被转换成 <code class="highlighter-rouge">DataStream</code> 时（参阅<a href="#integration-with-datastream-and-dataset-api">与 DataStream 和 DataSet API 结合</a>）触发翻译。转换完成后，它就成为一个普通的 DataStream 程序，并会在调用 <code class="highlighter-rouge">StreamExecutionEnvironment.execute()</code> 时被执行。对于 Batch 而言，<code class="highlighter-rouge">Table</code> 被转换成 <code class="highlighter-rouge">DataSet</code> 时（参阅<a href="#integration-with-datastream-and-dataset-api">与 DataStream 和 DataSet API 结合</a>）触发翻译。转换完成后，它就成为一个普通的 DataSet 程序，并会在调用 <code class="highlighter-rouge">ExecutionEnvironment.execute()</code> 时被执行。</li>
    </ul>

    <p><span class="label label-danger">注意</span> <strong>从 1.11 版本开始，<code class="highlighter-rouge">sqlUpdate</code> 方法 和 <code class="highlighter-rouge">insertInto</code> 方法被废弃。对于 Streaming 而言，如果一个 Table 程序是从这两个方法构建出来的，必须通过 <code class="highlighter-rouge">StreamTableEnvironment.execute()</code> 方法执行，而不能通过 <code class="highlighter-rouge">StreamExecutionEnvironment.execute()</code> 方法执行；对于 Batch 而言，如果一个 Table 程序是从这两个方法构建出来的，必须通过 <code class="highlighter-rouge">BatchTableEnvironment.execute()</code> 方法执行，而不能通过 <code class="highlighter-rouge">ExecutionEnvironment.execute()</code> 方法执行。</strong></p>

  </div>

</div>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<p><a name="integration-with-datastream-and-dataset-api"></a></p>

<h2 id="与-datastream-和-dataset-api-结合">与 DataStream 和 DataSet API 结合</h2>

<p>在流处理方面两种计划器都可以与 <code class="highlighter-rouge">DataStream</code> API 结合。只有旧计划器可以与 <code class="highlighter-rouge">DataSet API</code> 结合。在批处理方面，Blink 计划器不能同两种计划器中的任何一个结合。</p>

<p><strong>注意：</strong> 下文讨论的 <code class="highlighter-rouge">DataSet</code> API 只与旧计划起有关。</p>

<p>Table API 和 SQL 可以被很容易地集成并嵌入到 <a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/datastream_api.html">DataStream</a> 和 <a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/">DataSet</a> 程序中。例如，可以查询外部表（例如从 RDBMS），进行一些预处理，例如过滤，投影，聚合或与元数据 join，然后使用 DataStream 或 DataSet API（以及在这些 API 之上构建的任何库，例如 CEP 或 Gelly）。相反，也可以将 Table API 或 SQL 查询应用于 DataStream 或 DataSet 程序的结果。</p>

<p>这种交互可以通过 <code class="highlighter-rouge">DataStream</code> 或 <code class="highlighter-rouge">DataSet</code> 与 <code class="highlighter-rouge">Table</code> 的相互转化实现。本节我们会介绍这些转化是如何实现的。</p>

<p><a name="implicit-conversion-for-scala"></a></p>

<h3 id="scala-隐式转换">Scala 隐式转换</h3>

<p>Scala Table API 含有对 <code class="highlighter-rouge">DataSet</code>、<code class="highlighter-rouge">DataStream</code> 和 <code class="highlighter-rouge">Table</code> 类的隐式转换。 通过为 Scala DataStream API 导入 <code class="highlighter-rouge">org.apache.flink.table.api.bridge.scala._</code> 包以及 <code class="highlighter-rouge">org.apache.flink.api.scala._</code> 包，可以启用这些转换。</p>

<p><a name="create-a-view-from-a-datastream-or-dataset"></a></p>

<h3 id="通过-dataset-或-datastream-创建视图">通过 DataSet 或 DataStream 创建<code class="highlighter-rouge">视图</code></h3>

<p>在 <code class="highlighter-rouge">TableEnvironment</code> 中可以将 <code class="highlighter-rouge">DataStream</code> 或 <code class="highlighter-rouge">DataSet</code> 注册成视图。结果视图的 schema 取决于注册的 <code class="highlighter-rouge">DataStream</code> 或 <code class="highlighter-rouge">DataSet</code> 的数据类型。请参阅文档 <a href="#mapping-of-data-types-to-table-schema">数据类型到 table schema 的映射</a>获取详细信息。</p>

<p><strong>注意：</strong> 通过 <code class="highlighter-rouge">DataStream</code> 或 <code class="highlighter-rouge">DataSet</code> 创建的视图只能注册成临时视图。</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// get StreamTableEnvironment</span>
<span class="c1">// registration of a DataSet in a BatchTableEnvironment is equivalent</span>
<span class="nc">StreamTableEnvironment</span> <span class="n">tableEnv</span> <span class="o">=</span> <span class="o">...;</span> <span class="c1">// see "Create a TableEnvironment" section</span>

<span class="nc">DataStream</span><span class="o">&lt;</span><span class="nc">Tuple2</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="n">stream</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// register the DataStream as View "myTable" with fields "f0", "f1"</span>
<span class="n">tableEnv</span><span class="o">.</span><span class="na">createTemporaryView</span><span class="o">(</span><span class="s">"myTable"</span><span class="o">,</span> <span class="n">stream</span><span class="o">);</span>

<span class="c1">// register the DataStream as View "myTable2" with fields "myLong", "myString"</span>
<span class="n">tableEnv</span><span class="o">.</span><span class="na">createTemporaryView</span><span class="o">(</span><span class="s">"myTable2"</span><span class="o">,</span> <span class="n">stream</span><span class="o">,</span> <span class="err">$</span><span class="o">(</span><span class="s">"myLong"</span><span class="o">),</span> <span class="err">$</span><span class="o">(</span><span class="s">"myString"</span><span class="o">));</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// get TableEnvironment </span>
<span class="c1">// registration of a DataSet is equivalent</span>
<span class="k">val</span> <span class="nv">tableEnv</span><span class="k">:</span> <span class="kt">StreamTableEnvironment</span> <span class="o">=</span> <span class="o">...</span> <span class="c1">// see "Create a TableEnvironment" section</span>

<span class="k">val</span> <span class="nv">stream</span><span class="k">:</span> <span class="kt">DataStream</span><span class="o">[(</span><span class="kt">Long</span>, <span class="kt">String</span><span class="o">)]</span> <span class="k">=</span> <span class="o">...</span>

<span class="c1">// register the DataStream as View "myTable" with fields "f0", "f1"</span>
<span class="nv">tableEnv</span><span class="o">.</span><span class="py">createTemporaryView</span><span class="o">(</span><span class="s">"myTable"</span><span class="o">,</span> <span class="n">stream</span><span class="o">)</span>

<span class="c1">// register the DataStream as View "myTable2" with fields "myLong", "myString"</span>
<span class="nv">tableEnv</span><span class="o">.</span><span class="py">createTemporaryView</span><span class="o">(</span><span class="s">"myTable2"</span><span class="o">,</span> <span class="n">stream</span><span class="o">,</span> <span class="ss">'myLong</span><span class="o">,</span> <span class="ss">'myString</span><span class="o">)</span></code></pre></figure>

  </div>
</div>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<p><a name="convert-a-datastream-or-dataset-into-a-table"></a></p>

<h3 id="将-datastream-或-dataset-转换成表">将 DataStream 或 DataSet 转换成表</h3>

<p>与在 <code class="highlighter-rouge">TableEnvironment</code> 注册 <code class="highlighter-rouge">DataStream</code> 或 <code class="highlighter-rouge">DataSet</code> 不同，DataStream 和 DataSet 还可以直接转换成 <code class="highlighter-rouge">Table</code>。如果你想在 Table API 的查询中使用表，这将非常便捷。</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// get StreamTableEnvironment</span>
<span class="c1">// registration of a DataSet in a BatchTableEnvironment is equivalent</span>
<span class="nc">StreamTableEnvironment</span> <span class="n">tableEnv</span> <span class="o">=</span> <span class="o">...;</span> <span class="c1">// see "Create a TableEnvironment" section</span>

<span class="nc">DataStream</span><span class="o">&lt;</span><span class="nc">Tuple2</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="n">stream</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// Convert the DataStream into a Table with default fields "f0", "f1"</span>
<span class="nc">Table</span> <span class="n">table1</span> <span class="o">=</span> <span class="n">tableEnv</span><span class="o">.</span><span class="na">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">);</span>

<span class="c1">// Convert the DataStream into a Table with fields "myLong", "myString"</span>
<span class="nc">Table</span> <span class="n">table2</span> <span class="o">=</span> <span class="n">tableEnv</span><span class="o">.</span><span class="na">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="err">$</span><span class="o">(</span><span class="s">"myLong"</span><span class="o">),</span> <span class="err">$</span><span class="o">(</span><span class="s">"myString"</span><span class="o">));</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// get TableEnvironment</span>
<span class="c1">// registration of a DataSet is equivalent</span>
<span class="k">val</span> <span class="nv">tableEnv</span> <span class="k">=</span> <span class="o">...</span> <span class="c1">// see "Create a TableEnvironment" section</span>

<span class="k">val</span> <span class="nv">stream</span><span class="k">:</span> <span class="kt">DataStream</span><span class="o">[(</span><span class="kt">Long</span>, <span class="kt">String</span><span class="o">)]</span> <span class="k">=</span> <span class="o">...</span>

<span class="c1">// convert the DataStream into a Table with default fields "_1", "_2"</span>
<span class="k">val</span> <span class="nv">table1</span><span class="k">:</span> <span class="kt">Table</span> <span class="o">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">)</span>

<span class="c1">// convert the DataStream into a Table with fields "myLong", "myString"</span>
<span class="k">val</span> <span class="nv">table2</span><span class="k">:</span> <span class="kt">Table</span> <span class="o">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="n">$</span><span class="s">"myLong"</span><span class="o">,</span> <span class="n">$</span><span class="s">"myString"</span><span class="o">)</span></code></pre></figure>

  </div>
</div>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<p><a name="convert-a-table-into-a-datastream-or-dataset"></a></p>

<h3 id="将表转换成-datastream-或-dataset">将表转换成 DataStream 或 DataSet</h3>

<p><code class="highlighter-rouge">Table</code> 可以被转换成 <code class="highlighter-rouge">DataStream</code> 或 <code class="highlighter-rouge">DataSet</code>。通过这种方式，定制的 DataSet 或 DataStream 程序就可以在 Table API 或者 SQL 的查询结果上运行了。</p>

<p>将 <code class="highlighter-rouge">Table</code> 转换为 <code class="highlighter-rouge">DataStream</code> 或者 <code class="highlighter-rouge">DataSet</code> 时，你需要指定生成的 <code class="highlighter-rouge">DataStream</code> 或者 <code class="highlighter-rouge">DataSet</code> 的数据类型，即，<code class="highlighter-rouge">Table</code> 的每行数据要转换成的数据类型。通常最方便的选择是转换成 <code class="highlighter-rouge">Row</code> 。以下列表概述了不同选项的功能：</p>

<ul>
  <li><strong>Row</strong>: 字段按位置映射，字段数量任意，支持 <code class="highlighter-rouge">null</code> 值，无类型安全（type-safe）检查。</li>
  <li><strong>POJO</strong>: 字段按名称映射（POJO 必须按<code class="highlighter-rouge">Table</code> 中字段名称命名），字段数量任意，支持 <code class="highlighter-rouge">null</code> 值，无类型安全检查。</li>
  <li><strong>Case Class</strong>: 字段按位置映射，不支持 <code class="highlighter-rouge">null</code> 值，有类型安全检查。</li>
  <li><strong>Tuple</strong>: 字段按位置映射，字段数量少于 22（Scala）或者 25（Java），不支持 <code class="highlighter-rouge">null</code> 值，无类型安全检查。</li>
  <li><strong>Atomic Type</strong>: <code class="highlighter-rouge">Table</code> 必须有一个字段，不支持 <code class="highlighter-rouge">null</code> 值，有类型安全检查。</li>
</ul>

<p><a name="convert-a-table-into-a-datastream"></a></p>

<h4 id="将表转换成-datastream">将表转换成 DataStream</h4>

<p>流式查询（streaming query）的结果表会动态更新，即，当新纪录到达查询的输入流时，查询结果会改变。因此，像这样将动态查询结果转换成 DataStream 需要对表的更新方式进行编码。</p>

<p>将 <code class="highlighter-rouge">Table</code> 转换为 <code class="highlighter-rouge">DataStream</code> 有两种模式：</p>

<ol>
  <li><strong>Append Mode</strong>: 仅当动态 <code class="highlighter-rouge">Table</code> 仅通过<code class="highlighter-rouge">INSERT</code>更改进行修改时，才可以使用此模式，即，它仅是追加操作，并且之前输出的结果永远不会更新。</li>
  <li><strong>Retract Mode</strong>: 任何情形都可以使用此模式。它使用 boolean 值对 <code class="highlighter-rouge">INSERT</code> 和 <code class="highlighter-rouge">DELETE</code> 操作的数据进行标记。</li>
</ol>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// get StreamTableEnvironment. </span>
<span class="nc">StreamTableEnvironment</span> <span class="n">tableEnv</span> <span class="o">=</span> <span class="o">...;</span> <span class="c1">// see "Create a TableEnvironment" section</span>

<span class="c1">// Table with two fields (String name, Integer age)</span>
<span class="nc">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// convert the Table into an append DataStream of Row by specifying the class</span>
<span class="nc">DataStream</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">dsRow</span> <span class="o">=</span> <span class="n">tableEnv</span><span class="o">.</span><span class="na">toAppendStream</span><span class="o">(</span><span class="n">table</span><span class="o">,</span> <span class="nc">Row</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

<span class="c1">// convert the Table into an append DataStream of Tuple2&lt;String, Integer&gt; </span>
<span class="c1">//   via a TypeInformation</span>
<span class="nc">TupleTypeInfo</span><span class="o">&lt;</span><span class="nc">Tuple2</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;&gt;</span> <span class="n">tupleType</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TupleTypeInfo</span><span class="o">&lt;&gt;(</span>
  <span class="nc">Types</span><span class="o">.</span><span class="na">STRING</span><span class="o">(),</span>
  <span class="nc">Types</span><span class="o">.</span><span class="na">INT</span><span class="o">());</span>
<span class="nc">DataStream</span><span class="o">&lt;</span><span class="nc">Tuple2</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;&gt;</span> <span class="n">dsTuple</span> <span class="o">=</span> 
  <span class="n">tableEnv</span><span class="o">.</span><span class="na">toAppendStream</span><span class="o">(</span><span class="n">table</span><span class="o">,</span> <span class="n">tupleType</span><span class="o">);</span>

<span class="c1">// convert the Table into a retract DataStream of Row.</span>
<span class="c1">//   A retract stream of type X is a DataStream&lt;Tuple2&lt;Boolean, X&gt;&gt;. </span>
<span class="c1">//   The boolean field indicates the type of the change. </span>
<span class="c1">//   True is INSERT, false is DELETE.</span>
<span class="nc">DataStream</span><span class="o">&lt;</span><span class="nc">Tuple2</span><span class="o">&lt;</span><span class="nc">Boolean</span><span class="o">,</span> <span class="nc">Row</span><span class="o">&gt;&gt;</span> <span class="n">retractStream</span> <span class="o">=</span> 
  <span class="n">tableEnv</span><span class="o">.</span><span class="na">toRetractStream</span><span class="o">(</span><span class="n">table</span><span class="o">,</span> <span class="nc">Row</span><span class="o">.</span><span class="na">class</span><span class="o">);</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// get TableEnvironment. </span>
<span class="c1">// registration of a DataSet is equivalent</span>
<span class="k">val</span> <span class="nv">tableEnv</span><span class="k">:</span> <span class="kt">StreamTableEnvironment</span> <span class="o">=</span> <span class="o">...</span> <span class="c1">// see "Create a TableEnvironment" section</span>

<span class="c1">// Table with two fields (String name, Integer age)</span>
<span class="k">val</span> <span class="nv">table</span><span class="k">:</span> <span class="kt">Table</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// convert the Table into an append DataStream of Row</span>
<span class="k">val</span> <span class="nv">dsRow</span><span class="k">:</span> <span class="kt">DataStream</span><span class="o">[</span><span class="kt">Row</span><span class="o">]</span> <span class="k">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">toAppendStream</span><span class="o">[</span><span class="kt">Row</span><span class="o">](</span><span class="n">table</span><span class="o">)</span>

<span class="c1">// convert the Table into an append DataStream of Tuple2[String, Int]</span>
<span class="k">val</span> <span class="nv">dsTuple</span><span class="k">:</span> <span class="kt">DataStream</span><span class="o">[(</span><span class="kt">String</span>, <span class="kt">Int</span><span class="o">)]</span> <span class="n">dsTuple</span> <span class="k">=</span> 
  <span class="nv">tableEnv</span><span class="o">.</span><span class="py">toAppendStream</span><span class="o">[(</span><span class="kt">String</span>, <span class="kt">Int</span><span class="o">)](</span><span class="n">table</span><span class="o">)</span>

<span class="c1">// convert the Table into a retract DataStream of Row.</span>
<span class="c1">//   A retract stream of type X is a DataStream[(Boolean, X)]. </span>
<span class="c1">//   The boolean field indicates the type of the change. </span>
<span class="c1">//   True is INSERT, false is DELETE.</span>
<span class="k">val</span> <span class="nv">retractStream</span><span class="k">:</span> <span class="kt">DataStream</span><span class="o">[(</span><span class="kt">Boolean</span>, <span class="kt">Row</span><span class="o">)]</span> <span class="k">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">toRetractStream</span><span class="o">[</span><span class="kt">Row</span><span class="o">](</span><span class="n">table</span><span class="o">)</span></code></pre></figure>

  </div>
</div>

<p><strong>注意：</strong> 文档<a href="streaming/dynamic_tables.html">动态表</a>给出了有关动态表及其属性的详细讨论。</p>

<p><span class="label label-danger">注意</span> <strong>一旦 Table 被转化为 DataStream，必须使用 StreamExecutionEnvironment 的 execute 方法执行该 DataStream 作业。</strong></p>

<p><a name="convert-a-table-into-a-dataset"></a></p>

<h4 id="将表转换成-dataset">将表转换成 DataSet</h4>

<p>将 <code class="highlighter-rouge">Table</code> 转换成 <code class="highlighter-rouge">DataSet</code> 的过程如下：</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// get BatchTableEnvironment</span>
<span class="nc">BatchTableEnvironment</span> <span class="n">tableEnv</span> <span class="o">=</span> <span class="nc">BatchTableEnvironment</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">env</span><span class="o">);</span>

<span class="c1">// Table with two fields (String name, Integer age)</span>
<span class="nc">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// convert the Table into a DataSet of Row by specifying a class</span>
<span class="nc">DataSet</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">dsRow</span> <span class="o">=</span> <span class="n">tableEnv</span><span class="o">.</span><span class="na">toDataSet</span><span class="o">(</span><span class="n">table</span><span class="o">,</span> <span class="nc">Row</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

<span class="c1">// convert the Table into a DataSet of Tuple2&lt;String, Integer&gt; via a TypeInformation</span>
<span class="nc">TupleTypeInfo</span><span class="o">&lt;</span><span class="nc">Tuple2</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;&gt;</span> <span class="n">tupleType</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TupleTypeInfo</span><span class="o">&lt;&gt;(</span>
  <span class="nc">Types</span><span class="o">.</span><span class="na">STRING</span><span class="o">(),</span>
  <span class="nc">Types</span><span class="o">.</span><span class="na">INT</span><span class="o">());</span>
<span class="nc">DataSet</span><span class="o">&lt;</span><span class="nc">Tuple2</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;&gt;</span> <span class="n">dsTuple</span> <span class="o">=</span> 
  <span class="n">tableEnv</span><span class="o">.</span><span class="na">toDataSet</span><span class="o">(</span><span class="n">table</span><span class="o">,</span> <span class="n">tupleType</span><span class="o">);</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// get TableEnvironment </span>
<span class="c1">// registration of a DataSet is equivalent</span>
<span class="k">val</span> <span class="nv">tableEnv</span> <span class="k">=</span> <span class="nv">BatchTableEnvironment</span><span class="o">.</span><span class="py">create</span><span class="o">(</span><span class="n">env</span><span class="o">)</span>

<span class="c1">// Table with two fields (String name, Integer age)</span>
<span class="k">val</span> <span class="nv">table</span><span class="k">:</span> <span class="kt">Table</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// convert the Table into a DataSet of Row</span>
<span class="k">val</span> <span class="nv">dsRow</span><span class="k">:</span> <span class="kt">DataSet</span><span class="o">[</span><span class="kt">Row</span><span class="o">]</span> <span class="k">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">toDataSet</span><span class="o">[</span><span class="kt">Row</span><span class="o">](</span><span class="n">table</span><span class="o">)</span>

<span class="c1">// convert the Table into a DataSet of Tuple2[String, Int]</span>
<span class="k">val</span> <span class="nv">dsTuple</span><span class="k">:</span> <span class="kt">DataSet</span><span class="o">[(</span><span class="kt">String</span>, <span class="kt">Int</span><span class="o">)]</span> <span class="k">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">toDataSet</span><span class="o">[(</span><span class="kt">String</span>, <span class="kt">Int</span><span class="o">)](</span><span class="n">table</span><span class="o">)</span></code></pre></figure>

  </div>
</div>

<p><span class="label label-danger">注意</span> <strong>一旦 Table 被转化为 DataSet，必须使用 ExecutionEnvironment 的 execute 方法执行该 DataSet 作业。</strong></p>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<p><a name="mapping-of-data-types-to-table-schema"></a></p>

<h3 id="数据类型到-table-schema-的映射">数据类型到 Table Schema 的映射</h3>

<p>Flink 的 DataStream 和 DataSet APIs 支持多样的数据类型。例如 Tuple（Scala 内置以及Flink Java tuple）、POJO 类型、Scala case class 类型以及 Flink 的 Row 类型等允许嵌套且有多个可在表的表达式中访问的字段的复合数据类型。其他类型被视为原子类型。下面，我们讨论 Table API 如何将这些数据类型类型转换为内部 row 表示形式，并提供将 <code class="highlighter-rouge">DataStream</code> 转换成 <code class="highlighter-rouge">Table</code> 的样例。</p>

<p>数据类型到 table schema 的映射有两种方式：<strong>基于字段位置</strong>或<strong>基于字段名称</strong>。</p>

<p><strong>基于位置映射</strong></p>

<p>基于位置的映射可在保持字段顺序的同时为字段提供更有意义的名称。这种映射方式可用于<em>具有特定的字段顺序</em>的复合数据类型以及原子类型。如 tuple、row 以及 case class 这些复合数据类型都有这样的字段顺序。然而，POJO 类型的字段则必须通过名称映射（参见下一章）。可以将字段投影出来，但不能使用<code class="highlighter-rouge">as</code>重命名。</p>

<p>定义基于位置的映射时，输入数据类型中一定不能存在指定的名称，否则 API 会假定应该基于字段名称进行映射。如果未指定任何字段名称，则使用默认的字段名称和复合数据类型的字段顺序，或者使用 <code class="highlighter-rouge">f0</code> 表示原子类型。</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// get a StreamTableEnvironment, works for BatchTableEnvironment equivalently</span>
<span class="nc">StreamTableEnvironment</span> <span class="n">tableEnv</span> <span class="o">=</span> <span class="o">...;</span> <span class="c1">// see "Create a TableEnvironment" section;</span>

<span class="nc">DataStream</span><span class="o">&lt;</span><span class="nc">Tuple2</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;&gt;</span> <span class="n">stream</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// convert DataStream into Table with default field names "f0" and "f1"</span>
<span class="nc">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">tableEnv</span><span class="o">.</span><span class="na">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">);</span>

<span class="c1">// convert DataStream into Table with field "myLong" only</span>
<span class="nc">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">tableEnv</span><span class="o">.</span><span class="na">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="err">$</span><span class="o">(</span><span class="s">"myLong"</span><span class="o">));</span>

<span class="c1">// convert DataStream into Table with field names "myLong" and "myInt"</span>
<span class="nc">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">tableEnv</span><span class="o">.</span><span class="na">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="err">$</span><span class="o">(</span><span class="s">"myLong"</span><span class="o">),</span> <span class="err">$</span><span class="o">(</span><span class="s">"myInt"</span><span class="o">));</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// get a TableEnvironment</span>
<span class="k">val</span> <span class="nv">tableEnv</span><span class="k">:</span> <span class="kt">StreamTableEnvironment</span> <span class="o">=</span> <span class="o">...</span> <span class="c1">// see "Create a TableEnvironment" section</span>

<span class="k">val</span> <span class="nv">stream</span><span class="k">:</span> <span class="kt">DataStream</span><span class="o">[(</span><span class="kt">Long</span>, <span class="kt">Int</span><span class="o">)]</span> <span class="k">=</span> <span class="o">...</span>

<span class="c1">// convert DataStream into Table with default field names "_1" and "_2"</span>
<span class="k">val</span> <span class="nv">table</span><span class="k">:</span> <span class="kt">Table</span> <span class="o">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">)</span>

<span class="c1">// convert DataStream into Table with field "myLong" only</span>
<span class="k">val</span> <span class="nv">table</span><span class="k">:</span> <span class="kt">Table</span> <span class="o">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="n">$</span><span class="s">"myLong"</span><span class="o">)</span>

<span class="c1">// convert DataStream into Table with field names "myLong" and "myInt"</span>
<span class="k">val</span> <span class="nv">table</span><span class="k">:</span> <span class="kt">Table</span> <span class="o">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="n">$</span><span class="s">"myLong"</span><span class="o">,</span> <span class="n">$</span><span class="s">"myInt"</span><span class="o">)</span></code></pre></figure>

  </div>
</div>

<p><strong>基于名称的映射</strong></p>

<p>基于名称的映射适用于任何数据类型包括 POJO 类型。这是定义 table schema 映射最灵活的方式。映射中的所有字段均按名称引用，并且可以通过 <code class="highlighter-rouge">as</code> 重命名。字段可以被重新排序和映射。</p>

<p>若果没有指定任何字段名称，则使用默认的字段名称和复合数据类型的字段顺序，或者使用 <code class="highlighter-rouge">f0</code> 表示原子类型。</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// get a StreamTableEnvironment, works for BatchTableEnvironment equivalently</span>
<span class="nc">StreamTableEnvironment</span> <span class="n">tableEnv</span> <span class="o">=</span> <span class="o">...;</span> <span class="c1">// see "Create a TableEnvironment" section</span>

<span class="nc">DataStream</span><span class="o">&lt;</span><span class="nc">Tuple2</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;&gt;</span> <span class="n">stream</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// convert DataStream into Table with default field names "f0" and "f1"</span>
<span class="nc">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">tableEnv</span><span class="o">.</span><span class="na">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">);</span>

<span class="c1">// convert DataStream into Table with field "f1" only</span>
<span class="nc">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">tableEnv</span><span class="o">.</span><span class="na">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="err">$</span><span class="o">(</span><span class="s">"f1"</span><span class="o">));</span>

<span class="c1">// convert DataStream into Table with swapped fields</span>
<span class="nc">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">tableEnv</span><span class="o">.</span><span class="na">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="err">$</span><span class="o">(</span><span class="s">"f1"</span><span class="o">),</span> <span class="err">$</span><span class="o">(</span><span class="s">"f0"</span><span class="o">));</span>

<span class="c1">// convert DataStream into Table with swapped fields and field names "myInt" and "myLong"</span>
<span class="nc">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">tableEnv</span><span class="o">.</span><span class="na">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="err">$</span><span class="o">(</span><span class="s">"f1"</span><span class="o">).</span><span class="na">as</span><span class="o">(</span><span class="s">"myInt"</span><span class="o">),</span> <span class="err">$</span><span class="o">(</span><span class="s">"f0"</span><span class="o">).</span><span class="na">as</span><span class="o">(</span><span class="s">"myLong"</span><span class="o">));</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// get a TableEnvironment</span>
<span class="k">val</span> <span class="nv">tableEnv</span><span class="k">:</span> <span class="kt">StreamTableEnvironment</span> <span class="o">=</span> <span class="o">...</span> <span class="c1">// see "Create a TableEnvironment" section</span>

<span class="k">val</span> <span class="nv">stream</span><span class="k">:</span> <span class="kt">DataStream</span><span class="o">[(</span><span class="kt">Long</span>, <span class="kt">Int</span><span class="o">)]</span> <span class="k">=</span> <span class="o">...</span>

<span class="c1">// convert DataStream into Table with default field names "_1" and "_2"</span>
<span class="k">val</span> <span class="nv">table</span><span class="k">:</span> <span class="kt">Table</span> <span class="o">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">)</span>

<span class="c1">// convert DataStream into Table with field "_2" only</span>
<span class="k">val</span> <span class="nv">table</span><span class="k">:</span> <span class="kt">Table</span> <span class="o">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="n">$</span><span class="s">"_2"</span><span class="o">)</span>

<span class="c1">// convert DataStream into Table with swapped fields</span>
<span class="k">val</span> <span class="nv">table</span><span class="k">:</span> <span class="kt">Table</span> <span class="o">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="n">$</span><span class="s">"_2"</span><span class="o">,</span> <span class="n">$</span><span class="s">"_1"</span><span class="o">)</span>

<span class="c1">// convert DataStream into Table with swapped fields and field names "myInt" and "myLong"</span>
<span class="k">val</span> <span class="nv">table</span><span class="k">:</span> <span class="kt">Table</span> <span class="o">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="n">$</span><span class="s">"_2"</span> <span class="n">as</span> <span class="s">"myInt"</span><span class="o">,</span> <span class="n">$</span><span class="s">"_1"</span> <span class="n">as</span> <span class="s">"myLong"</span><span class="o">)</span></code></pre></figure>

  </div>
</div>

<p><a name="atomic-types"></a></p>

<h4 id="原子类型">原子类型</h4>

<p>Flink 将基础数据类型（<code class="highlighter-rouge">Integer</code>、<code class="highlighter-rouge">Double</code>、<code class="highlighter-rouge">String</code>）或者通用数据类型（不可再拆分的数据类型）视为原子类型。原子类型的 <code class="highlighter-rouge">DataStream</code> 或者 <code class="highlighter-rouge">DataSet</code> 会被转换成只有一条属性的 <code class="highlighter-rouge">Table</code>。属性的数据类型可以由原子类型推断出，还可以重新命名属性。</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// get a StreamTableEnvironment, works for BatchTableEnvironment equivalently</span>
<span class="nc">StreamTableEnvironment</span> <span class="n">tableEnv</span> <span class="o">=</span> <span class="o">...;</span> <span class="c1">// see "Create a TableEnvironment" section</span>

<span class="nc">DataStream</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="n">stream</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// convert DataStream into Table with default field name "f0"</span>
<span class="nc">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">tableEnv</span><span class="o">.</span><span class="na">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">);</span>

<span class="c1">// convert DataStream into Table with field name "myLong"</span>
<span class="nc">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">tableEnv</span><span class="o">.</span><span class="na">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="err">$</span><span class="o">(</span><span class="s">"myLong"</span><span class="o">));</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// get a TableEnvironment</span>
<span class="k">val</span> <span class="nv">tableEnv</span><span class="k">:</span> <span class="kt">StreamTableEnvironment</span> <span class="o">=</span> <span class="o">...</span> <span class="c1">// see "Create a TableEnvironment" section</span>

<span class="k">val</span> <span class="nv">stream</span><span class="k">:</span> <span class="kt">DataStream</span><span class="o">[</span><span class="kt">Long</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>

<span class="c1">// convert DataStream into Table with default field name "f0"</span>
<span class="k">val</span> <span class="nv">table</span><span class="k">:</span> <span class="kt">Table</span> <span class="o">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">)</span>

<span class="c1">// convert DataStream into Table with field name "myLong"</span>
<span class="k">val</span> <span class="nv">table</span><span class="k">:</span> <span class="kt">Table</span> <span class="o">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="n">$</span><span class="s">"myLong"</span><span class="o">)</span></code></pre></figure>

  </div>
</div>

<p><a name="tuples-scala-and-java-and-case-classes-scala-only"></a></p>

<h4 id="tuple类型scala-和-java和-case-class类型仅-scala">Tuple类型（Scala 和 Java）和 Case Class类型（仅 Scala）</h4>

<p>Flink 支持 Scala 的内置 tuple 类型并给 Java 提供自己的 tuple 类型。两种 tuple 的 DataStream 和 DataSet 都能被转换成表。可以通过提供所有字段名称来重命名字段（基于位置映射）。如果没有指明任何字段名称，则会使用默认的字段名称。如果引用了原始字段名称（对于 Flink tuple 为<code class="highlighter-rouge">f0</code>、<code class="highlighter-rouge">f1</code> … …，对于 Scala tuple 为<code class="highlighter-rouge">_1</code>、<code class="highlighter-rouge">_2</code> … …），则 API 会假定映射是基于名称的而不是基于位置的。基于名称的映射可以通过 <code class="highlighter-rouge">as</code> 对字段和投影进行重新排序。</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// get a StreamTableEnvironment, works for BatchTableEnvironment equivalently</span>
<span class="nc">StreamTableEnvironment</span> <span class="n">tableEnv</span> <span class="o">=</span> <span class="o">...;</span> <span class="c1">// see "Create a TableEnvironment" section</span>

<span class="nc">DataStream</span><span class="o">&lt;</span><span class="nc">Tuple2</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="n">stream</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// convert DataStream into Table with default field names "f0", "f1"</span>
<span class="nc">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">tableEnv</span><span class="o">.</span><span class="na">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">);</span>

<span class="c1">// convert DataStream into Table with renamed field names "myLong", "myString" (position-based)</span>
<span class="nc">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">tableEnv</span><span class="o">.</span><span class="na">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="err">$</span><span class="o">(</span><span class="s">"myLong"</span><span class="o">),</span> <span class="err">$</span><span class="o">(</span><span class="s">"myString"</span><span class="o">));</span>

<span class="c1">// convert DataStream into Table with reordered fields "f1", "f0" (name-based)</span>
<span class="nc">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">tableEnv</span><span class="o">.</span><span class="na">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="err">$</span><span class="o">(</span><span class="s">"f1"</span><span class="o">),</span> <span class="err">$</span><span class="o">(</span><span class="s">"f0"</span><span class="o">));</span>

<span class="c1">// convert DataStream into Table with projected field "f1" (name-based)</span>
<span class="nc">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">tableEnv</span><span class="o">.</span><span class="na">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="err">$</span><span class="o">(</span><span class="s">"f1"</span><span class="o">));</span>

<span class="c1">// convert DataStream into Table with reordered and aliased fields "myString", "myLong" (name-based)</span>
<span class="nc">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">tableEnv</span><span class="o">.</span><span class="na">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="err">$</span><span class="o">(</span><span class="s">"f1"</span><span class="o">).</span><span class="na">as</span><span class="o">(</span><span class="s">"myString"</span><span class="o">),</span> <span class="err">$</span><span class="o">(</span><span class="s">"f0"</span><span class="o">).</span><span class="na">as</span><span class="o">(</span><span class="s">"myLong"</span><span class="o">));</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// get a TableEnvironment</span>
<span class="k">val</span> <span class="nv">tableEnv</span><span class="k">:</span> <span class="kt">StreamTableEnvironment</span> <span class="o">=</span> <span class="o">...</span> <span class="c1">// see "Create a TableEnvironment" section</span>

<span class="k">val</span> <span class="nv">stream</span><span class="k">:</span> <span class="kt">DataStream</span><span class="o">[(</span><span class="kt">Long</span>, <span class="kt">String</span><span class="o">)]</span> <span class="k">=</span> <span class="o">...</span>

<span class="c1">// convert DataStream into Table with renamed default field names '_1, '_2</span>
<span class="k">val</span> <span class="nv">table</span><span class="k">:</span> <span class="kt">Table</span> <span class="o">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">)</span>

<span class="c1">// convert DataStream into Table with field names "myLong", "myString" (position-based)</span>
<span class="k">val</span> <span class="nv">table</span><span class="k">:</span> <span class="kt">Table</span> <span class="o">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="n">$</span><span class="s">"myLong"</span><span class="o">,</span> <span class="n">$</span><span class="s">"myString"</span><span class="o">)</span>

<span class="c1">// convert DataStream into Table with reordered fields "_2", "_1" (name-based)</span>
<span class="k">val</span> <span class="nv">table</span><span class="k">:</span> <span class="kt">Table</span> <span class="o">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="n">$</span><span class="s">"_2"</span><span class="o">,</span> <span class="n">$</span><span class="s">"_1"</span><span class="o">)</span>

<span class="c1">// convert DataStream into Table with projected field "_2" (name-based)</span>
<span class="k">val</span> <span class="nv">table</span><span class="k">:</span> <span class="kt">Table</span> <span class="o">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="n">$</span><span class="s">"_2"</span><span class="o">)</span>

<span class="c1">// convert DataStream into Table with reordered and aliased fields "myString", "myLong" (name-based)</span>
<span class="k">val</span> <span class="nv">table</span><span class="k">:</span> <span class="kt">Table</span> <span class="o">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="n">$</span><span class="s">"_2"</span> <span class="n">as</span> <span class="s">"myString"</span><span class="o">,</span> <span class="n">$</span><span class="s">"_1"</span> <span class="n">as</span> <span class="s">"myLong"</span><span class="o">)</span>

<span class="c1">// define case class</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Person</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">age</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">streamCC</span><span class="k">:</span> <span class="kt">DataStream</span><span class="o">[</span><span class="kt">Person</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>

<span class="c1">// convert DataStream into Table with default field names 'name, 'age</span>
<span class="k">val</span> <span class="nv">table</span> <span class="k">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">fromDataStream</span><span class="o">(</span><span class="n">streamCC</span><span class="o">)</span>

<span class="c1">// convert DataStream into Table with field names 'myName, 'myAge (position-based)</span>
<span class="k">val</span> <span class="nv">table</span> <span class="k">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">fromDataStream</span><span class="o">(</span><span class="n">streamCC</span><span class="o">,</span> <span class="n">$</span><span class="s">"myName"</span><span class="o">,</span> <span class="n">$</span><span class="s">"myAge"</span><span class="o">)</span>

<span class="c1">// convert DataStream into Table with reordered and aliased fields "myAge", "myName" (name-based)</span>
<span class="k">val</span> <span class="nv">table</span><span class="k">:</span> <span class="kt">Table</span> <span class="o">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="n">$</span><span class="s">"age"</span> <span class="n">as</span> <span class="s">"myAge"</span><span class="o">,</span> <span class="n">$</span><span class="s">"name"</span> <span class="n">as</span> <span class="s">"myName"</span><span class="o">)</span></code></pre></figure>

  </div>
</div>

<p><a name="pojo-java-and-scala"></a></p>

<h4 id="pojo-类型-java-和-scala">POJO 类型 （Java 和 Scala）</h4>

<p>Flink 支持 POJO 类型作为复合类型。确定 POJO 类型的规则记录在<a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/types_serialization.html#pojos">这里</a>.</p>

<p>在不指定字段名称的情况下将 POJO 类型的 <code class="highlighter-rouge">DataStream</code> 或 <code class="highlighter-rouge">DataSet</code> 转换成 <code class="highlighter-rouge">Table</code> 时，将使用原始 POJO 类型字段的名称。名称映射需要原始名称，并且不能按位置进行。字段可以使用别名（带有 <code class="highlighter-rouge">as</code> 关键字）来重命名，重新排序和投影。</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// get a StreamTableEnvironment, works for BatchTableEnvironment equivalently</span>
<span class="nc">StreamTableEnvironment</span> <span class="n">tableEnv</span> <span class="o">=</span> <span class="o">...;</span> <span class="c1">// see "Create a TableEnvironment" section</span>

<span class="c1">// Person is a POJO with fields "name" and "age"</span>
<span class="nc">DataStream</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">stream</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// convert DataStream into Table with default field names "age", "name" (fields are ordered by name!)</span>
<span class="nc">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">tableEnv</span><span class="o">.</span><span class="na">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">);</span>

<span class="c1">// convert DataStream into Table with renamed fields "myAge", "myName" (name-based)</span>
<span class="nc">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">tableEnv</span><span class="o">.</span><span class="na">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="err">$</span><span class="o">(</span><span class="s">"age"</span><span class="o">).</span><span class="na">as</span><span class="o">(</span><span class="s">"myAge"</span><span class="o">),</span> <span class="err">$</span><span class="o">(</span><span class="s">"name"</span><span class="o">).</span><span class="na">as</span><span class="o">(</span><span class="s">"myName"</span><span class="o">));</span>

<span class="c1">// convert DataStream into Table with projected field "name" (name-based)</span>
<span class="nc">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">tableEnv</span><span class="o">.</span><span class="na">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="err">$</span><span class="o">(</span><span class="s">"name"</span><span class="o">));</span>

<span class="c1">// convert DataStream into Table with projected and renamed field "myName" (name-based)</span>
<span class="nc">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">tableEnv</span><span class="o">.</span><span class="na">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="err">$</span><span class="o">(</span><span class="s">"name"</span><span class="o">).</span><span class="na">as</span><span class="o">(</span><span class="s">"myName"</span><span class="o">));</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// get a TableEnvironment</span>
<span class="k">val</span> <span class="nv">tableEnv</span><span class="k">:</span> <span class="kt">StreamTableEnvironment</span> <span class="o">=</span> <span class="o">...</span> <span class="c1">// see "Create a TableEnvironment" section</span>

<span class="c1">// Person is a POJO with field names "name" and "age"</span>
<span class="k">val</span> <span class="nv">stream</span><span class="k">:</span> <span class="kt">DataStream</span><span class="o">[</span><span class="kt">Person</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>

<span class="c1">// convert DataStream into Table with default field names "age", "name" (fields are ordered by name!)</span>
<span class="k">val</span> <span class="nv">table</span><span class="k">:</span> <span class="kt">Table</span> <span class="o">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">)</span>

<span class="c1">// convert DataStream into Table with renamed fields "myAge", "myName" (name-based)</span>
<span class="k">val</span> <span class="nv">table</span><span class="k">:</span> <span class="kt">Table</span> <span class="o">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="n">$</span><span class="s">"age"</span> <span class="n">as</span> <span class="s">"myAge"</span><span class="o">,</span> <span class="n">$</span><span class="s">"name"</span> <span class="n">as</span> <span class="s">"myName"</span><span class="o">)</span>

<span class="c1">// convert DataStream into Table with projected field "name" (name-based)</span>
<span class="k">val</span> <span class="nv">table</span><span class="k">:</span> <span class="kt">Table</span> <span class="o">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="n">$</span><span class="s">"name"</span><span class="o">)</span>

<span class="c1">// convert DataStream into Table with projected and renamed field "myName" (name-based)</span>
<span class="k">val</span> <span class="nv">table</span><span class="k">:</span> <span class="kt">Table</span> <span class="o">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="n">$</span><span class="s">"name"</span> <span class="n">as</span> <span class="s">"myName"</span><span class="o">)</span></code></pre></figure>

  </div>
</div>

<p><a name="row"></a></p>

<h4 id="row类型">Row类型</h4>

<p><code class="highlighter-rouge">Row</code> 类型支持任意数量的字段以及具有 <code class="highlighter-rouge">null</code> 值的字段。字段名称可以通过 <code class="highlighter-rouge">RowTypeInfo</code> 指定，也可以在将 <code class="highlighter-rouge">Row</code> 的 <code class="highlighter-rouge">DataStream</code> 或 <code class="highlighter-rouge">DataSet</code> 转换为 <code class="highlighter-rouge">Table</code> 时指定。Row 类型的字段映射支持基于名称和基于位置两种方式。字段可以通过提供所有字段的名称的方式重命名（基于位置映射）或者分别选择进行投影/排序/重命名（基于名称映射）。</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// get a StreamTableEnvironment, works for BatchTableEnvironment equivalently</span>
<span class="nc">StreamTableEnvironment</span> <span class="n">tableEnv</span> <span class="o">=</span> <span class="o">...;</span> <span class="c1">// see "Create a TableEnvironment" section</span>

<span class="c1">// DataStream of Row with two fields "name" and "age" specified in `RowTypeInfo`</span>
<span class="nc">DataStream</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">stream</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// convert DataStream into Table with default field names "name", "age"</span>
<span class="nc">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">tableEnv</span><span class="o">.</span><span class="na">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">);</span>

<span class="c1">// convert DataStream into Table with renamed field names "myName", "myAge" (position-based)</span>
<span class="nc">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">tableEnv</span><span class="o">.</span><span class="na">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="err">$</span><span class="o">(</span><span class="s">"myName"</span><span class="o">),</span> <span class="err">$</span><span class="o">(</span><span class="s">"myAge"</span><span class="o">));</span>

<span class="c1">// convert DataStream into Table with renamed fields "myName", "myAge" (name-based)</span>
<span class="nc">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">tableEnv</span><span class="o">.</span><span class="na">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="err">$</span><span class="o">(</span><span class="s">"name"</span><span class="o">).</span><span class="na">as</span><span class="o">(</span><span class="s">"myName"</span><span class="o">),</span> <span class="err">$</span><span class="o">(</span><span class="s">"age"</span><span class="o">).</span><span class="na">as</span><span class="o">(</span><span class="s">"myAge"</span><span class="o">));</span>

<span class="c1">// convert DataStream into Table with projected field "name" (name-based)</span>
<span class="nc">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">tableEnv</span><span class="o">.</span><span class="na">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="err">$</span><span class="o">(</span><span class="s">"name"</span><span class="o">));</span>

<span class="c1">// convert DataStream into Table with projected and renamed field "myName" (name-based)</span>
<span class="nc">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">tableEnv</span><span class="o">.</span><span class="na">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="err">$</span><span class="o">(</span><span class="s">"name"</span><span class="o">).</span><span class="na">as</span><span class="o">(</span><span class="s">"myName"</span><span class="o">));</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// get a TableEnvironment</span>
<span class="k">val</span> <span class="nv">tableEnv</span><span class="k">:</span> <span class="kt">StreamTableEnvironment</span> <span class="o">=</span> <span class="o">...</span> <span class="c1">// see "Create a TableEnvironment" section</span>

<span class="c1">// DataStream of Row with two fields "name" and "age" specified in `RowTypeInfo`</span>
<span class="k">val</span> <span class="nv">stream</span><span class="k">:</span> <span class="kt">DataStream</span><span class="o">[</span><span class="kt">Row</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>

<span class="c1">// convert DataStream into Table with default field names "name", "age"</span>
<span class="k">val</span> <span class="nv">table</span><span class="k">:</span> <span class="kt">Table</span> <span class="o">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">)</span>

<span class="c1">// convert DataStream into Table with renamed field names "myName", "myAge" (position-based)</span>
<span class="k">val</span> <span class="nv">table</span><span class="k">:</span> <span class="kt">Table</span> <span class="o">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="n">$</span><span class="s">"myName"</span><span class="o">,</span> <span class="n">$</span><span class="s">"myAge"</span><span class="o">)</span>

<span class="c1">// convert DataStream into Table with renamed fields "myName", "myAge" (name-based)</span>
<span class="k">val</span> <span class="nv">table</span><span class="k">:</span> <span class="kt">Table</span> <span class="o">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="n">$</span><span class="s">"name"</span> <span class="n">as</span> <span class="s">"myName"</span><span class="o">,</span> <span class="n">$</span><span class="s">"age"</span> <span class="n">as</span> <span class="s">"myAge"</span><span class="o">)</span>

<span class="c1">// convert DataStream into Table with projected field "name" (name-based)</span>
<span class="k">val</span> <span class="nv">table</span><span class="k">:</span> <span class="kt">Table</span> <span class="o">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="n">$</span><span class="s">"name"</span><span class="o">)</span>

<span class="c1">// convert DataStream into Table with projected and renamed field "myName" (name-based)</span>
<span class="k">val</span> <span class="nv">table</span><span class="k">:</span> <span class="kt">Table</span> <span class="o">=</span> <span class="nv">tableEnv</span><span class="o">.</span><span class="py">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="n">$</span><span class="s">"name"</span> <span class="n">as</span> <span class="s">"myName"</span><span class="o">)</span></code></pre></figure>

  </div>
</div>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<p><a name="query-optimization"></a></p>

<h2 id="查询优化">查询优化</h2>

<div class="codetabs">
  <div data-lang="Blink planner">
    <p>Apache Flink 使用并扩展了 Apache Calcite 来执行复杂的查询优化。
这包括一系列基于规则和成本的优化，例如：</p>

    <ul>
      <li>基于 Apache Calcite 的子查询解相关</li>
      <li>投影剪裁</li>
      <li>分区剪裁</li>
      <li>过滤器下推</li>
      <li>子计划消除重复数据以避免重复计算</li>
      <li>特殊子查询重写，包括两部分：
        <ul>
          <li>将 IN 和 EXISTS 转换为 left semi-joins</li>
          <li>将 NOT IN 和 NOT EXISTS 转换为 left anti-join</li>
        </ul>
      </li>
      <li>可选 join 重新排序
        <ul>
          <li>通过 <code class="highlighter-rouge">table.optimizer.join-reorder-enabled</code> 启用</li>
        </ul>
      </li>
    </ul>

    <p><strong>注意：</strong> 当前仅在子查询重写的结合条件下支持 IN / EXISTS / NOT IN / NOT EXISTS。</p>

    <p>优化器不仅基于计划，而且还基于可从数据源获得的丰富统计信息以及每个算子（例如 io，cpu，网络和内存）的细粒度成本来做出明智的决策。</p>

    <p>高级用户可以通过 <code class="highlighter-rouge">CalciteConfig</code> 对象提供自定义优化，可以通过调用  <code class="highlighter-rouge">TableEnvironment＃getConfig＃setPlannerConfig</code> 将其提供给 TableEnvironment。</p>
  </div>

  <div data-lang="Old planner">
    <p>Apache Flink 利用 Apache Calcite 来优化和翻译查询。当前执行的优化包括投影和过滤器下推，子查询消除以及其他类型的查询重写。原版计划程序尚未优化 join 的顺序，而是按照查询中定义的顺序执行它们（FROM 子句中的表顺序和/或 WHERE 子句中的 join 谓词顺序）。</p>

    <p>通过提供一个 <code class="highlighter-rouge">CalciteConfig</code> 对象，可以调整在不同阶段应用的优化规则集合。这个对象可以通过调用构造器 <code class="highlighter-rouge">CalciteConfig.createBuilder()</code> 创建，并通过调用 <code class="highlighter-rouge">tableEnv.getConfig.setPlannerConfig(calciteConfig)</code> 提供给 TableEnvironment。</p>
  </div>
</div>

<p><a name="explaining-a-table"></a></p>

<h2 id="解释表">解释表</h2>

<p>Table API 提供了一种机制来解释计算 <code class="highlighter-rouge">Table</code> 的逻辑和优化查询计划。
这是通过 <code class="highlighter-rouge">Table.explain()</code> 方法或者 <code class="highlighter-rouge">StatementSet.explain()</code> 方法来完成的。<code class="highlighter-rouge">Table.explain()</code> 返回一个 Table 的计划。<code class="highlighter-rouge">StatementSet.explain()</code> 返回多 sink 计划的结果。它返回一个描述三种计划的字符串：</p>

<ol>
  <li>关系查询的抽象语法树（the Abstract Syntax Tree），即未优化的逻辑查询计划，</li>
  <li>优化的逻辑查询计划，以及</li>
  <li>物理执行计划。</li>
</ol>

<p>可以用 <code class="highlighter-rouge">TableEnvironment.explainSql()</code> 方法和 <code class="highlighter-rouge">TableEnvironment.executeSql()</code> 方法支持执行一个 <code class="highlighter-rouge">EXPLAIN</code> 语句获取逻辑和优化查询计划，请参阅 <a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/explain.html">EXPLAIN</a> 页面.</p>

<p>以下代码展示了一个示例以及对给定 <code class="highlighter-rouge">Table</code> 使用 <code class="highlighter-rouge">Table.explain()</code> 方法的相应输出：</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">StreamExecutionEnvironment</span> <span class="n">env</span> <span class="o">=</span> <span class="nc">StreamExecutionEnvironment</span><span class="o">.</span><span class="na">getExecutionEnvironment</span><span class="o">();</span>
<span class="nc">StreamTableEnvironment</span> <span class="n">tEnv</span> <span class="o">=</span> <span class="nc">StreamTableEnvironment</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">env</span><span class="o">);</span>

<span class="nc">DataStream</span><span class="o">&lt;</span><span class="nc">Tuple2</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="n">stream1</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="na">fromElements</span><span class="o">(</span><span class="k">new</span> <span class="nc">Tuple2</span><span class="o">&lt;&gt;(</span><span class="mi">1</span><span class="o">,</span> <span class="s">"hello"</span><span class="o">));</span>
<span class="nc">DataStream</span><span class="o">&lt;</span><span class="nc">Tuple2</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="n">stream2</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="na">fromElements</span><span class="o">(</span><span class="k">new</span> <span class="nc">Tuple2</span><span class="o">&lt;&gt;(</span><span class="mi">1</span><span class="o">,</span> <span class="s">"hello"</span><span class="o">));</span>

<span class="c1">// explain Table API</span>
<span class="nc">Table</span> <span class="n">table1</span> <span class="o">=</span> <span class="n">tEnv</span><span class="o">.</span><span class="na">fromDataStream</span><span class="o">(</span><span class="n">stream1</span><span class="o">,</span> <span class="err">$</span><span class="o">(</span><span class="s">"count"</span><span class="o">),</span> <span class="err">$</span><span class="o">(</span><span class="s">"word"</span><span class="o">));</span>
<span class="nc">Table</span> <span class="n">table2</span> <span class="o">=</span> <span class="n">tEnv</span><span class="o">.</span><span class="na">fromDataStream</span><span class="o">(</span><span class="n">stream2</span><span class="o">,</span> <span class="err">$</span><span class="o">(</span><span class="s">"count"</span><span class="o">),</span> <span class="err">$</span><span class="o">(</span><span class="s">"word"</span><span class="o">));</span>
<span class="nc">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">table1</span>
  <span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="err">$</span><span class="o">(</span><span class="s">"word"</span><span class="o">).</span><span class="na">like</span><span class="o">(</span><span class="s">"F%"</span><span class="o">))</span>
  <span class="o">.</span><span class="na">unionAll</span><span class="o">(</span><span class="n">table2</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">table</span><span class="o">.</span><span class="na">explain</span><span class="o">());</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="nv">env</span> <span class="k">=</span> <span class="nv">StreamExecutionEnvironment</span><span class="o">.</span><span class="py">getExecutionEnvironment</span>
<span class="k">val</span> <span class="nv">tEnv</span> <span class="k">=</span> <span class="nv">StreamTableEnvironment</span><span class="o">.</span><span class="py">create</span><span class="o">(</span><span class="n">env</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">table1</span> <span class="k">=</span> <span class="nv">env</span><span class="o">.</span><span class="py">fromElements</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="s">"hello"</span><span class="o">)).</span><span class="py">toTable</span><span class="o">(</span><span class="n">tEnv</span><span class="o">,</span> <span class="n">$</span><span class="s">"count"</span><span class="o">,</span> <span class="n">$</span><span class="s">"word"</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">table2</span> <span class="k">=</span> <span class="nv">env</span><span class="o">.</span><span class="py">fromElements</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="s">"hello"</span><span class="o">)).</span><span class="py">toTable</span><span class="o">(</span><span class="n">tEnv</span><span class="o">,</span> <span class="n">$</span><span class="s">"count"</span><span class="o">,</span> <span class="n">$</span><span class="s">"word"</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">table</span> <span class="k">=</span> <span class="n">table1</span>
  <span class="o">.</span><span class="py">where</span><span class="o">(</span><span class="n">$</span><span class="s">"word"</span><span class="o">.</span><span class="py">like</span><span class="o">(</span><span class="s">"F%"</span><span class="o">))</span>
  <span class="o">.</span><span class="py">unionAll</span><span class="o">(</span><span class="n">table2</span><span class="o">)</span>
<span class="nf">println</span><span class="o">(</span><span class="nv">table</span><span class="o">.</span><span class="py">explain</span><span class="o">())</span></code></pre></figure>

  </div>

  <div data-lang="python">

    <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">env</span> <span class="o">=</span> <span class="n">StreamExecutionEnvironment</span><span class="p">.</span><span class="n">get_execution_environment</span><span class="p">()</span>
<span class="n">t_env</span> <span class="o">=</span> <span class="n">StreamTableEnvironment</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>

<span class="n">table1</span> <span class="o">=</span> <span class="n">t_env</span><span class="p">.</span><span class="n">from_elements</span><span class="p">([(</span><span class="mi">1</span><span class="p">,</span> <span class="s">"hello"</span><span class="p">)],</span> <span class="p">[</span><span class="s">"count"</span><span class="p">,</span> <span class="s">"word"</span><span class="p">])</span>
<span class="n">table2</span> <span class="o">=</span> <span class="n">t_env</span><span class="p">.</span><span class="n">from_elements</span><span class="p">([(</span><span class="mi">1</span><span class="p">,</span> <span class="s">"hello"</span><span class="p">)],</span> <span class="p">[</span><span class="s">"count"</span><span class="p">,</span> <span class="s">"word"</span><span class="p">])</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">table1</span> \
    <span class="p">.</span><span class="n">where</span><span class="p">(</span><span class="n">table1</span><span class="p">.</span><span class="n">word</span><span class="p">.</span><span class="n">like</span><span class="p">(</span><span class="s">'F%'</span><span class="p">))</span> \
    <span class="p">.</span><span class="n">union_all</span><span class="p">(</span><span class="n">table2</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">table</span><span class="p">.</span><span class="n">explain</span><span class="p">())</span></code></pre></figure>

  </div>
</div>

<p>上述例子的结果是：</p>
<div>

<figure class="highlight"><pre><code class="language-text" data-lang="text">== Abstract Syntax Tree ==
LogicalUnion(all=[true])
  LogicalFilter(condition=[LIKE($1, _UTF-16LE'F%')])
    FlinkLogicalDataStreamScan(id=[1], fields=[count, word])
  FlinkLogicalDataStreamScan(id=[2], fields=[count, word])

== Optimized Logical Plan ==
DataStreamUnion(all=[true], union all=[count, word])
  DataStreamCalc(select=[count, word], where=[LIKE(word, _UTF-16LE'F%')])
    DataStreamScan(id=[1], fields=[count, word])
  DataStreamScan(id=[2], fields=[count, word])

== Physical Execution Plan ==
Stage 1 : Data Source
	content : collect elements with CollectionInputFormat

Stage 2 : Data Source
	content : collect elements with CollectionInputFormat

	Stage 3 : Operator
		content : from: (count, word)
		ship_strategy : REBALANCE

		Stage 4 : Operator
			content : where: (LIKE(word, _UTF-16LE'F%')), select: (count, word)
			ship_strategy : FORWARD

			Stage 5 : Operator
				content : from: (count, word)
				ship_strategy : REBALANCE</code></pre></figure>

</div>

<p>以下代码展示了一个示例以及使用 <code class="highlighter-rouge">StatementSet.explain()</code> 的多 sink 计划的相应输出：</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">EnvironmentSettings</span> <span class="n">settings</span> <span class="o">=</span> <span class="nc">EnvironmentSettings</span><span class="o">.</span><span class="na">newInstance</span><span class="o">().</span><span class="na">useBlinkPlanner</span><span class="o">().</span><span class="na">inStreamingMode</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
<span class="nc">TableEnvironment</span> <span class="n">tEnv</span> <span class="o">=</span> <span class="nc">TableEnvironment</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">settings</span><span class="o">);</span>

<span class="kd">final</span> <span class="nc">Schema</span> <span class="n">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Schema</span><span class="o">()</span>
    <span class="o">.</span><span class="na">field</span><span class="o">(</span><span class="s">"count"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">INT</span><span class="o">())</span>
    <span class="o">.</span><span class="na">field</span><span class="o">(</span><span class="s">"word"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">STRING</span><span class="o">());</span>

<span class="n">tEnv</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileSystem</span><span class="o">().</span><span class="na">path</span><span class="o">(</span><span class="s">"/source/path1"</span><span class="o">))</span>
    <span class="o">.</span><span class="na">withFormat</span><span class="o">(</span><span class="k">new</span> <span class="nc">Csv</span><span class="o">().</span><span class="na">deriveSchema</span><span class="o">())</span>
    <span class="o">.</span><span class="na">withSchema</span><span class="o">(</span><span class="n">schema</span><span class="o">)</span>
    <span class="o">.</span><span class="na">createTemporaryTable</span><span class="o">(</span><span class="s">"MySource1"</span><span class="o">);</span>
<span class="n">tEnv</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileSystem</span><span class="o">().</span><span class="na">path</span><span class="o">(</span><span class="s">"/source/path2"</span><span class="o">))</span>
    <span class="o">.</span><span class="na">withFormat</span><span class="o">(</span><span class="k">new</span> <span class="nc">Csv</span><span class="o">().</span><span class="na">deriveSchema</span><span class="o">())</span>
    <span class="o">.</span><span class="na">withSchema</span><span class="o">(</span><span class="n">schema</span><span class="o">)</span>
    <span class="o">.</span><span class="na">createTemporaryTable</span><span class="o">(</span><span class="s">"MySource2"</span><span class="o">);</span>
<span class="n">tEnv</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileSystem</span><span class="o">().</span><span class="na">path</span><span class="o">(</span><span class="s">"/sink/path1"</span><span class="o">))</span>
    <span class="o">.</span><span class="na">withFormat</span><span class="o">(</span><span class="k">new</span> <span class="nc">Csv</span><span class="o">().</span><span class="na">deriveSchema</span><span class="o">())</span>
    <span class="o">.</span><span class="na">withSchema</span><span class="o">(</span><span class="n">schema</span><span class="o">)</span>
    <span class="o">.</span><span class="na">createTemporaryTable</span><span class="o">(</span><span class="s">"MySink1"</span><span class="o">);</span>
<span class="n">tEnv</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileSystem</span><span class="o">().</span><span class="na">path</span><span class="o">(</span><span class="s">"/sink/path2"</span><span class="o">))</span>
    <span class="o">.</span><span class="na">withFormat</span><span class="o">(</span><span class="k">new</span> <span class="nc">Csv</span><span class="o">().</span><span class="na">deriveSchema</span><span class="o">())</span>
    <span class="o">.</span><span class="na">withSchema</span><span class="o">(</span><span class="n">schema</span><span class="o">)</span>
    <span class="o">.</span><span class="na">createTemporaryTable</span><span class="o">(</span><span class="s">"MySink2"</span><span class="o">);</span>

<span class="nc">StatementSet</span> <span class="n">stmtSet</span> <span class="o">=</span> <span class="n">tEnv</span><span class="o">.</span><span class="na">createStatementSet</span><span class="o">();</span>

<span class="nc">Table</span> <span class="n">table1</span> <span class="o">=</span> <span class="n">tEnv</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="s">"MySource1"</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="err">$</span><span class="o">(</span><span class="s">"word"</span><span class="o">).</span><span class="na">like</span><span class="o">(</span><span class="s">"F%"</span><span class="o">));</span>
<span class="n">stmtSet</span><span class="o">.</span><span class="na">addInsert</span><span class="o">(</span><span class="s">"MySink1"</span><span class="o">,</span> <span class="n">table1</span><span class="o">);</span>

<span class="nc">Table</span> <span class="n">table2</span> <span class="o">=</span> <span class="n">table1</span><span class="o">.</span><span class="na">unionAll</span><span class="o">(</span><span class="n">tEnv</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="s">"MySource2"</span><span class="o">));</span>
<span class="n">stmtSet</span><span class="o">.</span><span class="na">addInsert</span><span class="o">(</span><span class="s">"MySink2"</span><span class="o">,</span> <span class="n">table2</span><span class="o">);</span>

<span class="nc">String</span> <span class="n">explanation</span> <span class="o">=</span> <span class="n">stmtSet</span><span class="o">.</span><span class="na">explain</span><span class="o">();</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">explanation</span><span class="o">);</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="nv">settings</span> <span class="k">=</span> <span class="nv">EnvironmentSettings</span><span class="o">.</span><span class="py">newInstance</span><span class="o">.</span><span class="py">useBlinkPlanner</span><span class="o">.</span><span class="py">inStreamingMode</span><span class="o">.</span><span class="py">build</span>
<span class="k">val</span> <span class="nv">tEnv</span> <span class="k">=</span> <span class="nv">TableEnvironment</span><span class="o">.</span><span class="py">create</span><span class="o">(</span><span class="n">settings</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">schema</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Schema</span><span class="o">()</span>
    <span class="o">.</span><span class="py">field</span><span class="o">(</span><span class="s">"count"</span><span class="o">,</span> <span class="nv">DataTypes</span><span class="o">.</span><span class="py">INT</span><span class="o">())</span>
    <span class="o">.</span><span class="py">field</span><span class="o">(</span><span class="s">"word"</span><span class="o">,</span> <span class="nv">DataTypes</span><span class="o">.</span><span class="py">STRING</span><span class="o">())</span>

<span class="nv">tEnv</span><span class="o">.</span><span class="py">connect</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileSystem</span><span class="o">().</span><span class="py">path</span><span class="o">(</span><span class="s">"/source/path1"</span><span class="o">))</span>
    <span class="o">.</span><span class="py">withFormat</span><span class="o">(</span><span class="k">new</span> <span class="nc">Csv</span><span class="o">().</span><span class="py">deriveSchema</span><span class="o">())</span>
    <span class="o">.</span><span class="py">withSchema</span><span class="o">(</span><span class="n">schema</span><span class="o">)</span>
    <span class="o">.</span><span class="py">createTemporaryTable</span><span class="o">(</span><span class="s">"MySource1"</span><span class="o">)</span>
<span class="nv">tEnv</span><span class="o">.</span><span class="py">connect</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileSystem</span><span class="o">().</span><span class="py">path</span><span class="o">(</span><span class="s">"/source/path2"</span><span class="o">))</span>
    <span class="o">.</span><span class="py">withFormat</span><span class="o">(</span><span class="k">new</span> <span class="nc">Csv</span><span class="o">().</span><span class="py">deriveSchema</span><span class="o">())</span>
    <span class="o">.</span><span class="py">withSchema</span><span class="o">(</span><span class="n">schema</span><span class="o">)</span>
    <span class="o">.</span><span class="py">createTemporaryTable</span><span class="o">(</span><span class="s">"MySource2"</span><span class="o">)</span>
<span class="nv">tEnv</span><span class="o">.</span><span class="py">connect</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileSystem</span><span class="o">().</span><span class="py">path</span><span class="o">(</span><span class="s">"/sink/path1"</span><span class="o">))</span>
    <span class="o">.</span><span class="py">withFormat</span><span class="o">(</span><span class="k">new</span> <span class="nc">Csv</span><span class="o">().</span><span class="py">deriveSchema</span><span class="o">())</span>
    <span class="o">.</span><span class="py">withSchema</span><span class="o">(</span><span class="n">schema</span><span class="o">)</span>
    <span class="o">.</span><span class="py">createTemporaryTable</span><span class="o">(</span><span class="s">"MySink1"</span><span class="o">)</span>
<span class="nv">tEnv</span><span class="o">.</span><span class="py">connect</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileSystem</span><span class="o">().</span><span class="py">path</span><span class="o">(</span><span class="s">"/sink/path2"</span><span class="o">))</span>
    <span class="o">.</span><span class="py">withFormat</span><span class="o">(</span><span class="k">new</span> <span class="nc">Csv</span><span class="o">().</span><span class="py">deriveSchema</span><span class="o">())</span>
    <span class="o">.</span><span class="py">withSchema</span><span class="o">(</span><span class="n">schema</span><span class="o">)</span>
    <span class="o">.</span><span class="py">createTemporaryTable</span><span class="o">(</span><span class="s">"MySink2"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">stmtSet</span> <span class="k">=</span> <span class="nv">tEnv</span><span class="o">.</span><span class="py">createStatementSet</span><span class="o">()</span>

<span class="k">val</span> <span class="nv">table1</span> <span class="k">=</span> <span class="nv">tEnv</span><span class="o">.</span><span class="py">from</span><span class="o">(</span><span class="s">"MySource1"</span><span class="o">).</span><span class="py">where</span><span class="o">(</span><span class="n">$</span><span class="s">"word"</span><span class="o">.</span><span class="py">like</span><span class="o">(</span><span class="s">"F%"</span><span class="o">))</span>
<span class="nv">stmtSet</span><span class="o">.</span><span class="py">addInsert</span><span class="o">(</span><span class="s">"MySink1"</span><span class="o">,</span> <span class="n">table1</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">table2</span> <span class="k">=</span> <span class="nv">table1</span><span class="o">.</span><span class="py">unionAll</span><span class="o">(</span><span class="nv">tEnv</span><span class="o">.</span><span class="py">from</span><span class="o">(</span><span class="s">"MySource2"</span><span class="o">))</span>
<span class="nv">stmtSet</span><span class="o">.</span><span class="py">addInsert</span><span class="o">(</span><span class="s">"MySink2"</span><span class="o">,</span> <span class="n">table2</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">explanation</span> <span class="k">=</span> <span class="nv">stmtSet</span><span class="o">.</span><span class="py">explain</span><span class="o">()</span>
<span class="nf">println</span><span class="o">(</span><span class="n">explanation</span><span class="o">)</span></code></pre></figure>

  </div>

  <div data-lang="python">

    <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">settings</span> <span class="o">=</span> <span class="n">EnvironmentSettings</span><span class="p">.</span><span class="n">new_instance</span><span class="p">().</span><span class="n">use_blink_planner</span><span class="p">().</span><span class="n">in_streaming_mode</span><span class="p">().</span><span class="n">build</span><span class="p">()</span>
<span class="n">t_env</span> <span class="o">=</span> <span class="n">TableEnvironment</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">environment_settings</span><span class="o">=</span><span class="n">settings</span><span class="p">)</span>

<span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">()</span>
    <span class="p">.</span><span class="n">field</span><span class="p">(</span><span class="s">"count"</span><span class="p">,</span> <span class="n">DataTypes</span><span class="p">.</span><span class="n">INT</span><span class="p">())</span>
    <span class="p">.</span><span class="n">field</span><span class="p">(</span><span class="s">"word"</span><span class="p">,</span> <span class="n">DataTypes</span><span class="p">.</span><span class="n">STRING</span><span class="p">())</span>

<span class="n">t_env</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">FileSystem</span><span class="p">().</span><span class="n">path</span><span class="p">(</span><span class="s">"/source/path1"</span><span class="p">)))</span>
    <span class="p">.</span><span class="n">with_format</span><span class="p">(</span><span class="n">Csv</span><span class="p">().</span><span class="n">deriveSchema</span><span class="p">())</span>
    <span class="p">.</span><span class="n">with_schema</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
    <span class="p">.</span><span class="n">create_temporary_table</span><span class="p">(</span><span class="s">"MySource1"</span><span class="p">)</span>
<span class="n">t_env</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">FileSystem</span><span class="p">().</span><span class="n">path</span><span class="p">(</span><span class="s">"/source/path2"</span><span class="p">)))</span>
    <span class="p">.</span><span class="n">with_format</span><span class="p">(</span><span class="n">Csv</span><span class="p">().</span><span class="n">deriveSchema</span><span class="p">())</span>
    <span class="p">.</span><span class="n">with_schema</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
    <span class="p">.</span><span class="n">create_temporary_table</span><span class="p">(</span><span class="s">"MySource2"</span><span class="p">)</span>
<span class="n">t_env</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">FileSystem</span><span class="p">().</span><span class="n">path</span><span class="p">(</span><span class="s">"/sink/path1"</span><span class="p">)))</span>
    <span class="p">.</span><span class="n">with_format</span><span class="p">(</span><span class="n">Csv</span><span class="p">().</span><span class="n">deriveSchema</span><span class="p">())</span>
    <span class="p">.</span><span class="n">with_schema</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
    <span class="p">.</span><span class="n">create_temporary_table</span><span class="p">(</span><span class="s">"MySink1"</span><span class="p">)</span>
<span class="n">t_env</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">FileSystem</span><span class="p">().</span><span class="n">path</span><span class="p">(</span><span class="s">"/sink/path2"</span><span class="p">)))</span>
    <span class="p">.</span><span class="n">with_format</span><span class="p">(</span><span class="n">Csv</span><span class="p">().</span><span class="n">deriveSchema</span><span class="p">())</span>
    <span class="p">.</span><span class="n">with_schema</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
    <span class="p">.</span><span class="n">create_temporary_table</span><span class="p">(</span><span class="s">"MySink2"</span><span class="p">)</span>

<span class="n">stmt_set</span> <span class="o">=</span> <span class="n">t_env</span><span class="p">.</span><span class="n">create_statement_set</span><span class="p">()</span>

<span class="n">table1</span> <span class="o">=</span> <span class="n">t_env</span><span class="p">.</span><span class="n">from_path</span><span class="p">(</span><span class="s">"MySource1"</span><span class="p">).</span><span class="n">where</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s">'word'</span><span class="p">).</span><span class="n">like</span><span class="p">(</span><span class="s">'F%'</span><span class="p">))</span>
<span class="n">stmt_set</span><span class="p">.</span><span class="n">add_insert</span><span class="p">(</span><span class="s">"MySink1"</span><span class="p">,</span> <span class="n">table1</span><span class="p">)</span>

<span class="n">table2</span> <span class="o">=</span> <span class="n">table1</span><span class="p">.</span><span class="n">union_all</span><span class="p">(</span><span class="n">t_env</span><span class="p">.</span><span class="n">from_path</span><span class="p">(</span><span class="s">"MySource2"</span><span class="p">))</span>
<span class="n">stmt_set</span><span class="p">.</span><span class="n">add_insert</span><span class="p">(</span><span class="s">"MySink2"</span><span class="p">,</span> <span class="n">table2</span><span class="p">)</span>

<span class="n">explanation</span> <span class="o">=</span> <span class="n">stmt_set</span><span class="p">.</span><span class="n">explain</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">explanation</span><span class="p">)</span></code></pre></figure>

  </div>
</div>

<p>多 sink 计划的结果是：</p>
<div>

<figure class="highlight"><pre><code class="language-text" data-lang="text">== Abstract Syntax Tree ==
LogicalLegacySink(name=[MySink1], fields=[count, word])
+- LogicalFilter(condition=[LIKE($1, _UTF-16LE'F%')])
   +- LogicalTableScan(table=[[default_catalog, default_database, MySource1, source: [CsvTableSource(read fields: count, word)]]])

LogicalLegacySink(name=[MySink2], fields=[count, word])
+- LogicalUnion(all=[true])
   :- LogicalFilter(condition=[LIKE($1, _UTF-16LE'F%')])
   :  +- LogicalTableScan(table=[[default_catalog, default_database, MySource1, source: [CsvTableSource(read fields: count, word)]]])
   +- LogicalTableScan(table=[[default_catalog, default_database, MySource2, source: [CsvTableSource(read fields: count, word)]]])

== Optimized Logical Plan ==
Calc(select=[count, word], where=[LIKE(word, _UTF-16LE'F%')], reuse_id=[1])
+- TableSourceScan(table=[[default_catalog, default_database, MySource1, source: [CsvTableSource(read fields: count, word)]]], fields=[count, word])

LegacySink(name=[MySink1], fields=[count, word])
+- Reused(reference_id=[1])

LegacySink(name=[MySink2], fields=[count, word])
+- Union(all=[true], union=[count, word])
   :- Reused(reference_id=[1])
   +- TableSourceScan(table=[[default_catalog, default_database, MySource2, source: [CsvTableSource(read fields: count, word)]]], fields=[count, word])

== Physical Execution Plan ==
Stage 1 : Data Source
	content : collect elements with CollectionInputFormat

	Stage 2 : Operator
		content : CsvTableSource(read fields: count, word)
		ship_strategy : REBALANCE

		Stage 3 : Operator
			content : SourceConversion(table:Buffer(default_catalog, default_database, MySource1, source: [CsvTableSource(read fields: count, word)]), fields:(count, word))
			ship_strategy : FORWARD

			Stage 4 : Operator
				content : Calc(where: (word LIKE _UTF-16LE'F%'), select: (count, word))
				ship_strategy : FORWARD

				Stage 5 : Operator
					content : SinkConversionToRow
					ship_strategy : FORWARD

					Stage 6 : Operator
						content : Map
						ship_strategy : FORWARD

Stage 8 : Data Source
	content : collect elements with CollectionInputFormat

	Stage 9 : Operator
		content : CsvTableSource(read fields: count, word)
		ship_strategy : REBALANCE

		Stage 10 : Operator
			content : SourceConversion(table:Buffer(default_catalog, default_database, MySource2, source: [CsvTableSource(read fields: count, word)]), fields:(count, word))
			ship_strategy : FORWARD

			Stage 12 : Operator
				content : SinkConversionToRow
				ship_strategy : FORWARD

				Stage 13 : Operator
					content : Map
					ship_strategy : FORWARD

					Stage 7 : Data Sink
						content : Sink: CsvTableSink(count, word)
						ship_strategy : FORWARD

						Stage 14 : Data Sink
							content : Sink: CsvTableSink(count, word)
							ship_strategy : FORWARD</code></pre></figure>

</div>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>




<div class="footer">
  <a href="https://cwiki.apache.org/confluence/display/FLINK/Flink+Translation+Specifications" target="_blank">
    
      想参与贡献翻译？
    
  </a>
</div>


        </div>
      </div>
    </div><!-- /.container -->

    <!-- default code tab -->
    <script>var defaultCodeTab = "";</script>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/js/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.1.0/anchor.min.js"></script>
    <script src="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/js/flink.js"></script>

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-52545728-1', 'auto');
      ga('send', 'pageview');
    </script>

    <!-- Disqus -->
    
  </body>
</html>
