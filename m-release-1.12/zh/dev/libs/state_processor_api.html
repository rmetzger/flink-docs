<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Apache Flink 1.12 Documentation: State Processor API</title>
    <link rel="shortcut icon" href="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/favicon.ico" type="image/x-icon">
    <link rel="icon" href="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/favicon.ico" type="image/x-icon">
    <link rel="canonical" href="//ci.apache.org/projects/flink/flink-docs-stable/zh/dev/libs/state_processor_api.html">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/css/flink.css">
    <link rel="stylesheet" href="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/css/syntax.css">
    <link rel="stylesheet" href="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/css/codetabs.css">
    <link rel="stylesheet" href="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/font-awesome/css/font-awesome.min.css">
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    

    <!-- Main content. -->
    <div class="container">
      
      <div class="row">
        <div class="col-lg-3" id="sidenavcol">
          <div class="sidenav-logo">
  <p><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/"><img class="bottom" alt="Apache Flink" src="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/img/navbar-brand-logo.jpg"></a> v1.12</p>
</div>
<ul id="sidenav">
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/"><i class="fa fa-home title" aria-hidden="true"></i> Home</a></li><hr class="section-break"></hr>
<li><a href="#collapse-2" data-toggle="collapse"><i class="fa fa-rocket title appetizer" aria-hidden="true"></i> Try Flink<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-2"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/try-flink/local_installation.html">本地模式安装</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/try-flink/datastream_api.html">基于 DataStream API 实现欺诈检测</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/try-flink/table_api.html">基于 Table API 实现实时报表</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/try-flink/flink-operations-playground.html">Flink 操作场景</a></li>
</ul></div></li>
<li><a href="#collapse-8" data-toggle="collapse"><i class="fa fa-hand-paper-o title appetizer" aria-hidden="true"></i> 实践练习<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-8"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/learn-flink/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/learn-flink/datastream_api.html">DataStream API 简介</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/learn-flink/etl.html">数据管道 & ETL</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/learn-flink/streaming_analytics.html">流式分析</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/learn-flink/event_driven.html">事件驱动应用</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/learn-flink/fault_tolerance.html">容错处理</a></li>
</ul></div></li>
<li><a href="#collapse-15" data-toggle="collapse"><i class="fa fa-map-o title appetizer" aria-hidden="true"></i> 概念透析<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-15"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/concepts/index.html">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/concepts/stateful-stream-processing.html">有状态流处理</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/concepts/timely-stream-processing.html">及时流处理</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/concepts/flink-architecture.html">Flink 架构</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/concepts/glossary.html">词汇表</a></li>
</ul></div></li><hr class="section-break"></hr>
<li><a href="#collapse-21" data-toggle="collapse"><i class="fa fa-code title maindish" aria-hidden="true"></i> 应用开发<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-21"><ul>
<li><a href="#collapse-22" data-toggle="collapse">DataStream API<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-22"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/datastream_api.html">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/datastream_execution_mode.html">Execution Mode (Batch/Streaming)</a></li>
<li><a href="#collapse-24" data-toggle="collapse">事件时间<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-24"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/event_time.html">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/event_timestamps_watermarks.html">生成 Watermark</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/event_timestamp_extractors.html">内置 Watermark 生成器</a></li>
</ul></div></li>
<li><a href="#collapse-28" data-toggle="collapse">状态与容错<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-28"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/state.html">Working with State</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/broadcast_state.html">Broadcast State 模式</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/checkpointing.html">Checkpointing</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/queryable_state.html">Queryable State</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/state_backends.html">State Backends</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/schema_evolution.html">状态数据结构升级</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/custom_serialization.html">自定义状态序列化</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/user_defined_functions.html">用户自定义 Functions</a></li>
<li><a href="#collapse-38" data-toggle="collapse">算子<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-38"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/operators/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/operators/windows.html">窗口</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/operators/joining.html">Joining</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/operators/process_function.html">Process Function</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/operators/asyncio.html">异步 I/O</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/sources.html">Data Sources</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/side_output.html">旁路输出</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/application_parameters.html">Handling Application Parameters</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/testing.html">测试</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/experimental.html">实验功能</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/scala_api_extensions.html">Scala API Extensions</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/java_lambdas.html">Java Lambda 表达式</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/project-configuration.html">Project Configuration</a></li>
</ul></div></li>
<li><a href="#collapse-53" data-toggle="collapse">DataSet API<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-53"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/dataset_transformations.html">Transformations</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/iterations.html">迭代</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/zip_elements_guide.html">Zipping Elements</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/hadoop_compatibility.html">Hadoop 兼容</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/local_execution.html">本地执行</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/cluster_execution.html">集群执行</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/examples.html">Batch 示例</a></li>
</ul></div></li>
<li><a href="#collapse-62" data-toggle="collapse">Table API & SQL<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-62"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/common.html">概念与通用 API</a></li>
<li><a href="#collapse-64" data-toggle="collapse">流式概念<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-64"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/streaming/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/streaming/dynamic_tables.html">动态表 (Dynamic Table)</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/streaming/time_attributes.html">时间属性</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/streaming/joins.html">流上的 Join</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/streaming/temporal_tables.html">时态表（Temporal Tables）</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/streaming/match_recognize.html">模式检测</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/streaming/query_configuration.html">Query Configuration</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/types.html">数据类型</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/tableApi.html">Table API</a></li>
<li><a href="#collapse-74" data-toggle="collapse">SQL<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-74"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/queries.html">查询语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/create.html">CREATE 语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/drop.html">DROP 语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/alter.html">ALTER 语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/insert.html">INSERT 语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/hints.html">SQL Hints</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/describe.html">DESCRIBE 语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/explain.html">EXPLAIN 语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/use.html">USE 语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/show.html">SHOW 语句</a></li>
</ul></div></li>
<li><a href="#collapse-86" data-toggle="collapse">函数<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-86"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/functions/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/functions/systemFunctions.html">系统（内置）函数</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/functions/udfs.html">自定义函数</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/modules.html">模块</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/catalogs.html">Catalogs</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sqlClient.html">SQL 客户端</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/config.html">配置</a></li>
<li><a href="#collapse-94" data-toggle="collapse">Performance Tuning<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-94"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/tuning/streaming_aggregation_optimization.html">流式聚合</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sourceSinks.html">User-defined Sources & Sinks</a></li>
</ul></div></li>
<li><a href="#collapse-99" data-toggle="collapse">Python API<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-99"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/installation.html">环境安装</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table_api_tutorial.html">Table API 教程</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/datastream_tutorial.html">DataStream API 教程</a></li>
<li><a href="#collapse-103" data-toggle="collapse">Table API用户指南<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-103"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/intro_to_table_api.html">Python Table API 简介</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/table_environment.html">TableEnvironment</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/operations.html">Operations</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/python_types.html">数据类型</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/built_in_functions.html">系统（内置）函数</a></li>
<li><a href="#collapse-109" data-toggle="collapse">自定义函数<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-109"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/udfs/python_udfs.html">普通自定义函数（UDF）</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/udfs/vectorized_python_udfs.html">向量化自定义函数</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/conversion_of_pandas.html">PyFlink Table 和 Pandas DataFrame 互转</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/dependency_management.html">依赖管理</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/sql.html">SQL</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/catalogs.html">Catalogs</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/metrics.html">指标</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/python_table_api_connectors.html">连接器</a></li>
</ul></div></li>
<li><a href="#collapse-120" data-toggle="collapse">DataStream API用户指南<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-120"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/datastream-api-users-guide/data_types.html">数据类型</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/datastream-api-users-guide/operators.html">算子</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/datastream-api-users-guide/dependency_management.html">依赖管理</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/python_config.html">配置</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/environment_variables.html">环境变量</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/faq.html">常见问题</a></li>
</ul></div></li>
<li><a href="#collapse-129" data-toggle="collapse">数据类型以及序列化<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-129"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/types_serialization.html">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/custom_serializers.html">自定义序列化器</a></li>
</ul></div></li>
<li><a href="#collapse-132" data-toggle="collapse">管理执行<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-132"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/execution_configuration.html">执行配置</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/packaging.html">程序打包</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/parallel.html">并行执行</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/execution_plans.html">执行计划</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/task_failure_recovery.html">Task 故障恢复</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/migration.html">API 迁移指南</a></li>
</ul></div></li>
<li><a href="#collapse-141" data-toggle="collapse"class="active"><i class="fa fa-book title maindish" aria-hidden="true"></i> Libraries</a><div class="collapse in" id="collapse-141"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/cep.html">事件处理 (CEP)</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/state_processor_api.html" class="active">State Processor API</a></li>
<li><a href="#collapse-144" data-toggle="collapse">图计算: Gelly<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-144"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/graph_api.html">Graph API</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/iterative_graph_processing.html">Iterative Graph Processing</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/library_methods.html">Library Methods</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/graph_algorithms.html">Graph Algorithms</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/graph_generators.html">Graph Generators</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/bipartite_graph.html">Bipartite Graph</a></li>
</ul></div></li>
</ul></div></li>
<li><a href="#collapse-153" data-toggle="collapse"><i class="fa fa-random title maindish" aria-hidden="true"></i> Connectors<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-153"><ul>
<li><a href="#collapse-154" data-toggle="collapse">DataStream Connectors<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-154"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/guarantees.html">容错保证</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/kafka.html">Kafka</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/cassandra.html">Cassandra</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/kinesis.html">Kinesis</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/elasticsearch.html">Elasticsearch</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/file_sink.html">File Sink</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/streamfile_sink.html">Streaming File Sink</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/rabbitmq.html">RabbitMQ</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/nifi.html">NiFi</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/pubsub.html">Google Cloud PubSub</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/twitter.html">Twitter</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/jdbc.html">JDBC</a></li>
</ul></div></li>
<li><a href="#collapse-168" data-toggle="collapse">Table & SQL Connectors<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-168"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/">概览</a></li>
<li><a href="#collapse-169" data-toggle="collapse">Formats<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-169"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/csv.html">CSV</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/json.html">JSON</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/avro-confluent.html">Confluent Avro</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/avro.html">Avro</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/debezium.html">Debezium</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/canal.html">Canal</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/maxwell.html">Maxwell</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/parquet.html">Parquet</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/orc.html">Orc</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/raw.html">Raw</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/kafka.html">Kafka</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/upsert-kafka.html">Upsert Kafka</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/kinesis.html">Kinesis</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/jdbc.html">JDBC</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/elasticsearch.html">Elasticsearch</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/filesystem.html">FileSystem</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/hbase.html">HBase</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/datagen.html">DataGen</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/print.html">Print</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/blackhole.html">BlackHole</a></li>
<li><a href="#collapse-191" data-toggle="collapse">Hive<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-191"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/hive/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/hive/hive_catalog.html">Hive Catalog</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/hive/hive_dialect.html">Hive 方言</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/hive/hive_read_write.html">Hive Read & Write</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/hive/hive_functions.html">Hive 函数</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/downloads.html">下载</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/connectors.html">DataSet Connectors</a></li>
</ul></div></li>
<li><a href="#collapse-201" data-toggle="collapse"><i class="fa fa-sliders title maindish" aria-hidden="true"></i> Deployment<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-201"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/">概览</a></li>
<li><a href="#collapse-202" data-toggle="collapse">Resource Providers<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-202"><ul>
<li><a href="#collapse-203" data-toggle="collapse">Standalone<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-203"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/resource-providers/standalone/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/resource-providers/standalone/local.html">本地集群</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/resource-providers/standalone/docker.html">Docker</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/resource-providers/standalone/kubernetes.html">Kubernetes</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/resource-providers/native_kubernetes.html">Native Kubernetes</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/resource-providers/yarn.html">YARN</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/resource-providers/mesos.html">Mesos</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/config.html">配置参数</a></li>
<li><a href="#collapse-213" data-toggle="collapse">内存配置<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-213"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_setup.html">配置 Flink 进程的内存</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_setup_tm.html">配置 TaskManager 内存</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_setup_jobmanager.html">配置 JobManager 内存</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_tuning.html">调优指南</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_trouble.html">常见问题</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_migration.html">升级指南</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/cli.html">Command-Line Interface</a></li>
<li><a href="#collapse-222" data-toggle="collapse">文件系统<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-222"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/filesystems/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/filesystems/common.html">通用配置</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/filesystems/s3.html">Amazon S3</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/filesystems/oss.html">阿里云 OSS</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/filesystems/azure.html">Azure Blob 存储</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/filesystems/plugins.html">Plugins</a></li>
</ul></div></li>
<li><a href="#collapse-229" data-toggle="collapse">High Availability (HA)<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-229"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/ha/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/ha/zookeeper_ha.html">ZooKeeper HA Services</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/ha/kubernetes_ha.html">Kubernetes HA Services</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/metric_reporters.html">Metric Reporters</a></li>
<li><a href="#collapse-234" data-toggle="collapse">Security<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-234"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/security/security-ssl.html">SSL 设置</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/security/security-kerberos.html">Kerberos</a></li>
</ul></div></li>
<li><a href="#collapse-238" data-toggle="collapse">REPLs<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-238"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/repls/python_shell.html">Python REPL</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/repls/scala_shell.html">Scala REPL</a></li>
</ul></div></li>
<li><a href="#collapse-242" data-toggle="collapse">Advanced<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-242"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/advanced/external_resources.html">扩展资源</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/advanced/historyserver.html">History Server</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/advanced/logging.html">日志</a></li>
</ul></div></li>
</ul></div></li>
<li><a href="#collapse-248" data-toggle="collapse"><i class="fa fa-cogs title maindish" aria-hidden="true"></i> Operations<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-248"><ul>
<li><a href="#collapse-249" data-toggle="collapse">状态与容错<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-249"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/state/checkpoints.html">Checkpoints</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/state/savepoints.html">Savepoints</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/state/state_backends.html">State Backends</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/state/large_state_tuning.html">大状态与 Checkpoint 调优</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/metrics.html">指标</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/rest_api.html">REST API</a></li>
<li><a href="#collapse-257" data-toggle="collapse">Debugging<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-257"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/debugging/debugging_event_time.html">调试窗口与事件时间</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/debugging/debugging_classloading.html">调试类加载</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/debugging/application_profiling.html">应用程序分析</a></li>
</ul></div></li>
<li><a href="#collapse-262" data-toggle="collapse">Monitoring<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-262"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/monitoring/checkpoint_monitoring.html">监控 Checkpoint</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/monitoring/back_pressure.html">监控反压</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/upgrading.html">升级应用程序和 Flink 版本</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/production_ready.html">生产就绪情况核对清单</a></li>
</ul></div></li><hr class="section-break"></hr>
<li><a href="#collapse-269" data-toggle="collapse"><i class="fa fa-cogs title dessert" aria-hidden="true"></i> Flink 开发<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-269"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/flinkDev/ide_setup.html">导入 Flink 到 IDE 中</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/flinkDev/building.html">从源码构建 Flink</a></li>
</ul></div></li>
<li><a href="#collapse-273" data-toggle="collapse"><i class="fa fa-book title dessert" aria-hidden="true"></i> 内幕<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-273"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/internals/job_scheduling.html">作业调度</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/internals/task_lifecycle.html">Task 生命周期</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/internals/filesystems.html">文件系统</a></li>
</ul></div></li>
  <li class="divider"></li>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/api/java"><i class="fa fa-external-link title" aria-hidden="true"></i> Javadocs</a></li>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/api/scala/index.html#org.apache.flink.api.scala.package"><i class="fa fa-external-link title" aria-hidden="true"></i> Scaladocs</a></li>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/api/python"><i class="fa fa-external-link title" aria-hidden="true"></i> Pythondocs</a></li>
  <li><a href="http://flink.apache.org"><i class="fa fa-external-link title" aria-hidden="true"></i> Project Page</a></li>
</ul>

<div class="sidenav-search-box">
  <form class="navbar-form" role="search" action="//ci.apache.org/projects/flink/flink-docs-release-1.12/search-results.html">
    <div class="form-group">
      <input type="text" class="form-control" size="16px" name="q" placeholder="Search">
    </div>
    <button type="submit" class="btn btn-default">Go</button>
  </form>
</div>

<div class="sidenav-versions">
  <div class="dropdown">
    <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">选择文档版本<span class="caret"></span></button>
    <ul class="dropdown-menu">
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.11">v1.11</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.10">v1.10</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.9">v1.9</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.8">v1.8</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.7">v1.7</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.6">v1.6</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.5">v1.5</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.4">v1.4</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.3">v1.3</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.2">v1.2</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.1">v1.1</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.0">v1.0</a></li>
    </ul>
  </div>
</div>

<div class="sidenav-languages"><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/dev/libs/state_processor_api.html">
      <button type="submit" class="btn btn-default">English</button>
    </a>
</div>

        </div>
        <div class="col-lg-9 content" id="contentcol">

          

<ol class="breadcrumb">
  
    <li><i class="fa fa-book title maindish" aria-hidden="true"></i> Libraries</li>
  
    <li class="active">State Processor API</li>
</ol>

<h1>State Processor API</h1>




<p>Apache Flink’s State Processor API provides powerful functionality to reading, writing, and modifing savepoints and checkpoints using Flink’s batch DataSet API.
Due to the <a href="https://ci.apache.org/projects/flink/flink-docs-master/dev/table/common.html#integration-with-datastream-and-dataset-api">interoperability of DataSet and Table API</a>, you can even use relational Table API or SQL queries to analyze and process state data.</p>

<p>For example, you can take a savepoint of a running stream processing application and analyze it with a DataSet batch program to verify that the application behaves correctly.
Or you can read a batch of data from any store, preprocess it, and write the result to a savepoint that you use to bootstrap the state of a streaming application.
It is also possible to fix inconsistent state entries.
Finally, the State Processor API opens up many ways to evolve a stateful application that was previously blocked by parameter and design choices that could not be changed without losing all the state of the application after it was started.
For example, you can now arbitrarily modify the data types of states, adjust the maximum parallelism of operators, split or merge operator state, re-assign operator UIDs, and so on.</p>

<p>To get started with the state processor api, include the following library in your application.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.apache.flink<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>flink-state-processor-api_2.11<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>1.12.0<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure>

<ul id="markdown-toc">
  <li><a href="#mapping-application-state-to-datasets" id="markdown-toc-mapping-application-state-to-datasets">Mapping Application State to DataSets</a></li>
  <li><a href="#reading-state" id="markdown-toc-reading-state">Reading State</a>    <ul>
      <li><a href="#operator-state" id="markdown-toc-operator-state">Operator State</a></li>
      <li><a href="#keyed-state" id="markdown-toc-keyed-state">Keyed State</a></li>
      <li><a href="#window-state" id="markdown-toc-window-state">Window State</a></li>
    </ul>
  </li>
  <li><a href="#writing-new-savepoints" id="markdown-toc-writing-new-savepoints">Writing New Savepoints</a>    <ul>
      <li><a href="#operator-state-1" id="markdown-toc-operator-state-1">Operator State</a></li>
      <li><a href="#broadcast-state-1" id="markdown-toc-broadcast-state-1">Broadcast State</a></li>
      <li><a href="#keyed-state-1" id="markdown-toc-keyed-state-1">Keyed State</a></li>
      <li><a href="#window-state-1" id="markdown-toc-window-state-1">Window State</a></li>
    </ul>
  </li>
  <li><a href="#modifying-savepoints" id="markdown-toc-modifying-savepoints">Modifying Savepoints</a></li>
</ul>

<h2 id="mapping-application-state-to-datasets">Mapping Application State to DataSets</h2>

<p>The State Processor API maps the state of a streaming application to one or more data sets that can be processed separately.
In order to be able to use the API, you need to understand how this mapping works.</p>

<p>But let us first have a look at what a stateful Flink job looks like.
A Flink job is composed of operators; typically one or more source operators, a few operators for the actual processing, and one or more sink operators.
Each operator runs in parallel in one or more tasks and can work with different types of state.
An operator can have zero, one, or more <em>“operator states”</em> which are organized as lists that are scoped to the operator’s tasks.
If the operator is applied on a keyed stream, it can also have zero, one, or more <em>“keyed states”</em> which are scoped to a key that is extracted from each processed record.
You can think of keyed state as a distributed key-value map.</p>

<p>The following figure shows the application “MyApp” which consists of three operators called “Src”, “Proc”, and “Snk”.
Src has one operator state (os1), Proc has one operator state (os2) and two keyed states (ks1, ks2) and Snk is stateless.</p>

<p style="display: block; text-align: center; margin-top: 20px; margin-bottom: 20px">
	<img src="//ci.apache.org/projects/flink/flink-docs-release-1.12/fig/application-my-app-state-processor-api.png" width="600px" alt="Application: MyApp" />
</p>

<p>A savepoint or checkpoint of MyApp consists of the data of all states, organized in a way that the states of each task can be restored.
When processing the data of a savepoint (or checkpoint) with a batch job, we need a mental model that maps the data of the individual tasks’ states into data sets or tables.
In fact, we can think of a savepoint as a database. Every operator (identified by its UID) represents a namespace.
Each operator state of an operator is mapped to a dedicated table in the namespace with a single column that holds the state’s data of all tasks.
All keyed states of an operator are mapped to a single table consisting of a column for the key, and one column for each keyed state.
The following figure shows how a savepoint of MyApp is mapped to a database.</p>

<p style="display: block; text-align: center; margin-top: 20px; margin-bottom: 20px">
	<img src="//ci.apache.org/projects/flink/flink-docs-release-1.12/fig/database-my-app-state-processor-api.png" width="600px" alt="Database: MyApp" />
</p>

<p>The figure shows how the values of Src’s operator state are mapped to a table with one column and five rows, one row for each of the list entries across all parallel tasks of Src.
Operator state os2 of the operator “Proc” is similarly mapped to an individual table.
The keyed states ks1 and ks2 are combined to a single table with three columns, one for the key, one for ks1 and one for ks2.
The keyed table holds one row for each distinct key of both keyed states.
Since the operator “Snk” does not have any state, its namespace is empty.</p>

<h2 id="reading-state">Reading State</h2>

<p>Reading state begins by specifying the path to a valid savepoint or checkpoint along with the <code class="highlighter-rouge">StateBackend</code> that should be used to restore the data.
The compatibility guarantees for restoring state are identical to those when restoring a <code class="highlighter-rouge">DataStream</code> application.</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">ExecutionEnvironment</span> <span class="n">bEnv</span>   <span class="o">=</span> <span class="nc">ExecutionEnvironment</span><span class="o">.</span><span class="na">getExecutionEnvironment</span><span class="o">();</span>
<span class="nc">ExistingSavepoint</span> <span class="n">savepoint</span> <span class="o">=</span> <span class="nc">Savepoint</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">bEnv</span><span class="o">,</span> <span class="s">"hdfs://path/"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MemoryStateBackend</span><span class="o">());</span></code></pre></figure>

  </div>
  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="nv">bEnv</span>      <span class="k">=</span> <span class="nv">ExecutionEnvironment</span><span class="o">.</span><span class="py">getExecutionEnvironment</span>
<span class="k">val</span> <span class="nv">savepoint</span> <span class="k">=</span> <span class="nv">Savepoint</span><span class="o">.</span><span class="py">load</span><span class="o">(</span><span class="n">bEnv</span><span class="o">,</span> <span class="s">"hdfs://path/"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MemoryStateBackend</span><span class="o">)</span></code></pre></figure>

  </div>
</div>

<h3 id="operator-state">Operator State</h3>

<p><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/state.html#operator-state">Operator state</a> is any non-keyed state in Flink.
This includes, but is not limited to, any use of <code class="highlighter-rouge">CheckpointedFunction</code> or <code class="highlighter-rouge">BroadcastState</code> within an application.
When reading operator state, users specify the operator uid, the state name, and the type information.</p>

<h4 id="operator-list-state">Operator List State</h4>

<p>Operator state stored in a <code class="highlighter-rouge">CheckpointedFunction</code> using <code class="highlighter-rouge">getListState</code> can be read using <code class="highlighter-rouge">ExistingSavepoint#readListState</code>.
The state name and type information should match those used to define the <code class="highlighter-rouge">ListStateDescriptor</code> that declared this state in the DataStream application.</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">DataSet</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">listState</span>  <span class="o">=</span> <span class="n">savepoint</span><span class="o">.</span><span class="na">readListState</span><span class="o">&lt;&gt;(</span>
    <span class="s">"my-uid"</span><span class="o">,</span>
    <span class="s">"list-state"</span><span class="o">,</span>
    <span class="nc">Types</span><span class="o">.</span><span class="na">INT</span><span class="o">);</span></code></pre></figure>

  </div>
  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="nv">listState</span>  <span class="k">=</span> <span class="nv">savepoint</span><span class="o">.</span><span class="py">readListState</span><span class="o">(</span>
    <span class="s">"my-uid"</span><span class="o">,</span>
    <span class="s">"list-state"</span><span class="o">,</span>
    <span class="nv">Types</span><span class="o">.</span><span class="py">INT</span><span class="o">)</span></code></pre></figure>

  </div>
</div>

<h4 id="operator-union-list-state">Operator Union List State</h4>

<p>Operator state stored in a <code class="highlighter-rouge">CheckpointedFunction</code> using <code class="highlighter-rouge">getUnionListState</code> can be read using <code class="highlighter-rouge">ExistingSavepoint#readUnionState</code>.
The state name and type information should match those used to define the <code class="highlighter-rouge">ListStateDescriptor</code> that declared this state in the DataStream application.
The framework will return a <em>single</em> copy of the state, equivalent to restoring a DataStream with parallelism 1.</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">DataSet</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">listState</span>  <span class="o">=</span> <span class="n">savepoint</span><span class="o">.</span><span class="na">readUnionState</span><span class="o">&lt;&gt;(</span>
    <span class="s">"my-uid"</span><span class="o">,</span>
    <span class="s">"union-state"</span><span class="o">,</span>
    <span class="nc">Types</span><span class="o">.</span><span class="na">INT</span><span class="o">);</span></code></pre></figure>

  </div>
  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="nv">listState</span>  <span class="k">=</span> <span class="nv">savepoint</span><span class="o">.</span><span class="py">readUnionState</span><span class="o">(</span>
    <span class="s">"my-uid"</span><span class="o">,</span>
    <span class="s">"union-state"</span><span class="o">,</span>
    <span class="nv">Types</span><span class="o">.</span><span class="py">INT</span><span class="o">)</span></code></pre></figure>

  </div>
</div>

<h4 id="broadcast-state">Broadcast State</h4>

<p><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/broadcast_state.html">BroadcastState</a> can be read using <code class="highlighter-rouge">ExistingSavepoint#readBroadcastState</code>.
The state name and type information should match those used to define the <code class="highlighter-rouge">MapStateDescriptor</code> that declared this state in the DataStream application.
The framework will return a <em>single</em> copy of the state, equivalent to restoring a DataStream with parallelism 1.</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">DataSet</span><span class="o">&lt;</span><span class="nc">Tuple2</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;&gt;</span> <span class="n">broadcastState</span> <span class="o">=</span> <span class="n">savepoint</span><span class="o">.</span><span class="na">readBroadcastState</span><span class="o">&lt;&gt;(</span>
    <span class="s">"my-uid"</span><span class="o">,</span>
    <span class="s">"broadcast-state"</span><span class="o">,</span>
    <span class="nc">Types</span><span class="o">.</span><span class="na">INT</span><span class="o">,</span>
    <span class="nc">Types</span><span class="o">.</span><span class="na">INT</span><span class="o">);</span></code></pre></figure>

  </div>
  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="nv">broadcastState</span> <span class="k">=</span> <span class="nv">savepoint</span><span class="o">.</span><span class="py">readBroadcastState</span><span class="o">(</span>
    <span class="s">"my-uid"</span><span class="o">,</span>
    <span class="s">"broadcast-state"</span><span class="o">,</span>
    <span class="nv">Types</span><span class="o">.</span><span class="py">INT</span><span class="o">,</span>
    <span class="nv">Types</span><span class="o">.</span><span class="py">INT</span><span class="o">)</span></code></pre></figure>

  </div>
</div>

<h4 id="using-custom-serializers">Using Custom Serializers</h4>

<p>Each of the operator state readers support using custom <code class="highlighter-rouge">TypeSerializers</code> if one was used to define the <code class="highlighter-rouge">StateDescriptor</code> that wrote out the state.</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">DataSet</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">listState</span> <span class="o">=</span> <span class="n">savepoint</span><span class="o">.</span><span class="na">readListState</span><span class="o">&lt;&gt;(</span>
    <span class="s">"uid"</span><span class="o">,</span>
    <span class="s">"list-state"</span><span class="o">,</span> 
    <span class="nc">Types</span><span class="o">.</span><span class="na">INT</span><span class="o">,</span>
    <span class="k">new</span> <span class="nf">MyCustomIntSerializer</span><span class="o">());</span></code></pre></figure>

  </div>
  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="nv">listState</span> <span class="k">=</span> <span class="nv">savepoint</span><span class="o">.</span><span class="py">readListState</span><span class="o">(</span>
    <span class="s">"uid"</span><span class="o">,</span>
    <span class="s">"list-state"</span><span class="o">,</span> 
    <span class="nv">Types</span><span class="o">.</span><span class="py">INT</span><span class="o">,</span>
    <span class="k">new</span> <span class="nc">MyCustomIntSerializer</span><span class="o">)</span></code></pre></figure>

  </div>
</div>

<h3 id="keyed-state">Keyed State</h3>

<p><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/state.html#keyed-state">Keyed state</a>, or partitioned state, is any state that is partitioned relative to a key.
When reading a keyed state, users specify the operator id and a <code class="highlighter-rouge">KeyedStateReaderFunction&lt;KeyType, OutputType&gt;</code>.</p>

<p>The <code class="highlighter-rouge">KeyedStateReaderFunction</code> allows users to read arbitrary columns and complex state types such as ListState, MapState, and AggregatingState.
This means if an operator contains a stateful process function such as:</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">StatefulFunctionWithTime</span> <span class="kd">extends</span> <span class="nc">KeyedProcessFunction</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">,</span> <span class="nc">Void</span><span class="o">&gt;</span> <span class="o">{</span>
 
   <span class="nc">ValueState</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">state</span><span class="o">;</span>
 
   <span class="nc">ListState</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="n">updateTimes</span><span class="o">;</span>

   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">open</span><span class="o">(</span><span class="nc">Configuration</span> <span class="n">parameters</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">ValueStateDescriptor</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">stateDescriptor</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ValueStateDescriptor</span><span class="o">&lt;&gt;(</span><span class="s">"state"</span><span class="o">,</span> <span class="nc">Types</span><span class="o">.</span><span class="na">INT</span><span class="o">);</span>
      <span class="n">state</span> <span class="o">=</span> <span class="n">getRuntimeContext</span><span class="o">().</span><span class="na">getState</span><span class="o">(</span><span class="n">stateDescriptor</span><span class="o">);</span>

      <span class="nc">ListStateDescriptor</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="n">updateDescriptor</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ListStateDescriptor</span><span class="o">&lt;&gt;(</span><span class="s">"times"</span><span class="o">,</span> <span class="nc">Types</span><span class="o">.</span><span class="na">LONG</span><span class="o">);</span>
      <span class="n">updateTimes</span> <span class="o">=</span> <span class="n">getRuntimeContext</span><span class="o">().</span><span class="na">getListState</span><span class="o">(</span><span class="n">updateDescriptor</span><span class="o">);</span>
   <span class="o">}</span>
 
   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">processElement</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">value</span><span class="o">,</span> <span class="nc">Context</span> <span class="n">ctx</span><span class="o">,</span> <span class="nc">Collector</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">&gt;</span> <span class="n">out</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
      <span class="n">state</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">value</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
      <span class="n">updateTimes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">());</span>
   <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

  </div>
  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">class</span> <span class="nc">StatefulFunctionWithTime</span> <span class="k">extends</span> <span class="nc">KeyedProcessFunction</span><span class="o">[</span><span class="kt">Int</span>, <span class="kt">Int</span>, <span class="kt">Void</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">var</span> <span class="n">state</span><span class="k">:</span> <span class="kt">ValueState</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="k">_</span>
  <span class="k">var</span> <span class="n">updateTimes</span><span class="k">:</span> <span class="kt">ListState</span><span class="o">[</span><span class="kt">Long</span><span class="o">]</span> <span class="k">=</span> <span class="k">_</span>

  <span class="nd">@throws</span><span class="o">[</span><span class="kt">Exception</span><span class="o">]</span>
  <span class="k">override</span> <span class="k">def</span> <span class="nf">open</span><span class="o">(</span><span class="n">parameters</span><span class="k">:</span> <span class="kt">Configuration</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="nv">stateDescriptor</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ValueStateDescriptor</span><span class="o">(</span><span class="s">"state"</span><span class="o">,</span> <span class="n">createTypeInformation</span><span class="o">[</span><span class="kt">Int</span><span class="o">])</span>
    <span class="n">state</span> <span class="k">=</span> <span class="nf">getRuntimeContext</span><span class="o">().</span><span class="py">getState</span><span class="o">(</span><span class="n">stateDescriptor</span><span class="o">)</span>

    <span class="k">val</span> <span class="nv">updateDescriptor</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ListStateDescriptor</span><span class="o">(</span><span class="s">"times"</span><span class="o">,</span> <span class="n">createTypeInformation</span><span class="o">[</span><span class="kt">Long</span><span class="o">])</span>
    <span class="n">updateTimes</span> <span class="k">=</span> <span class="nf">getRuntimeContext</span><span class="o">().</span><span class="py">getListState</span><span class="o">(</span><span class="n">updateDescriptor</span><span class="o">)</span>
  <span class="o">}</span>

  <span class="nd">@throws</span><span class="o">[</span><span class="kt">Exception</span><span class="o">]</span>
  <span class="k">override</span> <span class="k">def</span> <span class="nf">processElement</span><span class="o">(</span><span class="n">value</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">ctx</span><span class="k">:</span> <span class="kt">KeyedProcessFunction</span><span class="o">[</span><span class="kt">Int</span>, <span class="kt">Int</span>, <span class="kt">Void</span><span class="o">]</span><span class="k">#</span><span class="nc">Context</span><span class="o">,</span> <span class="n">out</span><span class="k">:</span> <span class="kt">Collector</span><span class="o">[</span><span class="kt">Void</span><span class="o">])</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="nv">state</span><span class="o">.</span><span class="py">update</span><span class="o">(</span><span class="n">value</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span>
    <span class="nv">updateTimes</span><span class="o">.</span><span class="py">add</span><span class="o">(</span><span class="nv">System</span><span class="o">.</span><span class="py">currentTimeMillis</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

  </div>
</div>

<p>Then it can read by defining an output type and corresponding <code class="highlighter-rouge">KeyedStateReaderFunction</code>.</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">DataSet</span><span class="o">&lt;</span><span class="nc">KeyedState</span><span class="o">&gt;</span> <span class="n">keyedState</span> <span class="o">=</span> <span class="n">savepoint</span><span class="o">.</span><span class="na">readKeyedState</span><span class="o">(</span><span class="s">"my-uid"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">ReaderFunction</span><span class="o">());</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">KeyedState</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="n">key</span><span class="o">;</span>

  <span class="kd">public</span> <span class="kt">int</span> <span class="n">value</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="n">times</span><span class="o">;</span>
<span class="o">}</span>
 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReaderFunction</span> <span class="kd">extends</span> <span class="nc">KeyedStateReaderFunction</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span> <span class="nc">KeyedState</span><span class="o">&gt;</span> <span class="o">{</span>

  <span class="nc">ValueState</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">state</span><span class="o">;</span>
 
  <span class="nc">ListState</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="n">updateTimes</span><span class="o">;</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">open</span><span class="o">(</span><span class="nc">Configuration</span> <span class="n">parameters</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">ValueStateDescriptor</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">stateDescriptor</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ValueStateDescriptor</span><span class="o">&lt;&gt;(</span><span class="s">"state"</span><span class="o">,</span> <span class="nc">Types</span><span class="o">.</span><span class="na">INT</span><span class="o">);</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">getRuntimeContext</span><span class="o">().</span><span class="na">getState</span><span class="o">(</span><span class="n">stateDescriptor</span><span class="o">);</span>

    <span class="nc">ListStateDescriptor</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="n">updateDescriptor</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ListStateDescriptor</span><span class="o">&lt;&gt;(</span><span class="s">"times"</span><span class="o">,</span> <span class="nc">Types</span><span class="o">.</span><span class="na">LONG</span><span class="o">);</span>
    <span class="n">updateTimes</span> <span class="o">=</span> <span class="n">getRuntimeContext</span><span class="o">().</span><span class="na">getListState</span><span class="o">(</span><span class="n">updateDescriptor</span><span class="o">);</span>
  <span class="o">}</span>
 
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">readKey</span><span class="o">(</span>
    <span class="nc">Integer</span> <span class="n">key</span><span class="o">,</span>
    <span class="nc">Context</span> <span class="n">ctx</span><span class="o">,</span>
    <span class="nc">Collector</span><span class="o">&lt;</span><span class="nc">KeyedState</span><span class="o">&gt;</span> <span class="n">out</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        
    <span class="nc">KeyedState</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">KeyedState</span><span class="o">();</span>
    <span class="n">data</span><span class="o">.</span><span class="na">key</span>    <span class="o">=</span> <span class="n">key</span><span class="o">;</span>
    <span class="n">data</span><span class="o">.</span><span class="na">value</span>  <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="na">value</span><span class="o">();</span>
    <span class="n">data</span><span class="o">.</span><span class="na">times</span>  <span class="o">=</span> <span class="nc">StreamSupport</span>
      <span class="o">.</span><span class="na">stream</span><span class="o">(</span><span class="n">updateTimes</span><span class="o">.</span><span class="na">get</span><span class="o">().</span><span class="na">spliterator</span><span class="o">(),</span> <span class="kc">false</span><span class="o">)</span>
      <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>

    <span class="n">out</span><span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

  </div>
  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">class</span> <span class="nc">ReaderFunction</span> <span class="k">extends</span> <span class="nc">KeyedStateReaderFunction</span><span class="o">[</span><span class="kt">Int</span>, <span class="kt">KeyedState</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">var</span> <span class="n">state</span><span class="k">:</span> <span class="kt">ValueState</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="k">_</span>
  <span class="k">var</span> <span class="n">updateTimes</span><span class="k">:</span> <span class="kt">ListState</span><span class="o">[</span><span class="kt">Long</span><span class="o">]</span> <span class="k">=</span> <span class="k">_</span>

  <span class="nd">@throws</span><span class="o">[</span><span class="kt">Exception</span><span class="o">]</span>
  <span class="k">override</span> <span class="k">def</span> <span class="nf">open</span><span class="o">(</span><span class="n">parameters</span><span class="k">:</span> <span class="kt">Configuration</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="nv">stateDescriptor</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ValueStateDescriptor</span><span class="o">(</span><span class="s">"state"</span><span class="o">,</span> <span class="n">createTypeInformation</span><span class="o">[</span><span class="kt">Int</span><span class="o">])</span>
    <span class="n">state</span> <span class="k">=</span> <span class="nf">getRuntimeContext</span><span class="o">().</span><span class="py">getState</span><span class="o">(</span><span class="n">stateDescriptor</span><span class="o">)</span>

    <span class="k">val</span> <span class="nv">updateDescriptor</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ListStateDescriptor</span><span class="o">(</span><span class="s">"times"</span><span class="o">,</span> <span class="n">createTypeInformation</span><span class="o">[</span><span class="kt">Long</span><span class="o">])</span>
    <span class="n">updateTimes</span> <span class="k">=</span> <span class="nf">getRuntimeContext</span><span class="o">().</span><span class="py">getListState</span><span class="o">(</span><span class="n">updateDescriptor</span><span class="o">)</span>
  <span class="o">}</span>

  <span class="k">override</span> <span class="k">def</span> <span class="nf">readKey</span><span class="o">(</span><span class="n">key</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">ctx</span><span class="k">:</span> <span class="kt">KeyedStateReaderFunction.Context</span><span class="o">,</span> <span class="n">out</span><span class="k">:</span> <span class="kt">Collector</span><span class="o">[</span><span class="kt">KeyedState</span><span class="o">])</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nc">KeyedState</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="nv">state</span><span class="o">.</span><span class="py">value</span><span class="o">,</span> <span class="nv">updateTimes</span><span class="o">.</span><span class="py">get</span><span class="o">.</span><span class="py">asScala</span><span class="o">.</span><span class="py">toList</span><span class="o">)</span>
    <span class="nv">out</span><span class="o">.</span><span class="py">collect</span><span class="o">(</span><span class="n">data</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

  </div>
</div>

<p>Along with reading registered state values, each key has access to a <code class="highlighter-rouge">Context</code> with metadata such as registered event time and processing time timers.</p>

<div class="panel panel-default"><div class="panel-body"><strong>Note:</strong> When using a <code class="highlighter-rouge">KeyedStateReaderFunction</code>, all state descriptors must be registered eagerly inside of open. Any attempt to call a <code class="highlighter-rouge">RuntimeContext#get*State</code> will result in a <code class="highlighter-rouge">RuntimeException</code>.</div></div>

<h3 id="window-state">Window State</h3>

<p>The state processor api supports reading state from a <a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/operators/windows.html">window operator</a>.
When reading a window state, users specify the operator id, window assigner, and aggregation type.</p>

<p>Additionally, a <code class="highlighter-rouge">WindowReaderFunction</code> can be specified to enrich each read with additional information similar
to a <code class="highlighter-rouge">WindowFunction</code> or <code class="highlighter-rouge">ProcessWindowFunction</code>.</p>

<p>Suppose a DataStream application that counts the number of clicks per user per minute.</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">Click</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="n">userId</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">LocalDateTime</span> <span class="n">time</span><span class="o">;</span>    
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">ClickCounter</span> <span class="kd">implements</span> <span class="nc">AggregateFunction</span><span class="o">&lt;</span><span class="nc">Click</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;</span> <span class="o">{</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Integer</span> <span class="nf">createAccumulator</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Integer</span> <span class="nf">add</span><span class="o">(</span><span class="nc">Click</span> <span class="n">value</span><span class="o">,</span> <span class="nc">Integer</span> <span class="n">accumulator</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">accumulator</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Integer</span> <span class="nf">getResult</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">accumulator</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">accumulator</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Integer</span> <span class="nf">merge</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">a</span><span class="o">,</span> <span class="nc">Integer</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="nc">DataStream</span><span class="o">&lt;</span><span class="nc">Click</span><span class="o">&gt;</span> <span class="n">clicks</span> <span class="o">=</span> <span class="o">.</span> <span class="o">.</span> <span class="o">.</span> 

<span class="n">clicks</span>
    <span class="o">.</span><span class="na">keyBy</span><span class="o">(</span><span class="n">click</span> <span class="o">-&gt;</span> <span class="n">click</span><span class="o">.</span><span class="na">userId</span><span class="o">)</span>
    <span class="o">.</span><span class="na">window</span><span class="o">(</span><span class="nc">TumblingEventTimeWindows</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="nc">Time</span><span class="o">.</span><span class="na">minutes</span><span class="o">(</span><span class="mi">1</span><span class="o">)))</span>
    <span class="o">.</span><span class="na">aggregate</span><span class="o">(</span><span class="k">new</span> <span class="nc">ClickCounter</span><span class="o">())</span>
    <span class="o">.</span><span class="na">uid</span><span class="o">(</span><span class="s">"click-window"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">addSink</span><span class="o">(</span><span class="k">new</span> <span class="nc">Sink</span><span class="o">());</span></code></pre></figure>

  </div>
  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">import</span> <span class="nn">java.lang.</span><span class="o">{</span><span class="nc">Integer</span> <span class="k">=&gt;</span> <span class="nc">JInteger</span><span class="o">}</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Click</span><span class="o">(</span><span class="n">userId</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">time</span><span class="k">:</span> <span class="kt">LocalDateTime</span><span class="o">)</span>

<span class="k">class</span> <span class="nc">ClickCounter</span> <span class="k">extends</span> <span class="nc">AggregateFunction</span><span class="o">[</span><span class="kt">Click</span>, <span class="kt">JInteger</span>, <span class="kt">JInteger</span><span class="o">]</span> <span class="o">{</span>

	<span class="k">override</span> <span class="k">def</span> <span class="nf">createAccumulator</span><span class="o">()</span><span class="k">:</span> <span class="kt">JInteger</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">override</span> <span class="k">def</span> <span class="nf">add</span><span class="o">(</span><span class="n">value</span><span class="k">:</span> <span class="kt">Click</span><span class="o">,</span> <span class="n">accumulator</span><span class="k">:</span> <span class="kt">JInteger</span><span class="o">)</span><span class="k">:</span> <span class="kt">JInteger</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">accumulator</span>
    
    <span class="k">override</span> <span class="k">def</span> <span class="nf">getResult</span><span class="o">(</span><span class="n">accumulator</span><span class="k">:</span> <span class="kt">JInteger</span><span class="o">)</span><span class="k">:</span> <span class="kt">JInteger</span> <span class="o">=</span> <span class="n">accumulator</span>

    <span class="k">override</span> <span class="k">def</span> <span class="nf">merge</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">JInteger</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">JInteger</span><span class="o">)</span><span class="k">:</span> <span class="kt">JInteger</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="o">}</span>

<span class="nc">DataStream</span><span class="o">[</span><span class="kt">Click</span><span class="o">]</span> <span class="n">clicks</span> <span class="k">=</span> <span class="o">.</span> <span class="o">.</span> <span class="o">.</span> 

<span class="n">clicks</span>
    <span class="o">.</span><span class="py">keyBy</span><span class="o">(</span><span class="n">click</span> <span class="k">=&gt;</span> <span class="nv">click</span><span class="o">.</span><span class="py">userId</span><span class="o">)</span>
    <span class="o">.</span><span class="py">window</span><span class="o">(</span><span class="nv">TumblingEventTimeWindows</span><span class="o">.</span><span class="py">of</span><span class="o">(</span><span class="nv">Time</span><span class="o">.</span><span class="py">minutes</span><span class="o">(</span><span class="mi">1</span><span class="o">)))</span>
    <span class="o">.</span><span class="py">aggregate</span><span class="o">(</span><span class="k">new</span> <span class="nc">ClickCounter</span><span class="o">())</span>
    <span class="o">.</span><span class="py">uid</span><span class="o">(</span><span class="s">"click-window"</span><span class="o">)</span>
    <span class="o">.</span><span class="py">addSink</span><span class="o">(</span><span class="k">new</span> <span class="nc">Sink</span><span class="o">())</span></code></pre></figure>

  </div>
</div>

<p>This state can be read using the code below.</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">ClickState</span> <span class="o">{</span>
    
    <span class="kd">public</span> <span class="nc">String</span> <span class="n">userId</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="n">count</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">TimeWindow</span> <span class="n">window</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="n">triggerTimers</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">ClickReader</span> <span class="kd">extends</span> <span class="nc">WindowReaderFunction</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span> <span class="nc">ClickState</span><span class="o">,</span> <span class="nc">String</span><span class="o">,</span> <span class="nc">TimeWindow</span><span class="o">&gt;</span> <span class="o">{</span> 

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">readWindow</span><span class="o">(</span><span class="nc">String</span> <span class="n">key</span><span class="o">,</span> <span class="nc">Context</span><span class="o">&lt;</span><span class="nc">TimeWindow</span><span class="o">&gt;</span> <span class="n">context</span><span class="o">,</span> <span class="nc">Iterable</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">elements</span><span class="o">,</span> <span class="nc">Collector</span><span class="o">&lt;</span><span class="nc">ClickState</span><span class="o">&gt;</span> <span class="n">out</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">ClickState</span> <span class="n">state</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ClickState</span><span class="o">();</span>
		<span class="n">state</span><span class="o">.</span><span class="na">userId</span> <span class="o">=</span> <span class="n">key</span><span class="o">;</span>
		<span class="n">state</span><span class="o">.</span><span class="na">count</span> <span class="o">=</span> <span class="n">elements</span><span class="o">.</span><span class="na">iterator</span><span class="o">().</span><span class="na">next</span><span class="o">();</span>
		<span class="n">state</span><span class="o">.</span><span class="na">window</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">window</span><span class="o">();</span>
		<span class="n">state</span><span class="o">.</span><span class="na">triggerTimers</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">registeredEventTimeTimers</span><span class="o">();</span>
		
		<span class="n">out</span><span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">state</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="nc">ExecutionEnvironment</span> <span class="n">batchEnv</span> <span class="o">=</span> <span class="nc">ExecutionEnvironment</span><span class="o">.</span><span class="na">getExecutionEnvironment</span><span class="o">();</span>
<span class="nc">ExistingSavepoint</span> <span class="n">savepoint</span> <span class="o">=</span> <span class="nc">Savepoint</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">batchEnv</span><span class="o">,</span> <span class="s">"hdfs://checkpoint-dir"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MemoryStateBackend</span><span class="o">());</span>

<span class="n">savepoint</span>
    <span class="o">.</span><span class="na">window</span><span class="o">(</span><span class="nc">TumblingEventTimeWindows</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="nc">Time</span><span class="o">.</span><span class="na">minutes</span><span class="o">(</span><span class="mi">1</span><span class="o">)))</span>
    <span class="o">.</span><span class="na">aggregate</span><span class="o">(</span><span class="s">"click-window"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">ClickCounter</span><span class="o">(),</span> <span class="k">new</span> <span class="nc">ClickReader</span><span class="o">(),</span> <span class="nc">Types</span><span class="o">.</span><span class="na">String</span><span class="o">,</span> <span class="nc">Types</span><span class="o">.</span><span class="na">INT</span><span class="o">,</span> <span class="nc">Types</span><span class="o">.</span><span class="na">INT</span><span class="o">)</span>
    <span class="o">.</span><span class="na">print</span><span class="o">();</span></code></pre></figure>

  </div>
  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">import</span> <span class="nn">java.lang.</span><span class="o">{</span><span class="nc">Integer</span> <span class="k">=&gt;</span> <span class="nc">JInteger</span><span class="o">,</span> <span class="nc">Long</span> <span class="k">=&gt;</span> <span class="nc">JLong</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">java.util.</span><span class="o">{</span><span class="nc">Set</span> <span class="k">=&gt;</span> <span class="nc">JSet</span><span class="o">}</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">ClickState</span><span class="o">(</span><span class="n">userId</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">count</span><span class="k">:</span> <span class="kt">JInteger</span><span class="o">,</span> <span class="n">window</span><span class="k">:</span> <span class="kt">TimeWindow</span><span class="o">,</span> <span class="n">triggerTimers</span><span class="k">:</span> <span class="kt">JSet</span><span class="o">[</span><span class="kt">JLong</span><span class="o">])</span>

<span class="k">class</span> <span class="nc">ClickReader</span> <span class="k">extends</span> <span class="nc">WindowReaderFunction</span><span class="o">[</span><span class="kt">JInteger</span>, <span class="kt">ClickState</span>, <span class="kt">String</span>, <span class="kt">TimeWindow</span><span class="o">]</span> <span class="o">{</span> 

	<span class="k">override</span> <span class="k">def</span> <span class="nf">readWindow</span><span class="o">(</span>
	    <span class="n">key</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
	    <span class="n">context</span><span class="k">:</span> <span class="kt">Context</span><span class="o">[</span><span class="kt">TimeWindow</span><span class="o">],</span>
	    <span class="n">elements</span><span class="k">:</span> <span class="kt">Iterable</span><span class="o">[</span><span class="kt">JInteger</span><span class="o">],</span>
	    <span class="n">out</span><span class="k">:</span> <span class="kt">Collector</span><span class="o">[</span><span class="kt">ClickState</span><span class="o">])</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
		 
		<span class="n">state</span> <span class="k">=</span> <span class="nc">ClickState</span><span class="o">(</span>
		    <span class="n">userId</span> <span class="k">=</span> <span class="n">key</span><span class="o">,</span>
		    <span class="n">count</span> <span class="k">=</span> <span class="nv">elements</span><span class="o">.</span><span class="py">iterator</span><span class="o">().</span><span class="py">next</span><span class="o">(),</span>
		    <span class="n">window</span> <span class="k">=</span> <span class="nv">context</span><span class="o">.</span><span class="py">window</span><span class="o">()</span><span class="n">k</span>
		    <span class="n">triggerTimers</span> <span class="k">=</span> <span class="nv">context</span><span class="o">.</span><span class="py">registeredEventTimeTimers</span><span class="o">())</span>
		    
		<span class="nv">out</span><span class="o">.</span><span class="py">collect</span><span class="o">(</span><span class="n">state</span><span class="o">)</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="k">val</span> <span class="nv">batchEnv</span> <span class="k">=</span> <span class="nv">ExecutionEnvironment</span><span class="o">.</span><span class="py">getExecutionEnvironment</span><span class="o">()</span>
<span class="k">val</span> <span class="nv">savepoint</span> <span class="k">=</span> <span class="nv">Savepoint</span><span class="o">.</span><span class="py">load</span><span class="o">(</span><span class="n">batchEnv</span><span class="o">,</span> <span class="s">"hdfs://checkpoint-dir"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MemoryStateBackend</span><span class="o">())</span>

<span class="n">savepoint</span>
    <span class="o">.</span><span class="py">window</span><span class="o">(</span><span class="nv">TumblingEventTimeWindows</span><span class="o">.</span><span class="py">of</span><span class="o">(</span><span class="nv">Time</span><span class="o">.</span><span class="py">minutes</span><span class="o">(</span><span class="mi">1</span><span class="o">)))</span>
    <span class="o">.</span><span class="py">aggregate</span><span class="o">(</span><span class="s">"click-window"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">ClickCounter</span><span class="o">(),</span> <span class="k">new</span> <span class="nc">ClickReader</span><span class="o">(),</span> <span class="nv">Types</span><span class="o">.</span><span class="py">String</span><span class="o">,</span> <span class="nv">Types</span><span class="o">.</span><span class="py">INT</span><span class="o">,</span> <span class="nv">Types</span><span class="o">.</span><span class="py">INT</span><span class="o">)</span>
    <span class="o">.</span><span class="py">print</span><span class="o">()</span></code></pre></figure>

  </div>
</div>

<p>Additionally, trigger state - from <code class="highlighter-rouge">CountTrigger</code>s or custom triggers - can be read using the method
<code class="highlighter-rouge">Context#triggerState</code> inside the <code class="highlighter-rouge">WindowReaderFunction</code>.</p>

<h2 id="writing-new-savepoints">Writing New Savepoints</h2>

<p><code class="highlighter-rouge">Savepoint</code>’s may also be written, which allows such use cases as bootstrapping state based on historical data.
Each savepoint is made up of one or more <code class="highlighter-rouge">BootstrapTransformation</code>’s (explained below), each of which defines the state for an individual operator.</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kt">int</span> <span class="n">maxParallelism</span> <span class="o">=</span> <span class="mi">128</span><span class="o">;</span>

<span class="nc">Savepoint</span>
    <span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="k">new</span> <span class="nc">MemoryStateBackend</span><span class="o">(),</span> <span class="n">maxParallelism</span><span class="o">)</span>
    <span class="o">.</span><span class="na">withOperator</span><span class="o">(</span><span class="s">"uid1"</span><span class="o">,</span> <span class="n">transformation1</span><span class="o">)</span>
    <span class="o">.</span><span class="na">withOperator</span><span class="o">(</span><span class="s">"uid2"</span><span class="o">,</span> <span class="n">transformation2</span><span class="o">)</span>
    <span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">savepointPath</span><span class="o">);</span></code></pre></figure>

  </div>
  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="nv">maxParallelism</span> <span class="k">=</span> <span class="mi">128</span>

<span class="nc">Savepoint</span>
    <span class="o">.</span><span class="py">create</span><span class="o">(</span><span class="k">new</span> <span class="nc">MemoryStateBackend</span><span class="o">(),</span> <span class="n">maxParallelism</span><span class="o">)</span>
    <span class="o">.</span><span class="py">withOperator</span><span class="o">(</span><span class="s">"uid1"</span><span class="o">,</span> <span class="n">transformation1</span><span class="o">)</span>
    <span class="o">.</span><span class="py">withOperator</span><span class="o">(</span><span class="s">"uid2"</span><span class="o">,</span> <span class="n">transformation2</span><span class="o">)</span>
    <span class="o">.</span><span class="py">write</span><span class="o">(</span><span class="n">savepointPath</span><span class="o">)</span></code></pre></figure>

  </div>
</div>

<p>The <a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/state/savepoints.html#assigning-operator-ids">UIDs</a> associated with each operator must match one to one with the UIDs assigned to the operators in your <code class="highlighter-rouge">DataStream</code> application; these are how Flink knows what state maps to which operator.</p>

<h3 id="operator-state-1">Operator State</h3>

<p>Simple operator state, using <code class="highlighter-rouge">CheckpointedFunction</code>, can be created using the <code class="highlighter-rouge">StateBootstrapFunction</code>.</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleBootstrapFunction</span> <span class="kd">extends</span> <span class="nc">StateBootstrapFunction</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">ListState</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">state</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">processElement</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">value</span><span class="o">,</span> <span class="nc">Context</span> <span class="n">ctx</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">state</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">snapshotState</span><span class="o">(</span><span class="nc">FunctionSnapshotContext</span> <span class="n">context</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="o">}</span>
	
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">initializeState</span><span class="o">(</span><span class="nc">FunctionInitializationContext</span> <span class="n">context</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getOperatorState</span><span class="o">().</span><span class="na">getListState</span><span class="o">(</span><span class="k">new</span> <span class="nc">ListStateDescriptor</span><span class="o">&lt;&gt;(</span><span class="s">"state"</span><span class="o">,</span> <span class="nc">Types</span><span class="o">.</span><span class="na">INT</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="nc">ExecutionEnvironment</span> <span class="n">env</span> <span class="o">=</span> <span class="nc">ExecutionEnvironment</span><span class="o">.</span><span class="na">getExecutionEnvironment</span><span class="o">();</span>
<span class="nc">DataSet</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="na">fromElements</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">);</span>

<span class="nc">BootstrapTransformation</span> <span class="n">transformation</span> <span class="o">=</span> <span class="nc">OperatorTransformation</span>
    <span class="o">.</span><span class="na">bootstrapWith</span><span class="o">(</span><span class="n">data</span><span class="o">)</span>
    <span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="k">new</span> <span class="nc">SimpleBootstrapFunction</span><span class="o">());</span></code></pre></figure>

  </div>
  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">class</span> <span class="nc">SimpleBootstrapFunction</span> <span class="k">extends</span> <span class="nc">StateBootstrapFunction</span><span class="o">[</span><span class="kt">Integer</span><span class="o">]</span> <span class="o">{</span>

    <span class="k">var</span> <span class="nc">ListState</span><span class="o">[</span><span class="kt">Integer</span><span class="o">]</span> <span class="n">state</span> <span class="k">=</span> <span class="k">_</span>

    <span class="nd">@throws</span><span class="o">[</span><span class="kt">Exception</span><span class="o">]</span>
    <span class="k">override</span> <span class="k">def</span> <span class="nf">processElement</span><span class="o">(</span><span class="n">value</span><span class="k">:</span> <span class="kt">Integer</span><span class="o">,</span> <span class="n">ctx</span><span class="k">:</span> <span class="kt">Context</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
        <span class="nv">state</span><span class="o">.</span><span class="py">add</span><span class="o">(</span><span class="n">value</span><span class="o">)</span>
    <span class="o">}</span>

    <span class="nd">@throws</span><span class="o">[</span><span class="kt">Exception</span><span class="o">]</span>
    <span class="k">override</span> <span class="k">def</span> <span class="nf">snapshotState</span><span class="o">(</span><span class="n">context</span><span class="k">:</span> <span class="kt">FunctionSnapshotContext</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="o">}</span>
	
    <span class="nd">@throws</span><span class="o">[</span><span class="kt">Exception</span><span class="o">]</span>
    <span class="k">override</span> <span class="k">def</span> <span class="nf">initializeState</span><span class="o">(</span><span class="n">context</span><span class="k">:</span> <span class="kt">FunctionInitializationContext</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
        <span class="n">state</span> <span class="k">=</span> <span class="nv">context</span><span class="o">.</span><span class="py">getOperatorState</span><span class="o">().</span><span class="py">getListState</span><span class="o">(</span><span class="k">new</span> <span class="nc">ListStateDescriptor</span><span class="o">(</span><span class="s">"state"</span><span class="o">,</span> <span class="nv">Types</span><span class="o">.</span><span class="py">INT</span><span class="o">))</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="k">val</span> <span class="nv">env</span> <span class="k">=</span> <span class="nv">ExecutionEnvironment</span><span class="o">.</span><span class="py">getExecutionEnvironment</span>
<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nv">env</span><span class="o">.</span><span class="py">fromElements</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">)</span>

<span class="nc">BootstrapTransformation</span> <span class="n">transformation</span> <span class="k">=</span> <span class="nc">OperatorTransformation</span>
    <span class="o">.</span><span class="py">bootstrapWith</span><span class="o">(</span><span class="n">data</span><span class="o">)</span>
    <span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="k">new</span> <span class="nc">SimpleBootstrapFunction</span><span class="o">)</span></code></pre></figure>

  </div>
</div>

<h3 id="broadcast-state-1">Broadcast State</h3>

<p><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/broadcast_state.html">BroadcastState</a> can be written using a <code class="highlighter-rouge">BroadcastStateBootstrapFunction</code>. Similar to broadcast state in the <code class="highlighter-rouge">DataStream</code> API, the full state must fit in memory.</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CurrencyRate</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="n">currency</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">Double</span> <span class="n">rate</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CurrencyBootstrapFunction</span> <span class="kd">extends</span> <span class="nc">BroadcastStateBootstrapFunction</span><span class="o">&lt;</span><span class="nc">CurrencyRate</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">MapStateDescriptor</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Double</span><span class="o">&gt;</span> <span class="n">descriptor</span> <span class="o">=</span> 
        <span class="k">new</span> <span class="nc">MapStateDescriptor</span><span class="o">&lt;&gt;(</span><span class="s">"currency-rates"</span><span class="o">,</span> <span class="nc">Types</span><span class="o">.</span><span class="na">STRING</span><span class="o">,</span> <span class="nc">Types</span><span class="o">.</span><span class="na">DOUBLE</span><span class="o">);</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">processElement</span><span class="o">(</span><span class="nc">CurrencyRate</span> <span class="n">value</span><span class="o">,</span> <span class="nc">Context</span> <span class="n">ctx</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">ctx</span><span class="o">.</span><span class="na">getBroadcastState</span><span class="o">(</span><span class="n">descriptor</span><span class="o">).</span><span class="na">put</span><span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">currency</span><span class="o">,</span> <span class="n">value</span><span class="o">.</span><span class="na">rate</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="nc">DataSet</span><span class="o">&lt;</span><span class="nc">CurrencyRate</span><span class="o">&gt;</span> <span class="n">currencyDataSet</span> <span class="o">=</span> <span class="n">bEnv</span><span class="o">.</span><span class="na">fromCollection</span><span class="o">(</span>
    <span class="k">new</span> <span class="nf">CurrencyRate</span><span class="o">(</span><span class="s">"USD"</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">),</span> <span class="k">new</span> <span class="nc">CurrencyRate</span><span class="o">(</span><span class="s">"EUR"</span><span class="o">,</span> <span class="mf">1.3</span><span class="o">));</span>

<span class="nc">BootstrapTransformation</span><span class="o">&lt;</span><span class="nc">CurrencyRate</span><span class="o">&gt;</span> <span class="n">broadcastTransformation</span> <span class="o">=</span> <span class="nc">OperatorTransformation</span>
    <span class="o">.</span><span class="na">bootstrapWith</span><span class="o">(</span><span class="n">currencyDataSet</span><span class="o">)</span>
    <span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="k">new</span> <span class="nc">CurrencyBootstrapFunction</span><span class="o">());</span></code></pre></figure>

  </div>
  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">case</span> <span class="k">class</span> <span class="nc">CurrencyRate</span><span class="o">(</span><span class="n">currency</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">rate</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span>

<span class="k">object</span> <span class="nc">CurrencyBootstrapFunction</span> <span class="o">{</span>
    <span class="k">val</span> <span class="nv">descriptor</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MapStateDescriptor</span><span class="o">(</span><span class="s">"currency-rates"</span><span class="o">,</span> <span class="nv">Types</span><span class="o">.</span><span class="py">STRING</span><span class="o">,</span> <span class="nv">Types</span><span class="o">.</span><span class="py">DOUBLE</span><span class="o">)</span>
<span class="o">}</span>

<span class="k">class</span> <span class="nc">CurrencyBootstrapFunction</span> <span class="k">extends</span> <span class="nc">BroadcastStateBootstrapFunction</span><span class="o">[</span><span class="kt">CurrencyRate</span><span class="o">]</span> <span class="o">{</span>

    <span class="nd">@throws</span><span class="o">[</span><span class="kt">Exception</span><span class="o">]</span>
    <span class="k">override</span> <span class="nf">processElement</span><span class="o">(</span><span class="n">value</span><span class="k">:</span> <span class="kt">CurrencyRate</span><span class="o">,</span> <span class="n">ctx</span><span class="k">:</span> <span class="kt">Context</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
        <span class="nv">ctx</span><span class="o">.</span><span class="py">getBroadcastState</span><span class="o">(</span><span class="n">descriptor</span><span class="o">).</span><span class="py">put</span><span class="o">(</span><span class="nv">value</span><span class="o">.</span><span class="py">currency</span><span class="o">,</span> <span class="nv">value</span><span class="o">.</span><span class="py">rate</span><span class="o">)</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="k">val</span> <span class="nv">currencyDataSet</span> <span class="k">=</span> <span class="nv">bEnv</span><span class="o">.</span><span class="py">fromCollection</span><span class="o">(</span><span class="nc">CurrencyRate</span><span class="o">(</span><span class="s">"USD"</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">),</span> <span class="nc">CurrencyRate</span><span class="o">(</span><span class="s">"EUR"</span><span class="o">,</span> <span class="mf">1.3</span><span class="o">))</span>

<span class="k">val</span> <span class="nv">broadcastTransformation</span> <span class="k">=</span> <span class="nc">OperatorTransformation</span>
    <span class="o">.</span><span class="py">bootstrapWith</span><span class="o">(</span><span class="n">currencyDataSet</span><span class="o">)</span>
    <span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="k">new</span> <span class="nc">CurrencyBootstrapFunction</span><span class="o">)</span></code></pre></figure>

  </div>
</div>

<h3 id="keyed-state-1">Keyed State</h3>

<p>Keyed state for <code class="highlighter-rouge">ProcessFunction</code>’s and other <code class="highlighter-rouge">RichFunction</code> types can be written using a <code class="highlighter-rouge">KeyedStateBootstrapFunction</code>.</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Account</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">double</span> <span class="n">amount</span><span class="o">;</span>	

    <span class="kd">public</span> <span class="kt">long</span> <span class="n">timestamp</span><span class="o">;</span>
<span class="o">}</span>
 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AccountBootstrapper</span> <span class="kd">extends</span> <span class="nc">KeyedStateBootstrapFunction</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span> <span class="nc">Account</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="nc">ValueState</span><span class="o">&lt;</span><span class="nc">Double</span><span class="o">&gt;</span> <span class="n">state</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">open</span><span class="o">(</span><span class="nc">Configuration</span> <span class="n">parameters</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">ValueStateDescriptor</span><span class="o">&lt;</span><span class="nc">Double</span><span class="o">&gt;</span> <span class="n">descriptor</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ValueStateDescriptor</span><span class="o">&lt;&gt;(</span><span class="s">"total"</span><span class="o">,</span><span class="nc">Types</span><span class="o">.</span><span class="na">DOUBLE</span><span class="o">);</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">getRuntimeContext</span><span class="o">().</span><span class="na">getState</span><span class="o">(</span><span class="n">descriptor</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">processElement</span><span class="o">(</span><span class="nc">Account</span> <span class="n">value</span><span class="o">,</span> <span class="nc">Context</span> <span class="n">ctx</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">state</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">amount</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
 
<span class="nc">ExecutionEnvironment</span> <span class="n">bEnv</span> <span class="o">=</span> <span class="nc">ExecutionEnvironment</span><span class="o">.</span><span class="na">getExecutionEnvironment</span><span class="o">();</span>

<span class="nc">DataSet</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;</span> <span class="n">accountDataSet</span> <span class="o">=</span> <span class="n">bEnv</span><span class="o">.</span><span class="na">fromCollection</span><span class="o">(</span><span class="n">accounts</span><span class="o">);</span>

<span class="nc">BootstrapTransformation</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;</span> <span class="n">transformation</span> <span class="o">=</span> <span class="nc">OperatorTransformation</span>
    <span class="o">.</span><span class="na">bootstrapWith</span><span class="o">(</span><span class="n">accountDataSet</span><span class="o">)</span>
    <span class="o">.</span><span class="na">keyBy</span><span class="o">(</span><span class="n">acc</span> <span class="o">-&gt;</span> <span class="n">acc</span><span class="o">.</span><span class="na">id</span><span class="o">)</span>
    <span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="k">new</span> <span class="nc">AccountBootstrapper</span><span class="o">());</span></code></pre></figure>

  </div>
  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">case</span> <span class="k">class</span> <span class="nc">Account</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">amount</span><span class="k">:</span> <span class="kt">Double</span><span class="o">,</span> <span class="n">timestamp</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span>

<span class="k">class</span> <span class="nc">AccountBootstrapper</span> <span class="k">extends</span> <span class="nc">KeyedStateBootstrapFunction</span><span class="o">[</span><span class="kt">Integer</span>, <span class="kt">Account</span><span class="o">]</span> <span class="o">{</span>
    <span class="k">var</span> <span class="n">state</span><span class="k">:</span> <span class="kt">ValueState</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span>

    <span class="nd">@throws</span><span class="o">[</span><span class="kt">Exception</span><span class="o">]</span>
    <span class="k">override</span> <span class="k">def</span> <span class="nf">open</span><span class="o">(</span><span class="n">parameters</span><span class="k">:</span> <span class="kt">Configuration</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
        <span class="k">val</span> <span class="nv">descriptor</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ValueStateDescriptor</span><span class="o">(</span><span class="s">"total"</span><span class="o">,</span><span class="nv">Types</span><span class="o">.</span><span class="py">DOUBLE</span><span class="o">)</span>
        <span class="n">state</span> <span class="k">=</span> <span class="nf">getRuntimeContext</span><span class="o">().</span><span class="py">getState</span><span class="o">(</span><span class="n">descriptor</span><span class="o">)</span>
    <span class="o">}</span>

    <span class="nd">@throws</span><span class="o">[</span><span class="kt">Exception</span><span class="o">]</span>
    <span class="k">override</span> <span class="k">def</span> <span class="nf">processElement</span><span class="o">(</span><span class="n">value</span><span class="k">:</span> <span class="kt">Account</span><span class="o">,</span> <span class="n">ctx</span><span class="k">:</span> <span class="kt">Context</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
        <span class="nv">state</span><span class="o">.</span><span class="py">update</span><span class="o">(</span><span class="nv">value</span><span class="o">.</span><span class="py">amount</span><span class="o">)</span>
    <span class="o">}</span>
<span class="o">}</span>
 
<span class="k">val</span> <span class="nv">bEnv</span> <span class="k">=</span> <span class="nv">ExecutionEnvironment</span><span class="o">.</span><span class="py">getExecutionEnvironment</span><span class="o">()</span>

<span class="k">val</span> <span class="nv">accountDataSet</span> <span class="k">=</span> <span class="nv">bEnv</span><span class="o">.</span><span class="py">fromCollection</span><span class="o">(</span><span class="n">accounts</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">transformation</span> <span class="k">=</span> <span class="nc">OperatorTransformation</span>
    <span class="o">.</span><span class="py">bootstrapWith</span><span class="o">(</span><span class="n">accountDataSet</span><span class="o">)</span>
    <span class="o">.</span><span class="py">keyBy</span><span class="o">(</span><span class="n">acc</span> <span class="k">=&gt;</span> <span class="nv">acc</span><span class="o">.</span><span class="py">id</span><span class="o">)</span>
    <span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="k">new</span> <span class="nc">AccountBootstrapper</span><span class="o">)</span></code></pre></figure>

  </div>
</div>

<p>The <code class="highlighter-rouge">KeyedStateBootstrapFunction</code> supports setting event time and processing time timers.
The timers will not fire inside the bootstrap function and only become active once restored within a <code class="highlighter-rouge">DataStream</code> application.
If a processing time timer is set but the state is not restored until after that time has passed, the timer will fire immediately upon start.</p>

<p><span class="label label-danger">Attention</span> If your bootstrap function creates timers, the state can only be restored using one of the <a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/operators/process_function.html">process</a> type functions.</p>

<h3 id="window-state-1">Window State</h3>

<p>The state processor api supports writing state for the <a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/operators/windows.html">window operator</a>.
When writing window state, users specify the operator id, window assigner, evictor, optional trigger, and aggregation type.
It is important the configurations on the bootstrap transformation match the configurations on the DataStream window.</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Account</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">double</span> <span class="n">amount</span><span class="o">;</span>	

    <span class="kd">public</span> <span class="kt">long</span> <span class="n">timestamp</span><span class="o">;</span>
<span class="o">}</span>
 
<span class="nc">ExecutionEnvironment</span> <span class="n">bEnv</span> <span class="o">=</span> <span class="nc">ExecutionEnvironment</span><span class="o">.</span><span class="na">getExecutionEnvironment</span><span class="o">();</span>

<span class="nc">DataSet</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;</span> <span class="n">accountDataSet</span> <span class="o">=</span> <span class="n">bEnv</span><span class="o">.</span><span class="na">fromCollection</span><span class="o">(</span><span class="n">accounts</span><span class="o">);</span>

<span class="nc">BootstrapTransformation</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;</span> <span class="n">transformation</span> <span class="o">=</span> <span class="nc">OperatorTransformation</span>
    <span class="o">.</span><span class="na">bootstrapWith</span><span class="o">(</span><span class="n">accountDataSet</span><span class="o">)</span>
    <span class="c1">// When using event time windows, it is important</span>
    <span class="c1">// to assign timestamps to each record.</span>
    <span class="o">.</span><span class="na">assignTimestamps</span><span class="o">(</span><span class="n">account</span> <span class="o">-&gt;</span> <span class="n">account</span><span class="o">.</span><span class="na">timestamp</span><span class="o">)</span>
    <span class="o">.</span><span class="na">keyBy</span><span class="o">(</span><span class="n">acc</span> <span class="o">-&gt;</span> <span class="n">acc</span><span class="o">.</span><span class="na">id</span><span class="o">)</span>
    <span class="o">.</span><span class="na">window</span><span class="o">(</span><span class="nc">TumblingEventTimeWindows</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="nc">Time</span><span class="o">.</span><span class="na">minutes</span><span class="o">(</span><span class="mi">5</span><span class="o">)))</span>
    <span class="o">.</span><span class="na">reduce</span><span class="o">((</span><span class="n">left</span><span class="o">,</span> <span class="n">right</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="o">);</span></code></pre></figure>

  </div>
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">case</span> <span class="k">class</span> <span class="nc">Account</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">amount</span><span class="k">:</span> <span class="kt">Double</span><span class="o">,</span> <span class="n">timestamp</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span>
 
<span class="k">val</span> <span class="nv">bEnv</span> <span class="k">=</span> <span class="nv">ExecutionEnvironment</span><span class="o">.</span><span class="py">getExecutionEnvironment</span><span class="o">();</span>
<span class="k">val</span> <span class="nv">accountDataSet</span> <span class="k">=</span> <span class="nv">bEnv</span><span class="o">.</span><span class="py">fromCollection</span><span class="o">(</span><span class="n">accounts</span><span class="o">);</span>

<span class="k">val</span> <span class="nv">transformation</span> <span class="k">=</span> <span class="nc">OperatorTransformation</span>
    <span class="o">.</span><span class="py">bootstrapWith</span><span class="o">(</span><span class="n">accountDataSet</span><span class="o">)</span>
    <span class="c1">// When using event time windows, its important</span>
    <span class="c1">// to assign timestamps to each record.</span>
    <span class="o">.</span><span class="py">assignTimestamps</span><span class="o">(</span><span class="n">account</span> <span class="k">=&gt;</span> <span class="nv">account</span><span class="o">.</span><span class="py">timestamp</span><span class="o">)</span>
    <span class="o">.</span><span class="py">keyBy</span><span class="o">(</span><span class="n">acc</span> <span class="k">=&gt;</span> <span class="nv">acc</span><span class="o">.</span><span class="py">id</span><span class="o">)</span>
    <span class="o">.</span><span class="py">window</span><span class="o">(</span><span class="nv">TumblingEventTimeWindows</span><span class="o">.</span><span class="py">of</span><span class="o">(</span><span class="nv">Time</span><span class="o">.</span><span class="py">minutes</span><span class="o">(</span><span class="mi">5</span><span class="o">)))</span>
    <span class="o">.</span><span class="py">reduce</span><span class="o">((</span><span class="n">left</span><span class="o">,</span> <span class="n">right</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="o">)</span></code></pre></figure>

  </div>
</div>

<h2 id="modifying-savepoints">Modifying Savepoints</h2>

<p>Besides creating a savepoint from scratch, you can base one off an existing savepoint such as when bootstrapping a single new operator for an existing job.</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">Savepoint</span>
    <span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">bEnv</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MemoryStateBackend</span><span class="o">(),</span> <span class="n">oldPath</span><span class="o">)</span>
    <span class="o">.</span><span class="na">withOperator</span><span class="o">(</span><span class="s">"uid"</span><span class="o">,</span> <span class="n">transformation</span><span class="o">)</span>
    <span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">newPath</span><span class="o">);</span></code></pre></figure>

  </div>
  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="nc">Savepoint</span>
    <span class="o">.</span><span class="py">load</span><span class="o">(</span><span class="n">bEnv</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MemoryStateBackend</span><span class="o">,</span> <span class="n">oldPath</span><span class="o">)</span>
    <span class="o">.</span><span class="py">withOperator</span><span class="o">(</span><span class="s">"uid"</span><span class="o">,</span> <span class="n">transformation</span><span class="o">)</span>
    <span class="o">.</span><span class="py">write</span><span class="o">(</span><span class="n">newPath</span><span class="o">)</span></code></pre></figure>

  </div>
</div>



<div class="footer">
  <a href="https://cwiki.apache.org/confluence/display/FLINK/Flink+Translation+Specifications" target="_blank">
    
      想参与贡献翻译？
    
  </a>
</div>


        </div>
      </div>
    </div><!-- /.container -->

    <!-- default code tab -->
    <script>var defaultCodeTab = "";</script>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/js/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.1.0/anchor.min.js"></script>
    <script src="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/js/flink.js"></script>

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-52545728-1', 'auto');
      ga('send', 'pageview');
    </script>

    <!-- Disqus -->
    
  </body>
</html>
