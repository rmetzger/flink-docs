<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Apache Flink 1.12 Documentation: Iterative Graph Processing</title>
    <link rel="shortcut icon" href="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/favicon.ico" type="image/x-icon">
    <link rel="icon" href="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/favicon.ico" type="image/x-icon">
    <link rel="canonical" href="//ci.apache.org/projects/flink/flink-docs-stable/zh/dev/libs/gelly/iterative_graph_processing.html">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/css/flink.css">
    <link rel="stylesheet" href="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/css/syntax.css">
    <link rel="stylesheet" href="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/css/codetabs.css">
    <link rel="stylesheet" href="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/font-awesome/css/font-awesome.min.css">
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    

    <!-- Main content. -->
    <div class="container">
      
      <div class="row">
        <div class="col-lg-3" id="sidenavcol">
          <div class="sidenav-logo">
  <p><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/"><img class="bottom" alt="Apache Flink" src="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/img/navbar-brand-logo.jpg"></a> v1.12</p>
</div>
<ul id="sidenav">
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/"><i class="fa fa-home title" aria-hidden="true"></i> Home</a></li><hr class="section-break"></hr>
<li><a href="#collapse-2" data-toggle="collapse"><i class="fa fa-rocket title appetizer" aria-hidden="true"></i> Try Flink<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-2"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/try-flink/local_installation.html">本地模式安装</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/try-flink/datastream_api.html">基于 DataStream API 实现欺诈检测</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/try-flink/table_api.html">基于 Table API 实现实时报表</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/try-flink/flink-operations-playground.html">Flink 操作场景</a></li>
</ul></div></li>
<li><a href="#collapse-8" data-toggle="collapse"><i class="fa fa-hand-paper-o title appetizer" aria-hidden="true"></i> 实践练习<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-8"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/learn-flink/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/learn-flink/datastream_api.html">DataStream API 简介</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/learn-flink/etl.html">数据管道 & ETL</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/learn-flink/streaming_analytics.html">流式分析</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/learn-flink/event_driven.html">事件驱动应用</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/learn-flink/fault_tolerance.html">容错处理</a></li>
</ul></div></li>
<li><a href="#collapse-15" data-toggle="collapse"><i class="fa fa-map-o title appetizer" aria-hidden="true"></i> 概念透析<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-15"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/concepts/index.html">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/concepts/stateful-stream-processing.html">有状态流处理</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/concepts/timely-stream-processing.html">及时流处理</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/concepts/flink-architecture.html">Flink 架构</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/concepts/glossary.html">词汇表</a></li>
</ul></div></li><hr class="section-break"></hr>
<li><a href="#collapse-21" data-toggle="collapse"><i class="fa fa-code title maindish" aria-hidden="true"></i> 应用开发<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-21"><ul>
<li><a href="#collapse-22" data-toggle="collapse">DataStream API<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-22"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/datastream_api.html">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/datastream_execution_mode.html">Execution Mode (Batch/Streaming)</a></li>
<li><a href="#collapse-24" data-toggle="collapse">事件时间<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-24"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/event_time.html">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/event_timestamps_watermarks.html">生成 Watermark</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/event_timestamp_extractors.html">内置 Watermark 生成器</a></li>
</ul></div></li>
<li><a href="#collapse-28" data-toggle="collapse">状态与容错<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-28"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/state.html">Working with State</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/broadcast_state.html">Broadcast State 模式</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/checkpointing.html">Checkpointing</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/queryable_state.html">Queryable State</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/state_backends.html">State Backends</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/schema_evolution.html">状态数据结构升级</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/custom_serialization.html">自定义状态序列化</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/user_defined_functions.html">用户自定义 Functions</a></li>
<li><a href="#collapse-38" data-toggle="collapse">算子<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-38"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/operators/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/operators/windows.html">窗口</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/operators/joining.html">Joining</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/operators/process_function.html">Process Function</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/operators/asyncio.html">异步 I/O</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/sources.html">Data Sources</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/side_output.html">旁路输出</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/application_parameters.html">Handling Application Parameters</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/testing.html">测试</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/experimental.html">实验功能</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/scala_api_extensions.html">Scala API Extensions</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/java_lambdas.html">Java Lambda 表达式</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/project-configuration.html">Project Configuration</a></li>
</ul></div></li>
<li><a href="#collapse-53" data-toggle="collapse">DataSet API<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-53"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/dataset_transformations.html">Transformations</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/iterations.html">迭代</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/zip_elements_guide.html">Zipping Elements</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/hadoop_compatibility.html">Hadoop 兼容</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/local_execution.html">本地执行</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/cluster_execution.html">集群执行</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/examples.html">Batch 示例</a></li>
</ul></div></li>
<li><a href="#collapse-62" data-toggle="collapse">Table API & SQL<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-62"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/common.html">概念与通用 API</a></li>
<li><a href="#collapse-64" data-toggle="collapse">流式概念<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-64"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/streaming/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/streaming/dynamic_tables.html">动态表 (Dynamic Table)</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/streaming/time_attributes.html">时间属性</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/streaming/joins.html">流上的 Join</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/streaming/temporal_tables.html">时态表（Temporal Tables）</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/streaming/match_recognize.html">模式检测</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/streaming/query_configuration.html">Query Configuration</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/types.html">数据类型</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/tableApi.html">Table API</a></li>
<li><a href="#collapse-74" data-toggle="collapse">SQL<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-74"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/queries.html">查询语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/create.html">CREATE 语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/drop.html">DROP 语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/alter.html">ALTER 语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/insert.html">INSERT 语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/hints.html">SQL Hints</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/describe.html">DESCRIBE 语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/explain.html">EXPLAIN 语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/use.html">USE 语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/show.html">SHOW 语句</a></li>
</ul></div></li>
<li><a href="#collapse-86" data-toggle="collapse">函数<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-86"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/functions/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/functions/systemFunctions.html">系统（内置）函数</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/functions/udfs.html">自定义函数</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/modules.html">模块</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/catalogs.html">Catalogs</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sqlClient.html">SQL 客户端</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/config.html">配置</a></li>
<li><a href="#collapse-94" data-toggle="collapse">Performance Tuning<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-94"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/tuning/streaming_aggregation_optimization.html">流式聚合</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sourceSinks.html">User-defined Sources & Sinks</a></li>
</ul></div></li>
<li><a href="#collapse-99" data-toggle="collapse">Python API<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-99"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/installation.html">环境安装</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table_api_tutorial.html">Table API 教程</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/datastream_tutorial.html">DataStream API 教程</a></li>
<li><a href="#collapse-103" data-toggle="collapse">Table API用户指南<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-103"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/intro_to_table_api.html">Python Table API 简介</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/table_environment.html">TableEnvironment</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/operations.html">Operations</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/python_types.html">数据类型</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/built_in_functions.html">系统（内置）函数</a></li>
<li><a href="#collapse-109" data-toggle="collapse">自定义函数<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-109"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/udfs/python_udfs.html">普通自定义函数（UDF）</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/udfs/vectorized_python_udfs.html">向量化自定义函数</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/conversion_of_pandas.html">PyFlink Table 和 Pandas DataFrame 互转</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/dependency_management.html">依赖管理</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/sql.html">SQL</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/catalogs.html">Catalogs</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/metrics.html">指标</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/python_table_api_connectors.html">连接器</a></li>
</ul></div></li>
<li><a href="#collapse-120" data-toggle="collapse">DataStream API用户指南<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-120"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/datastream-api-users-guide/data_types.html">数据类型</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/datastream-api-users-guide/operators.html">算子</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/datastream-api-users-guide/dependency_management.html">依赖管理</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/python_config.html">配置</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/environment_variables.html">环境变量</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/faq.html">常见问题</a></li>
</ul></div></li>
<li><a href="#collapse-129" data-toggle="collapse">数据类型以及序列化<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-129"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/types_serialization.html">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/custom_serializers.html">自定义序列化器</a></li>
</ul></div></li>
<li><a href="#collapse-132" data-toggle="collapse">管理执行<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-132"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/execution_configuration.html">执行配置</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/packaging.html">程序打包</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/parallel.html">并行执行</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/execution_plans.html">执行计划</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/task_failure_recovery.html">Task 故障恢复</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/migration.html">API 迁移指南</a></li>
</ul></div></li>
<li><a href="#collapse-141" data-toggle="collapse"class="active"><i class="fa fa-book title maindish" aria-hidden="true"></i> Libraries</a><div class="collapse in" id="collapse-141"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/cep.html">事件处理 (CEP)</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/state_processor_api.html">State Processor API</a></li>
<li><a href="#collapse-144" data-toggle="collapse"class="active">图计算: Gelly</a><div class="collapse in" id="collapse-144"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/graph_api.html">Graph API</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/iterative_graph_processing.html" class="active">Iterative Graph Processing</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/library_methods.html">Library Methods</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/graph_algorithms.html">Graph Algorithms</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/graph_generators.html">Graph Generators</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/bipartite_graph.html">Bipartite Graph</a></li>
</ul></div></li>
</ul></div></li>
<li><a href="#collapse-153" data-toggle="collapse"><i class="fa fa-random title maindish" aria-hidden="true"></i> Connectors<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-153"><ul>
<li><a href="#collapse-154" data-toggle="collapse">DataStream Connectors<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-154"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/guarantees.html">容错保证</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/kafka.html">Kafka</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/cassandra.html">Cassandra</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/kinesis.html">Kinesis</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/elasticsearch.html">Elasticsearch</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/file_sink.html">File Sink</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/streamfile_sink.html">Streaming File Sink</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/rabbitmq.html">RabbitMQ</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/nifi.html">NiFi</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/pubsub.html">Google Cloud PubSub</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/twitter.html">Twitter</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/jdbc.html">JDBC</a></li>
</ul></div></li>
<li><a href="#collapse-168" data-toggle="collapse">Table & SQL Connectors<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-168"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/">概览</a></li>
<li><a href="#collapse-169" data-toggle="collapse">Formats<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-169"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/csv.html">CSV</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/json.html">JSON</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/avro-confluent.html">Confluent Avro</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/avro.html">Avro</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/debezium.html">Debezium</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/canal.html">Canal</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/maxwell.html">Maxwell</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/parquet.html">Parquet</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/orc.html">Orc</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/raw.html">Raw</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/kafka.html">Kafka</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/upsert-kafka.html">Upsert Kafka</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/kinesis.html">Kinesis</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/jdbc.html">JDBC</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/elasticsearch.html">Elasticsearch</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/filesystem.html">FileSystem</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/hbase.html">HBase</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/datagen.html">DataGen</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/print.html">Print</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/blackhole.html">BlackHole</a></li>
<li><a href="#collapse-191" data-toggle="collapse">Hive<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-191"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/hive/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/hive/hive_catalog.html">Hive Catalog</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/hive/hive_dialect.html">Hive 方言</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/hive/hive_read_write.html">Hive Read & Write</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/hive/hive_functions.html">Hive 函数</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/downloads.html">下载</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/connectors.html">DataSet Connectors</a></li>
</ul></div></li>
<li><a href="#collapse-201" data-toggle="collapse"><i class="fa fa-sliders title maindish" aria-hidden="true"></i> Deployment<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-201"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/">概览</a></li>
<li><a href="#collapse-202" data-toggle="collapse">Resource Providers<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-202"><ul>
<li><a href="#collapse-203" data-toggle="collapse">Standalone<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-203"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/resource-providers/standalone/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/resource-providers/standalone/local.html">本地集群</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/resource-providers/standalone/docker.html">Docker</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/resource-providers/standalone/kubernetes.html">Kubernetes</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/resource-providers/native_kubernetes.html">Native Kubernetes</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/resource-providers/yarn.html">YARN</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/resource-providers/mesos.html">Mesos</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/config.html">配置参数</a></li>
<li><a href="#collapse-213" data-toggle="collapse">内存配置<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-213"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_setup.html">配置 Flink 进程的内存</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_setup_tm.html">配置 TaskManager 内存</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_setup_jobmanager.html">配置 JobManager 内存</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_tuning.html">调优指南</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_trouble.html">常见问题</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_migration.html">升级指南</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/cli.html">Command-Line Interface</a></li>
<li><a href="#collapse-222" data-toggle="collapse">文件系统<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-222"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/filesystems/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/filesystems/common.html">通用配置</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/filesystems/s3.html">Amazon S3</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/filesystems/oss.html">阿里云 OSS</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/filesystems/azure.html">Azure Blob 存储</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/filesystems/plugins.html">Plugins</a></li>
</ul></div></li>
<li><a href="#collapse-229" data-toggle="collapse">High Availability (HA)<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-229"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/ha/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/ha/zookeeper_ha.html">ZooKeeper HA Services</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/ha/kubernetes_ha.html">Kubernetes HA Services</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/metric_reporters.html">Metric Reporters</a></li>
<li><a href="#collapse-234" data-toggle="collapse">Security<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-234"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/security/security-ssl.html">SSL 设置</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/security/security-kerberos.html">Kerberos</a></li>
</ul></div></li>
<li><a href="#collapse-238" data-toggle="collapse">REPLs<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-238"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/repls/python_shell.html">Python REPL</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/repls/scala_shell.html">Scala REPL</a></li>
</ul></div></li>
<li><a href="#collapse-242" data-toggle="collapse">Advanced<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-242"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/advanced/external_resources.html">扩展资源</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/advanced/historyserver.html">History Server</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/advanced/logging.html">日志</a></li>
</ul></div></li>
</ul></div></li>
<li><a href="#collapse-248" data-toggle="collapse"><i class="fa fa-cogs title maindish" aria-hidden="true"></i> Operations<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-248"><ul>
<li><a href="#collapse-249" data-toggle="collapse">状态与容错<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-249"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/state/checkpoints.html">Checkpoints</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/state/savepoints.html">Savepoints</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/state/state_backends.html">State Backends</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/state/large_state_tuning.html">大状态与 Checkpoint 调优</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/metrics.html">指标</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/rest_api.html">REST API</a></li>
<li><a href="#collapse-257" data-toggle="collapse">Debugging<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-257"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/debugging/debugging_event_time.html">调试窗口与事件时间</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/debugging/debugging_classloading.html">调试类加载</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/debugging/application_profiling.html">应用程序分析</a></li>
</ul></div></li>
<li><a href="#collapse-262" data-toggle="collapse">Monitoring<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-262"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/monitoring/checkpoint_monitoring.html">监控 Checkpoint</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/monitoring/back_pressure.html">监控反压</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/upgrading.html">升级应用程序和 Flink 版本</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/production_ready.html">生产就绪情况核对清单</a></li>
</ul></div></li><hr class="section-break"></hr>
<li><a href="#collapse-269" data-toggle="collapse"><i class="fa fa-cogs title dessert" aria-hidden="true"></i> Flink 开发<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-269"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/flinkDev/ide_setup.html">导入 Flink 到 IDE 中</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/flinkDev/building.html">从源码构建 Flink</a></li>
</ul></div></li>
<li><a href="#collapse-273" data-toggle="collapse"><i class="fa fa-book title dessert" aria-hidden="true"></i> 内幕<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-273"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/internals/job_scheduling.html">作业调度</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/internals/task_lifecycle.html">Task 生命周期</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/internals/filesystems.html">文件系统</a></li>
</ul></div></li>
  <li class="divider"></li>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/api/java"><i class="fa fa-external-link title" aria-hidden="true"></i> Javadocs</a></li>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/api/scala/index.html#org.apache.flink.api.scala.package"><i class="fa fa-external-link title" aria-hidden="true"></i> Scaladocs</a></li>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/api/python"><i class="fa fa-external-link title" aria-hidden="true"></i> Pythondocs</a></li>
  <li><a href="http://flink.apache.org"><i class="fa fa-external-link title" aria-hidden="true"></i> Project Page</a></li>
</ul>

<div class="sidenav-search-box">
  <form class="navbar-form" role="search" action="//ci.apache.org/projects/flink/flink-docs-release-1.12/search-results.html">
    <div class="form-group">
      <input type="text" class="form-control" size="16px" name="q" placeholder="Search">
    </div>
    <button type="submit" class="btn btn-default">Go</button>
  </form>
</div>

<div class="sidenav-versions">
  <div class="dropdown">
    <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">选择文档版本<span class="caret"></span></button>
    <ul class="dropdown-menu">
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.11">v1.11</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.10">v1.10</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.9">v1.9</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.8">v1.8</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.7">v1.7</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.6">v1.6</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.5">v1.5</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.4">v1.4</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.3">v1.3</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.2">v1.2</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.1">v1.1</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.0">v1.0</a></li>
    </ul>
  </div>
</div>

<div class="sidenav-languages"><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/dev/libs/gelly/iterative_graph_processing.html">
      <button type="submit" class="btn btn-default">English</button>
    </a>
</div>

        </div>
        <div class="col-lg-9 content" id="contentcol">

          

<ol class="breadcrumb">
  
    <li><i class="fa fa-book title maindish" aria-hidden="true"></i> Libraries</li>
  
    <li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/">图计算: Gelly</a></li>
  
    <li class="active">Iterative Graph Processing</li>
</ol>

<h1>Iterative Graph Processing</h1>




<p>Gelly exploits Flink’s efficient iteration operators to support large-scale iterative graph processing. Currently, we provide implementations of the vertex-centric, scatter-gather, and gather-sum-apply models. In the following sections, we describe these abstractions and show how you can use them in Gelly.</p>

<ul id="markdown-toc">
  <li><a href="#vertex-centric-iterations" id="markdown-toc-vertex-centric-iterations">Vertex-Centric Iterations</a></li>
  <li><a href="#configuring-a-vertex-centric-iteration" id="markdown-toc-configuring-a-vertex-centric-iteration">Configuring a Vertex-Centric Iteration</a></li>
  <li><a href="#scatter-gather-iterations" id="markdown-toc-scatter-gather-iterations">Scatter-Gather Iterations</a></li>
  <li><a href="#configuring-a-scatter-gather-iteration" id="markdown-toc-configuring-a-scatter-gather-iteration">Configuring a Scatter-Gather Iteration</a></li>
  <li><a href="#gather-sum-apply-iterations" id="markdown-toc-gather-sum-apply-iterations">Gather-Sum-Apply Iterations</a></li>
  <li><a href="#configuring-a-gather-sum-apply-iteration" id="markdown-toc-configuring-a-gather-sum-apply-iteration">Configuring a Gather-Sum-Apply Iteration</a></li>
  <li><a href="#iteration-abstractions-comparison" id="markdown-toc-iteration-abstractions-comparison">Iteration Abstractions Comparison</a></li>
</ul>

<h2 id="vertex-centric-iterations">Vertex-Centric Iterations</h2>
<p>The vertex-centric model, also known as “think like a vertex” or “Pregel”, expresses computation from the perspective of a vertex in the graph.
The computation proceeds in synchronized iteration steps, called supersteps. In each superstep, each vertex executes one user-defined function.
Vertices communicate with other vertices through messages. A vertex can send a message to any other vertex in the graph, as long as it knows its unique ID.</p>

<p>The computational model is shown in the figure below. The dotted boxes correspond to parallelization units.
In each superstep, all active vertices execute the
same user-defined computation in parallel. Supersteps are executed synchronously, so that messages sent during one superstep are guaranteed to be delivered in the beginning of the next superstep.</p>

<p class="text-center">
    <img alt="Vertex-Centric Computational Model" width="70%" src="//ci.apache.org/projects/flink/flink-docs-release-1.12/fig/vertex-centric%20supersteps.png" />
</p>

<p>To use vertex-centric iterations in Gelly, the user only needs to define the vertex compute function, <code class="highlighter-rouge">ComputeFunction</code>.
This function and the maximum number of iterations to run are given as parameters to Gelly’s <code class="highlighter-rouge">runVertexCentricIteration</code>. This method will execute the vertex-centric iteration on the input Graph and return a new Graph, with updated vertex values. An optional message combiner, <code class="highlighter-rouge">MessageCombiner</code>, can be defined to reduce communication costs.</p>

<p>Let us consider computing Single-Source-Shortest-Paths with vertex-centric iterations. Initially, each vertex has a value of infinite distance, except from the source vertex, which has a value of zero. During the first superstep, the source propagates distances to its neighbors. During the following supersteps, each vertex checks its received messages and chooses the minimum distance among them. If this distance is smaller than its current value, it updates its state and produces messages for its neighbors. If a vertex does not change its value during a superstep, then it does not produce any messages for its neighbors for the next superstep. The algorithm converges when there are no value updates or the maximum number of supersteps has been reached. In this algorithm, a message combiner can be used to reduce the number of messages sent to a target vertex.</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// read the input graph</span>
<span class="nc">Graph</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">Double</span><span class="o">,</span> <span class="nc">Double</span><span class="o">&gt;</span> <span class="n">graph</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// define the maximum number of iterations</span>
<span class="kt">int</span> <span class="n">maxIterations</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>

<span class="c1">// Execute the vertex-centric iteration</span>
<span class="nc">Graph</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">Double</span><span class="o">,</span> <span class="nc">Double</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="na">runVertexCentricIteration</span><span class="o">(</span>
            <span class="k">new</span> <span class="nf">SSSPComputeFunction</span><span class="o">(),</span> <span class="k">new</span> <span class="nc">SSSPCombiner</span><span class="o">(),</span> <span class="n">maxIterations</span><span class="o">);</span>

<span class="c1">// Extract the vertices as the result</span>
<span class="nc">DataSet</span><span class="o">&lt;</span><span class="nc">Vertex</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">Double</span><span class="o">&gt;&gt;</span> <span class="n">singleSourceShortestPaths</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">getVertices</span><span class="o">();</span>


<span class="c1">// - - -  UDFs - - - //</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">SSSPComputeFunction</span> <span class="kd">extends</span> <span class="nc">ComputeFunction</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">Double</span><span class="o">,</span> <span class="nc">Double</span><span class="o">,</span> <span class="nc">Double</span><span class="o">&gt;</span> <span class="o">{</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">compute</span><span class="o">(</span><span class="nc">Vertex</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">Double</span><span class="o">&gt;</span> <span class="n">vertex</span><span class="o">,</span> <span class="nc">MessageIterator</span><span class="o">&lt;</span><span class="nc">Double</span><span class="o">&gt;</span> <span class="n">messages</span><span class="o">)</span> <span class="o">{</span>

    <span class="kt">double</span> <span class="n">minDistance</span> <span class="o">=</span> <span class="o">(</span><span class="n">vertex</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">srcId</span><span class="o">))</span> <span class="o">?</span> <span class="mi">0</span><span class="n">d</span> <span class="o">:</span> <span class="nc">Double</span><span class="o">.</span><span class="na">POSITIVE_INFINITY</span><span class="o">;</span>

    <span class="k">for</span> <span class="o">(</span><span class="nc">Double</span> <span class="n">msg</span> <span class="o">:</span> <span class="n">messages</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">minDistance</span> <span class="o">=</span> <span class="nc">Math</span><span class="o">.</span><span class="na">min</span><span class="o">(</span><span class="n">minDistance</span><span class="o">,</span> <span class="n">msg</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">minDistance</span> <span class="o">&lt;</span> <span class="n">vertex</span><span class="o">.</span><span class="na">getValue</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">setNewVertexValue</span><span class="o">(</span><span class="n">minDistance</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">Edge</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">Double</span><span class="o">&gt;</span> <span class="nl">e:</span> <span class="n">getEdges</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">sendMessageTo</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getTarget</span><span class="o">(),</span> <span class="n">minDistance</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// message combiner</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">SSSPCombiner</span> <span class="kd">extends</span> <span class="nc">MessageCombiner</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">Double</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">combineMessages</span><span class="o">(</span><span class="nc">MessageIterator</span><span class="o">&lt;</span><span class="nc">Double</span><span class="o">&gt;</span> <span class="n">messages</span><span class="o">)</span> <span class="o">{</span>

        <span class="kt">double</span> <span class="n">minMessage</span> <span class="o">=</span> <span class="nc">Double</span><span class="o">.</span><span class="na">POSITIVE_INFINITY</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">Double</span> <span class="nl">msg:</span> <span class="n">messages</span><span class="o">)</span> <span class="o">{</span>
           <span class="n">minMessage</span> <span class="o">=</span> <span class="nc">Math</span><span class="o">.</span><span class="na">min</span><span class="o">(</span><span class="n">minMessage</span><span class="o">,</span> <span class="n">msg</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">sendCombinedMessage</span><span class="o">(</span><span class="n">minMessage</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// read the input graph</span>
<span class="k">val</span> <span class="nv">graph</span><span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Double</span>, <span class="kt">Double</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>

<span class="c1">// define the maximum number of iterations</span>
<span class="k">val</span> <span class="nv">maxIterations</span> <span class="k">=</span> <span class="mi">10</span>

<span class="c1">// Execute the vertex-centric iteration</span>
<span class="k">val</span> <span class="nv">result</span> <span class="k">=</span> <span class="nv">graph</span><span class="o">.</span><span class="py">runVertexCentricIteration</span><span class="o">(</span><span class="k">new</span> <span class="nc">SSSPComputeFunction</span><span class="o">,</span> <span class="k">new</span> <span class="nc">SSSPCombiner</span><span class="o">,</span> <span class="n">maxIterations</span><span class="o">)</span>

<span class="c1">// Extract the vertices as the result</span>
<span class="k">val</span> <span class="nv">singleSourceShortestPaths</span> <span class="k">=</span> <span class="nv">result</span><span class="o">.</span><span class="py">getVertices</span>


<span class="c1">// - - -  UDFs - - - //</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">SSSPComputeFunction</span> <span class="k">extends</span> <span class="nc">ComputeFunction</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Double</span>, <span class="kt">Double</span>, <span class="kt">Double</span><span class="o">]</span> <span class="o">{</span>

    <span class="k">override</span> <span class="k">def</span> <span class="nf">compute</span><span class="o">(</span><span class="n">vertex</span><span class="k">:</span> <span class="kt">Vertex</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Double</span><span class="o">],</span> <span class="n">messages</span><span class="k">:</span> <span class="kt">MessageIterator</span><span class="o">[</span><span class="kt">Double</span><span class="o">])</span> <span class="k">=</span> <span class="o">{</span>

    <span class="k">var</span> <span class="n">minDistance</span> <span class="k">=</span> <span class="nf">if</span> <span class="o">(</span><span class="nv">vertex</span><span class="o">.</span><span class="py">getId</span><span class="o">.</span><span class="py">equals</span><span class="o">(</span><span class="n">srcId</span><span class="o">))</span> <span class="mi">0</span> <span class="k">else</span> <span class="nv">Double</span><span class="o">.</span><span class="py">MaxValue</span>

    <span class="nf">while</span> <span class="o">(</span><span class="nv">messages</span><span class="o">.</span><span class="py">hasNext</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">val</span> <span class="nv">msg</span> <span class="k">=</span> <span class="nv">messages</span><span class="o">.</span><span class="py">next</span>
        <span class="nf">if</span> <span class="o">(</span><span class="n">msg</span> <span class="o">&lt;</span> <span class="n">minDistance</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">minDistance</span> <span class="k">=</span> <span class="n">msg</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nf">if</span> <span class="o">(</span><span class="nv">vertex</span><span class="o">.</span><span class="py">getValue</span> <span class="o">&gt;</span> <span class="n">minDistance</span><span class="o">)</span> <span class="o">{</span>
        <span class="nf">setNewVertexValue</span><span class="o">(</span><span class="n">minDistance</span><span class="o">)</span>
        <span class="nf">for</span> <span class="o">(</span><span class="n">edge</span><span class="k">:</span> <span class="kt">Edge</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Double</span><span class="o">]</span> <span class="k">&lt;-</span> <span class="n">getEdges</span><span class="o">)</span> <span class="o">{</span>
            <span class="nf">sendMessageTo</span><span class="o">(</span><span class="nv">edge</span><span class="o">.</span><span class="py">getTarget</span><span class="o">,</span> <span class="nv">vertex</span><span class="o">.</span><span class="py">getValue</span> <span class="o">+</span> <span class="nv">edge</span><span class="o">.</span><span class="py">getValue</span><span class="o">)</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// message combiner</span>
<span class="k">final</span> <span class="k">class</span> <span class="nc">SSSPCombiner</span> <span class="k">extends</span> <span class="nc">MessageCombiner</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Double</span><span class="o">]</span> <span class="o">{</span>

    <span class="k">override</span> <span class="k">def</span> <span class="nf">combineMessages</span><span class="o">(</span><span class="n">messages</span><span class="k">:</span> <span class="kt">MessageIterator</span><span class="o">[</span><span class="kt">Double</span><span class="o">])</span> <span class="o">{</span>

        <span class="k">var</span> <span class="n">minDistance</span> <span class="k">=</span> <span class="nv">Double</span><span class="o">.</span><span class="py">MaxValue</span>

        <span class="nf">while</span> <span class="o">(</span><span class="nv">messages</span><span class="o">.</span><span class="py">hasNext</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">val</span> <span class="nv">msg</span> <span class="k">=</span> <span class="nv">inMessages</span><span class="o">.</span><span class="py">next</span>
          <span class="nf">if</span> <span class="o">(</span><span class="n">msg</span> <span class="o">&lt;</span> <span class="n">minDistance</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">minDistance</span> <span class="k">=</span> <span class="n">msg</span>
          <span class="o">}</span>
        <span class="o">}</span>
        <span class="nf">sendCombinedMessage</span><span class="o">(</span><span class="n">minMessage</span><span class="o">)</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

  </div>
</div>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<h2 id="configuring-a-vertex-centric-iteration">Configuring a Vertex-Centric Iteration</h2>
<p>A vertex-centric iteration can be configured using a <code class="highlighter-rouge">VertexCentricConfiguration</code> object.
Currently, the following parameters can be specified:</p>

<ul>
  <li>
    <p><strong>Name</strong>: The name for the vertex-centric iteration. The name is displayed in logs and messages
and can be specified using the <code class="highlighter-rouge">setName()</code> method.</p>
  </li>
  <li>
    <p><strong>Parallelism</strong>: The parallelism for the iteration. It can be set using the <code class="highlighter-rouge">setParallelism()</code> method.</p>
  </li>
  <li>
    <p><strong>Solution set in unmanaged memory</strong>: Defines whether the solution set is kept in managed memory (Flink’s internal way of keeping objects in serialized form) or as a simple object map. By default, the solution set runs in managed memory. This property can be set using the <code class="highlighter-rouge">setSolutionSetUnmanagedMemory()</code> method.</p>
  </li>
  <li>
    <p><strong>Aggregators</strong>: Iteration aggregators can be registered using the <code class="highlighter-rouge">registerAggregator()</code> method. An iteration aggregator combines
all aggregates globally once per superstep and makes them available in the next superstep. Registered aggregators can be accessed inside the user-defined <code class="highlighter-rouge">ComputeFunction</code>.</p>
  </li>
  <li>
    <p><strong>Broadcast Variables</strong>: DataSets can be added as <a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/#broadcast-variables">Broadcast Variables</a> to the <code class="highlighter-rouge">ComputeFunction</code>, using the <code class="highlighter-rouge">addBroadcastSet()</code> method.</p>
  </li>
</ul>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">Graph</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">Double</span><span class="o">,</span> <span class="nc">Double</span><span class="o">&gt;</span> <span class="n">graph</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// configure the iteration</span>
<span class="nc">VertexCentricConfiguration</span> <span class="n">parameters</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">VertexCentricConfiguration</span><span class="o">();</span>

<span class="c1">// set the iteration name</span>
<span class="n">parameters</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"Gelly Iteration"</span><span class="o">);</span>

<span class="c1">// set the parallelism</span>
<span class="n">parameters</span><span class="o">.</span><span class="na">setParallelism</span><span class="o">(</span><span class="mi">16</span><span class="o">);</span>

<span class="c1">// register an aggregator</span>
<span class="n">parameters</span><span class="o">.</span><span class="na">registerAggregator</span><span class="o">(</span><span class="s">"sumAggregator"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">LongSumAggregator</span><span class="o">());</span>

<span class="c1">// run the vertex-centric iteration, also passing the configuration parameters</span>
<span class="nc">Graph</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">Long</span><span class="o">,</span> <span class="nc">Double</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span>
            <span class="n">graph</span><span class="o">.</span><span class="na">runVertexCentricIteration</span><span class="o">(</span>
            <span class="k">new</span> <span class="nf">Compute</span><span class="o">(),</span> <span class="kc">null</span><span class="o">,</span> <span class="n">maxIterations</span><span class="o">,</span> <span class="n">parameters</span><span class="o">);</span>

<span class="c1">// user-defined function</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Compute</span> <span class="kd">extends</span> <span class="nc">ComputeFunction</span> <span class="o">{</span>

    <span class="nc">LongSumAggregator</span> <span class="n">aggregator</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LongSumAggregator</span><span class="o">();</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">preSuperstep</span><span class="o">()</span> <span class="o">{</span>

        <span class="c1">// retrieve the Aggregator</span>
        <span class="n">aggregator</span> <span class="o">=</span> <span class="n">getIterationAggregator</span><span class="o">(</span><span class="s">"sumAggregator"</span><span class="o">);</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">compute</span><span class="o">(</span><span class="nc">Vertex</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="n">vertex</span><span class="o">,</span> <span class="nc">MessageIterator</span> <span class="n">inMessages</span><span class="o">)</span> <span class="o">{</span>

        <span class="c1">//do some computation</span>
        <span class="nc">Long</span> <span class="n">partialValue</span> <span class="o">=</span> <span class="o">...</span>

        <span class="c1">// aggregate the partial value</span>
        <span class="n">aggregator</span><span class="o">.</span><span class="na">aggregate</span><span class="o">(</span><span class="n">partialValue</span><span class="o">);</span>

        <span class="c1">// update the vertex value</span>
        <span class="n">setNewVertexValue</span><span class="o">(...);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="nv">graph</span><span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Long</span>, <span class="kt">Double</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>

<span class="k">val</span> <span class="nv">parameters</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">VertexCentricConfiguration</span>

<span class="c1">// set the iteration name</span>
<span class="nv">parameters</span><span class="o">.</span><span class="py">setName</span><span class="o">(</span><span class="s">"Gelly Iteration"</span><span class="o">)</span>

<span class="c1">// set the parallelism</span>
<span class="nv">parameters</span><span class="o">.</span><span class="py">setParallelism</span><span class="o">(</span><span class="mi">16</span><span class="o">)</span>

<span class="c1">// register an aggregator</span>
<span class="nv">parameters</span><span class="o">.</span><span class="py">registerAggregator</span><span class="o">(</span><span class="s">"sumAggregator"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">LongSumAggregator</span><span class="o">)</span>

<span class="c1">// run the vertex-centric iteration, also passing the configuration parameters</span>
<span class="k">val</span> <span class="nv">result</span> <span class="k">=</span> <span class="nv">graph</span><span class="o">.</span><span class="py">runVertexCentricIteration</span><span class="o">(</span><span class="k">new</span> <span class="nc">Compute</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Combiner</span><span class="o">,</span> <span class="n">maxIterations</span><span class="o">,</span> <span class="n">parameters</span><span class="o">)</span>

<span class="c1">// user-defined function</span>
<span class="k">final</span> <span class="k">class</span> <span class="nc">Compute</span> <span class="k">extends</span> <span class="nc">ComputeFunction</span> <span class="o">{</span>

    <span class="k">var</span> <span class="n">aggregator</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">LongSumAggregator</span>

    <span class="k">override</span> <span class="k">def</span> <span class="nf">preSuperstep</span> <span class="o">{</span>

        <span class="c1">// retrieve the Aggregator</span>
        <span class="n">aggregator</span> <span class="k">=</span> <span class="nf">getIterationAggregator</span><span class="o">(</span><span class="s">"sumAggregator"</span><span class="o">)</span>
    <span class="o">}</span>


    <span class="k">override</span> <span class="k">def</span> <span class="nf">compute</span><span class="o">(</span><span class="n">vertex</span><span class="k">:</span> <span class="kt">Vertex</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Long</span><span class="o">],</span> <span class="n">inMessages</span><span class="k">:</span> <span class="kt">MessageIterator</span><span class="o">[</span><span class="kt">Long</span><span class="o">])</span> <span class="o">{</span>

        <span class="c1">//do some computation</span>
        <span class="k">val</span> <span class="nv">partialValue</span> <span class="k">=</span> <span class="o">...</span>

        <span class="c1">// aggregate the partial value</span>
        <span class="nv">aggregator</span><span class="o">.</span><span class="py">aggregate</span><span class="o">(</span><span class="n">partialValue</span><span class="o">)</span>

        <span class="c1">// update the vertex value</span>
        <span class="nf">setNewVertexValue</span><span class="o">(...)</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

  </div>
</div>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<h2 id="scatter-gather-iterations">Scatter-Gather Iterations</h2>
<p>The scatter-gather model, also known as “signal/collect” model, expresses computation from the perspective of a vertex in the graph. The computation proceeds in synchronized iteration steps, called supersteps. In each superstep, a vertex produces messages for other vertices and updates its value based on the messages it receives. To use scatter-gather iterations in Gelly, the user only needs to define how a vertex behaves in each superstep:</p>

<ul>
  <li><strong>Scatter</strong>:  produces the messages that a vertex will send to other vertices.</li>
  <li><strong>Gather</strong>: updates the vertex value using received messages.</li>
</ul>

<p>Gelly provides methods for scatter-gather iterations. The user only needs to implement two functions, corresponding to the scatter and gather phases. The first function is a <code class="highlighter-rouge">ScatterFunction</code>, which allows a vertex to send out messages to other vertices. Messages are received during the same superstep as they are sent. The second function is <code class="highlighter-rouge">GatherFunction</code>, which defines how a vertex will update its value based on the received messages.
These functions and the maximum number of iterations to run are given as parameters to Gelly’s <code class="highlighter-rouge">runScatterGatherIteration</code>. This method will execute the scatter-gather iteration on the input Graph and return a new Graph, with updated vertex values.</p>

<p>A scatter-gather iteration can be extended with information such as the total number of vertices, the in degree and out degree.
Additionally, the  neighborhood type (in/out/all) over which to run the scatter-gather iteration can be specified. By default, the updates from the in-neighbors are used to modify the current vertex’s state and messages are sent to out-neighbors.</p>

<p>Let us consider computing Single-Source-Shortest-Paths with scatter-gather iterations on the following graph and let vertex 1 be the source. In each superstep, each vertex sends a candidate distance message to all its neighbors. The message value is the sum of the current value of the vertex and the edge weight connecting this vertex with its neighbor. Upon receiving candidate distance messages, each vertex calculates the minimum distance and, if a shorter path has been discovered, it updates its value. If a vertex does not change its value during a superstep, then it does not produce messages for its neighbors for the next superstep. The algorithm converges when there are no value updates.</p>

<p class="text-center">
    <img alt="Scatter-gather SSSP superstep 1" width="70%" src="//ci.apache.org/projects/flink/flink-docs-release-1.12/fig/gelly-vc-sssp1.png" />
</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// read the input graph</span>
<span class="nc">Graph</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">Double</span><span class="o">,</span> <span class="nc">Double</span><span class="o">&gt;</span> <span class="n">graph</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// define the maximum number of iterations</span>
<span class="kt">int</span> <span class="n">maxIterations</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>

<span class="c1">// Execute the scatter-gather iteration</span>
<span class="nc">Graph</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">Double</span><span class="o">,</span> <span class="nc">Double</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="na">runScatterGatherIteration</span><span class="o">(</span>
			<span class="k">new</span> <span class="nf">MinDistanceMessenger</span><span class="o">(),</span> <span class="k">new</span> <span class="nc">VertexDistanceUpdater</span><span class="o">(),</span> <span class="n">maxIterations</span><span class="o">);</span>

<span class="c1">// Extract the vertices as the result</span>
<span class="nc">DataSet</span><span class="o">&lt;</span><span class="nc">Vertex</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">Double</span><span class="o">&gt;&gt;</span> <span class="n">singleSourceShortestPaths</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">getVertices</span><span class="o">();</span>


<span class="c1">// - - -  UDFs - - - //</span>

<span class="c1">// scatter: messaging</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">MinDistanceMessenger</span> <span class="kd">extends</span> <span class="nc">ScatterFunction</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">Double</span><span class="o">,</span> <span class="nc">Double</span><span class="o">,</span> <span class="nc">Double</span><span class="o">&gt;</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">sendMessages</span><span class="o">(</span><span class="nc">Vertex</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">Double</span><span class="o">&gt;</span> <span class="n">vertex</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">for</span> <span class="o">(</span><span class="nc">Edge</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">Double</span><span class="o">&gt;</span> <span class="n">edge</span> <span class="o">:</span> <span class="n">getEdges</span><span class="o">())</span> <span class="o">{</span>
			<span class="n">sendMessageTo</span><span class="o">(</span><span class="n">edge</span><span class="o">.</span><span class="na">getTarget</span><span class="o">(),</span> <span class="n">vertex</span><span class="o">.</span><span class="na">getValue</span><span class="o">()</span> <span class="o">+</span> <span class="n">edge</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="c1">// gather: vertex update</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">VertexDistanceUpdater</span> <span class="kd">extends</span> <span class="nc">GatherFunction</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">Double</span><span class="o">,</span> <span class="nc">Double</span><span class="o">&gt;</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateVertex</span><span class="o">(</span><span class="nc">Vertex</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">Double</span><span class="o">&gt;</span> <span class="n">vertex</span><span class="o">,</span> <span class="nc">MessageIterator</span><span class="o">&lt;</span><span class="nc">Double</span><span class="o">&gt;</span> <span class="n">inMessages</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">Double</span> <span class="n">minDistance</span> <span class="o">=</span> <span class="nc">Double</span><span class="o">.</span><span class="na">MAX_VALUE</span><span class="o">;</span>

		<span class="k">for</span> <span class="o">(</span><span class="kt">double</span> <span class="n">msg</span> <span class="o">:</span> <span class="n">inMessages</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">msg</span> <span class="o">&lt;</span> <span class="n">minDistance</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">minDistance</span> <span class="o">=</span> <span class="n">msg</span><span class="o">;</span>
			<span class="o">}</span>
		<span class="o">}</span>

		<span class="k">if</span> <span class="o">(</span><span class="n">vertex</span><span class="o">.</span><span class="na">getValue</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">minDistance</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">setNewVertexValue</span><span class="o">(</span><span class="n">minDistance</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// read the input graph</span>
<span class="k">val</span> <span class="nv">graph</span><span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Double</span>, <span class="kt">Double</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>

<span class="c1">// define the maximum number of iterations</span>
<span class="k">val</span> <span class="nv">maxIterations</span> <span class="k">=</span> <span class="mi">10</span>

<span class="c1">// Execute the scatter-gather iteration</span>
<span class="k">val</span> <span class="nv">result</span> <span class="k">=</span> <span class="nv">graph</span><span class="o">.</span><span class="py">runScatterGatherIteration</span><span class="o">(</span><span class="k">new</span> <span class="nc">MinDistanceMessenger</span><span class="o">,</span> <span class="k">new</span> <span class="nc">VertexDistanceUpdater</span><span class="o">,</span> <span class="n">maxIterations</span><span class="o">)</span>

<span class="c1">// Extract the vertices as the result</span>
<span class="k">val</span> <span class="nv">singleSourceShortestPaths</span> <span class="k">=</span> <span class="nv">result</span><span class="o">.</span><span class="py">getVertices</span>


<span class="c1">// - - -  UDFs - - - //</span>

<span class="c1">// messaging</span>
<span class="k">final</span> <span class="k">class</span> <span class="nc">MinDistanceMessenger</span> <span class="k">extends</span> <span class="nc">ScatterFunction</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Double</span>, <span class="kt">Double</span>, <span class="kt">Double</span><span class="o">]</span> <span class="o">{</span>

	<span class="k">override</span> <span class="k">def</span> <span class="nf">sendMessages</span><span class="o">(</span><span class="n">vertex</span><span class="k">:</span> <span class="kt">Vertex</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Double</span><span class="o">])</span> <span class="k">=</span> <span class="o">{</span>
		<span class="nf">for</span> <span class="o">(</span><span class="n">edge</span><span class="k">:</span> <span class="kt">Edge</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Double</span><span class="o">]</span> <span class="k">&lt;-</span> <span class="n">getEdges</span><span class="o">)</span> <span class="o">{</span>
			<span class="nf">sendMessageTo</span><span class="o">(</span><span class="nv">edge</span><span class="o">.</span><span class="py">getTarget</span><span class="o">,</span> <span class="nv">vertex</span><span class="o">.</span><span class="py">getValue</span> <span class="o">+</span> <span class="nv">edge</span><span class="o">.</span><span class="py">getValue</span><span class="o">)</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="c1">// vertex update</span>
<span class="k">final</span> <span class="k">class</span> <span class="nc">VertexDistanceUpdater</span> <span class="k">extends</span> <span class="nc">GatherFunction</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Double</span>, <span class="kt">Double</span><span class="o">]</span> <span class="o">{</span>

	<span class="k">override</span> <span class="k">def</span> <span class="nf">updateVertex</span><span class="o">(</span><span class="n">vertex</span><span class="k">:</span> <span class="kt">Vertex</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Double</span><span class="o">],</span> <span class="n">inMessages</span><span class="k">:</span> <span class="kt">MessageIterator</span><span class="o">[</span><span class="kt">Double</span><span class="o">])</span> <span class="k">=</span> <span class="o">{</span>
		<span class="k">var</span> <span class="n">minDistance</span> <span class="k">=</span> <span class="nv">Double</span><span class="o">.</span><span class="py">MaxValue</span>

		<span class="nf">while</span> <span class="o">(</span><span class="nv">inMessages</span><span class="o">.</span><span class="py">hasNext</span><span class="o">)</span> <span class="o">{</span>
		  <span class="k">val</span> <span class="nv">msg</span> <span class="k">=</span> <span class="nv">inMessages</span><span class="o">.</span><span class="py">next</span>
		  <span class="nf">if</span> <span class="o">(</span><span class="n">msg</span> <span class="o">&lt;</span> <span class="n">minDistance</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">minDistance</span> <span class="k">=</span> <span class="n">msg</span>
		  <span class="o">}</span>
		<span class="o">}</span>

		<span class="nf">if</span> <span class="o">(</span><span class="nv">vertex</span><span class="o">.</span><span class="py">getValue</span> <span class="o">&gt;</span> <span class="n">minDistance</span><span class="o">)</span> <span class="o">{</span>
		  <span class="nf">setNewVertexValue</span><span class="o">(</span><span class="n">minDistance</span><span class="o">)</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

  </div>
</div>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<h2 id="configuring-a-scatter-gather-iteration">Configuring a Scatter-Gather Iteration</h2>
<p>A scatter-gather iteration can be configured using a <code class="highlighter-rouge">ScatterGatherConfiguration</code> object.
Currently, the following parameters can be specified:</p>

<ul>
  <li>
    <p><strong>Name</strong>: The name for the scatter-gather iteration. The name is displayed in logs and messages
and can be specified using the <code class="highlighter-rouge">setName()</code> method.</p>
  </li>
  <li>
    <p><strong>Parallelism</strong>: The parallelism for the iteration. It can be set using the <code class="highlighter-rouge">setParallelism()</code> method.</p>
  </li>
  <li>
    <p><strong>Solution set in unmanaged memory</strong>: Defines whether the solution set is kept in managed memory (Flink’s internal way of keeping objects in serialized form) or as a simple object map. By default, the solution set runs in managed memory. This property can be set using the <code class="highlighter-rouge">setSolutionSetUnmanagedMemory()</code> method.</p>
  </li>
  <li>
    <p><strong>Aggregators</strong>: Iteration aggregators can be registered using the <code class="highlighter-rouge">registerAggregator()</code> method. An iteration aggregator combines
all aggregates globally once per superstep and makes them available in the next superstep. Registered aggregators can be accessed inside the user-defined <code class="highlighter-rouge">ScatterFunction</code> and <code class="highlighter-rouge">GatherFunction</code>.</p>
  </li>
  <li>
    <p><strong>Broadcast Variables</strong>: DataSets can be added as <a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/#broadcast-variables">Broadcast Variables</a> to the <code class="highlighter-rouge">ScatterFunction</code> and <code class="highlighter-rouge">GatherFunction</code>, using the <code class="highlighter-rouge">addBroadcastSetForUpdateFunction()</code> and <code class="highlighter-rouge">addBroadcastSetForMessagingFunction()</code> methods, respectively.</p>
  </li>
  <li>
    <p><strong>Number of Vertices</strong>: Accessing the total number of vertices within the iteration. This property can be set using the <code class="highlighter-rouge">setOptNumVertices()</code> method.
The number of vertices can then be accessed in the vertex update function and in the messaging function using the <code class="highlighter-rouge">getNumberOfVertices()</code> method. If the option is not set in the configuration, this method will return -1.</p>
  </li>
  <li>
    <p><strong>Degrees</strong>: Accessing the in/out degree for a vertex within an iteration. This property can be set using the <code class="highlighter-rouge">setOptDegrees()</code> method.
The in/out degrees can then be accessed in the vertex update function and in the messaging function, per vertex using the <code class="highlighter-rouge">getInDegree()</code> and <code class="highlighter-rouge">getOutDegree()</code> methods.
If the degrees option is not set in the configuration, these methods will return -1.</p>
  </li>
  <li>
    <p><strong>Messaging Direction</strong>: By default, a vertex sends messages to its out-neighbors and updates its value based on messages received from its in-neighbors. This configuration option allows users to change the messaging direction to either <code class="highlighter-rouge">EdgeDirection.IN</code>, <code class="highlighter-rouge">EdgeDirection.OUT</code>, <code class="highlighter-rouge">EdgeDirection.ALL</code>. The messaging direction also dictates the update direction which would be <code class="highlighter-rouge">EdgeDirection.OUT</code>, <code class="highlighter-rouge">EdgeDirection.IN</code> and <code class="highlighter-rouge">EdgeDirection.ALL</code>, respectively. This property can be set using the <code class="highlighter-rouge">setDirection()</code> method.</p>
  </li>
</ul>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">Graph</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">Double</span><span class="o">,</span> <span class="nc">Double</span><span class="o">&gt;</span> <span class="n">graph</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// configure the iteration</span>
<span class="nc">ScatterGatherConfiguration</span> <span class="n">parameters</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ScatterGatherConfiguration</span><span class="o">();</span>

<span class="c1">// set the iteration name</span>
<span class="n">parameters</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"Gelly Iteration"</span><span class="o">);</span>

<span class="c1">// set the parallelism</span>
<span class="n">parameters</span><span class="o">.</span><span class="na">setParallelism</span><span class="o">(</span><span class="mi">16</span><span class="o">);</span>

<span class="c1">// register an aggregator</span>
<span class="n">parameters</span><span class="o">.</span><span class="na">registerAggregator</span><span class="o">(</span><span class="s">"sumAggregator"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">LongSumAggregator</span><span class="o">());</span>

<span class="c1">// run the scatter-gather iteration, also passing the configuration parameters</span>
<span class="nc">Graph</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">Double</span><span class="o">,</span> <span class="nc">Double</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span>
			<span class="n">graph</span><span class="o">.</span><span class="na">runScatterGatherIteration</span><span class="o">(</span>
			<span class="k">new</span> <span class="nf">Messenger</span><span class="o">(),</span> <span class="k">new</span> <span class="nc">VertexUpdater</span><span class="o">(),</span> <span class="n">maxIterations</span><span class="o">,</span> <span class="n">parameters</span><span class="o">);</span>

<span class="c1">// user-defined functions</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Messenger</span> <span class="kd">extends</span> <span class="nc">ScatterFunction</span> <span class="o">{...}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">VertexUpdater</span> <span class="kd">extends</span> <span class="nc">GatherFunction</span> <span class="o">{</span>

	<span class="nc">LongSumAggregator</span> <span class="n">aggregator</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LongSumAggregator</span><span class="o">();</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">preSuperstep</span><span class="o">()</span> <span class="o">{</span>

		<span class="c1">// retrieve the Aggregator</span>
		<span class="n">aggregator</span> <span class="o">=</span> <span class="n">getIterationAggregator</span><span class="o">(</span><span class="s">"sumAggregator"</span><span class="o">);</span>
	<span class="o">}</span>


	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateVertex</span><span class="o">(</span><span class="nc">Vertex</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="n">vertex</span><span class="o">,</span> <span class="nc">MessageIterator</span> <span class="n">inMessages</span><span class="o">)</span> <span class="o">{</span>

		<span class="c1">//do some computation</span>
		<span class="nc">Long</span> <span class="n">partialValue</span> <span class="o">=</span> <span class="o">...</span>

		<span class="c1">// aggregate the partial value</span>
		<span class="n">aggregator</span><span class="o">.</span><span class="na">aggregate</span><span class="o">(</span><span class="n">partialValue</span><span class="o">);</span>

		<span class="c1">// update the vertex value</span>
		<span class="n">setNewVertexValue</span><span class="o">(...);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="nv">graph</span><span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Double</span>, <span class="kt">Double</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>

<span class="k">val</span> <span class="nv">parameters</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ScatterGatherConfiguration</span>

<span class="c1">// set the iteration name</span>
<span class="nv">parameters</span><span class="o">.</span><span class="py">setName</span><span class="o">(</span><span class="s">"Gelly Iteration"</span><span class="o">)</span>

<span class="c1">// set the parallelism</span>
<span class="nv">parameters</span><span class="o">.</span><span class="py">setParallelism</span><span class="o">(</span><span class="mi">16</span><span class="o">)</span>

<span class="c1">// register an aggregator</span>
<span class="nv">parameters</span><span class="o">.</span><span class="py">registerAggregator</span><span class="o">(</span><span class="s">"sumAggregator"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">LongSumAggregator</span><span class="o">)</span>

<span class="c1">// run the scatter-gather iteration, also passing the configuration parameters</span>
<span class="k">val</span> <span class="nv">result</span> <span class="k">=</span> <span class="nv">graph</span><span class="o">.</span><span class="py">runScatterGatherIteration</span><span class="o">(</span><span class="k">new</span> <span class="nc">Messenger</span><span class="o">,</span> <span class="k">new</span> <span class="nc">VertexUpdater</span><span class="o">,</span> <span class="n">maxIterations</span><span class="o">,</span> <span class="n">parameters</span><span class="o">)</span>

<span class="c1">// user-defined functions</span>
<span class="k">final</span> <span class="k">class</span> <span class="nc">Messenger</span> <span class="k">extends</span> <span class="nc">ScatterFunction</span> <span class="o">{...}</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">VertexUpdater</span> <span class="k">extends</span> <span class="nc">GatherFunction</span> <span class="o">{</span>

	<span class="k">var</span> <span class="n">aggregator</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">LongSumAggregator</span>

	<span class="k">override</span> <span class="k">def</span> <span class="nf">preSuperstep</span> <span class="o">{</span>

		<span class="c1">// retrieve the Aggregator</span>
		<span class="n">aggregator</span> <span class="k">=</span> <span class="nf">getIterationAggregator</span><span class="o">(</span><span class="s">"sumAggregator"</span><span class="o">)</span>
	<span class="o">}</span>


	<span class="k">override</span> <span class="k">def</span> <span class="nf">updateVertex</span><span class="o">(</span><span class="n">vertex</span><span class="k">:</span> <span class="kt">Vertex</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Long</span><span class="o">],</span> <span class="n">inMessages</span><span class="k">:</span> <span class="kt">MessageIterator</span><span class="o">[</span><span class="kt">Long</span><span class="o">])</span> <span class="o">{</span>

		<span class="c1">//do some computation</span>
		<span class="k">val</span> <span class="nv">partialValue</span> <span class="k">=</span> <span class="o">...</span>

		<span class="c1">// aggregate the partial value</span>
		<span class="nv">aggregator</span><span class="o">.</span><span class="py">aggregate</span><span class="o">(</span><span class="n">partialValue</span><span class="o">)</span>

		<span class="c1">// update the vertex value</span>
		<span class="nf">setNewVertexValue</span><span class="o">(...)</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

  </div>
</div>

<p>The following example illustrates the usage of the degree as well as the number of vertices options.</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">Graph</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">Double</span><span class="o">,</span> <span class="nc">Double</span><span class="o">&gt;</span> <span class="n">graph</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// configure the iteration</span>
<span class="nc">ScatterGatherConfiguration</span> <span class="n">parameters</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ScatterGatherConfiguration</span><span class="o">();</span>

<span class="c1">// set the number of vertices option to true</span>
<span class="n">parameters</span><span class="o">.</span><span class="na">setOptNumVertices</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>

<span class="c1">// set the degree option to true</span>
<span class="n">parameters</span><span class="o">.</span><span class="na">setOptDegrees</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>

<span class="c1">// run the scatter-gather iteration, also passing the configuration parameters</span>
<span class="nc">Graph</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">Double</span><span class="o">,</span> <span class="nc">Double</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span>
			<span class="n">graph</span><span class="o">.</span><span class="na">runScatterGatherIteration</span><span class="o">(</span>
			<span class="k">new</span> <span class="nf">Messenger</span><span class="o">(),</span> <span class="k">new</span> <span class="nc">VertexUpdater</span><span class="o">(),</span> <span class="n">maxIterations</span><span class="o">,</span> <span class="n">parameters</span><span class="o">);</span>

<span class="c1">// user-defined functions</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Messenger</span> <span class="kd">extends</span> <span class="nc">ScatterFunction</span> <span class="o">{</span>
	<span class="o">...</span>
	<span class="c1">// retrieve the vertex out-degree</span>
	<span class="n">outDegree</span> <span class="o">=</span> <span class="n">getOutDegree</span><span class="o">();</span>
	<span class="o">...</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">VertexUpdater</span> <span class="kd">extends</span> <span class="nc">GatherFunction</span> <span class="o">{</span>
	<span class="o">...</span>
	<span class="c1">// get the number of vertices</span>
	<span class="kt">long</span> <span class="n">numVertices</span> <span class="o">=</span> <span class="n">getNumberOfVertices</span><span class="o">();</span>
	<span class="o">...</span>
<span class="o">}</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="nv">graph</span><span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Double</span>, <span class="kt">Double</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>

<span class="c1">// configure the iteration</span>
<span class="k">val</span> <span class="nv">parameters</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ScatterGatherConfiguration</span>

<span class="c1">// set the number of vertices option to true</span>
<span class="nv">parameters</span><span class="o">.</span><span class="py">setOptNumVertices</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>

<span class="c1">// set the degree option to true</span>
<span class="nv">parameters</span><span class="o">.</span><span class="py">setOptDegrees</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>

<span class="c1">// run the scatter-gather iteration, also passing the configuration parameters</span>
<span class="k">val</span> <span class="nv">result</span> <span class="k">=</span> <span class="nv">graph</span><span class="o">.</span><span class="py">runScatterGatherIteration</span><span class="o">(</span><span class="k">new</span> <span class="nc">Messenger</span><span class="o">,</span> <span class="k">new</span> <span class="nc">VertexUpdater</span><span class="o">,</span> <span class="n">maxIterations</span><span class="o">,</span> <span class="n">parameters</span><span class="o">)</span>

<span class="c1">// user-defined functions</span>
<span class="k">final</span> <span class="k">class</span> <span class="nc">Messenger</span> <span class="k">extends</span> <span class="nc">ScatterFunction</span> <span class="o">{</span>
	<span class="o">...</span>
	<span class="c1">// retrieve the vertex out-degree</span>
	<span class="k">val</span> <span class="nv">outDegree</span> <span class="k">=</span> <span class="n">getOutDegree</span>
	<span class="o">...</span>
<span class="o">}</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">VertexUpdater</span> <span class="k">extends</span> <span class="nc">GatherFunction</span> <span class="o">{</span>
	<span class="o">...</span>
	<span class="c1">// get the number of vertices</span>
	<span class="k">val</span> <span class="nv">numVertices</span> <span class="k">=</span> <span class="n">getNumberOfVertices</span>
	<span class="o">...</span>
<span class="o">}</span></code></pre></figure>

  </div>
</div>

<p>The following example illustrates the usage of the edge direction option. Vertices update their values to contain a list of all their in-neighbors.</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">Graph</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">HashSet</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;,</span> <span class="nc">Double</span><span class="o">&gt;</span> <span class="n">graph</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// configure the iteration</span>
<span class="nc">ScatterGatherConfiguration</span> <span class="n">parameters</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ScatterGatherConfiguration</span><span class="o">();</span>

<span class="c1">// set the messaging direction</span>
<span class="n">parameters</span><span class="o">.</span><span class="na">setDirection</span><span class="o">(</span><span class="nc">EdgeDirection</span><span class="o">.</span><span class="na">IN</span><span class="o">);</span>

<span class="c1">// run the scatter-gather iteration, also passing the configuration parameters</span>
<span class="nc">DataSet</span><span class="o">&lt;</span><span class="nc">Vertex</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">HashSet</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;&gt;&gt;</span> <span class="n">result</span> <span class="o">=</span>
			<span class="n">graph</span><span class="o">.</span><span class="na">runScatterGatherIteration</span><span class="o">(</span>
			<span class="k">new</span> <span class="nf">Messenger</span><span class="o">(),</span> <span class="k">new</span> <span class="nc">VertexUpdater</span><span class="o">(),</span> <span class="n">maxIterations</span><span class="o">,</span> <span class="n">parameters</span><span class="o">)</span>
			<span class="o">.</span><span class="na">getVertices</span><span class="o">();</span>

<span class="c1">// user-defined functions</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Messenger</span> <span class="kd">extends</span> <span class="nc">GatherFunction</span> <span class="o">{...}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">VertexUpdater</span> <span class="kd">extends</span> <span class="nc">ScatterFunction</span> <span class="o">{...}</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="nv">graph</span><span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">HashSet</span><span class="o">[</span><span class="kt">Long</span><span class="o">]</span>, <span class="kt">Double</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>

<span class="c1">// configure the iteration</span>
<span class="k">val</span> <span class="nv">parameters</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ScatterGatherConfiguration</span>

<span class="c1">// set the messaging direction</span>
<span class="nv">parameters</span><span class="o">.</span><span class="py">setDirection</span><span class="o">(</span><span class="nv">EdgeDirection</span><span class="o">.</span><span class="py">IN</span><span class="o">)</span>

<span class="c1">// run the scatter-gather iteration, also passing the configuration parameters</span>
<span class="k">val</span> <span class="nv">result</span> <span class="k">=</span> <span class="nv">graph</span><span class="o">.</span><span class="py">runScatterGatherIteration</span><span class="o">(</span><span class="k">new</span> <span class="nc">Messenger</span><span class="o">,</span> <span class="k">new</span> <span class="nc">VertexUpdater</span><span class="o">,</span> <span class="n">maxIterations</span><span class="o">,</span> <span class="n">parameters</span><span class="o">)</span>
			<span class="o">.</span><span class="py">getVertices</span>

<span class="c1">// user-defined functions</span>
<span class="k">final</span> <span class="k">class</span> <span class="nc">Messenger</span> <span class="k">extends</span> <span class="nc">ScatterFunction</span> <span class="o">{...}</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">VertexUpdater</span> <span class="k">extends</span> <span class="nc">GatherFunction</span> <span class="o">{...}</span></code></pre></figure>

  </div>
</div>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<h2 id="gather-sum-apply-iterations">Gather-Sum-Apply Iterations</h2>
<p>Like in the scatter-gather model, Gather-Sum-Apply also proceeds in synchronized iterative steps, called supersteps. Each superstep consists of the following three phases:</p>

<ul>
  <li><strong>Gather</strong>: a user-defined function is invoked in parallel on the edges and neighbors of each vertex, producing a partial value.</li>
  <li><strong>Sum</strong>: the partial values produced in the Gather phase are aggregated to a single value, using a user-defined reducer.</li>
  <li><strong>Apply</strong>:  each vertex value is updated by applying a function on the current value and the aggregated value produced by the Sum phase.</li>
</ul>

<p>Let us consider computing Single-Source-Shortest-Paths with GSA on the following graph and let vertex 1 be the source. During the <code class="highlighter-rouge">Gather</code> phase, we calculate the new candidate distances, by adding each vertex value with the edge weight. In <code class="highlighter-rouge">Sum</code>, the candidate distances are grouped by vertex ID and the minimum distance is chosen. In <code class="highlighter-rouge">Apply</code>, the newly calculated distance is compared to the current vertex value and the minimum of the two is assigned as the new value of the vertex.</p>

<p class="text-center">
    <img alt="GSA SSSP superstep 1" width="70%" src="//ci.apache.org/projects/flink/flink-docs-release-1.12/fig/gelly-gsa-sssp1.png" />
</p>

<p>Notice that, if a vertex does not change its value during a superstep, it will not calculate candidate distance during the next superstep. The algorithm converges when no vertex changes value.</p>

<p>To implement this example in Gelly GSA, the user only needs to call the <code class="highlighter-rouge">runGatherSumApplyIteration</code> method on the input graph and provide the <code class="highlighter-rouge">GatherFunction</code>, <code class="highlighter-rouge">SumFunction</code> and <code class="highlighter-rouge">ApplyFunction</code> UDFs. Iteration synchronization, grouping, value updates and convergence are handled by the system:</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// read the input graph</span>
<span class="nc">Graph</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">Double</span><span class="o">,</span> <span class="nc">Double</span><span class="o">&gt;</span> <span class="n">graph</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// define the maximum number of iterations</span>
<span class="kt">int</span> <span class="n">maxIterations</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>

<span class="c1">// Execute the GSA iteration</span>
<span class="nc">Graph</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">Double</span><span class="o">,</span> <span class="nc">Double</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="na">runGatherSumApplyIteration</span><span class="o">(</span>
				<span class="k">new</span> <span class="nf">CalculateDistances</span><span class="o">(),</span> <span class="k">new</span> <span class="nc">ChooseMinDistance</span><span class="o">(),</span> <span class="k">new</span> <span class="nc">UpdateDistance</span><span class="o">(),</span> <span class="n">maxIterations</span><span class="o">);</span>

<span class="c1">// Extract the vertices as the result</span>
<span class="nc">DataSet</span><span class="o">&lt;</span><span class="nc">Vertex</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">Double</span><span class="o">&gt;&gt;</span> <span class="n">singleSourceShortestPaths</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">getVertices</span><span class="o">();</span>


<span class="c1">// - - -  UDFs - - - //</span>

<span class="c1">// Gather</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">CalculateDistances</span> <span class="kd">extends</span> <span class="nc">GatherFunction</span><span class="o">&lt;</span><span class="nc">Double</span><span class="o">,</span> <span class="nc">Double</span><span class="o">,</span> <span class="nc">Double</span><span class="o">&gt;</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="nc">Double</span> <span class="nf">gather</span><span class="o">(</span><span class="nc">Neighbor</span><span class="o">&lt;</span><span class="nc">Double</span><span class="o">,</span> <span class="nc">Double</span><span class="o">&gt;</span> <span class="n">neighbor</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">neighbor</span><span class="o">.</span><span class="na">getNeighborValue</span><span class="o">()</span> <span class="o">+</span> <span class="n">neighbor</span><span class="o">.</span><span class="na">getEdgeValue</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Sum</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">ChooseMinDistance</span> <span class="kd">extends</span> <span class="nc">SumFunction</span><span class="o">&lt;</span><span class="nc">Double</span><span class="o">,</span> <span class="nc">Double</span><span class="o">,</span> <span class="nc">Double</span><span class="o">&gt;</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="nc">Double</span> <span class="nf">sum</span><span class="o">(</span><span class="nc">Double</span> <span class="n">newValue</span><span class="o">,</span> <span class="nc">Double</span> <span class="n">currentValue</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Math</span><span class="o">.</span><span class="na">min</span><span class="o">(</span><span class="n">newValue</span><span class="o">,</span> <span class="n">currentValue</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Apply</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">UpdateDistance</span> <span class="kd">extends</span> <span class="nc">ApplyFunction</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">Double</span><span class="o">,</span> <span class="nc">Double</span><span class="o">&gt;</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">apply</span><span class="o">(</span><span class="nc">Double</span> <span class="n">newDistance</span><span class="o">,</span> <span class="nc">Double</span> <span class="n">oldDistance</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">newDistance</span> <span class="o">&lt;</span> <span class="n">oldDistance</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">setResult</span><span class="o">(</span><span class="n">newDistance</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// read the input graph</span>
<span class="k">val</span> <span class="nv">graph</span><span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Double</span>, <span class="kt">Double</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>

<span class="c1">// define the maximum number of iterations</span>
<span class="k">val</span> <span class="nv">maxIterations</span> <span class="k">=</span> <span class="mi">10</span>

<span class="c1">// Execute the GSA iteration</span>
<span class="k">val</span> <span class="nv">result</span> <span class="k">=</span> <span class="nv">graph</span><span class="o">.</span><span class="py">runGatherSumApplyIteration</span><span class="o">(</span><span class="k">new</span> <span class="nc">CalculateDistances</span><span class="o">,</span> <span class="k">new</span> <span class="nc">ChooseMinDistance</span><span class="o">,</span> <span class="k">new</span> <span class="nc">UpdateDistance</span><span class="o">,</span> <span class="n">maxIterations</span><span class="o">)</span>

<span class="c1">// Extract the vertices as the result</span>
<span class="k">val</span> <span class="nv">singleSourceShortestPaths</span> <span class="k">=</span> <span class="nv">result</span><span class="o">.</span><span class="py">getVertices</span>


<span class="c1">// - - -  UDFs - - - //</span>

<span class="c1">// Gather</span>
<span class="k">final</span> <span class="k">class</span> <span class="nc">CalculateDistances</span> <span class="k">extends</span> <span class="nc">GatherFunction</span><span class="o">[</span><span class="kt">Double</span>, <span class="kt">Double</span>, <span class="kt">Double</span><span class="o">]</span> <span class="o">{</span>

	<span class="k">override</span> <span class="k">def</span> <span class="nf">gather</span><span class="o">(</span><span class="n">neighbor</span><span class="k">:</span> <span class="kt">Neighbor</span><span class="o">[</span><span class="kt">Double</span>, <span class="kt">Double</span><span class="o">])</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="o">{</span>
		<span class="nv">neighbor</span><span class="o">.</span><span class="py">getNeighborValue</span> <span class="o">+</span> <span class="nv">neighbor</span><span class="o">.</span><span class="py">getEdgeValue</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Sum</span>
<span class="k">final</span> <span class="k">class</span> <span class="nc">ChooseMinDistance</span> <span class="k">extends</span> <span class="nc">SumFunction</span><span class="o">[</span><span class="kt">Double</span>, <span class="kt">Double</span>, <span class="kt">Double</span><span class="o">]</span> <span class="o">{</span>

	<span class="k">override</span> <span class="k">def</span> <span class="nf">sum</span><span class="o">(</span><span class="n">newValue</span><span class="k">:</span> <span class="kt">Double</span><span class="o">,</span> <span class="n">currentValue</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="o">{</span>
		<span class="nv">Math</span><span class="o">.</span><span class="py">min</span><span class="o">(</span><span class="n">newValue</span><span class="o">,</span> <span class="n">currentValue</span><span class="o">)</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Apply</span>
<span class="k">final</span> <span class="k">class</span> <span class="nc">UpdateDistance</span> <span class="k">extends</span> <span class="nc">ApplyFunction</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Double</span>, <span class="kt">Double</span><span class="o">]</span> <span class="o">{</span>

	<span class="k">override</span> <span class="k">def</span> <span class="nf">apply</span><span class="o">(</span><span class="n">newDistance</span><span class="k">:</span> <span class="kt">Double</span><span class="o">,</span> <span class="n">oldDistance</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
		<span class="nf">if</span> <span class="o">(</span><span class="n">newDistance</span> <span class="o">&lt;</span> <span class="n">oldDistance</span><span class="o">)</span> <span class="o">{</span>
			<span class="nf">setResult</span><span class="o">(</span><span class="n">newDistance</span><span class="o">)</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

  </div>
</div>

<p>Note that <code class="highlighter-rouge">gather</code> takes a <code class="highlighter-rouge">Neighbor</code> type as an argument. This is a convenience type which simply wraps a vertex with its neighboring edge.</p>

<p>For more examples of how to implement algorithms with the Gather-Sum-Apply model, check the <a href="https://github.com/apache/flink/blob/master//flink-libraries/flink-gelly/src/main/java/org/apache/flink/graph/library/GSAPageRank.java">GSAPageRank</a> and <a href="https://github.com/apache/flink/blob/master//flink-libraries/flink-gelly/src/main/java/org/apache/flink/graph/library/GSAConnectedComponents.java">GSAConnectedComponents</a> library methods of Gelly.</p>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<h2 id="configuring-a-gather-sum-apply-iteration">Configuring a Gather-Sum-Apply Iteration</h2>
<p>A GSA iteration can be configured using a <code class="highlighter-rouge">GSAConfiguration</code> object.
Currently, the following parameters can be specified:</p>

<ul>
  <li>
    <p><strong>Name</strong>: The name for the GSA iteration. The name is displayed in logs and messages and can be specified using the <code class="highlighter-rouge">setName()</code> method.</p>
  </li>
  <li>
    <p><strong>Parallelism</strong>: The parallelism for the iteration. It can be set using the <code class="highlighter-rouge">setParallelism()</code> method.</p>
  </li>
  <li>
    <p><strong>Solution set in unmanaged memory</strong>: Defines whether the solution set is kept in managed memory (Flink’s internal way of keeping objects in serialized form) or as a simple object map. By default, the solution set runs in managed memory. This property can be set using the <code class="highlighter-rouge">setSolutionSetUnmanagedMemory()</code> method.</p>
  </li>
  <li>
    <p><strong>Aggregators</strong>: Iteration aggregators can be registered using the <code class="highlighter-rouge">registerAggregator()</code> method. An iteration aggregator combines all aggregates globally once per superstep and makes them available in the next superstep. Registered aggregators can be accessed inside the user-defined <code class="highlighter-rouge">GatherFunction</code>, <code class="highlighter-rouge">SumFunction</code> and <code class="highlighter-rouge">ApplyFunction</code>.</p>
  </li>
  <li>
    <p><strong>Broadcast Variables</strong>: DataSets can be added as <a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/#broadcast-variables">Broadcast Variables</a> to the <code class="highlighter-rouge">GatherFunction</code>, <code class="highlighter-rouge">SumFunction</code> and <code class="highlighter-rouge">ApplyFunction</code>, using the methods <code class="highlighter-rouge">addBroadcastSetForGatherFunction()</code>, <code class="highlighter-rouge">addBroadcastSetForSumFunction()</code> and <code class="highlighter-rouge">addBroadcastSetForApplyFunction</code> methods, respectively.</p>
  </li>
  <li>
    <p><strong>Number of Vertices</strong>: Accessing the total number of vertices within the iteration. This property can be set using the <code class="highlighter-rouge">setOptNumVertices()</code> method.
The number of vertices can then be accessed in the gather, sum and/or apply functions by using the <code class="highlighter-rouge">getNumberOfVertices()</code> method. If the option is not set in the configuration, this method will return -1.</p>
  </li>
  <li>
    <p><strong>Neighbor Direction</strong>: By default values are gathered from the out neighbors of the Vertex. This can be modified
using the <code class="highlighter-rouge">setDirection()</code> method.</p>
  </li>
</ul>

<p>The following example illustrates the usage of the number of vertices option.</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">Graph</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">Double</span><span class="o">,</span> <span class="nc">Double</span><span class="o">&gt;</span> <span class="n">graph</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// configure the iteration</span>
<span class="nc">GSAConfiguration</span> <span class="n">parameters</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GSAConfiguration</span><span class="o">();</span>

<span class="c1">// set the number of vertices option to true</span>
<span class="n">parameters</span><span class="o">.</span><span class="na">setOptNumVertices</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>

<span class="c1">// run the gather-sum-apply iteration, also passing the configuration parameters</span>
<span class="nc">Graph</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">Long</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="na">runGatherSumApplyIteration</span><span class="o">(</span>
				<span class="k">new</span> <span class="nf">Gather</span><span class="o">(),</span> <span class="k">new</span> <span class="nc">Sum</span><span class="o">(),</span> <span class="k">new</span> <span class="nc">Apply</span><span class="o">(),</span>
			    <span class="n">maxIterations</span><span class="o">,</span> <span class="n">parameters</span><span class="o">);</span>

<span class="c1">// user-defined functions</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Gather</span> <span class="o">{</span>
	<span class="o">...</span>
	<span class="c1">// get the number of vertices</span>
	<span class="kt">long</span> <span class="n">numVertices</span> <span class="o">=</span> <span class="n">getNumberOfVertices</span><span class="o">();</span>
	<span class="o">...</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Sum</span> <span class="o">{</span>
	<span class="o">...</span>
    <span class="c1">// get the number of vertices</span>
    <span class="kt">long</span> <span class="n">numVertices</span> <span class="o">=</span> <span class="n">getNumberOfVertices</span><span class="o">();</span>
    <span class="o">...</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Apply</span> <span class="o">{</span>
	<span class="o">...</span>
    <span class="c1">// get the number of vertices</span>
    <span class="kt">long</span> <span class="n">numVertices</span> <span class="o">=</span> <span class="n">getNumberOfVertices</span><span class="o">();</span>
    <span class="o">...</span>
<span class="o">}</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="nv">graph</span><span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Double</span>, <span class="kt">Double</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>

<span class="c1">// configure the iteration</span>
<span class="k">val</span> <span class="nv">parameters</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">GSAConfiguration</span>

<span class="c1">// set the number of vertices option to true</span>
<span class="nv">parameters</span><span class="o">.</span><span class="py">setOptNumVertices</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>

<span class="c1">// run the gather-sum-apply iteration, also passing the configuration parameters</span>
<span class="k">val</span> <span class="nv">result</span> <span class="k">=</span> <span class="nv">graph</span><span class="o">.</span><span class="py">runGatherSumApplyIteration</span><span class="o">(</span><span class="k">new</span> <span class="nc">Gather</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Sum</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Apply</span><span class="o">,</span> <span class="n">maxIterations</span><span class="o">,</span> <span class="n">parameters</span><span class="o">)</span>

<span class="c1">// user-defined functions</span>
<span class="k">final</span> <span class="k">class</span> <span class="nc">Gather</span> <span class="o">{</span>
	<span class="o">...</span>
	<span class="c1">// get the number of vertices</span>
	<span class="k">val</span> <span class="nv">numVertices</span> <span class="k">=</span> <span class="n">getNumberOfVertices</span>
	<span class="o">...</span>
<span class="o">}</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">Sum</span> <span class="o">{</span>
	<span class="o">...</span>
    <span class="c1">// get the number of vertices</span>
    <span class="k">val</span> <span class="nv">numVertices</span> <span class="k">=</span> <span class="n">getNumberOfVertices</span>
    <span class="o">...</span>
<span class="o">}</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">Apply</span> <span class="o">{</span>
	<span class="o">...</span>
    <span class="c1">// get the number of vertices</span>
    <span class="k">val</span> <span class="nv">numVertices</span> <span class="k">=</span> <span class="n">getNumberOfVertices</span>
    <span class="o">...</span>
<span class="o">}</span></code></pre></figure>

  </div>
</div>

<p>The following example illustrates the usage of the edge direction option.</p>
<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">Graph</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">HashSet</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;,</span> <span class="nc">Double</span><span class="o">&gt;</span> <span class="n">graph</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// configure the iteration</span>
<span class="nc">GSAConfiguration</span> <span class="n">parameters</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GSAConfiguration</span><span class="o">();</span>

<span class="c1">// set the messaging direction</span>
<span class="n">parameters</span><span class="o">.</span><span class="na">setDirection</span><span class="o">(</span><span class="nc">EdgeDirection</span><span class="o">.</span><span class="na">IN</span><span class="o">);</span>

<span class="c1">// run the gather-sum-apply iteration, also passing the configuration parameters</span>
<span class="nc">DataSet</span><span class="o">&lt;</span><span class="nc">Vertex</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">HashSet</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;&gt;&gt;</span> <span class="n">result</span> <span class="o">=</span>
			<span class="n">graph</span><span class="o">.</span><span class="na">runGatherSumApplyIteration</span><span class="o">(</span>
			<span class="k">new</span> <span class="nf">Gather</span><span class="o">(),</span> <span class="k">new</span> <span class="nc">Sum</span><span class="o">(),</span> <span class="k">new</span> <span class="nc">Apply</span><span class="o">(),</span> <span class="n">maxIterations</span><span class="o">,</span> <span class="n">parameters</span><span class="o">)</span>
			<span class="o">.</span><span class="na">getVertices</span><span class="o">();</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="nv">graph</span><span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">HashSet</span><span class="o">[</span><span class="kt">Long</span><span class="o">]</span>, <span class="kt">Double</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>

<span class="c1">// configure the iteration</span>
<span class="k">val</span> <span class="nv">parameters</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">GSAConfiguration</span>

<span class="c1">// set the messaging direction</span>
<span class="nv">parameters</span><span class="o">.</span><span class="py">setDirection</span><span class="o">(</span><span class="nv">EdgeDirection</span><span class="o">.</span><span class="py">IN</span><span class="o">)</span>

<span class="c1">// run the gather-sum-apply iteration, also passing the configuration parameters</span>
<span class="k">val</span> <span class="nv">result</span> <span class="k">=</span> <span class="nv">graph</span><span class="o">.</span><span class="py">runGatherSumApplyIteration</span><span class="o">(</span><span class="k">new</span> <span class="nc">Gather</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Sum</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Apply</span><span class="o">,</span> <span class="n">maxIterations</span><span class="o">,</span> <span class="n">parameters</span><span class="o">)</span>
			<span class="o">.</span><span class="py">getVertices</span><span class="o">()</span></code></pre></figure>

  </div>
</div>
<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<h2 id="iteration-abstractions-comparison">Iteration Abstractions Comparison</h2>
<p>Although the three iteration abstractions in Gelly seem quite similar, understanding their differences can lead to more performant and maintainable programs.
Among the three, the vertex-centric model is the most general model and supports arbitrary computation and messaging for each vertex. In the scatter-gather model, the logic of producing messages is decoupled from the logic of updating vertex values. Thus, programs written using scatter-gather are sometimes easier to follow and maintain.
Separating the messaging phase from the vertex value update logic not only makes some programs easier to follow but might also have a positive impact on performance. Scatter-gather implementations typically have lower memory requirements, because concurrent access to the inbox (messages received) and outbox (messages to send) data structures is not required. However, this characteristic also limits expressiveness and makes some computation patterns non-intuitive. Naturally, if an algorithm requires a vertex to concurrently access its inbox and outbox, then the expression of this algorithm in scatter-gather might be problematic. Strongly Connected Components and Approximate Maximum
Weight Matching are examples of such graph algorithms. A direct consequence of this restriction is that vertices cannot generate messages and update their states in the same phase. Thus, deciding whether to propagate a message based on its content would require storing it in the vertex value, so that the gather phase has access to it, in the following iteration step. Similarly, if the vertex update logic includes computation over the values of the neighboring edges, these have to be included inside a special message passed from the scatter to the gather phase. Such workarounds often lead to higher memory requirements and non-elegant, hard to understand algorithm implementations.</p>

<p>Gather-sum-apply iterations are also quite similar to scatter-gather iterations. In fact, any algorithm which can be expressed as a GSA iteration can also be written in the scatter-gather model. The messaging phase of the scatter-gather model is equivalent to the Gather and Sum steps of GSA: Gather can be seen as the phase where the messages are produced and Sum as the phase where they are routed to the target vertex. Similarly, the value update phase corresponds to the Apply step.</p>

<p>The main difference between the two implementations is that the Gather phase of GSA parallelizes the computation over the edges, while the messaging phase distributes the computation over the vertices. Using the SSSP examples above, we see that in the first superstep of the scatter-gather case, vertices 1, 2 and 3 produce messages in parallel. Vertex 1 produces 3 messages, while vertices 2 and 3 produce one message each. In the GSA case on the other hand, the computation is parallelized over the edges: the three candidate distance values of vertex 1 are produced in parallel. Thus, if the Gather step contains “heavy” computation, it might be a better idea to use GSA and spread out the computation, instead of burdening a single vertex. Another case when parallelizing over the edges might prove to be more efficient is when the input graph is skewed (some vertices have a lot more neighbors than others).</p>

<p>Another difference between the two implementations is that the scatter-gather implementation uses a <code class="highlighter-rouge">coGroup</code> operator internally, while GSA uses a <code class="highlighter-rouge">reduce</code>. Therefore, if the function that combines neighbor values (messages) requires the whole group of values for the computation, scatter-gather should be used. If the update function is associative and commutative, then the GSA’s reducer is expected to give a more efficient implementation, as it can make use of a combiner.</p>

<p>Another thing to note is that GSA works strictly on neighborhoods, while in the vertex-centric and scatter-gather models, a vertex can send a message to any vertex, given that it knows its vertex ID, regardless of whether it is a neighbor. Finally, in Gelly’s scatter-gather implementation, one can choose the messaging direction, i.e. the direction in which updates propagate. GSA does not support this yet, so each vertex will be updated based on the values of its in-neighbors only.</p>

<p>The main differences among the Gelly iteration models are shown in the table below.</p>

<table class="table table-bordered">
  <thead>
    <tr>
      <th class="text-left" style="width: 25%">Iteration Model</th>
      <th class="text-center">Update Function</th>
      <th class="text-center">Update Logic</th>
      <th class="text-center">Communication Scope</th>
      <th class="text-center">Communication Logic</th>
    </tr>
  </thead>
  <tbody>
 <tr>
  <td>Vertex-Centric</td>
  <td>arbitrary</td>
  <td>arbitrary</td>
  <td>any vertex</td>
  <td>arbitrary</td>
</tr>
<tr>
  <td>Scatter-Gather</td>
  <td>arbitrary</td>
  <td>based on received messages</td>
  <td>any vertex</td>
  <td>based on vertex state</td>
</tr>
<tr>
  <td>Gather-Sum-Apply</td>
  <td>associative and commutative</td>
  <td>based on neighbors' values</td>
  <td>neighborhood</td>
  <td>based on vertex state</td>
</tr>
</tbody>
</table>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>



<div class="footer">
  <a href="https://cwiki.apache.org/confluence/display/FLINK/Flink+Translation+Specifications" target="_blank">
    
      想参与贡献翻译？
    
  </a>
</div>


        </div>
      </div>
    </div><!-- /.container -->

    <!-- default code tab -->
    <script>var defaultCodeTab = "";</script>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/js/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.1.0/anchor.min.js"></script>
    <script src="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/js/flink.js"></script>

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-52545728-1', 'auto');
      ga('send', 'pageview');
    </script>

    <!-- Disqus -->
    
  </body>
</html>
