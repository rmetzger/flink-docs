<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Apache Flink 1.12 Documentation: Custom Serialization for Managed State</title>
    <link rel="shortcut icon" href="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/favicon.ico" type="image/x-icon">
    <link rel="icon" href="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/favicon.ico" type="image/x-icon">
    <link rel="canonical" href="//ci.apache.org/projects/flink/flink-docs-stable/zh/dev/stream/state/custom_serialization.html">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/css/flink.css">
    <link rel="stylesheet" href="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/css/syntax.css">
    <link rel="stylesheet" href="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/css/codetabs.css">
    <link rel="stylesheet" href="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/font-awesome/css/font-awesome.min.css">
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    

    <!-- Main content. -->
    <div class="container">
      
      <div class="row">
        <div class="col-lg-3" id="sidenavcol">
          <div class="sidenav-logo">
  <p><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/"><img class="bottom" alt="Apache Flink" src="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/img/navbar-brand-logo.jpg"></a> v1.12</p>
</div>
<ul id="sidenav">
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/"><i class="fa fa-home title" aria-hidden="true"></i> Home</a></li><hr class="section-break"></hr>
<li><a href="#collapse-2" data-toggle="collapse"><i class="fa fa-rocket title appetizer" aria-hidden="true"></i> Try Flink<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-2"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/try-flink/local_installation.html">本地模式安装</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/try-flink/datastream_api.html">基于 DataStream API 实现欺诈检测</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/try-flink/table_api.html">基于 Table API 实现实时报表</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/try-flink/flink-operations-playground.html">Flink 操作场景</a></li>
</ul></div></li>
<li><a href="#collapse-8" data-toggle="collapse"><i class="fa fa-hand-paper-o title appetizer" aria-hidden="true"></i> 实践练习<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-8"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/learn-flink/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/learn-flink/datastream_api.html">DataStream API 简介</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/learn-flink/etl.html">数据管道 & ETL</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/learn-flink/streaming_analytics.html">流式分析</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/learn-flink/event_driven.html">事件驱动应用</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/learn-flink/fault_tolerance.html">容错处理</a></li>
</ul></div></li>
<li><a href="#collapse-15" data-toggle="collapse"><i class="fa fa-map-o title appetizer" aria-hidden="true"></i> 概念透析<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-15"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/concepts/index.html">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/concepts/stateful-stream-processing.html">有状态流处理</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/concepts/timely-stream-processing.html">及时流处理</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/concepts/flink-architecture.html">Flink 架构</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/concepts/glossary.html">词汇表</a></li>
</ul></div></li><hr class="section-break"></hr>
<li><a href="#collapse-21" data-toggle="collapse"class="active"><i class="fa fa-code title maindish" aria-hidden="true"></i> 应用开发</a><div class="collapse in" id="collapse-21"><ul>
<li><a href="#collapse-22" data-toggle="collapse"class="active">DataStream API</a><div class="collapse in" id="collapse-22"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/datastream_api.html">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/datastream_execution_mode.html">Execution Mode (Batch/Streaming)</a></li>
<li><a href="#collapse-24" data-toggle="collapse">事件时间<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-24"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/event_time.html">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/event_timestamps_watermarks.html">生成 Watermark</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/event_timestamp_extractors.html">内置 Watermark 生成器</a></li>
</ul></div></li>
<li><a href="#collapse-28" data-toggle="collapse"class="active">状态与容错</a><div class="collapse in" id="collapse-28"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/state.html">Working with State</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/broadcast_state.html">Broadcast State 模式</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/checkpointing.html">Checkpointing</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/queryable_state.html">Queryable State</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/state_backends.html">State Backends</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/schema_evolution.html">状态数据结构升级</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/custom_serialization.html" class="active">自定义状态序列化</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/user_defined_functions.html">用户自定义 Functions</a></li>
<li><a href="#collapse-38" data-toggle="collapse">算子<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-38"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/operators/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/operators/windows.html">窗口</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/operators/joining.html">Joining</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/operators/process_function.html">Process Function</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/operators/asyncio.html">异步 I/O</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/sources.html">Data Sources</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/side_output.html">旁路输出</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/application_parameters.html">Handling Application Parameters</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/testing.html">测试</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/experimental.html">实验功能</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/scala_api_extensions.html">Scala API Extensions</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/java_lambdas.html">Java Lambda 表达式</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/project-configuration.html">Project Configuration</a></li>
</ul></div></li>
<li><a href="#collapse-53" data-toggle="collapse">DataSet API<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-53"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/dataset_transformations.html">Transformations</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/iterations.html">迭代</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/zip_elements_guide.html">Zipping Elements</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/hadoop_compatibility.html">Hadoop 兼容</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/local_execution.html">本地执行</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/cluster_execution.html">集群执行</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/examples.html">Batch 示例</a></li>
</ul></div></li>
<li><a href="#collapse-62" data-toggle="collapse">Table API & SQL<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-62"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/common.html">概念与通用 API</a></li>
<li><a href="#collapse-64" data-toggle="collapse">流式概念<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-64"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/streaming/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/streaming/dynamic_tables.html">动态表 (Dynamic Table)</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/streaming/time_attributes.html">时间属性</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/streaming/joins.html">流上的 Join</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/streaming/temporal_tables.html">时态表（Temporal Tables）</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/streaming/match_recognize.html">模式检测</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/streaming/query_configuration.html">Query Configuration</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/types.html">数据类型</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/tableApi.html">Table API</a></li>
<li><a href="#collapse-74" data-toggle="collapse">SQL<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-74"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/queries.html">查询语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/create.html">CREATE 语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/drop.html">DROP 语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/alter.html">ALTER 语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/insert.html">INSERT 语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/hints.html">SQL Hints</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/describe.html">DESCRIBE 语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/explain.html">EXPLAIN 语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/use.html">USE 语句</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sql/show.html">SHOW 语句</a></li>
</ul></div></li>
<li><a href="#collapse-86" data-toggle="collapse">函数<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-86"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/functions/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/functions/systemFunctions.html">系统（内置）函数</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/functions/udfs.html">自定义函数</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/modules.html">模块</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/catalogs.html">Catalogs</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sqlClient.html">SQL 客户端</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/config.html">配置</a></li>
<li><a href="#collapse-94" data-toggle="collapse">Performance Tuning<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-94"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/tuning/streaming_aggregation_optimization.html">流式聚合</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/sourceSinks.html">User-defined Sources & Sinks</a></li>
</ul></div></li>
<li><a href="#collapse-99" data-toggle="collapse">Python API<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-99"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/installation.html">环境安装</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table_api_tutorial.html">Table API 教程</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/datastream_tutorial.html">DataStream API 教程</a></li>
<li><a href="#collapse-103" data-toggle="collapse">Table API用户指南<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-103"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/intro_to_table_api.html">Python Table API 简介</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/table_environment.html">TableEnvironment</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/operations.html">Operations</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/python_types.html">数据类型</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/built_in_functions.html">系统（内置）函数</a></li>
<li><a href="#collapse-109" data-toggle="collapse">自定义函数<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-109"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/udfs/python_udfs.html">普通自定义函数（UDF）</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/udfs/vectorized_python_udfs.html">向量化自定义函数</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/conversion_of_pandas.html">PyFlink Table 和 Pandas DataFrame 互转</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/dependency_management.html">依赖管理</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/sql.html">SQL</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/catalogs.html">Catalogs</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/metrics.html">指标</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/python_table_api_connectors.html">连接器</a></li>
</ul></div></li>
<li><a href="#collapse-120" data-toggle="collapse">DataStream API用户指南<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-120"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/datastream-api-users-guide/data_types.html">数据类型</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/datastream-api-users-guide/operators.html">算子</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/datastream-api-users-guide/dependency_management.html">依赖管理</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/python_config.html">配置</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/environment_variables.html">环境变量</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/faq.html">常见问题</a></li>
</ul></div></li>
<li><a href="#collapse-129" data-toggle="collapse">数据类型以及序列化<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-129"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/types_serialization.html">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/custom_serializers.html">自定义序列化器</a></li>
</ul></div></li>
<li><a href="#collapse-132" data-toggle="collapse">管理执行<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-132"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/execution_configuration.html">执行配置</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/packaging.html">程序打包</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/parallel.html">并行执行</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/execution_plans.html">执行计划</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/task_failure_recovery.html">Task 故障恢复</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/migration.html">API 迁移指南</a></li>
</ul></div></li>
<li><a href="#collapse-141" data-toggle="collapse"><i class="fa fa-book title maindish" aria-hidden="true"></i> Libraries<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-141"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/cep.html">事件处理 (CEP)</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/state_processor_api.html">State Processor API</a></li>
<li><a href="#collapse-144" data-toggle="collapse">图计算: Gelly<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-144"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/graph_api.html">Graph API</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/iterative_graph_processing.html">Iterative Graph Processing</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/library_methods.html">Library Methods</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/graph_algorithms.html">Graph Algorithms</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/graph_generators.html">Graph Generators</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/libs/gelly/bipartite_graph.html">Bipartite Graph</a></li>
</ul></div></li>
</ul></div></li>
<li><a href="#collapse-153" data-toggle="collapse"><i class="fa fa-random title maindish" aria-hidden="true"></i> Connectors<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-153"><ul>
<li><a href="#collapse-154" data-toggle="collapse">DataStream Connectors<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-154"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/guarantees.html">容错保证</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/kafka.html">Kafka</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/cassandra.html">Cassandra</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/kinesis.html">Kinesis</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/elasticsearch.html">Elasticsearch</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/file_sink.html">File Sink</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/streamfile_sink.html">Streaming File Sink</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/rabbitmq.html">RabbitMQ</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/nifi.html">NiFi</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/pubsub.html">Google Cloud PubSub</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/twitter.html">Twitter</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/jdbc.html">JDBC</a></li>
</ul></div></li>
<li><a href="#collapse-168" data-toggle="collapse">Table & SQL Connectors<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-168"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/">概览</a></li>
<li><a href="#collapse-169" data-toggle="collapse">Formats<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-169"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/csv.html">CSV</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/json.html">JSON</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/avro-confluent.html">Confluent Avro</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/avro.html">Avro</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/debezium.html">Debezium</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/canal.html">Canal</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/maxwell.html">Maxwell</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/parquet.html">Parquet</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/orc.html">Orc</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/formats/raw.html">Raw</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/kafka.html">Kafka</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/upsert-kafka.html">Upsert Kafka</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/kinesis.html">Kinesis</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/jdbc.html">JDBC</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/elasticsearch.html">Elasticsearch</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/filesystem.html">FileSystem</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/hbase.html">HBase</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/datagen.html">DataGen</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/print.html">Print</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/blackhole.html">BlackHole</a></li>
<li><a href="#collapse-191" data-toggle="collapse">Hive<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-191"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/hive/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/hive/hive_catalog.html">Hive Catalog</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/hive/hive_dialect.html">Hive 方言</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/hive/hive_read_write.html">Hive Read & Write</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/hive/hive_functions.html">Hive 函数</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/table/connectors/downloads.html">下载</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/connectors.html">DataSet Connectors</a></li>
</ul></div></li>
<li><a href="#collapse-201" data-toggle="collapse"><i class="fa fa-sliders title maindish" aria-hidden="true"></i> Deployment<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-201"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/">概览</a></li>
<li><a href="#collapse-202" data-toggle="collapse">Resource Providers<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-202"><ul>
<li><a href="#collapse-203" data-toggle="collapse">Standalone<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-203"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/resource-providers/standalone/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/resource-providers/standalone/local.html">本地集群</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/resource-providers/standalone/docker.html">Docker</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/resource-providers/standalone/kubernetes.html">Kubernetes</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/resource-providers/native_kubernetes.html">Native Kubernetes</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/resource-providers/yarn.html">YARN</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/resource-providers/mesos.html">Mesos</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/config.html">配置参数</a></li>
<li><a href="#collapse-213" data-toggle="collapse">内存配置<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-213"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_setup.html">配置 Flink 进程的内存</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_setup_tm.html">配置 TaskManager 内存</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_setup_jobmanager.html">配置 JobManager 内存</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_tuning.html">调优指南</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_trouble.html">常见问题</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_migration.html">升级指南</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/cli.html">Command-Line Interface</a></li>
<li><a href="#collapse-222" data-toggle="collapse">文件系统<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-222"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/filesystems/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/filesystems/common.html">通用配置</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/filesystems/s3.html">Amazon S3</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/filesystems/oss.html">阿里云 OSS</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/filesystems/azure.html">Azure Blob 存储</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/filesystems/plugins.html">Plugins</a></li>
</ul></div></li>
<li><a href="#collapse-229" data-toggle="collapse">High Availability (HA)<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-229"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/ha/">概览</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/ha/zookeeper_ha.html">ZooKeeper HA Services</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/ha/kubernetes_ha.html">Kubernetes HA Services</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/metric_reporters.html">Metric Reporters</a></li>
<li><a href="#collapse-234" data-toggle="collapse">Security<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-234"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/security/security-ssl.html">SSL 设置</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/security/security-kerberos.html">Kerberos</a></li>
</ul></div></li>
<li><a href="#collapse-238" data-toggle="collapse">REPLs<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-238"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/repls/python_shell.html">Python REPL</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/repls/scala_shell.html">Scala REPL</a></li>
</ul></div></li>
<li><a href="#collapse-242" data-toggle="collapse">Advanced<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-242"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/advanced/external_resources.html">扩展资源</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/advanced/historyserver.html">History Server</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/advanced/logging.html">日志</a></li>
</ul></div></li>
</ul></div></li>
<li><a href="#collapse-248" data-toggle="collapse"><i class="fa fa-cogs title maindish" aria-hidden="true"></i> Operations<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-248"><ul>
<li><a href="#collapse-249" data-toggle="collapse">状态与容错<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-249"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/state/checkpoints.html">Checkpoints</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/state/savepoints.html">Savepoints</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/state/state_backends.html">State Backends</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/state/large_state_tuning.html">大状态与 Checkpoint 调优</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/metrics.html">指标</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/rest_api.html">REST API</a></li>
<li><a href="#collapse-257" data-toggle="collapse">Debugging<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-257"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/debugging/debugging_event_time.html">调试窗口与事件时间</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/debugging/debugging_classloading.html">调试类加载</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/debugging/application_profiling.html">应用程序分析</a></li>
</ul></div></li>
<li><a href="#collapse-262" data-toggle="collapse">Monitoring<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-262"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/monitoring/checkpoint_monitoring.html">监控 Checkpoint</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/monitoring/back_pressure.html">监控反压</a></li>
</ul></div></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/upgrading.html">升级应用程序和 Flink 版本</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/production_ready.html">生产就绪情况核对清单</a></li>
</ul></div></li><hr class="section-break"></hr>
<li><a href="#collapse-269" data-toggle="collapse"><i class="fa fa-cogs title dessert" aria-hidden="true"></i> Flink 开发<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-269"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/flinkDev/ide_setup.html">导入 Flink 到 IDE 中</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/flinkDev/building.html">从源码构建 Flink</a></li>
</ul></div></li>
<li><a href="#collapse-273" data-toggle="collapse"><i class="fa fa-book title dessert" aria-hidden="true"></i> 内幕<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-273"><ul>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/internals/job_scheduling.html">作业调度</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/internals/task_lifecycle.html">Task 生命周期</a></li>
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/internals/filesystems.html">文件系统</a></li>
</ul></div></li>
  <li class="divider"></li>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/api/java"><i class="fa fa-external-link title" aria-hidden="true"></i> Javadocs</a></li>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/api/scala/index.html#org.apache.flink.api.scala.package"><i class="fa fa-external-link title" aria-hidden="true"></i> Scaladocs</a></li>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/api/python"><i class="fa fa-external-link title" aria-hidden="true"></i> Pythondocs</a></li>
  <li><a href="http://flink.apache.org"><i class="fa fa-external-link title" aria-hidden="true"></i> Project Page</a></li>
</ul>

<div class="sidenav-search-box">
  <form class="navbar-form" role="search" action="//ci.apache.org/projects/flink/flink-docs-release-1.12/search-results.html">
    <div class="form-group">
      <input type="text" class="form-control" size="16px" name="q" placeholder="Search">
    </div>
    <button type="submit" class="btn btn-default">Go</button>
  </form>
</div>

<div class="sidenav-versions">
  <div class="dropdown">
    <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">选择文档版本<span class="caret"></span></button>
    <ul class="dropdown-menu">
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.11">v1.11</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.10">v1.10</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.9">v1.9</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.8">v1.8</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.7">v1.7</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.6">v1.6</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.5">v1.5</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.4">v1.4</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.3">v1.3</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.2">v1.2</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.1">v1.1</a></li>
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.0">v1.0</a></li>
    </ul>
  </div>
</div>

<div class="sidenav-languages"><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/dev/stream/state/custom_serialization.html">
      <button type="submit" class="btn btn-default">English</button>
    </a>
</div>

        </div>
        <div class="col-lg-9 content" id="contentcol">

          

<ol class="breadcrumb">
  
    <li><i class="fa fa-code title maindish" aria-hidden="true"></i> 应用开发</li>
  
    <li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/datastream_api.html">DataStream API</a></li>
  
    <li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/state/">状态与容错</a></li>
  
    <li class="active">自定义状态序列化</li>
</ol>

<h1>Custom Serialization for Managed State</h1>




<ul id="markdown-toc">
  <li><a href="#using-custom-state-serializers" id="markdown-toc-using-custom-state-serializers">Using custom state serializers</a></li>
  <li><a href="#state-serializers-and-schema-evolution" id="markdown-toc-state-serializers-and-schema-evolution">State serializers and schema evolution</a>    <ul>
      <li><a href="#the-typeserializersnapshot-abstraction" id="markdown-toc-the-typeserializersnapshot-abstraction">The <code class="highlighter-rouge">TypeSerializerSnapshot</code> abstraction</a></li>
      <li><a href="#how-flink-interacts-with-the-typeserializer-and-typeserializersnapshot-abstractions" id="markdown-toc-how-flink-interacts-with-the-typeserializer-and-typeserializersnapshot-abstractions">How Flink interacts with the <code class="highlighter-rouge">TypeSerializer</code> and <code class="highlighter-rouge">TypeSerializerSnapshot</code> abstractions</a></li>
    </ul>
  </li>
  <li><a href="#predefined-convenient-typeserializersnapshot-classes" id="markdown-toc-predefined-convenient-typeserializersnapshot-classes">Predefined convenient <code class="highlighter-rouge">TypeSerializerSnapshot</code> classes</a>    <ul>
      <li><a href="#implementing-a-simpletypeserializersnapshot" id="markdown-toc-implementing-a-simpletypeserializersnapshot">Implementing a <code class="highlighter-rouge">SimpleTypeSerializerSnapshot</code></a></li>
      <li><a href="#implementing-a-compositetypeserializersnapshot" id="markdown-toc-implementing-a-compositetypeserializersnapshot">Implementing a <code class="highlighter-rouge">CompositeTypeSerializerSnapshot</code></a></li>
    </ul>
  </li>
  <li><a href="#implementation-notes-and-best-practices" id="markdown-toc-implementation-notes-and-best-practices">Implementation notes and best practices</a></li>
  <li><a href="#migrating-from-deprecated-serializer-snapshot-apis-before-flink-17" id="markdown-toc-migrating-from-deprecated-serializer-snapshot-apis-before-flink-17">Migrating from deprecated serializer snapshot APIs before Flink 1.7</a></li>
</ul>

<p>This page is targeted as a guideline for users who require the use of custom serialization for their state, covering
how to provide a custom state serializer as well as guidelines and best practices for implementing serializers that allow
state schema evolution.</p>

<p>If you’re simply using Flink’s own serializers, this page is irrelevant and can be ignored.</p>

<h2 id="using-custom-state-serializers">Using custom state serializers</h2>

<p>When registering a managed operator or keyed state, a <code class="highlighter-rouge">StateDescriptor</code> is required
to specify the state’s name, as well as information about the type of the state. The type information is used by Flink’s
<a href="../../types_serialization.html">type serialization framework</a> to create appropriate serializers for the state.</p>

<p>It is also possible to completely bypass this and let Flink use your own custom serializer to serialize managed states,
simply by directly instantiating the <code class="highlighter-rouge">StateDescriptor</code> with your own <code class="highlighter-rouge">TypeSerializer</code> implementation:</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomTypeSerializer</span> <span class="kd">extends</span> <span class="nc">TypeSerializer</span><span class="o">&lt;</span><span class="nc">Tuple2</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;&gt;</span> <span class="o">{...};</span>

<span class="nc">ListStateDescriptor</span><span class="o">&lt;</span><span class="nc">Tuple2</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;&gt;</span> <span class="n">descriptor</span> <span class="o">=</span>
    <span class="k">new</span> <span class="nc">ListStateDescriptor</span><span class="o">&lt;&gt;(</span>
        <span class="s">"state-name"</span><span class="o">,</span>
        <span class="k">new</span> <span class="nf">CustomTypeSerializer</span><span class="o">());</span>

<span class="n">checkpointedState</span> <span class="o">=</span> <span class="n">getRuntimeContext</span><span class="o">().</span><span class="na">getListState</span><span class="o">(</span><span class="n">descriptor</span><span class="o">);</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">class</span> <span class="nc">CustomTypeSerializer</span> <span class="k">extends</span> <span class="nc">TypeSerializer</span><span class="o">[(</span><span class="kt">String</span>, <span class="kt">Integer</span><span class="o">)]</span> <span class="o">{...}</span>

<span class="k">val</span> <span class="nv">descriptor</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ListStateDescriptor</span><span class="o">[(</span><span class="kt">String</span>, <span class="kt">Integer</span><span class="o">)](</span>
    <span class="s">"state-name"</span><span class="o">,</span>
    <span class="k">new</span> <span class="nc">CustomTypeSerializer</span><span class="o">)</span>
<span class="o">)</span>

<span class="n">checkpointedState</span> <span class="k">=</span> <span class="nv">getRuntimeContext</span><span class="o">.</span><span class="py">getListState</span><span class="o">(</span><span class="n">descriptor</span><span class="o">)</span></code></pre></figure>

  </div>
</div>

<h2 id="state-serializers-and-schema-evolution">State serializers and schema evolution</h2>

<p>This section explains the user-facing abstractions related to state serialization and schema evolution, and necessary
internal details about how Flink interacts with these abstractions.</p>

<p>When restoring from savepoints, Flink allows changing the serializers used to read and write previously registered state,
so that users are not locked in to any specific serialization schema. When state is restored, a new serializer will be
registered for the state (i.e., the serializer that comes with the <code class="highlighter-rouge">StateDescriptor</code> used to access the state in the
restored job). This new serializer may have a different schema than that of the previous serializer. Therefore, when
implementing state serializers, besides the basic logic of reading / writing data, another important thing to keep in
mind is how the serialization schema can be changed in the future.</p>

<p>When speaking of <em>schema</em>, in this context the term is interchangeable between referring to the <em>data model</em> of a state
type and the <em>serialized binary format</em> of a state type. The schema, generally speaking, can change for a few cases:</p>

<ol>
  <li>Data schema of the state type has evolved, i.e. adding or removing a field from a POJO that is used as state.</li>
  <li>Generally speaking, after a change to the data schema, the serialization format of the serializer will need to be upgraded.</li>
  <li>Configuration of the serializer has changed.</li>
</ol>

<p>In order for the new execution to have information about the <em>written schema</em> of state and detect whether or not the
schema has changed, upon taking a savepoint of an operator’s state, a <em>snapshot</em> of the state serializer needs to be
written along with the state bytes. This is abstracted a <code class="highlighter-rouge">TypeSerializerSnapshot</code>, explained in the next subsection.</p>

<h3 id="the-typeserializersnapshot-abstraction">The <code class="highlighter-rouge">TypeSerializerSnapshot</code> abstraction</h3>

<div data-lang="java">

  <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TypeSerializerSnapshot</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="nf">getCurrentVersion</span><span class="o">();</span>
    <span class="kt">void</span> <span class="nf">writeSnapshot</span><span class="o">(</span><span class="nc">DataOuputView</span> <span class="n">out</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">;</span>
    <span class="kt">void</span> <span class="nf">readSnapshot</span><span class="o">(</span><span class="kt">int</span> <span class="n">readVersion</span><span class="o">,</span> <span class="nc">DataInputView</span> <span class="n">in</span><span class="o">,</span> <span class="nc">ClassLoader</span> <span class="n">userCodeClassLoader</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">;</span>
    <span class="nc">TypeSerializerSchemaCompatibility</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">resolveSchemaCompatibility</span><span class="o">(</span><span class="nc">TypeSerializer</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">newSerializer</span><span class="o">);</span>
    <span class="nc">TypeSerializer</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">restoreSerializer</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure>

</div>

<div data-lang="java">

  <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">TypeSerializer</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>    
    
    <span class="c1">// ...</span>
    
    <span class="kd">public</span> <span class="kd">abstract</span> <span class="nc">TypeSerializerSnapshot</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">snapshotConfiguration</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure>

</div>

<p>A serializer’s <code class="highlighter-rouge">TypeSerializerSnapshot</code> is a point-in-time information that serves as the single source of truth about
the state serializer’s write schema, as well as any additional information mandatory to restore a serializer that
would be identical to the given point-in-time. The logic about what should be written and read at restore time
as the serializer snapshot is defined in the <code class="highlighter-rouge">writeSnapshot</code> and <code class="highlighter-rouge">readSnapshot</code> methods.</p>

<p>Note that the snapshot’s own write schema may also need to change over time (e.g. when you wish to add more information
about the serializer to the snapshot). To facilitate this, snapshots are versioned, with the current version
number defined in the <code class="highlighter-rouge">getCurrentVersion</code> method. On restore, when the serializer snapshot is read from savepoints,
the version of the schema in which the snapshot was written in will be provided to the <code class="highlighter-rouge">readSnapshot</code> method so that
the read implementation can handle different versions.</p>

<p>At restore time, the logic that detects whether or not the new serializer’s schema has changed should be implemented in
the <code class="highlighter-rouge">resolveSchemaCompatibility</code> method. When previous registered state is registered again with new serializers in the
restored execution of an operator, the new serializer is provided to the previous serializer’s snapshot via this method.
This method returns a <code class="highlighter-rouge">TypeSerializerSchemaCompatibility</code> representing the result of the compatibility resolution,
which can be one of the following:</p>

<ol>
  <li><strong><code class="highlighter-rouge">TypeSerializerSchemaCompatibility.compatibleAsIs()</code></strong>: this result signals that the new serializer is compatible,
 meaning that the new serializer has identical schema with the previous serializer. It is possible that the new
 serializer has been reconfigured in the <code class="highlighter-rouge">resolveSchemaCompatibility</code> method so that it is compatible.</li>
  <li><strong><code class="highlighter-rouge">TypeSerializerSchemaCompatibility.compatibleAfterMigration()</code></strong>: this result signals that the new serializer has a
 different serialization schema, and it is possible to migrate from the old schema by using the previous serializer
 (which recognizes the old schema) to read bytes into state objects, and then rewriting the object back to bytes with
 the new serializer (which recognizes the new schema).</li>
  <li><strong><code class="highlighter-rouge">TypeSerializerSchemaCompatibility.incompatible()</code></strong>: this result signals that the new serializer has a
 different serialization schema, but it is not possible to migrate from the old schema.</li>
</ol>

<p>The last bit of detail is how the previous serializer is obtained in the case that migration is required.
Another important role of a serializer’s <code class="highlighter-rouge">TypeSerializerSnapshot</code> is that it serves as a factory to restore
the previous serializer. More specifically, the <code class="highlighter-rouge">TypeSerializerSnapshot</code> should implement the <code class="highlighter-rouge">restoreSerializer</code> method
to instantiate a serializer instance that recognizes the previous serializer’s schema and configuration, and can therefore
safely read data written by the previous serializer.</p>

<h3 id="how-flink-interacts-with-the-typeserializer-and-typeserializersnapshot-abstractions">How Flink interacts with the <code class="highlighter-rouge">TypeSerializer</code> and <code class="highlighter-rouge">TypeSerializerSnapshot</code> abstractions</h3>

<p>To wrap up, this section concludes how Flink, or more specifically the state backends, interact with the
abstractions. The interaction is slightly different depending on the state backend, but this is orthogonal
to the implementation of state serializers and their serializer snapshots.</p>

<h4 id="off-heap-state-backends-eg-rocksdbstatebackend">Off-heap state backends (e.g. <code class="highlighter-rouge">RocksDBStateBackend</code>)</h4>

<ol>
  <li><strong>Register new state with a state serializer that has schema <em>A</em></strong>
    <ul>
      <li>the registered <code class="highlighter-rouge">TypeSerializer</code> for the state is used to read / write state on every state access.</li>
      <li>State is written in schema <em>A</em>.</li>
    </ul>
  </li>
  <li><strong>Take a savepoint</strong>
    <ul>
      <li>The serializer snapshot is extracted via the <code class="highlighter-rouge">TypeSerializer#snapshotConfiguration</code> method.</li>
      <li>The serializer snapshot is written to the savepoint, as well as the already-serialized state bytes (with schema <em>A</em>).</li>
    </ul>
  </li>
  <li><strong>Restored execution re-accesses restored state bytes with new state serializer that has schema <em>B</em></strong>
    <ul>
      <li>The previous state serializer’s snapshot is restored.</li>
      <li>State bytes are not deserialized on restore, only loaded back to the state backends (therefore, still in schema <em>A</em>).</li>
      <li>Upon receiving the new serializer, it is provided to the restored previous serializer’s snapshot via the
  <code class="highlighter-rouge">TypeSerializer#resolveSchemaCompatibility</code> to check for schema compatibility.</li>
    </ul>
  </li>
  <li><strong>Migrate state bytes in backend from schema <em>A</em> to schema <em>B</em></strong>
    <ul>
      <li>If the compatibility resolution reflects that the schema has changed and migration is possible, schema migration is 
  performed. The previous state serializer which recognizes schema <em>A</em> will be obtained from the serializer snapshot, via
   <code class="highlighter-rouge">TypeSerializerSnapshot#restoreSerializer()</code>, and is used to deserialize state bytes to objects, which in turn
   are re-written again with the new serializer, which recognizes schema <em>B</em> to complete the migration. All entries
   of the accessed state is migrated all-together before processing continues.</li>
      <li>If the resolution signals incompatibility, then the state access fails with an exception.</li>
    </ul>
  </li>
</ol>

<h4 id="heap-state-backends-eg-memorystatebackend-fsstatebackend">Heap state backends (e.g. <code class="highlighter-rouge">MemoryStateBackend</code>, <code class="highlighter-rouge">FsStateBackend</code>)</h4>

<ol>
  <li><strong>Register new state with a state serializer that has schema <em>A</em></strong>
    <ul>
      <li>the registered <code class="highlighter-rouge">TypeSerializer</code> is maintained by the state backend.</li>
    </ul>
  </li>
  <li><strong>Take a savepoint, serializing all state with schema <em>A</em></strong>
    <ul>
      <li>The serializer snapshot is extracted via the <code class="highlighter-rouge">TypeSerializer#snapshotConfiguration</code> method.</li>
      <li>The serializer snapshot is written to the savepoint.</li>
      <li>State objects are now serialized to the savepoint, written in schema <em>A</em>.</li>
    </ul>
  </li>
  <li><strong>On restore, deserialize state into objects in heap</strong>
    <ul>
      <li>The previous state serializer’s snapshot is restored.</li>
      <li>The previous serializer, which recognizes schema <em>A</em>, is obtained from the serializer snapshot, via
  <code class="highlighter-rouge">TypeSerializerSnapshot#restoreSerializer()</code>, and is used to deserialize state bytes to objects.</li>
      <li>From now on, all of the state is already deserialized.</li>
    </ul>
  </li>
  <li><strong>Restored execution re-accesses previous state with new state serializer that has schema <em>B</em></strong>
    <ul>
      <li>Upon receiving the new serializer, it is provided to the restored previous serializer’s snapshot via the
  <code class="highlighter-rouge">TypeSerializer#resolveSchemaCompatibility</code> to check for schema compatibility.</li>
      <li>If the compatibility check signals that migration is required, nothing happens in this case since for
   heap backends, all state is already deserialized into objects.</li>
      <li>If the resolution signals incompatibility, then the state access fails with an exception.</li>
    </ul>
  </li>
  <li><strong>Take another savepoint, serializing all state with schema <em>B</em></strong>
    <ul>
      <li>Same as step 2., but now state bytes are all in schema <em>B</em>.</li>
    </ul>
  </li>
</ol>

<h2 id="predefined-convenient-typeserializersnapshot-classes">Predefined convenient <code class="highlighter-rouge">TypeSerializerSnapshot</code> classes</h2>

<p>Flink provides two abstract base <code class="highlighter-rouge">TypeSerializerSnapshot</code> classes that can be used for typical scenarios:
<code class="highlighter-rouge">SimpleTypeSerializerSnapshot</code> and <code class="highlighter-rouge">CompositeTypeSerializerSnapshot</code>.</p>

<p>Serializers that provide these predefined snapshots as their serializer snapshot must always have their own, independent
subclass implementation. This corresponds to the best practice of not sharing snapshot classes
across different serializers, which is more thoroughly explained in the next section.</p>

<h3 id="implementing-a-simpletypeserializersnapshot">Implementing a <code class="highlighter-rouge">SimpleTypeSerializerSnapshot</code></h3>

<p>The <code class="highlighter-rouge">SimpleTypeSerializerSnapshot</code> is intended for serializers that do not have any state or configuration,
essentially meaning that the serialization schema of the serializer is solely defined by the serializer’s class.</p>

<p>There will only be 2 possible results of the compatibility resolution when using the <code class="highlighter-rouge">SimpleTypeSerializerSnapshot</code>
as your serializer’s snapshot class:</p>

<ul>
  <li><code class="highlighter-rouge">TypeSerializerSchemaCompatibility.compatibleAsIs()</code>, if the new serializer class remains identical, or</li>
  <li><code class="highlighter-rouge">TypeSerializerSchemaCompatibility.incompatible()</code>, if the new serializer class is different then the previous one.</li>
</ul>

<p>Below is an example of how the <code class="highlighter-rouge">SimpleTypeSerializerSnapshot</code> is used, using Flink’s <code class="highlighter-rouge">IntSerializer</code> as an example:</p>
<div data-lang="java">

  <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">IntSerializerSnapshot</span> <span class="kd">extends</span> <span class="nc">SimpleTypeSerializerSnapshot</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nf">IntSerializerSnapshot</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="nc">IntSerializer</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

</div>

<p>The <code class="highlighter-rouge">IntSerializer</code> has no state or configurations. Serialization format is solely defined by the serializer
class itself, and can only be read by another <code class="highlighter-rouge">IntSerializer</code>. Therefore, it suits the use case of the
<code class="highlighter-rouge">SimpleTypeSerializerSnapshot</code>.</p>

<p>The base super constructor of the <code class="highlighter-rouge">SimpleTypeSerializerSnapshot</code> expects a <code class="highlighter-rouge">Supplier</code> of instances
of the corresponding serializer, regardless of whether the snapshot is currently being restored or being written during
snapshots. That supplier is used to create the restore serializer, as well as type checks to verify that the
new serializer is of the same expected serializer class.</p>

<h3 id="implementing-a-compositetypeserializersnapshot">Implementing a <code class="highlighter-rouge">CompositeTypeSerializerSnapshot</code></h3>

<p>The <code class="highlighter-rouge">CompositeTypeSerializerSnapshot</code> is intended for serializers that rely on multiple nested serializers for serialization.</p>

<p>Before further explanation, we call the serializer, which relies on multiple nested serializer(s), as the “outer” serializer in this context.
Examples for this could be <code class="highlighter-rouge">MapSerializer</code>, <code class="highlighter-rouge">ListSerializer</code>, <code class="highlighter-rouge">GenericArraySerializer</code>, etc.
Consider the <code class="highlighter-rouge">MapSerializer</code>, for example - the key and value serializers would be the nested serializers,
while <code class="highlighter-rouge">MapSerializer</code> itself is the “outer” serializer.</p>

<p>In this case, the snapshot of the outer serializer should also contain snapshots of the nested serializers, so that
the compatibility of the nested serializers can be independently checked. When resolving the compatibility of the
outer serializer, the compatibility of each nested serializer needs to be considered.</p>

<p><code class="highlighter-rouge">CompositeTypeSerializerSnapshot</code> is provided to assist in the implementation of snapshots for these kind of
composite serializers. It deals with reading and writing the nested serializer snapshots, as well as resolving
the final compatibility result taking into account the compatibility of all nested serializers.</p>

<p>Below is an example of how the <code class="highlighter-rouge">CompositeTypeSerializerSnapshot</code> is used, using Flink’s <code class="highlighter-rouge">MapSerializer</code> as an example:</p>
<div data-lang="java">

  <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MapSerializerSnapshot</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span> <span class="no">V</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="nc">CompositeTypeSerializerSnapshot</span><span class="o">&lt;</span><span class="nc">Map</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span> <span class="no">V</span><span class="o">&gt;,</span> <span class="nc">MapSerializer</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">CURRENT_VERSION</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">MapSerializerSnapshot</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="nc">MapSerializer</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">MapSerializerSnapshot</span><span class="o">(</span><span class="nc">MapSerializer</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span> <span class="no">V</span><span class="o">&gt;</span> <span class="n">mapSerializer</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">mapSerializer</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getCurrentOuterSnapshotVersion</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="no">CURRENT_VERSION</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="nc">MapSerializer</span> <span class="nf">createOuterSerializerWithNestedSerializers</span><span class="o">(</span><span class="nc">TypeSerializer</span><span class="o">&lt;?&gt;[]</span> <span class="n">nestedSerializers</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">TypeSerializer</span><span class="o">&lt;</span><span class="no">K</span><span class="o">&gt;</span> <span class="n">keySerializer</span> <span class="o">=</span> <span class="o">(</span><span class="nc">TypeSerializer</span><span class="o">&lt;</span><span class="no">K</span><span class="o">&gt;)</span> <span class="n">nestedSerializers</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
        <span class="nc">TypeSerializer</span><span class="o">&lt;</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">valueSerializer</span> <span class="o">=</span> <span class="o">(</span><span class="nc">TypeSerializer</span><span class="o">&lt;</span><span class="no">V</span><span class="o">&gt;)</span> <span class="n">nestedSerializers</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nc">MapSerializer</span><span class="o">&lt;&gt;(</span><span class="n">keySerializer</span><span class="o">,</span> <span class="n">valueSerializer</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="nc">TypeSerializer</span><span class="o">&lt;?&gt;[]</span> <span class="n">getNestedSerializers</span><span class="o">(</span><span class="nc">MapSerializer</span> <span class="n">outerSerializer</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nc">TypeSerializer</span><span class="o">&lt;?&gt;[]</span> <span class="o">{</span> <span class="n">outerSerializer</span><span class="o">.</span><span class="na">getKeySerializer</span><span class="o">(),</span> <span class="n">outerSerializer</span><span class="o">.</span><span class="na">getValueSerializer</span><span class="o">()</span> <span class="o">};</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

</div>

<p>When implementing a new serializer snapshot as a subclass of <code class="highlighter-rouge">CompositeTypeSerializerSnapshot</code>,
the following three methods must be implemented:</p>
<ul>
  <li><code class="highlighter-rouge">#getCurrentOuterSnapshotVersion()</code>: This method defines the version of
the current outer serializer snapshot’s serialized binary format.</li>
  <li><code class="highlighter-rouge">#getNestedSerializers(TypeSerializer)</code>: Given the outer serializer, returns its nested serializers.</li>
  <li><code class="highlighter-rouge">#createOuterSerializerWithNestedSerializers(TypeSerializer[])</code>:
Given the nested serializers, create an instance of the outer serializer.</li>
</ul>

<p>The above example is a <code class="highlighter-rouge">CompositeTypeSerializerSnapshot</code> where there are no extra information to be snapshotted
apart from the nested serializers’ snapshots. Therefore, its outer snapshot version can be expected to never
require an uptick. Some other serializers, however, contains some additional static configuration
that needs to be persisted along with the nested component serializer. An example for this would be Flink’s
<code class="highlighter-rouge">GenericArraySerializer</code>, which contains as configuration the class of the array element type, besides
the nested element serializer.</p>

<p>In these cases, an additional three methods need to be implemented on the <code class="highlighter-rouge">CompositeTypeSerializerSnapshot</code>:</p>
<ul>
  <li><code class="highlighter-rouge">#writeOuterSnapshot(DataOutputView)</code>: defines how the outer snapshot information is written.</li>
  <li><code class="highlighter-rouge">#readOuterSnapshot(int, DataInputView, ClassLoader)</code>: defines how the outer snapshot information is read.</li>
  <li><code class="highlighter-rouge">#resolveOuterSchemaCompatibility(TypeSerializer)</code>: checks the compatibility based on the outer snapshot information.</li>
</ul>

<p>By default, the <code class="highlighter-rouge">CompositeTypeSerializerSnapshot</code> assumes that there isn’t any outer snapshot information to
read / write, and therefore have empty default implementations for the above methods. If the subclass
has outer snapshot information, then all three methods must be implemented.</p>

<p>Below is an example of how the <code class="highlighter-rouge">CompositeTypeSerializerSnapshot</code> is used for composite serializer snapshots
that do have outer snapshot information, using Flink’s <code class="highlighter-rouge">GenericArraySerializer</code> as an example:</p>

<div data-lang="java">

  <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">GenericArraySerializerSnapshot</span><span class="o">&lt;</span><span class="no">C</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="nc">CompositeTypeSerializerSnapshot</span><span class="o">&lt;</span><span class="no">C</span><span class="o">[],</span> <span class="nc">GenericArraySerializer</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">CURRENT_VERSION</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">Class</span><span class="o">&lt;</span><span class="no">C</span><span class="o">&gt;</span> <span class="n">componentClass</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">GenericArraySerializerSnapshot</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="nc">GenericArraySerializer</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">GenericArraySerializerSnapshot</span><span class="o">(</span><span class="nc">GenericArraySerializer</span><span class="o">&lt;</span><span class="no">C</span><span class="o">&gt;</span> <span class="n">genericArraySerializer</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">genericArraySerializer</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">componentClass</span> <span class="o">=</span> <span class="n">genericArraySerializer</span><span class="o">.</span><span class="na">getComponentClass</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">int</span> <span class="nf">getCurrentOuterSnapshotVersion</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="no">CURRENT_VERSION</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">writeOuterSnapshot</span><span class="o">(</span><span class="nc">DataOutputView</span> <span class="n">out</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="n">out</span><span class="o">.</span><span class="na">writeUTF</span><span class="o">(</span><span class="n">componentClass</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">readOuterSnapshot</span><span class="o">(</span><span class="kt">int</span> <span class="n">readOuterSnapshotVersion</span><span class="o">,</span> <span class="nc">DataInputView</span> <span class="n">in</span><span class="o">,</span> <span class="nc">ClassLoader</span> <span class="n">userCodeClassLoader</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">componentClass</span> <span class="o">=</span> <span class="nc">InstantiationUtil</span><span class="o">.</span><span class="na">resolveClassByName</span><span class="o">(</span><span class="n">in</span><span class="o">,</span> <span class="n">userCodeClassLoader</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">boolean</span> <span class="nf">resolveOuterSchemaCompatibility</span><span class="o">(</span><span class="nc">GenericArraySerializer</span> <span class="n">newSerializer</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">componentClass</span> <span class="o">==</span> <span class="n">newSerializer</span><span class="o">.</span><span class="na">getComponentClass</span><span class="o">())</span>
            <span class="o">?</span> <span class="nc">OuterSchemaCompatibility</span><span class="o">.</span><span class="na">COMPATIBLE_AS_IS</span>
            <span class="o">:</span> <span class="nc">OuterSchemaCompatibility</span><span class="o">.</span><span class="na">INCOMPATIBLE</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="nc">GenericArraySerializer</span> <span class="nf">createOuterSerializerWithNestedSerializers</span><span class="o">(</span><span class="nc">TypeSerializer</span><span class="o">&lt;?&gt;[]</span> <span class="n">nestedSerializers</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">TypeSerializer</span><span class="o">&lt;</span><span class="no">C</span><span class="o">&gt;</span> <span class="n">componentSerializer</span> <span class="o">=</span> <span class="o">(</span><span class="nc">TypeSerializer</span><span class="o">&lt;</span><span class="no">C</span><span class="o">&gt;)</span> <span class="n">nestedSerializers</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nc">GenericArraySerializer</span><span class="o">&lt;&gt;(</span><span class="n">componentClass</span><span class="o">,</span> <span class="n">componentSerializer</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="nc">TypeSerializer</span><span class="o">&lt;?&gt;[]</span> <span class="n">getNestedSerializers</span><span class="o">(</span><span class="nc">GenericArraySerializer</span> <span class="n">outerSerializer</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nc">TypeSerializer</span><span class="o">&lt;?&gt;[]</span> <span class="o">{</span> <span class="n">outerSerializer</span><span class="o">.</span><span class="na">getComponentSerializer</span><span class="o">()</span> <span class="o">};</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

</div>

<p>There are two important things to notice in the above code snippet. First of all, since this
<code class="highlighter-rouge">CompositeTypeSerializerSnapshot</code> implementation has outer snapshot information that is written as part of the snapshot,
the outer snapshot version, as defined by <code class="highlighter-rouge">getCurrentOuterSnapshotVersion()</code>, must be upticked whenever the
serialization format of the outer snapshot information changes.</p>

<p>Second of all, notice how we avoid using Java serialization when writing the component class, by only writing
the classname and dynamically loading it when reading back the snapshot. Avoiding Java serialization for writing
contents of serializer snapshots is in general a good practice to follow. More details about this is covered in the
next section.</p>

<h2 id="implementation-notes-and-best-practices">Implementation notes and best practices</h2>

<h4 id="1-flink-restores-serializer-snapshots-by-instantiating-them-with-their-classname">1. Flink restores serializer snapshots by instantiating them with their classname</h4>

<p>A serializer’s snapshot, being the single source of truth for how a registered state was serialized, serves as an
entry point to reading state in savepoints. In order to be able to restore and access previous state, the previous state
serializer’s snapshot must be able to be restored.</p>

<p>Flink restores serializer snapshots by first instantiating the <code class="highlighter-rouge">TypeSerializerSnapshot</code> with its classname (written
along with the snapshot bytes). Therefore, to avoid being subject to unintended classname changes or instantiation
failures, <code class="highlighter-rouge">TypeSerializerSnapshot</code> classes should:</p>

<ul>
  <li>avoid being implemented as anonymous classes or nested classes,</li>
  <li>have a public, nullary constructor for instantiation</li>
</ul>

<h4 id="2-avoid-sharing-the-same-typeserializersnapshot-class-across-different-serializers">2. Avoid sharing the same <code class="highlighter-rouge">TypeSerializerSnapshot</code> class across different serializers</h4>

<p>Since schema compatibility checks goes through the serializer snapshots, having multiple serializers returning
the same <code class="highlighter-rouge">TypeSerializerSnapshot</code> class as their snapshot would complicate the implementation for the
<code class="highlighter-rouge">TypeSerializerSnapshot#resolveSchemaCompatibility</code> and <code class="highlighter-rouge">TypeSerializerSnapshot#restoreSerializer()</code> method.</p>

<p>This would also be a bad separation of concerns; a single serializer’s serialization schema,
configuration, as well as how to restore it, should be consolidated in its own dedicated <code class="highlighter-rouge">TypeSerializerSnapshot</code> class.</p>

<h4 id="3-avoid-using-java-serialization-for-serializer-snapshot-content">3. Avoid using Java serialization for serializer snapshot content</h4>

<p>Java serialization should not be used at all when writing contents of a persisted serializer snapshot.
Take for example, a serializer which needs to persist a class of its target type as part of its snapshot.
Information about the class should be persisted by writing the class name, instead of directly serializing the class
using Java. When reading the snapshot, the class name is read, and used to dynamically load the class via the name.</p>

<p>This practice ensures that serializer snapshots can always be safely read. In the above example, if the type class
was persisted using Java serialization, the snapshot may no longer be readable once the class implementation has changed
and is no longer binary compatible according to Java serialization specifics.</p>

<h2 id="migrating-from-deprecated-serializer-snapshot-apis-before-flink-17">Migrating from deprecated serializer snapshot APIs before Flink 1.7</h2>

<p>This section is a guide for API migration from serializers and serializer snapshots that existed before Flink 1.7.</p>

<p>Before Flink 1.7, serializer snapshots were implemented as a <code class="highlighter-rouge">TypeSerializerConfigSnapshot</code> (which is now deprecated,
and will eventually be removed in the future to be fully replaced by the new <code class="highlighter-rouge">TypeSerializerSnapshot</code> interface).
Moreover, the responsibility of serializer schema compatibility checks lived within the <code class="highlighter-rouge">TypeSerializer</code>,
implemented in the <code class="highlighter-rouge">TypeSerializer#ensureCompatibility(TypeSerializerConfigSnapshot)</code> method.</p>

<p>Another major difference between the new and old abstractions is that the deprecated <code class="highlighter-rouge">TypeSerializerConfigSnapshot</code>
did not have the capability of instantiating the previous serializer. Therefore, in the case where your serializer
still returns a subclass of <code class="highlighter-rouge">TypeSerializerConfigSnapshot</code> as its snapshot, the serializer instance itself will always
be written to savepoints using Java serialization so that the previous serializer may be available at restore time.
This is very undesirable, since whether or not restoring the job will be successful is susceptible to availability
of the previous serializer’s class, or in general, whether or not the serializer instance can be read back at restore
time using Java serialization. This means that you be limited to the same serializer for your state,
and could be problematic once you want to upgrade serializer classes or perform schema migration.</p>

<p>To be future-proof and have flexibility to migrate your state serializers and schema, it is highly recommended to
migrate from the old abstractions. The steps to do this is as follows:</p>

<ol>
  <li>Implement a new subclass of <code class="highlighter-rouge">TypeSerializerSnapshot</code>. This will be the new snapshot for your serializer.</li>
  <li>Return the new <code class="highlighter-rouge">TypeSerializerSnapshot</code> as the serializer snapshot for your serializer in the
 <code class="highlighter-rouge">TypeSerializer#snapshotConfiguration()</code> method.</li>
  <li>Restore the job from the savepoint that existed before Flink 1.7, and then take a savepoint again.
 Note that at this step, the old <code class="highlighter-rouge">TypeSerializerConfigSnapshot</code> of the serializer must still exist in the classpath,
 and the implementation for the <code class="highlighter-rouge">TypeSerializer#ensureCompatibility(TypeSerializerConfigSnapshot)</code> method must not be
 removed. The purpose of this process is to replace the <code class="highlighter-rouge">TypeSerializerConfigSnapshot</code> written in old savepoints
 with the newly implemented <code class="highlighter-rouge">TypeSerializerSnapshot</code> for the serializer.</li>
  <li>Once you have a savepoint taken with Flink 1.7, the savepoint will contain <code class="highlighter-rouge">TypeSerializerSnapshot</code> as the
 state serializer snapshot, and the serializer instance will no longer be written in the savepoint.
 At this point, it is now safe to remove all implementations of the old abstraction (remove the old
 <code class="highlighter-rouge">TypeSerializerConfigSnapshot</code> implementation as will as the
 <code class="highlighter-rouge">TypeSerializer#ensureCompatibility(TypeSerializerConfigSnapshot)</code> from the serializer).</li>
</ol>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>



<div class="footer">
  <a href="https://cwiki.apache.org/confluence/display/FLINK/Flink+Translation+Specifications" target="_blank">
    
      想参与贡献翻译？
    
  </a>
</div>


        </div>
      </div>
    </div><!-- /.container -->

    <!-- default code tab -->
    <script>var defaultCodeTab = "";</script>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/js/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.1.0/anchor.min.js"></script>
    <script src="//ci.apache.org/projects/flink/flink-docs-release-1.12/page/js/flink.js"></script>

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-52545728-1', 'auto');
      ga('send', 'pageview');
    </script>

    <!-- Disqus -->
    
  </body>
</html>
